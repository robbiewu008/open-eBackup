#最终的可执行文件名
ifeq ($(strip $(ordtype)), KMC)
NAME = libKMC
else ifeq ($(strip $(ordtype)), SDP)
NAME = libSDP
endif
 
ifeq ($(strip $(libtype)), shared)
TARGETLIBS	 = $(NAME).so
else ifeq ($(strip $(libtype)), static)
TARGETLIBS	 = $(NAME).a
else
TARGETLIBS   = $(NAME)
endif
 
#可执行文件依赖的所有.o文件
ifeq ($(strip $(ordtype)), KMC)
OBJECTS = $(patsubst %.c,%.o,$(wildcard $(WORK_DIR)/platform/kmcv1/src/kmc/*.c))
OBJECTS += $(patsubst %.c,%.o,$(wildcard $(WORK_DIR)/platform/kmcv1/src/common/*.c))
OBJECTS += $(patsubst %.c,%.o,$(wildcard $(WORK_DIR)/platform/kmcv1/src/cac/*.c))
OBJECTS += $(patsubst %.c,%.o,$(wildcard $(WORK_DIR)/platform/kmcv1/src/mip/linux/*.c))
OBJECTS += $(patsubst %.c,%.o,$(wildcard $(WORK_DIR)/platform/kmcv1/src/mip/other/*.c))
 
LIBRARY_NAME += -ldl
LINK_KMCLIB =
else ifeq ($(strip $(ordtype)), SDP)
OBJECTS += $(patsubst %.c,%.o,$(wildcard $(WORK_DIR)/platform/kmcv1/src/sdp/*.c))
 
LIBRARY_NAME += -lsecurec  -ldl
LINK_KMCLIB = -L ./lib -lKMC
CFLAGS += -DWSEC_COMPILE_SDP
endif
 
 
.PHNOY: all
all:$(TARGETLIBS) 
 
$(TARGETLIBS):$(OBJECTS) 
ifeq ($(strip $(libtype)), static)
	$(AR) lib/$(TARGETLIBS) $(OBJECTS)
else ifeq ($(strip $(libtype)), shared)
	$(CC) $^  -o  lib/$@  -lc  $(LIBRARY_PATH) $(LIBRARY_NAME) $(LINK_KMCLIB) -shared -Wl,-z,now  -Wl,-Bsymbolic -Wl,-z,relro -Wl,-z,noexecstack -fPIC
else
	$(CXX) $^ -o lib/$@ -lpthread $(LIBRARY_PATH) $(LIBRARY_NAME) $(KMCLIB)
endif
	-rm -rf ${OBJECTS}
 
%.o:%.c 
	${CC}  ${INCLUDE_PATH}  $(CFLAGS) -c $< -o $@ 
 
%.obj:%.cpp
	${CXX} ${INCLUDE_PATH} ${CXXFLAGS} -c $< -o $@ 
	
 
.PHNOY : clean
 clean:
	-rm -rf  lib/$(TARGETLIBS)  $(OBJECTS)  Warnning.txt ../src/common/*.d  ../src/sdp/*.d  ../src/cac/*.d  ../src/kmcv1/*.d