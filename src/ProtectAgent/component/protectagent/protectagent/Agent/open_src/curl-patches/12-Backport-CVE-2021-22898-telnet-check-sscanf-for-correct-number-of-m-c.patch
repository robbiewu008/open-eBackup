From 2a3cda1d05d0be65a5d43e97c9b8adb923b6e743 Mon Sep 17 00:00:00 2001
From: jiahuasheng <jiahuasheng@huawei.com>
Date: Wed, 26 May 2021 20:16:40 +0800
Subject: [PATCH] [Backport] telnet: check sscanf() for correct number of
CVE: CVE-2021-22898
Reference: https://github.com/curl/curl/commit/39ce47f219b09c380b81f89fe54ac586c8db6bde
---
 lib/telnet.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/lib/telnet.c b/lib/telnet.c
index 1fc5af1..ea6bc71 100644
--- a/lib/telnet.c
+++ b/lib/telnet.c
@@ -967,7 +967,7 @@ static void suboption(struct connectdata *conn)
         size_t tmplen = (strlen(v->data) + 1);
         /* Add the variable only if it fits */
         if(len + tmplen < (int)sizeof(temp)-6) {
-          if(sscanf(v->data, "%127[^,],%127s", varname, varval)) {
+          if(sscanf(v->data, "%127[^,],%127s", varname, varval) == 2) {
             msnprintf((char *)&temp[len], sizeof(temp) - len,
                       "%c%s%c%s", CURL_NEW_ENV_VAR, varname,
                       CURL_NEW_ENV_VALUE, varval);
-- 
2.1.4

