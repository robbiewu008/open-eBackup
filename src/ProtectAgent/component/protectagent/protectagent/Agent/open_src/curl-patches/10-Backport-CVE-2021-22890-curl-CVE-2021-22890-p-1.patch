From a30f4560b332a10059c57e554ef82953470d93bf Mon Sep 17 00:00:00 2001
From: <niujiaming@huawei.com>
Date: Tue, 13 Apr 2021 15:03:45 +0800
Subject: [PATCH] =?UTF-8?q?[Backport]=E4=BF=AE=E5=A4=8Dcurl=E5=BC=80?=
CVE:CVE-2021-22890
Reference:https://github.com/curl/curl/commit/b09c8ee15771c614c4bf3ddac893cdb12187c844
---
 lib/vtls/schannel.c | 2 +-
 lib/vtls/vtls.c     | 2 +-
 lib/vtls/vtls.h     | 4 ++--
 3 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/lib/vtls/schannel.c b/lib/vtls/schannel.c
index f035858..3e7f0bf 100644
--- a/lib/vtls/schannel.c
+++ b/lib/vtls/schannel.c
@@ -1406,7 +1406,7 @@ schannel_connect_step3(struct connectdata *conn, int sockindex)
     struct curl_schannel_cred *old_cred = NULL;
 
     Curl_ssl_sessionid_lock(conn);
-    incache = !(Curl_ssl_getsessionid(conn, isproxy,(void **)&old_cred,
+    incache = !(Curl_ssl_getsessionid(conn, isproxy, (void **)&old_cred,
                                       NULL, sockindex));
     if(incache) {
       if(old_cred != BACKEND->cred) {
diff --git a/lib/vtls/vtls.c b/lib/vtls/vtls.c
index b7e2c9e..e50fdd2 100644
--- a/lib/vtls/vtls.c
+++ b/lib/vtls/vtls.c
@@ -477,7 +477,7 @@ void Curl_ssl_delsessionid(struct connectdata *conn, void *ssl_sessionid)
  * later on.
  */
 CURLcode Curl_ssl_addsessionid(struct connectdata *conn,
-                               bool isProxy;
+                               bool isProxy,
                                void *ssl_sessionid,
                                size_t idsize,
                                int sockindex)
diff --git a/lib/vtls/vtls.h b/lib/vtls/vtls.h
index e03bd49..4fa047b 100644
--- a/lib/vtls/vtls.h
+++ b/lib/vtls/vtls.h
@@ -203,7 +203,7 @@ void Curl_ssl_sessionid_unlock(struct connectdata *conn);
  * under sessionid mutex).
  */
 bool Curl_ssl_getsessionid(struct connectdata *conn,
-                           const bool isproxy;
+                           const bool isproxy,
                            void **ssl_sessionid,
                            size_t *idsize, /* set 0 if unknown */
                            int sockindex);
@@ -213,7 +213,7 @@ bool Curl_ssl_getsessionid(struct connectdata *conn,
  * object with cache (e.g. incrementing refcount on success)
  */
 CURLcode Curl_ssl_addsessionid(struct connectdata *conn,
-                               const bool isproxy;
+                               const bool isproxy,
                                void *ssl_sessionid,
                                size_t idsize,
                                int sockindex);
-- 
2.1.4

