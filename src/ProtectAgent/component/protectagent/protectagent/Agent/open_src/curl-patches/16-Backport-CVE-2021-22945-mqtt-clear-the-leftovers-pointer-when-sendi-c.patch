From 9e3930b2771e6bb0bc6578096939e23032b2aff5 Mon Sep 17 00:00:00 2001
From: z2_ on hackerone <>
Date: Tue, 24 Aug 2021 09:50:33 +0200
Subject: [PATCH] [Backport] mqtt: clear the leftovers pointer when sending
CVE: CVE-2021-22945
Reference: https://github.com/curl/curl/commit/43157490a5054bd
---
 lib/mqtt.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/lib/mqtt.c b/lib/mqtt.c
index 86b22b8..aed6df8 100644
--- a/lib/mqtt.c
+++ b/lib/mqtt.c
@@ -123,6 +123,10 @@ static CURLcode mqtt_send(struct connectdata *conn,
     mq->sendleftovers = sendleftovers;
     mq->nsend = nsend;
   }
+  else {
+    mq->sendleftovers = NULL;
+    mq->nsend = 0;
+  }
   return result;
 }
 
-- 
2.1.4

