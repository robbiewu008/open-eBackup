<?xml version="1.0" encoding="UTF-8"?>
<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->


<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="openbackup.access.framework.resource.persistence.dao.VirtualResourceMapper">
    <resultMap id="BaseResultMap"
               type="openbackup.access.framework.resource.persistence.model.VirtualResourceResponsePo"
               autoMapping="true">
        <id column="uuid" property="uuid"/>
        <result column="vm_ip" property="vmIp"/>
        <result column="env_ip" property="envIp"/>
        <result column="link_status" property="linkStatus"/>
        <result column="capacity" property="capacity"/>
        <result column="free_space" property="freeSpace"/>
        <result column="uncommitted" property="uncommitted"/>
        <result column="mo_id" property="moId"/>
        <result column="children" property="children"/>
        <result column="is_template" property="isTemplate"/>
        <result column="alias_type" property="aliasType"/>
        <result column="alias_value" property="aliasValue"/>
        <result column="os_type" property="osType"/>
        <result column="tags" property="tags"/>
        <result column="instance_id" property="instanceId"/>
        <result column="name" property="name"/>
        <result column="type" property="type"/>
        <result column="user_id" property="userId"/>
        <result column="authorized_user" property="authorizedUser"/>
        <result column="sub_type" property="subType"/>
        <result column="source_type" property="sourceType"/>
        <result column="path" property="path"/>
        <result column="parent_name" property="parentName"/>
        <result column="parent_uuid" property="parentUuid"/>
        <result column="root_uuid" property="rootUuid"/>
        <result column="children_uuids" property="childrenUuids"/>
        <result column="discriminator" property="discriminator"/>
        <result column="created_time" property="createdTime"/>
        <result column="protection_status" property="protectionStatus"/>
        <result column="version" property="version"/>
        <result column="auth" property="auth"/>
    </resultMap>
    <select id="queryVirtualResource" resultMap="BaseResultMap">
        select A.*, B.* from virtual_resource A LEFT JOIN resources B ON A.uuid = B.uuid
                        where B.sub_type ='vim.VirtualMachine' and B.parent_uuid=#{uuid}
    </select>
</mapper>