<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="DC.Type" content="topic">
  <meta name="DC.Title" content="步骤1：注册MongoDB实例">
  <meta name="product" content="">
  <meta name="DC.Relation" scheme="URI" content="mongodb-0011.html">
  <meta name="prodname" content="">
  <meta name="version" content="">
  <meta name="brand" content="30-OceanProtect 备份一体机 1.5.0-1.6.0 帮助中心">
  <meta name="DC.Publisher" content="20240320">
  <meta name="prodname" content="csbs">
  <meta name="documenttype" content="usermanual">
  <meta name="DC.Format" content="XHTML">
  <meta name="DC.Identifier" content="mongodb-0012">
  <meta name="DC.Language" content="zh-cn">
  <link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
  <title>步骤1：注册MongoDB实例</title>
 </head>
 <body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px">
  <a name="mongodb-0012"></a><a name="mongodb-0012"></a>
  <h1 class="topictitle1">步骤1：注册MongoDB实例</h1>
  <div>
   <div class="section">
    <h4 class="sectiontitle">前提条件</h4>
    <p>注册MongoDB实例前，请确保实例中的每个节点都已安装ProtectAgent。</p>
   </div>
   <div class="section">
    <h4 class="sectiontitle">操作步骤</h4>
    <ol>
     <li><span>选择<span class="uicontrol" id="mongodb-0012__zh-cn_topic_0000001839142377_uicontrol9332164373910">“<span id="mongodb-0012__zh-cn_topic_0000001839142377_text11332943123919">保护</span> &gt; 大数据 &gt; MongoDB”</span>。</span></li>
     <li><span>单击<span class="uicontrol">“<span>注册</span>”</span>，注册MongoDB实例。</span></li>
     <li><span>注册对话框中选择实例类型。</span><p></p>
      <ul>
       <li>单实例
        <ol type="a">
         <li>配置数据库实例及其认证信息。<p>相关参数说明如<a href="#mongodb-0012__zh-cn_topic_0000001311214069_table241515964115">表1</a>所示。</p>
          <div class="tablenoborder">
           <a name="mongodb-0012__zh-cn_topic_0000001311214069_table241515964115"></a><a name="zh-cn_topic_0000001311214069_table241515964115"></a>
           <table cellpadding="4" cellspacing="0" summary="" id="mongodb-0012__zh-cn_topic_0000001311214069_table241515964115" frame="border" border="1" rules="all">
            <caption>
             <b>表1 </b>MongoDB单实例注册信息
            </caption>
            <colgroup>
             <col style="width:25.629999999999995%">
             <col style="width:74.37%">
            </colgroup>
            <thead align="left">
             <tr>
              <th align="left" class="cellrowborder" valign="top" width="25.629999999999995%" id="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.1"><p>参数</p></th>
              <th align="left" class="cellrowborder" valign="top" width="74.37%" id="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.2"><p>说明</p></th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.1 "><p><span>名称</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.2 "><p>实例名称。</p></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.1 "><p><span>主机</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.2 "><p>选择要注册的数据库主机。</p></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.1 "><p><span>端口</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.2 "><p>MongoDB实例的端口，默认为27101。</p> <p>以MongoDB 4.4版本为例，实例端口具体查询方式如下：</p>
               <ol id="mongodb-0012__ol1995818474123">
                <li id="mongodb-0012__li3958134711120">登录MongoDB实例所在主机。</li>
                <li id="mongodb-0012__li9710361385">执行下面命令查询配置文件所在目录。<pre class="screen" id="mongodb-0012__screen14205122183714">whereis mongodb.conf</pre></li>
                <li id="mongodb-0012__li416512351393">执行<strong id="mongodb-0012__b1016663515395">cd</strong>命令进入配置文件所在目录。
                 <div class="p" id="mongodb-0012__p168731640123910">
                  例如：
                  <pre class="screen" id="mongodb-0012__screen1383295712371">cd /opt/install/mongodb-linux-x86_64-rhel70-4.4.20/bin</pre>
                 </div></li>
                <li id="mongodb-0012__li11958144715125">执行下面命令，查看port参数取值。<pre class="screen" id="mongodb-0012__screen1487425333911">cat mongodb.conf</pre></li>
               </ol></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.1 "><p><span>认证方式</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.2 "><p>实例认证方式支持OS认证和数据库认证。</p>
               <ul>
                <li>OS认证：基于操作系统的认证。</li>
                <li>数据库认证：通过数据库管理员用户和数据库管理员密码进行认证。
                 <div class="note" id="mongodb-0012__note54212327530">
                  <span class="notetitle"> 说明： </span>
                  <div class="notebody">
                   <p id="mongodb-0012__p2042133245315">OS认证存在安全风险，建议选择数据库认证。</p>
                  </div>
                 </div></li>
               </ul> <p>查询实例认证方式，并根据查询结果确认此处如何选择。</p> <p>以MongoDB 4.4版本为例，查询方式如下：</p>
               <ol id="mongodb-0012__ol754021012185">
                <li id="mongodb-0012__li1933651181810">登录MongoDB实例所在主机。</li>
                <li id="mongodb-0012__li43361411201811">执行下面命令查询配置文件所在目录。<pre class="screen" id="mongodb-0012__screen13643194174210">whereis mongodb.conf</pre></li>
                <li id="mongodb-0012__li14336111151810">执行<strong id="mongodb-0012__b19336171131810">cd</strong>命令进入配置文件所在目录。
                 <div class="p" id="mongodb-0012__p102435573425">
                  例如：
                  <pre class="screen" id="mongodb-0012__screen18567102854219">cd /opt/install/mongodb-linux-x86_64-rhel70-4.4.20/bin</pre>
                 </div></li>
                <li id="mongodb-0012__li14011375597"><a name="mongodb-0012__li14011375597"></a><a name="li14011375597"></a>执行下面命令，查看配置文件中auth参数取值。<pre class="screen" id="mongodb-0012__screen5880540114513">cat mongodb.conf</pre> <p id="mongodb-0012__p19703447174514">回显如下：</p> <pre class="screen" id="mongodb-0012__screen710181324510">[root@localhost bin]# cat mongodb.conf
port=27101
dapath=/opt/mongodb/single/data
logpath=/opt/mongodb/single/log/single.log
logappend=true
journal=false
fork-true
bind_ip=0.0.0.0
wiredTigerCacheSizeGB=1
keyFile=/opt/mongodb/keyfile
auth=true</pre></li>
                <li id="mongodb-0012__li29891373451"><a name="mongodb-0012__li29891373451"></a><a name="li29891373451"></a>执行下面命令，查看MongoDB数据库使用的配置文件。回显中有mongodb.conf信息则表明MongoDB数据库启动的配置文件是mongodb.conf。<pre class="screen" id="mongodb-0012__screen1268612119483">ps -ef | grep mongodb.conf</pre></li>
                <li id="mongodb-0012__li59681418114815">如果<a href="#mongodb-0012__li14011375597">4</a>中的auth参数取值为true，<a href="#mongodb-0012__li29891373451">5</a>中回显信息中含有mongodb.conf，则为数据库认证，否则为OS认证。</li>
               </ol></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.1 "><p><span>数据库用户名</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.2 "><p>仅在认证方式为数据库认证时展示，数据库的管理员用户的名称。</p></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.1 "><p><span>数据库密码</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.2 "><p>仅在认证方式为数据库认证时展示，数据库管理员用户的密码。</p>
               <div class="note">
                <span class="notetitle"> 说明： </span>
                <div class="notebody">
                 <p>当密码中包含转义字符反斜杠“\”时会发生转义，注册时应输入转义后的实际密码。示例：转义前的实际密码为123\()456，转义后为123()456，则此处应输入123()456。</p>
                </div>
               </div></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.1 "><p><span>数据库安装目录</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.2 "><p><span style="color:#282B33;">请填写mongo、mongod、mongos文件所在的目录地址，如果未填写，则默认使用全局变量中配置的目录地址。</span></p></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.1 "><p><span>数据库工具安装目录</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.2 "><p><span style="color:#282B33;">请填写mongodump、mongorestore工具所在的目录地址，如果未填写，则默认使用全局变量中配置的工具目录地址。</span></p></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.1 "><p>日志备份</p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.1.1.1.2.2.3.1.2 "><p>如需对单实例进行日志备份，请以单节点副本集的形式开启Oplog，具体操作请参见<a href="mongodb-0069.html">以单节点副本集的形式开启Oplog</a>。</p></td>
             </tr>
            </tbody>
           </table>
          </div></li>
         <li>单击<span class="uicontrol">“确定”</span>。</li>
        </ol></li>
       <li>集群实例
        <ol type="a">
         <li>自定义实例名，并选择集群实例类型，包含：副本和分片。</li>
         <li>（可选）批量配置数据安装目录或批量配置数据库工具安装目录。配置完成后，可以为添加的所有节点配置数据库安装目录或数据库工具安装目录。</li>
         <li>添加集群实例下的节点，若需要添加多个节点，请单击“添加”，在对话框中添加集群实例下的所有节点。<p>相关参数说明如<a href="#mongodb-0012__table935220207402">表2</a>所示。</p>
          <div class="tablenoborder">
           <a name="mongodb-0012__table935220207402"></a><a name="table935220207402"></a>
           <table cellpadding="4" cellspacing="0" summary="" id="mongodb-0012__table935220207402" frame="border" border="1" rules="all">
            <caption>
             <b>表2 </b>MongoDB集群实例的节点信息
            </caption>
            <colgroup>
             <col style="width:25.629999999999995%">
             <col style="width:74.37%">
            </colgroup>
            <thead align="left">
             <tr>
              <th align="left" class="cellrowborder" valign="top" width="25.629999999999995%" id="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.1"><p>参数</p></th>
              <th align="left" class="cellrowborder" valign="top" width="74.37%" id="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.2"><p>说明</p></th>
             </tr>
            </thead>
            <tbody>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.1 "><p><span>主机</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.2 "><p>选择要注册的数据库主机。</p></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.1 "><p><span>端口</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.2 "><p>MongoDB实例的端口，默认为27101。</p> <p>以MongoDB 4.4版本为例，实例端口具体查询方式如下：</p>
               <ol>
                <li id="mongodb-0012__mongodb-0012_li3958134711120">登录MongoDB实例所在主机。</li>
                <li id="mongodb-0012__mongodb-0012_li9710361385">执行下面命令查询配置文件所在目录。<pre class="screen" id="mongodb-0012__mongodb-0012_screen14205122183714">whereis mongodb.conf</pre></li>
                <li id="mongodb-0012__mongodb-0012_li416512351393">执行<strong id="mongodb-0012__mongodb-0012_b1016663515395">cd</strong>命令进入配置文件所在目录。
                 <div class="p" id="mongodb-0012__mongodb-0012_p168731640123910">
                  例如：
                  <pre class="screen" id="mongodb-0012__mongodb-0012_screen1383295712371">cd /opt/install/mongodb-linux-x86_64-rhel70-4.4.20/bin</pre>
                 </div></li>
                <li id="mongodb-0012__mongodb-0012_li11958144715125">执行下面命令，查看port参数取值。<pre class="screen" id="mongodb-0012__mongodb-0012_screen1487425333911">cat mongodb.conf</pre></li>
               </ol></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.1 "><p><span>认证方式</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.2 "><p>实例认证方式支持OS认证和数据库认证。</p>
               <ul>
                <li>OS认证：基于操作系统的认证。</li>
                <li>数据库认证：通过数据库管理员用户和数据库管理员密码进行认证。
                 <div class="note">
                  <span class="notetitle"> 说明： </span>
                  <div class="notebody">
                   <p id="mongodb-0012__mongodb-0012_p2042133245315">OS认证存在安全风险，建议选择数据库认证。</p>
                  </div>
                 </div></li>
               </ul> <p>查询实例认证方式，并根据查询结果确认此处如何选择。</p> <p>以MongoDB 4.4版本为例，查询方式如下：</p>
               <ol>
                <li id="mongodb-0012__mongodb-0012_li1933651181810">登录MongoDB实例所在主机。</li>
                <li id="mongodb-0012__mongodb-0012_li43361411201811">执行下面命令查询配置文件所在目录。<pre class="screen" id="mongodb-0012__mongodb-0012_screen13643194174210">whereis mongodb.conf</pre></li>
                <li id="mongodb-0012__mongodb-0012_li14336111151810">执行<strong id="mongodb-0012__mongodb-0012_b19336171131810">cd</strong>命令进入配置文件所在目录。
                 <div class="p" id="mongodb-0012__mongodb-0012_p102435573425">
                  例如：
                  <pre class="screen" id="mongodb-0012__mongodb-0012_screen18567102854219">cd /opt/install/mongodb-linux-x86_64-rhel70-4.4.20/bin</pre>
                 </div></li>
                <li id="mongodb-0012__mongodb-0012_li14011375597"><a name="mongodb-0012__mongodb-0012_li14011375597"></a><a name="mongodb-0012_li14011375597"></a>执行下面命令，查看配置文件中auth参数取值。<pre class="screen" id="mongodb-0012__mongodb-0012_screen5880540114513">cat mongodb.conf</pre> <p id="mongodb-0012__mongodb-0012_p19703447174514">回显如下：</p> <pre class="screen" id="mongodb-0012__mongodb-0012_screen710181324510">[root@localhost bin]# cat mongodb.conf
port=27101
dapath=/opt/mongodb/single/data
logpath=/opt/mongodb/single/log/single.log
logappend=true
journal=false
fork-true
bind_ip=0.0.0.0
wiredTigerCacheSizeGB=1
keyFile=/opt/mongodb/keyfile
auth=true</pre></li>
                <li id="mongodb-0012__mongodb-0012_li29891373451"><a name="mongodb-0012__mongodb-0012_li29891373451"></a><a name="mongodb-0012_li29891373451"></a>执行下面命令，查看MongoDB数据库使用的配置文件。回显中有mongodb.conf信息则表明MongoDB数据库启动的配置文件是mongodb.conf。<pre class="screen" id="mongodb-0012__mongodb-0012_screen1268612119483">ps -ef | grep mongodb.conf</pre></li>
                <li id="mongodb-0012__mongodb-0012_li59681418114815">如果<a href="#mongodb-0012__mongodb-0012_li14011375597">4</a>中的auth参数取值为true，<a href="#mongodb-0012__mongodb-0012_li29891373451">5</a>中回显信息中含有mongodb.conf，则为数据库认证，否则为OS认证。</li>
               </ol></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.1 "><p><span>数据库用户名</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.2 "><p>仅在认证方式为数据库认证时展示，数据库的管理员用户的名称。</p></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.1 "><p><span>数据库密码</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.2 "><p>仅在认证方式为数据库认证时展示，数据库管理员用户的密码。</p>
               <div class="note">
                <span class="notetitle"> 说明： </span>
                <div class="notebody">
                 <p>当密码中包含转义字符反斜杠“\”时会发生转义，注册时应输入转义后的实际密码。示例：转义前的实际密码为123\()456，转义后为123()456，则此处应输入123()456。</p>
                </div>
               </div></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.1 "><p><span>数据库安装目录</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.2 "><p><span style="color:#282B33;">请填写mongo、mongod、mongos文件所在的目录地址，如果未填写，则默认使用全局变量中配置的目录地址。</span></p>
               <div class="note">
                <span class="notetitle"> 说明： </span>
                <div class="notebody">
                 <p>您可以单击<span class="uicontrol">“批量配置数据库安装目录”</span>，为所有节点批量配置数据库安装目录。</p>
                </div>
               </div></td>
             </tr>
             <tr>
              <td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.1 "><p><span>数据库工具安装目录</span></p></td>
              <td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.2.2.3.2.1.2.1.3.2.2.3.1.2 "><p><span style="color:#282B33;">请填写mongodump、mongorestore工具所在的目录地址，如果未填写，则默认使用全局变量中配置的工具目录地址。</span></p>
               <div class="note">
                <span class="notetitle"> 说明： </span>
                <div class="notebody">
                 <p>您可以单击<span class="uicontrol">“批量配置数据库工具安装目录”</span>，为所有节点批量配置数据库工具安装目录。</p>
                </div>
               </div></td>
             </tr>
            </tbody>
           </table>
          </div></li>
         <li>单击<span class="uicontrol">“添加”</span>，在节点区域中添加集群实例下的所有节点。</li>
         <li>单击<span class="uicontrol">“确定”</span>。</li>
        </ol></li>
      </ul> <p></p></li>
    </ol>
   </div>
  </div>
  <div>
   <div class="familylinks">
    <div class="parentlink">
     <strong>父主题：</strong> <a href="mongodb-0011.html">备份MongoDB数据库</a>
    </div>
   </div>
  </div>
 </body>
</html>