<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->


<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="安装客户端（手动方式，适用于Windows OS）">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ZH-CN_TOPIC_0000002200116849">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<title>安装客户端（手动方式，适用于Windows OS）</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="ZH-CN_TOPIC_0000002200116849"></a><a name="ZH-CN_TOPIC_0000002200116849"></a>

<h1 class="topictitle1">安装客户端（手动方式，适用于Windows OS）</h1>
<div><p><span id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_ph9864114785610">客户端作为<span id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_zh-cn_topic_0000002200116717_text5223175701015">OceanProtect</span>与生产环境之间的数据连接组件，在备份和恢复过程中进行流程控制和数据传输。在进行数据备份和恢复前，需在主机上安装客户端。</span>本节介绍通过登录待安装客户端的主机的后台，手动为其安装客户端。</p>
<div class="section"><h4 class="sectiontitle">注意事项</h4><p>如果待安装客户端的Windows OS主机为域控制器，且需要在该域上的多台域控制器上安装客户端时，请逐一为域控制器安装客户端。</p>
</div>
<div class="section"><h4 class="sectiontitle">前提条件</h4><ul><li>请确保主机上未安装客户端。可在主机上执行<strong>sc query rdagent</strong>命令查询，如果回显提示指定的服务未安装，则表示未安装客户端。</li><li>请确保主机上的“C:\mnt”目录未被挂载。可在主机上执行<strong>mountvol</strong>命令查看。</li><li>已获取需要安装客户端的主机的IP地址，该IP地址必须与<span id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_text17183577108">OceanProtect</span>的备份网络连通。</li><li>已获取登录主机的用户及其密码。</li><li>客户端、<span>OceanProtect</span>以及待安装客户端的主机操作系统的安装语言请保持一致，否则客户端或<span>OceanProtect</span>上可能会出现多种语言或乱码。当出现该类情况时，请重新安装相同语言的客户端、<span>OceanProtect</span>或更换操作系统语言。</li></ul>
</div>
<div class="section"><h4 class="sectiontitle">操作步骤</h4><ol><li><span>在<span>OceanProtect</span>管理界面下载客户端软件包，具体操作请参考<a href="zh-cn_topic_0000002200116889.html">下载客户端软件包</a>。</span><p><div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p>如果在Windows Server使用Internet Explorer 11下载客户端软件包失败，可参考<a href="zh-cn_topic_0000002164790160.html">在Windows Server使用Internet Explorer 11下载客户端软件包失败</a>进行处理。</p>
</div></div>
</p></li><li><span>确保待安装客户端的主机与<span>OceanProtect</span>设备时间一致。</span><p><ul><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_li11744161816202">对于OceanProtect X系列备份一体机，参考以下步骤查看<span id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_text3456181418112">OceanProtect</span>设备时间：<ol type="a" id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_zh-cn_topic_0000001143474500_zh-cn_topic_0000001142182722_zh-cn_topic_0000001187942849_zh-cn_topic_0000001087149498_zh-cn_topic_0000001087149498_ol2172145813485"><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_zh-cn_topic_0000001839223165_li84033442337">选择“系统 &gt; 基础设施 &gt; 集群管理”。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_li365813483918">在“备份集群”页签的“本地集群节点”区域，单击节点名称。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_zh-cn_topic_0000001143474500_zh-cn_topic_0000001142182722_zh-cn_topic_0000001187942849_zh-cn_topic_0000001087149498_zh-cn_topic_0000001087149498_li929117916361">在弹出的“节点详情”界面，查看当前设备时间。<p id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_zh-cn_topic_0000001143474500_zh-cn_topic_0000001142182722_zh-cn_topic_0000001187942849_zh-cn_topic_0000001087149498_zh-cn_topic_0000001087149498_p3985106145415"><a name="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_zh-cn_topic_0000001143474500_zh-cn_topic_0000001142182722_zh-cn_topic_0000001187942849_zh-cn_topic_0000001087149498_zh-cn_topic_0000001087149498_li929117916361"></a><a name="zh-cn_topic_0000002200116717_zh-cn_topic_0000001143474500_zh-cn_topic_0000001142182722_zh-cn_topic_0000001187942849_zh-cn_topic_0000001087149498_zh-cn_topic_0000001087149498_li929117916361"></a>如果时间不一致，请修改待安装客户端的主机的时间，否则可能导致客户端安装失败，具体操作请参考<a href="zh-cn_topic_0000002200116621.html">如何修改主机时区和时间</a>。</p>
</li></ol>
</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_li1073861222115">对于OceanProtect E6000备份一体机，参考以下步骤查看<span id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_text39191616182111">OceanProtect</span>设备时间：<ol type="a" id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_ol1526019271211"><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_li245195714204">选择“系统 &gt; 基础设施 &gt; 集群管理”。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_li4868122742112">在“集群管理”界面，单击“查看集群详情”。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_li1286812720216">在弹出的“集群详情”界面，查看当前设备时间。<p id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_p486992752111"><a name="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_li1286812720216"></a><a name="zh-cn_topic_0000002200116717_li1286812720216"></a>如果时间不一致，请修改待安装客户端的主机的时间，否则可能导致客户端安装失败，具体操作请参考<a href="zh-cn_topic_0000002200116621.html">如何修改主机时区和时间</a>。</p>
</li></ol>
</li></ul>
</p></li><li><span>如果待安装客户端的Windows OS主机为域控制器，且需要在该域上的多台域控制器上安装客户端时，请执行本步骤，删除<strong>rdadmin</strong>用户。否则，请跳过本步骤。</span><p><div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_p1917124811416">可在主机上执行<strong id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_b281795271912">wmic computersystem get domainrole /value</strong>命令查询主机是否为域控制器，如果回显为<span class="msgph" id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_msgph1571662219">DomainRole=4</span>或者<span class="msgph" id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116717_msgph119186106216">DomainRole=5</span>，则表示为域控制器。</p>
</div></div>
<ol type="a"><li>以系统管理员登录待安装客户端的主机。</li><li>在键盘上按<span class="uicontrol" id="ZH-CN_TOPIC_0000002200116849__oracle_gud_0016_uicontrol11819941114510">“Win+R”</span>，打开运行窗口。</li><li>输入<span class="parmvalue">“cmd”</span>，进入命令提示符窗口。</li><li>执行以下命令，删除<strong>rdadmin</strong>用户。<pre class="screen">net user rdadmin /delete</pre>
</li></ol>
</p></li><li><span>安装客户端。</span><p><ol type="a"><li>以<strong>Administrator</strong><strong>s</strong>用户组中的账户登录待安装客户端的主机。</li><li>上传客户端软件包至主机并解压。<div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p>软件包名称中不能包含空格，否则将导致客户端安装失败。</p>
</div></div>
</li><li>进入软件包目录，安装软件。<ol class="substepthirdol"><li>如需指定用于注册的业务IP地址，请执行本步骤。否则，请直接跳转至<a href="#ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000001143474500_zh-cn_topic_0000001142182722_zh-cn_topic_0000001084775528_li14880301717">4.c.ii</a>。<ol><li>进入“..\DataProtect_<em>xxx</em>_client_general_windows\DataProtect_<em>xxx</em>_client_general_windows\conf”目录，<em>xxx</em>为客户端的版本号。</li><li>打开“client.conf”文件，在“client.conf”文件末尾增加配置项<strong>eip=</strong><em>XXX.XXX.XXX.XXX</em>，其中<em>XXX.XXX.XXX.XXX</em>请替换为用于注册的业务IP地址。</li></ol>
</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000001143474500_zh-cn_topic_0000001142182722_zh-cn_topic_0000001084775528_li14880301717"><a name="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000001143474500_zh-cn_topic_0000001142182722_zh-cn_topic_0000001084775528_li14880301717"></a><a name="zh-cn_topic_0000001143474500_zh-cn_topic_0000001142182722_zh-cn_topic_0000001084775528_li14880301717"></a>进行软件安装。<ol><li>进入“..\DataProtect_<em>xxx</em>_client_general_windows\DataProtect_<em>xxx</em>_client_general_windows”目录，<em>xxx</em>为客户端的版本号。</li><li>双击<span class="uicontrol">“install.bat”</span>，根据回显提示完成软件安装。<ol type="a"><li>当回显如下信息时，请根据提示输入客户端的安装目录。如果不输入直接按<span class="uicontrol">“Enter”</span>，则默认安装在<span class="filepath">“C:”</span>。<pre class="screen">"You need to enter the installation path (directly press 'Enter' use default installation path C:)."
Please enter custom install path:</pre>
</li><li>当回显类似如下信息时，请确认待安装客户端的主机与<span>OceanProtect</span>设备时间一致，并输入<span class="parmvalue">“y”</span>。<pre class="screen">The current host time and time zone are Thu 08/17/2023 17:17:34.87. Check whether the time and time zone are the same as those on DataBackup time:(y|n):
Your choice:</pre>
</li><li>当回显如下信息时，请输入下载客户端软件包时设置的私钥密码。<pre class="screen">Please enter the private key password set on ProtectManager, you still have 3 chances:
Enter password:</pre>
</li><li>当回显如下信息时，设置<strong>rdadmin</strong>用户的密码。<pre class="screen">Add User rdadmin Enter password:</pre>
<div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"></div></div>
</li><li>对于1.5.0SPC19及后续版本，当回显如下信息时，请选择是否开启源端重删功能。<pre class="screen">Whether enable dataturbo service:(y|n):
Your choice:</pre>
<p>如果输入<span class="parmvalue">“y”</span>，则开启源端重删功能，请确保待安装客户端的主机的空闲内存大于2GB，系统会自动安装OceanStor DataTurbo。支持源端重删的操作系统请查看<a href="https://info.support.huawei.com/storage/comp/#/oceanprotect" target="_blank" rel="noopener noreferrer">OceanProtect兼容性查询</a>工具。</p>
<p>如果输入<span class="parmvalue">“n”</span>，则不开启源端重删功能。在客户端安装完成后也可手动安装OceanStor DataTurbo，具体操作请参考<a href="zh-cn_topic_0000002200031329.html">安装OceanStor DataTurbo</a>章节。</p>
<div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p><span>如果后续会为该客户端配置LAN-Free，请开启此功能。</span></p>
<p>开启源端重删后，系统会自动在客户端所在主机安装OceanStor DataTurbo并创建<strong>dataturbo</strong>用户，该用户的用户目录为“C:\Users\dataturbo”。请勿删除或修改此用户及用户目录。</p>
<p><span>开启源端重删功能后，请将system用户的SID（S-1-5-18）添加到<span class="filepath" id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200031329_filepath8365201855911">“...\oceanstor\dataturbo\conf\whitelist”</span>白名单中，并依次执行<strong id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200031329_zh-cn_topic_0000001607704830_b16198172917816">sc stop dataturbo</strong>和<strong id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200031329_b1516780194917">sc start dataturbo</strong>命令重启DataTurbo服务。</span></p>
</div></div>
</li><li>对于1.5.0SPC19及后续版本，当回显如下信息时，请根据实际场景选择是否使用EIP（Elastic IP）或NAT（Network Address Translation）转换后的IP地址。<div class="p">如果为EIP映射到虚拟私有云（VPC）IP场景，请输入EIP；如果待安装客户端的主机与<span>OceanProtect</span>通过NAT转换进行通信，且转换后的IP地址与转换前的IP地址为一一对应，则请输入NAT转换后的IP地址。<pre class="screen">Check whether the agent ip will be redirected?(Such as EIP or the ip transformed by NAT):(y|n), default(n)
Your choice:</pre>
<div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><ul id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_ul125331052814"><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li35331702287"><span id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_zh-cn_topic_0000001839189313_ph163811744610">当已安装客户端，如果升级到1.5.0SPC19及后续版本且需使用映射到VPC IP的EIP或NAT转换后的IP地址，则请先参考<a href="zh-cn_topic_0000002164630332.html">卸载客户端</a>章节卸载客户端后，再重新执行本章节安装1.5.0SPC19及后续版本的客户端。</span></li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li248315212284">EIP（Elastic IP）：弹性IP是基于云外网络（以下简称外网，云外网络可以是外网Internet也可以是企业内部局域网）上的静态IP地址，是可以通过外网直接访问的IP地址，通过NAT方式映射到被绑定的实例上。</li></ul>
</div></div>
</div>
</li></ol>
<p>当回显如下信息时，表示安装客户端成功。</p>
<pre class="screen">The DataBackup ProtectAgent has been installed successfully.</pre>
</li></ol>
</li></ol>
</li></ol>
</p></li><li><span>如果安装客户端的Windows OS主机为域控制器，客户端安装成功后，请执行本步骤，更新该域其他已安装客户端的域控制器中以<strong>rdadmin</strong>用户登录的服务的密码。否则，请跳过本步骤。</span><p><ol type="a"><li>以系统管理员登录已安装客户端的主机。</li><li>在键盘上按<span class="uicontrol" id="ZH-CN_TOPIC_0000002200116849__oracle_gud_0016_uicontrol11819941114510_1">“Win+R”</span>，打开运行窗口。</li><li>输入<span class="parmvalue">“services.msc”</span>，打开服务窗口。</li><li>鼠标右键单击选择以<strong>rdadmin</strong>用户登录的服务，选择“属性”。</li><li>在“登录”页签更新密码，并单击“确定”。<p><span><img src="zh-cn_image_0000002214714888.png"></span></p>
</li><li>右键单击已更新<strong>rdadmin</strong>用户密码的服务，选择“重新启动”。<p>当服务状态为“正在运行”时，则表示更新成功。</p>
</li></ol>
</p></li><li><span>安装客户端后，<span id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_text1453912431623">OceanProtect</span>管理界面会自动发现该客户端，可执行以下操作进行检查。</span><p><ol type="a" id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_zh-cn_topic_0000001187942849_ol24016297360"><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_zh-cn_topic_0000001166356758_zh-cn_topic_0000001084775528_li10690245104713">选择<span class="uicontrol" id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_zh-cn_topic_0000002199964685_uicontrol08941439165212">“保护 &gt; 客户端 &gt; 客户端”</span>。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_zh-cn_topic_0000001187942849_li162702510381">查看已安装客户端的主机是否已存在于<span id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_text1857815461628">OceanProtect</span>管理界面。<div class="p" id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_zh-cn_topic_0000001187942849_p19934115894410">如果在<span id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_text16771165326">OceanProtect</span>管理界面上未发现已安装客户端的主机，请联系系统管理员为该用户进行资源授权。<ul id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_ul11315151683118"><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li7489102073110">对于1.5.0版本，请执行以下操作：<ol class="substepthirdol" id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_ol52668371313"><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_zh-cn_topic_0000001187942849_li13303622114615">在“客户端”界面该客户端所在行，单击<span class="uicontrol" id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_zh-cn_topic_0000001187942849_uicontrol183035225468">“<span id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_zh-cn_topic_0000001187942849_text18303422124612">更多</span> &gt; <span id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_zh-cn_topic_0000001187942849_text330392284615">资源授权</span>”</span>。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li12823859173115">将该客户端授权给相应的用户。</li></ol>
</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li1431512169316">对于1.6.0及后续版本，请执行以下操作：<ol class="substepthirdol" id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_ol156361033313"><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li2850165311349">选择“系统 &gt; 安全 &gt; RBAC”。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li17341115143513">在“用户”页签相应的用户所在行，单击“修改”。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li1660463123511">在“修改用户”界面，单击“下一步”。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li5421154015356">单击“创建资源集”。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li1749893713610"><a name="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li1749893713610"></a><a name="zh-cn_topic_0000002200116873_li1749893713610"></a>设置资源集名称，并在“客户端”页签选择对应的客户端。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li43218366416">单击“确定”。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li11991352174115">勾选<a href="#ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li1749893713610">6.b.v</a>中创建的资源集，并单击“下一步”。</li><li id="ZH-CN_TOPIC_0000002200116849__zh-cn_topic_0000002200116873_li11197205624116">单击“完成”。</li></ol>
</li></ul>
</div>
</li></ol>
</p></li></ol><ol start="7"><li><span>重复以上步骤为其他主机安装客户端。</span><p><div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p><span>主机注册成功后请等待5分钟再使用该客户端。</span></p>
</div></div>
</p></li></ol>
</div>
<div class="section"><h4 class="sectiontitle">后续操作</h4><p>成功安装客户端后，如果您需释放系统空间，可以删除软件包存放目录。</p>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">版权所有 &copy; 华为技术有限公司</div></body>
</html>