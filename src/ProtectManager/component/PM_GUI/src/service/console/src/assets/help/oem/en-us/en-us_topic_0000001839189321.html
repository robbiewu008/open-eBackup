<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="DC.Type" content="topic">
  <meta name="DC.Title" content="How Should I Add a Common User to sudoers?">
  <meta name="DC.Format" content="XHTML">
  <meta name="DC.Identifier" content="EN-US_TOPIC_0000001839189321">
  <meta name="DC.Language" content="en-us">
  <link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
  <title>How Should I Add a Common User to sudoers?</title>
 </head>
 <body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px">
  <a name="EN-US_TOPIC_0000001839189321"></a><a name="EN-US_TOPIC_0000001839189321"></a>
  <h1 class="topictitle1">How Should I Add a Common User to <strong>sudoers</strong>?</h1>
  <div>
   <p>When installing ProtectAgent in automatic push mode, if <span class="uicontrol"><b>User Type</b></span> is set to <span class="uicontrol"><b>Common User</b></span>, you need to add the common user to <strong>sudoers</strong> first. Otherwise, ProtectAgent registration will fail.</p>
   <div class="section">
    <h4 class="sectiontitle">Procedure</h4>
    <ol>
     <li><span>Log in to the agent host as user <strong>root</strong>.</span></li>
     <li><span>Run the following command to search for the directory of the <strong>sudoers</strong> configuration file:</span><p></p><pre class="screen">whereis sudoers</pre> <p></p></li>
     <li><span>Run the following command to change the permission on the <strong>sudoers</strong> configuration file:</span><p></p><pre class="screen">chmod u+w /etc/sudoers</pre> <p></p></li>
     <li><span>Back up the source file.</span><p></p><pre class="screen">mkdir /etc/backup_sudoers
cp /etc/sudoers /etc/backup_sudoers</pre> <p></p></li>
     <li id="EN-US_TOPIC_0000001839189321__li4145165012521"><a name="EN-US_TOPIC_0000001839189321__li4145165012521"></a><a name="li4145165012521"></a><span>Run the following command to open configuration file <strong>/etc/sudoers</strong>.</span><p></p><pre class="screen">vim /etc/sudoers</pre> <p></p></li>
     <li><span>Check whether the <span class="parmname"><b>Defaults requiretty</b></span> field exists in the configuration file. If yes, delete this configuration.</span></li>
     <li id="EN-US_TOPIC_0000001839189321__li188920444274"><a name="EN-US_TOPIC_0000001839189321__li188920444274"></a><a name="li188920444274"></a><span>Add the following content to the configuration file, save the modification, and exit.</span><p></p>
      <div class="p">
       Take common user <strong>common_user</strong> as an example. Replace it with the actual common username used for ProtectAgent installation.
       <ul>
        <li>If the sudo non-password-free mode is used, add the following content to the configuration file:<pre class="screen"><em>common_user</em>    ALL=(ALL)       /bin/sudo,/bin/command,/bin/date,/usr/bin/unzip,/usr/bin/xz,/usr/bin/touch,/usr/bin/vi,/usr/bin/mkdir,/usr/bin/sftp,/usr/bin/rm,/usr/bin/chown,/usr/bin/chmod,/bin/sh,/bin/bash *push_install_check.sh*,/bin/bash /{dir}/*,/bin/bash *register.sh*</pre> <p>Example:</p> <p><span><img src="en-us_image_0000001941788145.png"></span></p></li>
        <li>If the sudo password-free mode is used, add the following content to the configuration file:<pre class="screen"><em>common_user</em>    ALL=(ALL)       NOPASSWD:/bin/sudo,/bin/command,/bin/date,/usr/bin/unzip,/usr/bin/xz,/usr/bin/touch,/usr/bin/vi,/usr/bin/mkdir,/usr/bin/sftp,/usr/bin/rm,/usr/bin/chown,/usr/bin/chmod,/bin/sh,/bin/bash *push_install_check.sh*,/bin/bash /{dir}/*,/bin/bash *register.sh*</pre></li>
       </ul>
       <div class="note">
        <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
        <div class="notebody">
         <p>The preceding added content is divided into three columns in a row. The first and second columns are separated by four characters, and the second and third columns are separated by seven characters. If the preceding content copied to the configuration file contains line feed characters, manually delete the line feed characters.</p>
        </div>
       </div>
      </div> <p></p></li>
     <li><span>View the configuration file to check whether the <span class="parmname"><b>Defaults requiretty</b></span> field is deleted and whether the user added in <a href="#EN-US_TOPIC_0000001839189321__li188920444274">7</a> exists.</span><p></p><pre class="screen">cat /etc/sudoers</pre>
      <ul>
       <li>If the modification fails, roll back the configuration file. After confirming that the rollback is successful, repeat <a href="#EN-US_TOPIC_0000001839189321__li4145165012521">5</a> to <a href="#EN-US_TOPIC_0000001839189321__li188920444274">7</a>.<pre class="screen">cp /etc/backup_sudoers/sudoers /etc/sudoers
cat /etc/sudoers</pre></li>
       <li>If the modification is successful, delete the backup file.<pre class="screen">rm -fr /etc/backup_sudoers</pre></li>
      </ul> <p></p></li>
    </ol>
   </div>
  </div>
 </body>
</html>