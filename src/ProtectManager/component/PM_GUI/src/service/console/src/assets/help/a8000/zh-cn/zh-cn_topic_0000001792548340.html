
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="周期性执行备份">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="zh-cn_topic_0000001839267625.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="30-OceanProtect 备份一体机 1.5.0-1.6.0 帮助中心">
<meta name="DC.Publisher" content="20240320">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ZH-CN_TOPIC_0000001792548340">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<title>周期性执行备份</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="ZH-CN_TOPIC_0000001792548340"></a><a name="ZH-CN_TOPIC_0000001792548340"></a>

<h1 class="topictitle1">周期性执行备份</h1>
<div><p>将需要保护的资源关联到指定SLA策略，系统将对这些资源按照SLA策略进行保护。</p>
<div class="section"><h4 class="sectiontitle">注意事项</h4><p>单目录下备份文件数量超过10万时，请在/opt/DataBackup/ProtectClient/Plugins/FilePlugin/conf/hcpconf.ini配置文件中将FORCE_DISABLE_ACL参数取值设置为1。</p>
</div>
<div class="section"><h4 class="sectiontitle">操作步骤</h4><ol><li><span>选择<span class="uicontrol" id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001839142377_uicontrol1535113494115">“<span id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001839142377_text735434144116">保护</span> &gt; 文件系统 &gt; 文件集”</span>。</span><p><div class="note" id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001839142377_note12707194325517"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001839142377_p370854395513">对于1.5.0版本，请选择<span class="uicontrol" id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001839142377_uicontrol117931445568">“<span id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001839142377_text197938425615">保护</span> &gt; 裸机 &gt; 文件集”</span>。</p>
</div></div>
</p></li><li><span>勾选需要保护的文件集，单击<span class="uicontrol">“<span>保护</span>”</span>。</span><p><p>您也可以勾选多个文件集进行批量保护。</p>
<div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p>仅支持选择操作系统类型相同的文件集进行批量保护。</p>
</div></div>
</p></li><li><span>选择SLA。</span><p><p id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001607841256_p33248794210">您也可以单击<span class="uicontrol" id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001607841256_uicontrol744210206420">“<span id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001607841256_text1460532344618">创建</span>”</span>，创建新的SLA。</p>
</p></li><li id="ZH-CN_TOPIC_0000001792548340__li164660725814"><a name="ZH-CN_TOPIC_0000001792548340__li164660725814"></a><a name="li164660725814"></a><span>配置文件集保护高级参数。</span><p><div class="p">相关参数说明如<a href="#ZH-CN_TOPIC_0000001792548340__table354613271506">表1</a>所示。
<div class="tablenoborder"><a name="ZH-CN_TOPIC_0000001792548340__table354613271506"></a><a name="table354613271506"></a><table cellpadding="4" cellspacing="0" summary="" id="ZH-CN_TOPIC_0000001792548340__table354613271506" frame="border" border="1" rules="all"><caption><b>表1 </b>文件集保护高级参数说明</caption><colgroup><col style="width:19.75%"><col style="width:80.25%"></colgroup><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="19.75%" id="mcps1.3.3.2.4.2.1.2.2.3.1.1"><p>参数</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="80.25%" id="mcps1.3.3.2.4.2.1.2.2.3.1.2"><p>说明</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="19.75%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>通道数</span></p>
</td>
<td class="cellrowborder" valign="top" width="80.25%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 "><p><span style="color:#282B33;">通道数越大，备份性能越好，相应占用生产主机内存越多，每个通道占用约200MB内存。</span>取值范围为1~40。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.75%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>一致性备份</span></p>
</td>
<td class="cellrowborder" valign="top" width="80.25%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 "><p><span style="color:#282B33;">开启后，将对文件集执行一致性备份，以保证数据一致性。</span></p>
<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><ul><li>一致性备份仅支持LVM卷。通过对备份文件集所选路径所属的LVM卷创建快照，基于此快照卷进行备份，以达成一致性备份。</li><li>对LVM卷创建快照需确保LVM卷所属卷组的剩余空间大于备份所属LVM卷空间的5%，否则创建快照失败，备份任务转为非一致性备份。</li><li>LinuxOS备份任务创建的快照卷将挂载在/opt/lvm-snapshots/创建的子目录下，任务结束后删除快照卷，/opt/lvm-snapshots目录将一直保留。</li><li>AIXOS备份任务创建的快照卷将挂载在/opt/jfs_snapshots/创建的子目录下，任务结束后删除快照卷，/opt/jfs_snapshots目录将一直保留。</li><li>WindowsOS备份任务创建的快照卷将挂载在C:\vss_snapshots\创建的子目录下，任务结束后删除快照卷，C:\vss_snapshots目录将一直保留。</li><li>对于Solaris操作系统，开启一致性备份后，由于ZFS的快照机制，当备份的文件或目录路径长度超972个字符时，将会备份失败。</li><li>如果未开启一致性备份备份，又想忽略相关错误，请在/opt/DataBackup/ProtectClient/Plugins/FilePlugin/conf/hcpconf.ini配置文件中将BACKUP_READ_FAILED_DISCARD参数取值设置为1。</li></ul>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.75%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>跨文件系统备份</span></p>
</td>
<td class="cellrowborder" valign="top" width="80.25%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 "><p><span style="color:#282B33;">开启后，当同一目录下存在多个文件系统时，多个文件系统数据均会被备份，否则仅备份相同文件系统的数据。</span></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.75%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>备份NFS</span></p>
</td>
<td class="cellrowborder" valign="top" width="80.25%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 "><p><span style="color:#282B33;">仅在主机为非Windows系统时展示，开启后，文件集目录下挂载的所有NFS共享文件系统数据均会被备份，当文件系统数据量大时可能会影响性能。</span></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.75%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>备份SMB</span></p>
</td>
<td class="cellrowborder" valign="top" width="80.25%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 "><p><span style="color:#282B33;">仅在主机为Windows系统时展示，开启后，文件集目录下挂载的所有cifs共享文件系统数据均会被备份，当文件系统数据量大时可能会影响性能。</span></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.75%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>文件/目录备份失败继续保护</span></p>
</td>
<td class="cellrowborder" valign="top" width="80.25%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 "><p>开启后，当文件集中的某一个文件或目录备份失败，将继续执行备份任务，否则结束备份任务。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.75%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>稀疏文件检测</span></p>
</td>
<td class="cellrowborder" valign="top" width="80.25%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 "><p><span style="color:#282B33;">开启后，对稀疏文件进行压缩后再备份，以提升备份效率。</span></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.75%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>小文件聚合</span></p>
</td>
<td class="cellrowborder" valign="top" width="80.25%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 "><p><span style="color:#282B33;">开启后，将聚合同层目录下的小文件为大文件，以提升备份效率。</span></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="19.75%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>执行脚本</span></p>
</td>
<td class="cellrowborder" valign="top" width="80.25%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792548340__p3388183210404">您可以根据实际需求，在备份任务执行前、执行成功后、执行失败后，执行自定义脚本。</p>
<p id="ZH-CN_TOPIC_0000001792548340__p16797181010379">非WindowsOS请将执行脚本放在DataBackup/ProtectClient/ProtectClient-E/sbin/thirdparty目录下，例如：/opt/DataBackup/ProtectClient/ProtectClient-E/sbin/thirdparty/执行脚本的相对路径。</p>
<p>也可将执行脚本放在任意目录下，输入执行脚本的绝对路径即可。</p>
<p id="ZH-CN_TOPIC_0000001792548340__p2114155633414">非WindowsOS支持的脚本类型为<span class="uicontrol" id="ZH-CN_TOPIC_0000001792548340__uicontrol5132142794213">“.sh”</span>。</p>
<p id="ZH-CN_TOPIC_0000001792548340__p1436018422406">WindowsOS请将执行脚本放在DataBackup\ProtectClient\ProtectClient-E\bin\thirdparty目录下，例如C:\DataBackup\ProtectClient\ProtectClient-E\bin\thirdparty\执行脚本相对路径。</p>
<p id="ZH-CN_TOPIC_0000001792548340__p10529131392517">WindowsOS支持的脚本类型为<span class="uicontrol" id="ZH-CN_TOPIC_0000001792548340__uicontrol473615424258">“.bat”</span>。</p>
<div class="p" id="ZH-CN_TOPIC_0000001792548340__p175351445143016">也可将执行脚本放在任意目录下，输入执行脚本的绝对路径即可。<div class="note" id="ZH-CN_TOPIC_0000001792548340__note64007332505"><span class="notetitle"> 说明： </span><div class="notebody"><p id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001792402656_zh-cn_topic_0000001264099602_p196461512103113">当配置了<span class="uicontrol" id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001792402656_zh-cn_topic_0000001264099602_uicontrol180112781919">“<span id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001792402656_zh-cn_topic_0000001264099602_text10711756153116">恢复成功执行脚本</span>”</span>时，即使该脚本执行失败，<span id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001792402656_text712055613536">OceanProtect</span>上也会显示恢复任务的状态为<span class="uicontrol" id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001792402656_zh-cn_topic_0000001264099602_uicontrol488919204209">“<span id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001792402656_zh-cn_topic_0000001264099602_text186291135132417">成功</span>”</span>。请您留意任务详情中是否有后置脚本执行失败的相关提示，如有请及时修正脚本。</p>
</div></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</p></li><li><span>单击<span class="uicontrol" id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001607841256_uicontrol471113581111">“确定”</span>。</span><p><p id="ZH-CN_TOPIC_0000001792548340__zh-cn_topic_0000001607841256_p25041111535">如果当前系统时间已晚于该SLA首次备份的开始时间，则关联备份SLA后可以选择在当前立即执行备份或者根据SLA中设置的备份策略等待下次调度。</p>
</p></li></ol>
</div>
</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="zh-cn_topic_0000001839267625.html">步骤6：执行备份</a></div>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">版权所有 &copy; 华为技术有限公司</div></body>
</html>