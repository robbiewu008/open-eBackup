<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->


<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="Installing ProtectAgent (Manual Mode, Applicable to the Linux OS/AIX OS)">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TOPIC_0000001839189365">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<title>Installing ProtectAgent (Manual Mode, Applicable to the Linux OS/AIX OS)</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="EN-US_TOPIC_0000001839189365"></a><a name="EN-US_TOPIC_0000001839189365"></a>

<h1 class="topictitle1">Installing ProtectAgent (Manual Mode, Applicable to the Linux OS/AIX OS)</h1>
<div><p id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001166356758_p77861727131820">You need to install the ProtectAgent software on agent hosts. ProtectAgent functions as the agent between the <span id="EN-US_TOPIC_0000001839189365__text1368810101119">OceanProtect</span> and protected resources to back up and restore data. This section describes how to log in to the background of the agent host and install ProtectAgent on it.</p>
<div class="section"><h4 class="sectiontitle">Prerequisites</h4><p id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001657025025_en-us_topic_0000001792549964_p11178191432914">If you have set aliases for <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001657025025_b15975432164314">rm</strong>, <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001657025025_b1497553212435">cp</strong>, <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001657025025_b1897516328432">mv</strong>, and other commands that need to be input in interactive mode on the agent host (for example, alias setting <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001657025025_b169754321434">mv=mv -i</strong>, indicating that the <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001657025025_b109751132104320">mv</strong> command is executed with the <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001657025025_b2975103214313">-i</strong> parameter by default), cancel the alias setting first. Otherwise, the installation will fail.</p>
</div>
<div class="section"><h4 class="sectiontitle">Precautions</h4><p>If the protected resource is GaussDB (DWS) and the firewall is not required, run the <strong>systemctl stop firewalld</strong> command to disable the firewall. If you need to enable the firewall of the GaussDB (DWS) node or agent host, enable the ports required for GaussDB (DWS) backup and restoration before enabling the firewall. Otherwise, the GaussDB (DWS) cluster may not work properly. For details about ports required for GaussDB (DWS) backup and restoration, see the <a href="https://support.huawei.com/enterprise/en/doc/EDOC1100385843?idPath=7919749|251366268|250389224|251366267|258115661" target="_blank" rel="noopener noreferrer">Communication Matrix</a>. Enabling the firewall is a high-risk operation. Exercise caution when enabling the firewall.</p>
</div>
<div class="section"><h4 class="sectiontitle">Procedure</h4><ol><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001191380933_li734156194217"><a name="EN-US_TOPIC_0000001839189365__en-us_topic_0000001191380933_li734156194217"></a><a name="en-us_topic_0000001191380933_li734156194217"></a><span>Download the ProtectAgent software package from the <span>OceanProtect</span> WebUI.</span><p><p>For details, see <a href="en-us_topic_0000001839189405.html">Downloading the ProtectAgent Software Package</a>.</p>
</p></li><li><span>Check whether the protected resource is an HDFS, HBase, Hive, Elasticsearch, Redis, or ClickHouse cluster and whether Kerberos authentication is configured in the cluster.</span><p><ul id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_ul0257172810237"><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_li425762810230">If yes, ensure that the time on the agent host, <span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_text17431185819103">OceanProtect</span>, and Kerberos server is consistent before the installation. If the time is inconsistent, use the same NTP server. Otherwise, the ProtectAgent installation may fail.</li><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_li1669317304237">If no, ensure that the time on the agent host is consistent with that on the <span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_text49838681316">OceanProtect</span> before the installation.<ul id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_ul274421882011"><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_li11744161816202">For an OceanProtect X series backup appliance, perform the following steps to check the device time of the <span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_text3456181418112">OceanProtect</span>:<ol type="a" id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001143474500_en-us_topic_0000001142182722_en-us_topic_0000001187942849_en-us_topic_0000001087149498_en-us_topic_0000001087149498_ol2172145813485"><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839223165_li84033442337">Choose <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839223165_b124231410468">System</strong> &gt; <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839223165_b233321694610">Infrastructure</strong> &gt; <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839223165_b1744421834613">Cluster Management</strong>.</li><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_li365813483918">On the <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839223165_b4329457314">Backup Clusters</strong> tab page, click a node name under the <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839223165_b1632917571116">Local Cluster Nodes</strong> area.</li><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001143474500_en-us_topic_0000001142182722_en-us_topic_0000001187942849_en-us_topic_0000001087149498_en-us_topic_0000001087149498_li929117916361">In the <span class="uicontrol" id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_uicontrol626919191738"><b><span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_text8269719131"><strong>Node detail</strong></span></b></span> page that is displayed, view the current device time.<p id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001143474500_en-us_topic_0000001142182722_en-us_topic_0000001187942849_en-us_topic_0000001087149498_en-us_topic_0000001087149498_p3985106145415">If the time is inconsistent, change the agent host time. Otherwise, the ProtectAgent installation may fail. For details, see <a href="en-us_topic_0000002128909289.html">How Do I Change the Time Zone and Time of the Agent Host?</a>.</p>
</li></ol>
</li></ul>
</li></ul>
</p></li><li><span>Install ProtectAgent.</span><p><ol type="a"><li>Use PuTTY to log in to the host where ProtectAgent needs to be installed as user <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189401_b916917212">root</strong>.</li><li>Run the following commands in sequence to create a directory for storing the software package and grant the permission.<pre class="screen">mkdir /opt/install</pre>
<pre class="screen">chmod -R 755<em> /</em><em>opt/install</em></pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>The permission on the directory for storing the software package must be 755.</li><li>The <span class="filepath"><b>/opt/install</b></span> directory is used as an example. Replace it with the actual directory.</li></ul>
</div></div>
</li><li>Use WinSCP to upload the software package to the <span class="filepath"><b>/opt/install</b></span> directory.</li><li>Go to the <span class="filepath"><b>/opt/install</b></span> directory and run the following command to decompress the software package.<pre class="screen">unzip DataProtect_<em>xxx</em>_client_<em>xxx</em>.zip</pre>
<div class="note" id="EN-US_TOPIC_0000001839189365__note131823521140"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TOPIC_0000001839189365__p1818285216413">The name of the ProtectAgent software package varies depending on the version, agent type, and OS.</p>
</div></div>
</li><li>Run the following command to go to the software package directory:<pre class="screen">cd /opt/install/DataProtect_<em>xxx</em>_client_<em>xxx</em>/</pre>
</li><li>Run the following command and install the software as prompted.<ul><li>If you log in to the host as a system administrator, run the <strong>sh install.sh</strong> command.</li><li>If you log in to the host as a common user, run the <strong>sudo sh install.sh</strong> command.<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the common user is a sudo non-password-free user, enter the sudo password as prompted. If the common user is a sudo password-free user, you do not need to enter the sudo password.</p>
</div></div>
</li></ul>
<ol class="substepthirdol"><li>When the following information is displayed, enter the installation directory of the ProtectAgent software as prompted. The system automatically verifies the validity of the entered installation directory. The software is installed in <span class="filepath"><b>/opt</b></span> by default. The permission on the selected installation directory must be 755, and the user and owner group must be <strong>root</strong>.<pre class="screen">Enter the installation directory of the agent. The agent cannot be installed in a directory such as /tmp, /dev, /bin, /usr. Special characters such as [|;&amp;$&gt;&lt;`!]+ are not allowed. By default, the agent is installed in the /opt directory.
Please enter the agent installation directory:</pre>
</li><li>If information similar to the following is displayed, ensure that the host time is the same as the <span>OceanProtect</span> device time and enter <span class="parmvalue"><b>y</b></span>:<pre class="screen">The current host time and time zone are 2023/08/31-17:17:49[CST]. Check whether the time and time zone are the same as those on DataBackup time:(y/n):
Your choice:</pre>
</li><li>When the following information is displayed, enter the private key password set in <a href="#EN-US_TOPIC_0000001839189365__en-us_topic_0000001191380933_li734156194217">1</a>:<pre class="screen">Enter password:</pre>
</li><li>For 1.5.0SPC19 and later versions, when the following information is displayed, determine whether to enable source deduplication:<pre class="screen">Whether Open Dataturbo Service:(y|n), default(n)
Your choice:</pre>
<ul><li>If you enter <span class="parmvalue"><b>y</b></span>, source deduplication is enabled. Ensure that the free memory of the agent host is greater than 2 GB. The system will automatically install the OceanStor DataTurbo client. For details about the OSs that support source deduplication, refer to <a href="https://info.support.huawei.com/storage/comp/#/oceanprotect" target="_blank" rel="noopener noreferrer">OceanProtect Compatibility Query</a>.</li><li>If you enter <span class="parmvalue"><b>n</b></span>, source deduplication is disabled. You can also manually install the OceanStor DataTurbo client after ProtectAgent is installed. For details, see <a href="en-us_topic_0000001936780456.html">How Do I Install the OceanStor DataTurbo Client?</a>.</li></ul>
</li><li>For 1.5.0SPC19 and later versions, when the following information is displayed, determine whether to use an EIP based on the actual requirements:<pre class="screen">Check where the host is an EIP node:(y|n), default(n)
Your choice:</pre>
<ul><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_li8258810141315">If EIPs are mapped to Virtual Private Cloud (VPC) IP addresses, enter an EIP.</li><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_li1225811101134">If internal public IP addresses are mapped to VPC IP addresses, enter an internal public IP address.</li></ul>
</li></ol>
<p>If the following information is displayed, ProtectAgent is successfully installed:</p>
<pre class="screen">DataBackup ProtectAgent is successfully installed on the host. </pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>When the ProtectAgent software is installed, the system automatically checks whether the net-tools and iproute tool packages have been installed. If no, the system prompts you to install them.</li><li>During the installation, the system checks the service network IP addresses configured on the current host. If multiple service network IP addresses are configured, the system prompts you to select one for backup and restoration on the agent host.</li><li>During the installation, if the system detects hosts with the same IP address but different UUIDs on the <span>OceanProtect</span> WebUI, the system displays a message asking you whether to overwrite the original host on the <span>OceanProtect</span> WebUI.<ul><li>If you choose to overwrite the original host, the new host inherits the copy information of the original host, and the UUID of the new host is the same as that of the original host.</li><li>If you choose not to overwrite the original host, <a href="en-us_topic_0000001792549964.html#EN-US_TOPIC_0000001792549964__en-us_topic_0000001166835234_li1849451112587">delete the original host on OceanProtect</a> and reinstall it.</li></ul>
</li><li>After the installation is complete, the system automatically creates user <strong>rdadmin</strong> and user directory <strong>/home/rdadmin</strong>. Do not delete or modify the user or user directory.</li></ul>
</div></div>
</li></ol>
</p></li><li><span>After ProtectAgent is installed on the agent host, the <span>OceanProtect</span> WebUI automatically discovers the agent host. Perform the following steps to check the result. </span><p><ol type="a"><li>Choose <span class="uicontrol" id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839142377_uicontrol08941439165212"><b><span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839142377_text22651956143811"><strong>Protection</strong></span> &gt; Clients &gt; Clients</b></span>.</li><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001187942849_li162702510381">Check whether the host where ProtectAgent has been installed is displayed on the <span id="EN-US_TOPIC_0000001839189365__text1857815461628">OceanProtect</span> WebUI.<div class="p" id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001187942849_p19934115894410">If the agent host where ProtectAgent has been installed is not displayed on the OceanProtect WebUI, contact the system administrator to authorize resources to the user.<ul id="EN-US_TOPIC_0000001839189365__ul11315151683118"><li id="EN-US_TOPIC_0000001839189365__li7489102073110">For 1.5.0, perform the following operations:<ol class="substepthirdol" id="EN-US_TOPIC_0000001839189365__ol52668371313"><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001187942849_li13303622114615">On the <strong id="EN-US_TOPIC_0000001839189365__b16209195173810">Clients</strong> page, locate the row that contains the host and choose <span class="uicontrol" id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001187942849_uicontrol183035225468"><b><span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001187942849_text18303422124612"><strong>More</strong></span> &gt; <span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001187942849_text330392284615"><strong>Authorize Resource</strong></span></b></span>.</li><li id="EN-US_TOPIC_0000001839189365__li12823859173115">Authorize the host to the corresponding user.</li></ol>
</li><li id="EN-US_TOPIC_0000001839189365__li1431512169316">For 1.6.0 and later versions, perform the following operations:<ol class="substepthirdol" id="EN-US_TOPIC_0000001839189365__ol156361033313"><li id="EN-US_TOPIC_0000001839189365__li2850165311349">Choose <strong id="EN-US_TOPIC_0000001839189365__b74891625182811">System</strong> &gt; <strong id="EN-US_TOPIC_0000001839189365__b1348910252283">Security</strong> &gt; <strong id="EN-US_TOPIC_0000001839189365__b11490122512812">RBAC</strong>.</li><li id="EN-US_TOPIC_0000001839189365__li17341115143513">On the <strong id="EN-US_TOPIC_0000001839189365__b2506323194018">Users</strong> tab page, locate the row that contains the target user, and click <strong id="EN-US_TOPIC_0000001839189365__b1181144011404">Modify</strong>.</li><li id="EN-US_TOPIC_0000001839189365__li1660463123511">On the <strong id="EN-US_TOPIC_0000001839189365__b923343292813">Modify User</strong> page, click <strong id="EN-US_TOPIC_0000001839189365__b2233932182817">Next</strong>.</li><li id="EN-US_TOPIC_0000001839189365__li5421154015356">Click <strong id="EN-US_TOPIC_0000001839189365__b10361184514117">Create Resource Set</strong>.</li><li id="EN-US_TOPIC_0000001839189365__li1749893713610"><a name="EN-US_TOPIC_0000001839189365__li1749893713610"></a><a name="li1749893713610"></a>Set <strong id="EN-US_TOPIC_0000001839189365__b19771754174110">Resource Set Name</strong>. On the <strong id="EN-US_TOPIC_0000001839189365__b197356894611">Client</strong> tab page, select the corresponding agent host.</li><li id="EN-US_TOPIC_0000001839189365__li43218366416">Click <strong id="EN-US_TOPIC_0000001839189365__b4589103652819">OK</strong>.</li><li id="EN-US_TOPIC_0000001839189365__li11991352174115">Select the resource set created in <a href="#EN-US_TOPIC_0000001839189365__li1749893713610">4.b.v</a> and click <strong id="EN-US_TOPIC_0000001839189365__b83754204910">Next</strong>.</li><li id="EN-US_TOPIC_0000001839189365__li11197205624116">Click <strong id="EN-US_TOPIC_0000001839189365__b958010437288">Finish</strong>.</li></ol>
</li></ul>
</div>
</li></ol>
</p></li></ol><ol start="5"><li><span>Repeat the preceding steps to install the ProtectAgent software on other agent hosts.</span><p><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the agent host is registered successfully, wait for 5 minutes and then use the agent host.</p>
</div></div>
</p></li></ol>
</div>
<div class="section"><h4 class="sectiontitle">Follow-up Procedure</h4><p>To release system space after ProtectAgent is installed, run the following command to delete the directory for storing the software package:</p>
<pre class="screen">rm -r /opt/install</pre>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">Copyright &copy; Huawei Technologies Co., Ltd.</div></body>
</html>