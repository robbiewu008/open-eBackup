
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="Installing ProtectAgent (Manual Mode, Applicable to the Linux OS)">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="EN-US_TOPIC_0000001839189365">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<title>Installing ProtectAgent (Manual Mode, Applicable to the Linux OS)</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="EN-US_TOPIC_0000001839189365"></a><a name="EN-US_TOPIC_0000001839189365"></a>

<h1 class="topictitle1">Installing ProtectAgent (Manual Mode, Applicable to the Linux OS)</h1>
<div><p id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001166356758_p77861727131820">You need to install the ProtectAgent software on agent hosts. ProtectAgent functions as the agent between the <span id="EN-US_TOPIC_0000001839189365__text1368810101119">OceanProtect</span> and protected resources to back up and restore data. This section describes how to log in to the background of the agent host and install ProtectAgent on it.</p>
<div class="section"><h4 class="sectiontitle">Precautions</h4><p>If the protected resource is GaussDB (DWS) and the firewall is not required, run the <strong>systemctl stop firewalld</strong> command to disable the firewall. If you need to enable the firewall of the GaussDB (DWS) node or agent host, enable the ports required for GaussDB (DWS) backup and restoration before enabling the firewall. Otherwise, the GaussDB (DWS) cluster may not work properly. For details about how to enable the ports required for GaussDB (DWS) backup and restoration, see <span class="uicontrol"><b>Enabling Ports Required for GaussDB (DWS) Backup and Restoration</b></span> in the <i><cite>OceanProtect <span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001792502994_ph1612593082016">Appliance 1.5.0-1.6.0</span> Data Backup Feature Guide (for GaussDB (DWS))</cite></i>. Enabling the firewall is a high-risk operation. Exercise caution when enabling the firewall.</p>
</div>
<div class="section"><h4 class="sectiontitle">Procedure</h4><ol><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001191380933_li734156194217"><a name="EN-US_TOPIC_0000001839189365__en-us_topic_0000001191380933_li734156194217"></a><a name="en-us_topic_0000001191380933_li734156194217"></a><span>Download the ProtectAgent software package from OceanProtect.</span><p><p>For details, see <a href="en-us_topic_0000001839189405.html">Downloading the ProtectAgent Software Package</a>.</p>
</p></li><li><span>Check whether the protected resource is an HDFS, HBase, Hive, Elasticsearch, Redis, or ClickHouse cluster and whether Kerberos authentication is configured in the cluster.</span><p><ul id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_ul0257172810237"><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_li425762810230">If yes, ensure that the time on the agent host, <span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_text17431185819103">OceanProtect</span>, and Kerberos server is consistent before the installation. If the time is inconsistent, use the same NTP server. Otherwise, the ProtectAgent installation may fail.</li><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_li1669317304237">If no, ensure that the time on the agent host is consistent with that on the <span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_text49838681316">OceanProtect</span> before the installation.<ul id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_ul274421882011"><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_li11744161816202"> Perform the following steps to check the device time of the <span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_text3456181418112">OceanProtect</span>:<ol type="a" id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001143474500_en-us_topic_0000001142182722_en-us_topic_0000001187942849_en-us_topic_0000001087149498_en-us_topic_0000001087149498_ol2172145813485"><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_li2026912191135">Choose <span class="uicontrol" id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839143213_en-us_topic_0000001311295305_en-us_topic_0000001149078659_uicontrol1098185683619"><b><span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839143213_text157651936143415"><strong>System</strong></span> &gt; <span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839143213_text49601653123416"><strong>Infrastructure</strong></span> &gt; <span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839143213_text112401684352"><strong>Cluster Management</strong></span></b></span>.</li><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_li1626913191631">In the <span class="uicontrol" id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839143213_uicontrol1050641575312"><b><span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839143213_text133861121163513"><strong>Local Cluster Nodes</strong></span></b></span> area of the <span class="uicontrol" id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839143213_uicontrol13691645105219"><b><span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001839143213_text1763193125313"><strong>Backup Cluster</strong></span></b></span> tab page, click the node name.</li><li id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001143474500_en-us_topic_0000001142182722_en-us_topic_0000001187942849_en-us_topic_0000001087149498_en-us_topic_0000001087149498_li929117916361">In the <span class="uicontrol" id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_uicontrol626919191738"><b><span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_text8269719131"><strong>Node detail</strong></span></b></span> dialog box that is displayed, view the current device time.<p id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839189313_en-us_topic_0000001143474500_en-us_topic_0000001142182722_en-us_topic_0000001187942849_en-us_topic_0000001087149498_en-us_topic_0000001087149498_p3985106145415">If the time is inconsistent, change the agent host time. Otherwise, the ProtectAgent installation may fail.</p>
</li></ol>
</li></ul>
</li></ul>
</p></li><li><span>Install ProtectAgent.</span><p><ol type="a"><li>Use PuTTY to log in to the host where ProtectAgent needs to be installed.</li><li>Run the following commands in sequence to create a directory for storing the software package and grant the permission.<p><strong>mkdir /opt/install</strong></p>
<p><strong>chmod -R 755</strong><em> /</em><em>opt/install</em></p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>The permission on the directory for storing the software package must be 755.</li><li>The <span class="filepath"><b>/opt/install</b></span> directory is used as an example. Replace it with the actual directory.</li></ul>
</div></div>
</li><li>Use WinSCP to upload the software package to the <span class="filepath"><b>/opt/install</b></span> directory.</li><li>Go to the <span class="filepath"><b>/opt/install</b></span> directory and run the following command to decompress the software package.<div class="p"><strong>unzip DataProtect_</strong><em>xxx</em><strong>_client_</strong><em>xxx</em><strong>.zip</strong><div class="note" id="EN-US_TOPIC_0000001839189365__note131823521140"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TOPIC_0000001839189365__p1818285216413">The name of the ProtectAgent software package varies depending on the version, agent type, and OS.</p>
</div></div>
</div>
</li><li>Run the following command to go to the software package directory:<p><strong>cd /opt/install/DataProtect_</strong><em>xxx</em><strong>_client_</strong><em>xxx</em><strong>/</strong></p>
</li><li>Run the following command and install the software as prompted.<ul><li>If you log in to the host as a system administrator, run the <strong>sh install.sh</strong> command.</li><li>If you log in to the host as a common user, run the <strong>sudo sh install.sh</strong> command.<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>If the common user is a sudo non-password-free user, enter the sudo password as prompted. If the common user is a sudo password-free user, you do not need to enter the sudo password.</p>
</div></div>
</li></ul>
<ol class="substepthirdol"><li>When the following information is displayed, enter the installation directory of the ProtectAgent software as prompted: The system automatically verifies the validity of the entered installation directory. The software is installed in <span class="filepath"><b>/opt</b></span> by default. The permission on the selected installation directory must be 755, and the user and owner group must be <strong>root</strong>.<pre class="screen">Enter the installation directory of the agent. The agent cannot be installed in a directory such as /tmp, /dev, /bin, /usr. Special characters such as [|;&amp;$&gt;&lt;`!]+ are not allowed. By default, the agent is installed in the /opt directory.
Please enter the agent installation directory:</pre>
</li><li>If information similar to the following is displayed, ensure that the host time is the same as the <span>OceanProtect</span> device time and enter <span class="parmvalue"><b>y</b></span>:<pre class="screen">The current host time and time zone are 2023/08/31-17:17:49[CST]. Check whether the time and time zone are the same as those on DataBackup time:(y/n):
Your choice:</pre>
</li><li>When the following information is displayed, enter the private key password set in <a href="#EN-US_TOPIC_0000001839189365__en-us_topic_0000001191380933_li734156194217">1</a>:<pre class="screen">Enter password:</pre>
</li><li>(For 1.6.0 and later versions) When the following information is displayed on, determine whether to enable source deduplication.<pre class="screen">Whether to enable the dataturbo service:(y|n), default(n)
Your choice:</pre>
<ul><li>If you enter <span class="parmvalue"><b>y</b></span>, source deduplication is enabled. Ensure that the free memory of the agent host is greater than 2 GB. The system will automatically install the OceanStor DataTurbo client. For details about the OSs that support source deduplication, refer to <a href="https://info.support.huawei.com/storage/comp/#/oceanprotect" target="_blank" rel="noopener noreferrer">Compatibility Query Tool</a>.</li><li>If you enter <span class="parmvalue"><b>n</b></span>, source deduplication is disabled. You can also manually install the OceanStor DataTurbo client after ProtectAgent is installed. For details, see <a href="en-us_topic_0000001936780456.html">Installing the OceanStor DataTurbo Client (Applicable to 1.6.0 and Later Versions)</a>.</li></ul>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001936780456_p1942121419116">After source deduplication is enabled, add the source deduplication user to <strong id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001936780456_b13787183405016">sudoers</strong> before the first backup. For details, see <a href="en-us_topic_0000001792390228.html">How Should I Add a Source Deduplication User to sudoers?</a>.</p>
</div></div>
</li></ol>
<p>If the following information is displayed, ProtectAgent is successfully installed:</p>
<pre class="screen">DataBackup ProtectAgent is successfully installed on the host. </pre>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>When the ProtectAgent software is installed, the system automatically checks whether the net-tools and iproute tool packages have been installed. If no, the system prompts you to install them.</li><li>During the installation, the system checks the service network IP addresses configured on the current host. If multiple service network IP addresses are configured, the system prompts you to select one for backup and restoration on the agent host.</li><li>During the installation, if the system detects any host with the same IP address but different UUID on OceanProtect, the system displays a message asking you whether to overwrite the original host.<ul><li>If you choose to overwrite the original host, the new host inherits the copy information of the original host, and the UUID of the new host is the same as that of the original host.</li><li>If you choose not to overwrite the original host, <a href="en-us_topic_0000001792549964.html#EN-US_TOPIC_0000001792549964__en-us_topic_0000001166835234_li1849451112587">delete the original host on OceanProtect</a> and reinstall it.</li></ul>
</li></ul>
</div></div>
</li></ol>
</p></li><li><span>After ProtectAgent is installed on the host, OceanProtect automatically discovers the host. Perform the following steps to check the result. </span><p><ol type="a"><li>Choose <span class="uicontrol" id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839142377_uicontrol08941439165212"><b><span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839142377_text22651956143811"><strong>Protection</strong></span> &gt; Clients</b></span>.</li><li>Check whether the host where ProtectAgent has been installed is available on OceanProtect.<p>If the host where ProtectAgent has been installed is not available on the OceanProtect WebUI, contact the system administrator to authorize resources to the user.</p>
<ol class="substepthirdol"><li>Choose <span class="uicontrol" id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839142377_uicontrol08941439165212_1"><b><span id="EN-US_TOPIC_0000001839189365__en-us_topic_0000001839142377_text22651956143811_1"><strong>Protection</strong></span> &gt; Clients</b></span>.</li><li>In the row of the target host, choose <span class="uicontrol"><b><span><strong>More</strong></span> &gt; <span><strong>Authorize Resource</strong></span></b></span>.</li><li>Authorize the host to the user.</li></ol>
</li></ol>
</p></li></ol><ol start="5"><li><span>Repeat the preceding steps to install the ProtectAgent software on other agent hosts.</span><p><div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p>After the agent host is registered successfully, wait for 5 minutes and then use the agent host.</p>
</div></div>
</p></li></ol>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">Copyright &copy; Huawei Technologies Co., Ltd.</div></body>
</html>