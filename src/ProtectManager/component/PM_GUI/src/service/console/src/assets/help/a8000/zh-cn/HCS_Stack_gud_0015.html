<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->


<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="步骤2：注册华为云Stack">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="HCS_Stack_gud_0012.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="">
<meta name="DC.Publisher" content="20250306">
<meta name="prodname" content="csbs">
<meta name="documenttype" content="usermanual">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="HCS_Stack_gud_0015">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<title>步骤2：注册华为云Stack</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="HCS_Stack_gud_0015"></a><a name="HCS_Stack_gud_0015"></a>

<h1 class="topictitle1">步骤2：注册华为云Stack</h1>
<div><p>执行华为云Stack备份恢复前，需要将华为云Stack注册至<span>OceanProtect</span>。</p>
<div class="section"><h4 class="sectiontitle">前提条件</h4><ul><li>已为客户端所在主机配置反向代理或免代理。</li><li>已获取ManageOne运营面的运营管理员用户<strong>bss_admin</strong>及其对应的密码，该用户用于将华为云Stack接入<span>OceanProtect</span>。<div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p id="HCS_Stack_gud_0015__hcs_stack_gud_0011_p1245362114497">如果需要使用自定义用户，以最小权限将华为云Stack接入<span id="HCS_Stack_gud_0015__hcs_stack_gud_0011_text12410937181815">OceanProtect</span>，请参见华为云Stack对应版本《产品文档》中的<span class="uicontrol" id="HCS_Stack_gud_0015__hcs_stack_gud_0011_uicontrol156361124493">“安全管理”</span>章节，创建自定义用户。具体步骤如下：</p>
<ol id="HCS_Stack_gud_0015__hcs_stack_gud_0011_ol16337037165217"><li id="HCS_Stack_gud_0015__hcs_stack_gud_0011_li7337637135219"><a name="HCS_Stack_gud_0015__hcs_stack_gud_0011_li7337637135219"></a><a name="hcs_stack_gud_0011_li7337637135219"></a>参考<span class="uicontrol" id="HCS_Stack_gud_0015__hcs_stack_gud_0011_uicontrol89101831101218">“管理策略”</span>章节创建策略。其中，服务选择<span class="uicontrol" id="HCS_Stack_gud_0015__hcs_stack_gud_0011_uicontrol158749173530">“云服务管理中心”</span>，权限选择<span class="uicontrol" id="HCS_Stack_gud_0015__hcs_stack_gud_0011_uicontrol4509013195418">“vdc_readonly”</span>角色，该角色具有对租户中用户、资源空间、自运维等的查询权限。</li><li id="HCS_Stack_gud_0015__hcs_stack_gud_0011_li66202308549"><a name="HCS_Stack_gud_0015__hcs_stack_gud_0011_li66202308549"></a><a name="hcs_stack_gud_0011_li66202308549"></a>参考<span class="uicontrol" id="HCS_Stack_gud_0015__hcs_stack_gud_0011_uicontrol3956173401219">“管理集成账号”</span>章节创建集成账号。</li><li id="HCS_Stack_gud_0015__hcs_stack_gud_0011_li1619114155813">参考<span class="uicontrol" id="HCS_Stack_gud_0015__hcs_stack_gud_0011_uicontrol16668123711216">“管理用户组”</span>章节创建用户组。将<a href="#HCS_Stack_gud_0015__hcs_stack_gud_0011_li7337637135219">1</a>中创建的策略及<a href="#HCS_Stack_gud_0015__hcs_stack_gud_0011_li66202308549">2</a>中创建的集成账号添加进用户组。完成后，可以使用该用户组将华为云Stack接入<span id="HCS_Stack_gud_0015__hcs_stack_gud_0011_text12543171420173">OceanProtect</span>。</li></ol>
</div></div>
</li><li>已创建角色为“管理员”，登录方式为“RESTful”的存储设备用户，该用户用于将华为云Stack中的存储资源接入<span>OceanProtect</span>。创建用户的详细操作请参见存储设备对应版本的《管理员指南》。如果存储资源为OceanStor V5，还需要设置用户级别为“管理员”。</li><li>使用iSCSI备份，请确保华为云Stack对接的存储设备已配置备份软件的备份网络平面可访问的iSCSI端口。如未配置，请参考存储侧对应版本的产品文档配置。</li></ul>
</div>
<div class="section"><h4 class="sectiontitle">背景信息</h4><p>注册华为云Stack后，可以在管理界面浏览华为云Stack的项目/资源集、云服务器的信息并对其进行保护，也可将其作为恢复目标。</p>
</div>
<div class="section"><h4 class="sectiontitle">操作步骤</h4><ol><li><span>选择<span class="uicontrol" id="HCS_Stack_gud_0015__zh-cn_topic_0000002199964685_uicontrol23517341412">“保护 &gt; 云平台 &gt; 华为云Stack”</span>。</span></li><li><span>单击<span class="uicontrol">“<span>注册</span>”</span>，注册华为云Stack信息。</span><p><div class="p">华为云Stack注册信息如<a href="#HCS_Stack_gud_0015__table613227155112">表1</a>所示。
<div class="tablenoborder"><a name="HCS_Stack_gud_0015__table613227155112"></a><a name="table613227155112"></a><table cellpadding="4" cellspacing="0" summary="" id="HCS_Stack_gud_0015__table613227155112" frame="border" border="1" rules="all"><caption><b>表1 </b>华为云Stack注册信息</caption><colgroup><col style="width:25.629999999999995%"><col style="width:74.37%"></colgroup><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="25.629999999999995%" id="mcps1.3.4.2.2.2.1.2.2.3.1.1"><p>参数</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="74.37%" id="mcps1.3.4.2.2.2.1.2.2.3.1.2"><p>说明</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.1 "><p><span>名称</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.2 "><p>用户自定义华为云Stack名称。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.1 "><p><span>IP地址</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.2 "><p>API Gateway的浮动IP地址。获取方式如下：</p>
<p>请参考华为云Stack软件安装阶段HCC Turnkey导出的参数信息汇总文件《<em>xxx</em>_export_all_v2_CN.xlsx》的“工具生成的IP参数”页签，搜索“AGW-LB-Float-IP”，获取对应的IP地址。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.1 "><p><span>域名</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.2 "><p>华为云Stack的访问域名。获取方式如下：</p>
<p>请参考华为云Stack软件安装阶段HCC Turnkey导出的参数信息汇总文件《<em>xxx</em>_export_all_v2_CN.xlsx》的“基本参数”页签，搜索“external_global_domain_name”，获取对应的参数值。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.1 "><p><span>用户名</span></p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="74.37%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.2 "><p>访问ManageOne运营面的运营管理员的用户名和密码。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.4.2.2.2.1.2.2.3.1.1 "><p><span>密码</span></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.1 "><p>客户端</p>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.2 "><p>选择可用于备份华为云Stack的客户端。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.1 "><p><span>校验证书</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.2 "><p>默认开启，注册华为云Stack时会对其证书进行校验，确保<span>OceanProtect</span>与外部设备交互的安全性。关闭后，系统与云平台通信可能存在安全风险，请谨慎操作。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.1 "><p>Cinder证书</p>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.2.2.1.2.2.3.1.2 "><p>请导入<a href="HCS_Stack_gud_0013.html">步骤1：（可选）获取证书</a>章节中获取的Cinder证书，导入后执行备份任务时会校验该证书的有效性。</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</p></li><li id="HCS_Stack_gud_0015__li89549137399"><a name="HCS_Stack_gud_0015__li89549137399"></a><a name="li89549137399"></a><span>在“<span>存储资源</span>”区域，单击“<span>添加</span>”。存储资源参数说明如<a href="#HCS_Stack_gud_0015__table5692101024117">表2</a>所示。</span><p><div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><ul><li>如果华为云Stack的生产存储为华为分布式块存储，且客户端独立部署，无需添加存储资源。其他场景需要添加存储资源，否则会导致备份任务失败。</li><li>当华为云Stack生产存储有多套存储资源时，需要将待保护对象所在的存储资源都添加到<span>OceanProtect</span>中。</li></ul>
</div></div>

<div class="tablenoborder"><a name="HCS_Stack_gud_0015__table5692101024117"></a><a name="table5692101024117"></a><table cellpadding="4" cellspacing="0" summary="" id="HCS_Stack_gud_0015__table5692101024117" frame="border" border="1" rules="all"><caption><b>表2 </b>存储资源信息</caption><colgroup><col style="width:25.629999999999995%"><col style="width:74.37%"></colgroup><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="25.629999999999995%" id="mcps1.3.4.2.3.2.2.2.3.1.1"><p>参数</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="74.37%" id="mcps1.3.4.2.3.2.2.2.3.1.2"><p>说明</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.3.2.2.2.3.1.1 "><p><span>类型</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.3.2.2.2.3.1.2 "><p>存储资源的类型，包括：<span>华为SAN存储</span>和<span>华为分布式块存储</span>。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.3.2.2.2.3.1.1 "><p><span>管理IP地址</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.3.2.2.2.3.1.2 "><ul><li id="HCS_Stack_gud_0015__hcs_stack_gud_0011_li1797751513310">华为SAN存储的管理IP地址获取方式：请参考华为云Stack软件安装阶段HCC Turnkey导出的参数信息汇总文件《<em id="HCS_Stack_gud_0015__hcs_stack_gud_0011_i458810571318">xxx</em>_export_all_v2_CN.xlsx》的“基本参数”页签，搜索“业务存储REST URL”，获取对应参数值中的IP地址。</li><li id="HCS_Stack_gud_0015__hcs_stack_gud_0011_li1951120142324">华为分布式块存储的管理IP地址获取方式：请参考华为云Stack软件安装阶段HCC Turnkey导出的参数信息汇总文件《<em id="HCS_Stack_gud_0015__hcs_stack_gud_0011_i128706593320">xxx</em>_export_all_v2_CN.xlsx》的“Portal”页签，搜索“华为分布式块存储 Business”，获取对应参数值中的IP地址。<div class="note" id="HCS_Stack_gud_0015__hcs_stack_gud_0011_note871485915219"><span class="notetitle"> 说明： </span><div class="notebody"><p id="HCS_Stack_gud_0015__hcs_stack_gud_0011_p10714859182111">如果待备份虚拟机的存储信息不在此汇总文件中，则请联系华为云Stack的环境管理员获取，并添加至华为云Stack的注册信息中。</p>
</div></div>
</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.3.2.2.2.3.1.1 "><p><span>端口</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.3.2.2.2.3.1.2 "><p>存储资源的访问端口，默认是8088。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.3.2.2.2.3.1.1 "><p><span>用户名</span></p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="74.37%" headers="mcps1.3.4.2.3.2.2.2.3.1.2 "><p>登录存储资源DeviceManager界面的管理员或超级管理员的用户名和密码。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.4.2.3.2.2.2.3.1.1 "><p><span>密码</span></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.3.2.2.2.3.1.1 "><p><span>校验证书</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.3.2.2.2.3.1.2 "><p>默认开启，注册华为云Stack时会对存储资源的证书进行校验，确保<span>OceanProtect</span>与外部设备交互的安全性。关闭后，系统与存储设备通信可能存在安全风险，请谨慎操作。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.3.2.2.2.3.1.1 "><p><span>证书</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.3.2.2.2.3.1.2 "><p>请导入<a href="HCS_Stack_gud_0013.html">步骤1：（可选）获取证书</a>章节中获取的存储资源的CA证书。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.3.2.2.2.3.1.1 "><p><span>吊销列表</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.3.2.2.2.3.1.2 "><p>吊销列表由证书颁发机构发布，导入证书吊销列表后，系统将校验客户端证书是否被吊销，如果证书已被吊销，则注册存储设备失败。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.629999999999995%" headers="mcps1.3.4.2.3.2.2.2.3.1.1 "><div class="p">VBS节点登录信息<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><p>仅1.5.0SPC19及后续版本“<span>类型</span>”选择“<span>华为分布式块存储</span>”时存在此参数。</p>
</div></div>
</div>
</td>
<td class="cellrowborder" valign="top" width="74.37%" headers="mcps1.3.4.2.3.2.2.2.3.1.2 "><div class="p">当需要使用内置客户端对华为分布式块存储（8.1.3及后续版本）的卷进行增量备份时，请打开开关，并执行以下操作。<ol type="a"><li id="HCS_Stack_gud_0015__li867914501416"><a name="HCS_Stack_gud_0015__li867914501416"></a><a name="li867914501416"></a>在当前界面配置VBS节点的IP地址、端口、用户名和密码。<ul><li>“IP地址”：请输入VBS节点的IP地址。</li><li>“端口”：SSH服务端口，默认为<strong>22</strong>。</li><li>“用户名”：请输入具有VBS节点登录权限的用户名，例如<strong>fsp</strong>。</li><li>“密码”：请输入用户密码。</li></ul>
</li><li>检查配置的用户是否有权限执行VBS命令。<ol><li>使用PuTTY，以配置的用户登录配置的VBS节点。</li><li>执行以下命令，检查该用户是否有权限执行VBS命令。<p><strong>sudo</strong> <strong>/bin/vbs_cli</strong></p>
<p><strong>sudo</strong> <strong>/opt/dsware/vbs/script/vbs/vbs_cmd.sh</strong></p>
<p><strong>sudo /bin/sh</strong></p>
<p>如果能成功执行以上命令并无需输入密码，表示该用户有执行VBS命令权限，则结束操作。否则，请继续执行<a href="#HCS_Stack_gud_0015__li849205913223">3</a>。</p>
</li></ol>
</li><li id="HCS_Stack_gud_0015__li849205913223"><a name="HCS_Stack_gud_0015__li849205913223"></a><a name="li849205913223"></a>请执行以下操作，为用户配置VBS命令执行权限。<ol><li>执行<strong>su - root</strong>命令，输入<strong>root</strong>用户密码，切换到<strong>root</strong>用户。</li><li>执行<strong>vi /etc/sudoers</strong>命令，打开配置文件，并将以下内容增加至配置文件。<pre class="screen"><em>fsp</em> ALL=(root) NOPASSWD:/bin/vbs_cli
<em>fsp</em> ALL=(root) NOPASSWD:/opt/dsware/vbs/script/vbs/vbs_cmd.sh
<em>fsp</em> ALL=(root) NOPASSWD:/bin/sh</pre>
<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><p>其中，<em>fsp</em>为<a href="#HCS_Stack_gud_0015__li867914501416">1</a>中配置的“用户名”，请根据实际替换。</p>
</div></div>
</li></ol>
</li></ol>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</p></li><li><span>单击<span class="uicontrol">“<span>确定</span>”</span>。</span><p><p>注册成功后，已注册的华为云Stack信息将在页面左侧显示。</p>
</p></li></ol>
</div>
</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="HCS_Stack_gud_0012.html">备份云硬盘</a></div>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">版权所有 &copy; 华为技术有限公司</div></body>
</html>