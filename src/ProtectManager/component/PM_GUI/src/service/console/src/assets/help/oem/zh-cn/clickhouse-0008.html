<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="DC.Type" content="topic">
  <meta name="DC.Title" content="步骤1：注册ClickHouse集群">
  <meta name="product" content="">
  <meta name="DC.Relation" scheme="URI" content="clickhouse-0007.html">
  <meta name="prodname" content="">
  <meta name="version" content="">
  <meta name="brand" content="30-OceanProtect 备份一体机 1.5.0-1.6.0 帮助中心">
  <meta name="DC.Publisher" content="20240320">
  <meta name="prodname" content="csbs">
  <meta name="documenttype" content="usermanual">
  <meta name="DC.Format" content="XHTML">
  <meta name="DC.Identifier" content="clickhouse-0008">
  <meta name="DC.Language" content="zh-cn">
  <link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
  <title>步骤1：注册ClickHouse集群</title>
 </head>
 <body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px">
  <a name="clickhouse-0008"></a><a name="clickhouse-0008"></a>
  <h1 class="topictitle1">步骤1：注册ClickHouse集群</h1>
  <div>
   <p>执行ClickHouse数据库或表集备份恢复前，需要将ClickHouse集群注册至<span>本产品</span>。</p>
   <div class="section">
    <h4 class="sectiontitle">前提条件</h4>
    <p>已添加ClickHouse主机。</p>
   </div>
   <div class="section">
    <h4 class="sectiontitle">操作步骤</h4>
    <ol>
     <li><span>选择<span class="uicontrol" id="clickhouse-0008__zh-cn_topic_0000001839142377_uicontrol12263171215409">“<span id="clickhouse-0008__zh-cn_topic_0000001839142377_text1926371213406">保护</span> &gt; 大数据 &gt; ClickHouse”</span>。</span></li>
     <li><span>在<span class="uicontrol">“<span>集群</span>”</span>页面，单击<span class="uicontrol">“<span>注册</span>”</span>，注册ClickHouse集群。</span><p></p>
      <ol type="a">
       <li>填写ClickHouse集群的名称。</li>
       <li>添加节点。参数说明如<a href="#clickhouse-0008__table196232217593">表1</a>所示。 
        <div class="tablenoborder">
         <a name="clickhouse-0008__table196232217593"></a><a name="table196232217593"></a>
         <table cellpadding="4" cellspacing="0" summary="" id="clickhouse-0008__table196232217593" frame="border" border="1" rules="all">
          <caption>
           <b>表1 </b>添加ClickHouse节点
          </caption>
          <colgroup>
           <col style="width:25.03%">
           <col style="width:74.97%">
          </colgroup>
          <thead align="left">
           <tr>
            <th align="left" class="cellrowborder" valign="top" width="25.03%" id="mcps1.3.3.2.2.2.1.2.2.2.3.1.1"><p>参数</p></th>
            <th align="left" class="cellrowborder" valign="top" width="74.97%" id="mcps1.3.3.2.2.2.1.2.2.2.3.1.2"><p>说明</p></th>
           </tr>
          </thead>
          <tbody>
           <tr>
            <td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.1 "><p><span>主机</span></p></td>
            <td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.2 "><p>选择已经注册的ClickHouse主机。</p></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.1 "><p><span>客户端安装路径</span></p></td>
            <td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.2 "><p>MRS集群客户端的安装路径。</p></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.1 "><p><span>业务IP</span></p></td>
            <td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.2 "><p>ClickHouse业务IP。</p></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.1 "><p><span>端口</span></p></td>
            <td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.2 "><p>用户客户端通过TCP ssl连接到ClickHouse server的端口，默认为21427。取值范围：21420~21469。</p></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.1 "><p><span>认证方式</span></p></td>
            <td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.2 "><p>配置ClickHouse集群与<span>本产品</span>通信的认证模式。该配置项根据ClickHouse集群开启的认证方式配置。</p>
             <ul>
              <li><span>数据库认证</span>：当ClickHouse集群未开启Kerberos认证时，选择该认证模式。该认证方式采用用户名进行认证，安全性较差。</li>
              <li><span>Kerberos认证</span>：当ClickHouse集群已启用Kerberos认证时，选择该认证模式。ClickHouse集群与<span>本产品</span>之间采用Kerberos协议进行身份认证。</li>
             </ul></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.1 "><p><span>数据库用户名</span></p></td>
            <td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.2 "><p>当<span class="uicontrol">“<span>认证方式</span>”</span>选择<span class="uicontrol">“<span>数据库认证</span>”</span>时，才需要配置该参数。</p> <p>输入的用户必须具有受保护资源的读写权限。</p></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.1 "><p><span>密码</span></p></td>
            <td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.2 "><p>当<span class="uicontrol">“<span>认证方式</span>”</span>选择<span class="uicontrol">“<span>数据库认证</span>”</span>时，才需要配置该参数。</p> <p>输入数据库用户的密码。</p></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.1 "><p><span>Kerberos</span></p></td>
            <td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.1.2.2.2.3.1.2 "><p>当<span class="uicontrol">“<span>认证方式</span>”</span>选择<span class="uicontrol">“<span>Kerberos认证</span>”</span>时，才需要配置该参数。</p> <p>选择已创建的Kerberos认证。首次注册ClickHouse集群时，请单击<span class="uicontrol">“<span>创建</span>”</span>，配置Kerberos认证参数。具体参数说明如<a href="#clickhouse-0008__table93413354118">表2</a>。</p></td>
           </tr>
          </tbody>
         </table>
        </div> <p>配置Kerberos认证参数，相关参数说明如<a href="#clickhouse-0008__table93413354118">表2</a>。</p>
        <div class="tablenoborder">
         <a name="clickhouse-0008__table93413354118"></a><a name="table93413354118"></a>
         <table cellpadding="4" cellspacing="0" summary="" id="clickhouse-0008__table93413354118" frame="border" border="1" rules="all">
          <caption>
           <b>表2 </b>Kerberos认证参数说明
          </caption>
          <colgroup>
           <col style="width:23.24%">
           <col style="width:76.75999999999999%">
          </colgroup>
          <thead align="left">
           <tr>
            <th align="left" class="cellrowborder" valign="top" width="23.24%" id="mcps1.3.3.2.2.2.1.2.4.2.3.1.1"><p>参数</p></th>
            <th align="left" class="cellrowborder" valign="top" width="76.75999999999999%" id="mcps1.3.3.2.2.2.1.2.4.2.3.1.2"><p>说明</p></th>
           </tr>
          </thead>
          <tbody>
           <tr>
            <td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.1 "><p><span>名称</span></p></td>
            <td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.2 "><p>自定义Kerberos认证名称。</p></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.1 "><p><span>主体名</span></p></td>
            <td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.2 "><p>Kerberos认证的主体名。</p>
             <div class="note">
              <span class="notetitle"> 说明： </span>
              <div class="notebody">
               <p>配置为Kerberos服务器上已配置的主体名，并且该主体名需要对要访问的资源具备管理权限。</p>
              </div>
             </div></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.1 "><p><span>配置方式</span></p></td>
            <td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.2 ">
             <div class="p">
              Kerberos认证方式，与Kerberos服务器的配置保持一致。Kerberos支持以下两种认证方式：
              <ul>
               <li><span>密码</span>：通过主体名+密码完成身份认证。</li>
               <li><span>Keytab文件</span>：通过主体名+keytab文件完成身份认证。</li>
              </ul>
             </div></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.1 "><p><span>配置文件</span></p></td>
            <td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.2 "><p>Kerberos认证过程中使用的<span class="filepath">“.conf”</span>配置文件（如：krb5.conf）。请联系Kerberos服务器管理员从Kerberos服务器获取该文件，单击<span><img src="zh-cn_image_0000001792543204.png"></span>上传至<span>本产品</span>。</p>
             <div class="p">
              由于Kerberos自身的问题，当配置文件中存在<span class="uicontrol">“renew_lifetime”</span>参数时，需将其注释，否则可能导致注册失败。如：
              <pre class="screen">#renew_lifetime = 7d</pre>
             </div></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.1 "><p><span>密码</span></p></td>
            <td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.2 "><p>当<span class="uicontrol">“<span>配置方式</span>”</span>选择<span class="uicontrol">“<span>密码</span>”</span>时，才需要配置该参数。</p> <p>配置为<span class="uicontrol">“<span>主体名</span>”</span>的密码。</p></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.1 "><p><span>确认密码</span></p></td>
            <td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.2 "><p>确认<span class="uicontrol">“<span>主体名</span>”</span>的密码。</p></td>
           </tr>
           <tr>
            <td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.1 "><p><span>Keytab文件</span></p></td>
            <td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.1.2.4.2.3.1.2 "><p>当<span class="uicontrol">“<span>配置方式</span>”</span>选择<span class="uicontrol">“<span>Keytab文件</span>”</span>时，才需要配置该参数。Kerberos认证过程中使用的<span class="filepath">“.keytab”</span>文件（如：krb5.keytab）。</p> <p>请联系Kerberos服务器管理员从Kerberos服务器获取该文件，单击<span><img src="zh-cn_image_0000001839182581.png"></span>上传至<span>本产品</span>。</p></td>
           </tr>
          </tbody>
         </table>
        </div></li>
      </ol> <p></p></li>
     <li><span>单击<span class="uicontrol">“<span>确定</span>”</span>。ClickHouse集群注册完成后，系统会自动发现ClickHouse数据库，您可以在<span class="uicontrol">“<span>数据库</span>”</span>页签查看新发现上来的数据库。</span></li>
    </ol>
   </div>
   <p></p>
  </div>
  <div>
   <div class="familylinks">
    <div class="parentlink">
     <strong>父主题：</strong> <a href="clickhouse-0007.html">备份ClickHouse数据库/ClickHouse表集</a>
    </div>
   </div>
  </div>
 </body>
</html>