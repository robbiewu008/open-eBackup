
<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->

<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="备份前准备">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="oracle_gud_0008.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="30-OceanProtect 备份一体机 1.5.0-1.6.0 帮助中心">
<meta name="DC.Publisher" content="20240320">
<meta name="prodname" content="csbs">
<meta name="documenttype" content="usermanual">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="oracle_gud_0012">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<title>备份前准备</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="oracle_gud_0012"></a><a name="oracle_gud_0012"></a>

<h1 class="topictitle1">备份前准备</h1>
<div><p>备份Oracle数据库前，请参考<a href="#oracle_gud_0012__zh-cn_topic_0000001455091930_table10744125193920">表1</a>提前准备相关信息。以下信息均会在<a href="oracle_gud_0023.html">步骤4：注册数据库</a>章节使用。</p>
<div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><ul><li>请确保Oracle数据库为Open状态，再进行相关查询操作，Oracle数据库状态查询请参考<a href="oracle_gud_0015.html">步骤1：检查并配置数据库环境</a>。</li><li><span>本节操作如无特殊说明均以Oracle 19版本为例进行，Oracle版本不同操作可能存在差异，请以实际为准。</span></li><li><span>对于以集群方式部署的Oracle数据库，如无特殊说明，均需登录集群下所有主机执行以下操作。</span></li></ul>
</div></div>

<div class="tablenoborder"><a name="oracle_gud_0012__zh-cn_topic_0000001455091930_table10744125193920"></a><a name="zh-cn_topic_0000001455091930_table10744125193920"></a><table cellpadding="4" cellspacing="0" summary="" id="oracle_gud_0012__zh-cn_topic_0000001455091930_table10744125193920" frame="border" border="1" rules="all"><caption><b>表1 </b>备份前准备</caption><colgroup><col style="width:17.34%"><col style="width:11.55%"><col style="width:54.769999999999996%"><col style="width:16.34%"></colgroup><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="17.34%" id="mcps1.3.3.2.5.1.1"><p>准备项</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="11.55%" id="mcps1.3.3.2.5.1.2"><p>是否必须</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="54.769999999999996%" id="mcps1.3.3.2.5.1.3"><p>获取方式</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="16.34%" id="mcps1.3.3.2.5.1.4"><p>数据使用章节</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="17.34%" headers="mcps1.3.3.2.5.1.1 "><p>名称</p>
</td>
<td class="cellrowborder" valign="top" width="11.55%" headers="mcps1.3.3.2.5.1.2 "><p>必选</p>
</td>
<td class="cellrowborder" valign="top" width="54.769999999999996%" headers="mcps1.3.3.2.5.1.3 "><p>要保护的数据库名称。</p>
<div class="p">该名称与生产环境的数据库名称保持一致。一般数据库的name与db_unique_name一致，当两者不一致时，请配置为db_unique_name。可通过以下SQL语句查看name与db_unique_name。<pre class="screen">select name,db_unique_name FROM v$database;</pre>
</div>
</td>
<td class="cellrowborder" rowspan="11" valign="top" width="16.34%" headers="mcps1.3.3.2.5.1.4 "><p><a href="oracle_gud_0023.html">步骤4：注册数据库</a></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.1 "><p>主机</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.2 "><p>必选</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.3 "><p>Oracle数据库所在的主机名称或IP地址。如果是集群部署，请获取Oracle数据库分布的所有主机名称或IP地址。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.1 "><p>数据库认证方式（适用于Linux操作系统）</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.2 "><p>必选</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.3 "><p>数据库认证方式，查询方法如下：</p>
<ol><li>使用PuTTY，登录Oracle数据库主机。</li><li>执行以下命令，切换到数据库安装用户，如<strong>oracle</strong>用户。<pre class="screen">su - oracle</pre>
</li><li>执行以下命令查询数据库认证方式。<pre class="screen">cat $ORACLE_HOME/network/admin/sqlnet.ora</pre>
<ul id="oracle_gud_0012__ul1281144762818"><li id="oracle_gud_0012__li1181793163115">如果不存在sqlnet.ora文件，则表示为OS认证方式。</li><li id="oracle_gud_0012__li5252161217474">如果存在sqlnet.ora文件，且文件中存在记录：SQLNET.AUTHENTICATION_SERVICES= (ALL)或SQLNET.AUTHENTICATION_SERVICES= (NTS)，则表示为OS认证方式。</li><li id="oracle_gud_0012__li728111476285">如果存在sqlnet.ora文件，并且文件中存在记录：SQLNET.AUTHENTICATION_SERVICES= (None)，则表示为数据库认证。</li></ul>
</li></ol>
<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><ul><li>当要备份的数据库所在的主机为Oracle ADG集群的从端，则要求数据库必须采用数据库认证方式。</li><li>当指定了多个代理主机执行备份任务时，则要求数据库必须采用数据库认证方式。</li></ul>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.1 "><p>数据库认证方式（适用于Windows操作系统）</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.2 "><p>必选</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.3 "><p>数据库认证方式，查询方法如下：</p>
<ol><li id="oracle_gud_0012__li133281524514">系统管理员登录Oracle数据库主机。</li><li>在键盘上按<span class="uicontrol" id="oracle_gud_0012__oracle_gud_0016_uicontrol11819941114510">“Win+R”</span>，打开运行窗口。</li><li>输入<span class="parmvalue">“regedit”</span>，打开注册表，在“HKEY_LOCAL_MACHINE\SOFTWARE\ORACLE\KEY_OraDB<em>12Home</em>”路径下获取<span class="parmname">“ORACLE_HOME”</span>的路径。<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><p>路径中“KEY_OraDB<em>12Home</em>”为示例，请以实际为准。</p>
</div></div>
</li><li>进入“<em>ORACLE_HOME</em><em>的路径</em>\network\admin”路径，查看数据库认证方式。<ul><li id="oracle_gud_0012__oracle_gud_0012_li1181793163115">如果不存在sqlnet.ora文件，则表示为OS认证方式。</li><li id="oracle_gud_0012__oracle_gud_0012_li5252161217474">如果存在sqlnet.ora文件，且文件中存在记录：SQLNET.AUTHENTICATION_SERVICES= (ALL)或SQLNET.AUTHENTICATION_SERVICES= (NTS)，则表示为OS认证方式。</li><li id="oracle_gud_0012__oracle_gud_0012_li728111476285">如果存在sqlnet.ora文件，并且文件中存在记录：SQLNET.AUTHENTICATION_SERVICES= (None)，则表示为数据库认证。</li></ul>
</li></ol>
<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><p>当指定了多个代理主机执行备份任务时，则要求数据库必须采用数据库认证方式。</p>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.1 "><p>数据库用户名及密码</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.2 "><p>可选</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.3 "><p>当数据库认证方式为数据库认证时，需要获取具有sysdba权限的数据库用户名及密码。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.1 "><p>数据库安装用户名（适用于Linux操作系统）</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.2 "><p>必选</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.3 "><p>安装数据库的用户，如<strong>oracle</strong>。</p>
<p>该用户可登录数据库主机，执行以下命令查询。</p>
<pre class="screen">ps -ef  | grep pmon</pre>
<p>回显类似如下，<em>xxx</em><strong>_pmon_hwdb</strong>所在行的用户即为安装数据库的用户。</p>
<p><span><img src="zh-cn_image_0000001909814804.png"></span></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.1 "><p>数据库安装用户名（适用于Windows操作系统）</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.2 "><p>必选</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.3 "><p>安装数据库的用户。后续操作均以<strong id="oracle_gud_0012__zh-cn_topic_0000001656680997_b196811087138">oracle</strong>用户为例。</p>
<p>该用户名可登录数据库主机查询，操作如下：</p>
<ol><li>以系统管理员登录Oracle数据库主机。</li><li>在键盘上按<span class="uicontrol" id="oracle_gud_0012__zh-cn_topic_0000001656760969_uicontrol11819941114510">“Win+R”</span>，打开运行窗口。</li><li>输入<span class="parmvalue">“regedit”</span>，打开注册表。</li><li>在“HKEY_LOCAL_MACHINE\SOFTWARE\Oracle\KEY_OraDB<em>19Home</em><em>1</em>”路径下获取<span class="parmname">“ORACLE_GROUP_NAME”</span>的值。<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><p>路径中的<em>19Home</em><em>1</em>仅为示例，请以实际为准。</p>
</div></div>
<p><span class="parmname">“ORACLE_GROUP_NAME”</span>的值类似如下，其中<strong>Oracle</strong>即为安装数据库的用户。</p>
<p><span class="parmname">“ORACLE_SID”</span>的值为数据库实例名称。</p>
<p><span><img src="zh-cn_image_0000002035794917.png"></span></p>
</li></ol>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.1 "><p>安装用户名</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.2 "><p>可选</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.3 "><p>ASM的安装用户名，后续操作均以<strong>grid</strong>用户为例。</p>
<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><p id="oracle_gud_0012__zh-cn_topic_0000001656680997_p1836318172815">对于集群场景，登录任一Oracle数据库主机，执行以下操作即可。</p>
</div></div>
<p>该用户可登录Oracle数据库主机，执行以下命令查询ASM的安装用户名。</p>
<pre class="screen">ps -ef | grep pmon</pre>
<p>回显类似如下，<em>xxx</em><strong>_pmon_+ASM</strong>所在行的用户即为ASM的安装用户。</p>
<p><span><img src="zh-cn_image_0000001999754012.png"></span></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.1 "><p>ASM认证（适用于Linux操作系统）</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.2 "><p>可选</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.3 "><p>如果数据库使用了ASM，则需要获取ASM认证信息。</p>
<ol><li>执行以下SQL语句，确认数据库是否已使用ASM。<pre class="screen">select name from v$datafile;</pre>
<p>如果回显显示的是ASM目录，则表示已使用ASM，如：+DATA/DB/DATAFILE/system.264.113035</p>
</li><li>如果已使用ASM，确认数据库的ASM认证方式。具体方法如下：<ol type="a"><li>使用PuTTY，登录数据库主机。</li><li>执行以下命令切换至ASM的安装用户名，如<strong>grid</strong>用户。<pre class="screen">su - grid</pre>
</li><li>执行以下命令进入<span class="filepath">“/admin”</span>目录。<pre class="screen">cd $ORACLE_HOME/network/admin</pre>
</li><li>检查该目录下是否存在<span class="filepath">“sqlnet.ora”</span>文件。</li></ol>
<ul><li id="oracle_gud_0012__oracle_gud_0012_li1181793163115_1">如果不存在sqlnet.ora文件，则表示为OS认证方式。</li><li id="oracle_gud_0012__oracle_gud_0012_li5252161217474_1">如果存在sqlnet.ora文件，且文件中存在记录：SQLNET.AUTHENTICATION_SERVICES= (ALL)或SQLNET.AUTHENTICATION_SERVICES= (NTS)，则表示为OS认证方式。</li><li id="oracle_gud_0012__oracle_gud_0012_li728111476285_1">如果存在sqlnet.ora文件，并且文件中存在记录：SQLNET.AUTHENTICATION_SERVICES= (None)，则表示为数据库认证。</li></ul>
</li></ol>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.1 "><p>ASM认证（适用于Windows操作系统）</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.2 "><p>可选</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.3 "><p>如果数据库使用了ASM，则需要获取ASM认证信息。</p>
<ol><li>执行以下SQL语句，确认数据库是否已使用ASM。<pre class="screen">select name from v$datafile;</pre>
<p>如果回显显示的是ASM目录，则表示已使用ASM，如：+DATA/DB/DATAFILE/system.264.113035</p>
</li><li>如果已使用ASM，确认数据库的ASM认证方式。具体方法如下：<ol type="a"><li>系统管理员登录Oracle数据库主机。</li><li>在键盘上按<span class="uicontrol" id="oracle_gud_0012__oracle_gud_0016_uicontrol11819941114510_1">“Win+R”</span>，打开运行窗口。</li><li>输入<span class="parmvalue">“regedit”</span>，打开注册表，在“HKEY_LOCAL_MACHINE\SOFTWARE\ORACLE\KEY_OraGl<em>12Home</em>”路径下获取<span class="parmname">“ORACLE_HOME”</span>的路径。<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><p>路径中“KEY_OraGl<em>12Home</em>”为示例，请以实际为准。</p>
</div></div>
</li><li>进入“<em>ORACLE_HOME</em><em>的路径</em>\network\admin”路径，查看数据库认证方式。</li></ol>
<ul><li id="oracle_gud_0012__oracle_gud_0012_li1181793163115_2">如果不存在sqlnet.ora文件，则表示为OS认证方式。</li><li id="oracle_gud_0012__oracle_gud_0012_li5252161217474_2">如果存在sqlnet.ora文件，且文件中存在记录：SQLNET.AUTHENTICATION_SERVICES= (ALL)或SQLNET.AUTHENTICATION_SERVICES= (NTS)，则表示为OS认证方式。</li><li id="oracle_gud_0012__oracle_gud_0012_li728111476285_2">如果存在sqlnet.ora文件，并且文件中存在记录：SQLNET.AUTHENTICATION_SERVICES= (None)，则表示为数据库认证。</li></ul>
</li></ol>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.1 "><p>ASM用户名及密码</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.2 "><p>可选</p>
</td>
<td class="cellrowborder" valign="top" headers="mcps1.3.3.2.5.1.3 "><p>当认证方式为ASM认证时，需要获取具有sysdba权限的ASM用户名及密码。</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="oracle_gud_0008.html">备份</a></div>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">版权所有 &copy; 华为技术有限公司</div></body>
</html>