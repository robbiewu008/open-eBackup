
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="步骤3：注册HDFS集群">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="zh-cn_topic_0000001792557044.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="30-OceanProtect 备份一体机 1.5.0-1.6.0 帮助中心">
<meta name="DC.Publisher" content="20240320">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ZH-CN_TOPIC_0000001792557040">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<title>步骤3：注册HDFS集群</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="ZH-CN_TOPIC_0000001792557040"></a><a name="ZH-CN_TOPIC_0000001792557040"></a>

<h1 class="topictitle1">步骤3：注册HDFS集群</h1>
<div><p>执行HDFS文件集备份恢复前，需要将HDFS集群注册至<span>OceanProtect</span>。</p>
<div class="section" id="ZH-CN_TOPIC_0000001792557040__section10758914153313"><a name="ZH-CN_TOPIC_0000001792557040__section10758914153313"></a><a name="section10758914153313"></a><h4 class="sectiontitle">前提条件</h4><p>已获取HDFS集群中的<span class="filepath">“hdfs-site.xml”</span>和<span class="filepath">“core-site.xml”</span>文件，获取方法可参考以下步骤：</p>
<ul><li>大数据平台为CDH（Cloudera's Distribution Apache Of Hadoop）<p>本节以<span style="color:#1C2429;">Cloudera Express 6.3.1</span>版本为例说明，不同版本的操作可能存在差异，可查看CDH产品文档进行操作。</p>
<ol><li>使用浏览器，登录<span style="color:#1C2429;">Cloudera</span> Manager。</li><li>选择<span class="uicontrol">“群集 &gt; HDFS”</span>。</li><li>单击HDFS右侧的<span class="uicontrol">“操作 &gt; 下载客户端配置”</span>。</li><li>在下载得到的压缩包中获取<span class="filepath">“hdfs-site.xml”</span>和<span class="filepath">“core-site.xml”</span>文件。</li></ol>
</li><li>大数据平台为FusionInsight<p>本节以<span style="color:#1C2429;">FusionInsight 6.5.1</span>版本为例说明，不同版本的操作可能存在差异，可查看FusionInsight产品文档进行操作。</p>
<ol><li>使用浏览器，登录FusionInsight Manager。</li><li>选择<span class="uicontrol">“Cluster &gt; HDFS”</span>。</li><li>在页面右上方选择<span class="uicontrol">“More &gt; Download Client”</span>。</li><li>在下载得到的压缩包中获取<span class="filepath">“hdfs-site.xml”</span>和<span class="filepath">“core-site.xml”</span>文件。</li></ol>
</li><li>大数据平台为星环大数据（TDH）<p>本节以TDH 8.0.2版本为例说明，不同版本的操作可能存在差异，可查看Transwarp Data Hub产品文档进行操作。</p>
<ol><li>使用浏览器，登录Transwarp Data Hub。</li><li>选择“仪表盘 &gt; 集群”，单击界面中的HDFS集群进入集群页面。</li><li>在HDFS集群页面右上方选择<span><img src="zh-cn_image_0000001839276425.png"></span>图标， 单击“下载服务配置”。</li><li>在下载得到的压缩包中获取“hdfs-site.xml”和“core-site.xml”文件。</li><li>删除core-site.xml文件中的以下内容。</li></ol>
<pre class="screen">&lt;property&gt;
    &lt;name&gt;hadoop.security.group.mapping.ldap.bind.password.file&lt;/name&gt;
    &lt;value&gt;/etc/hdfs1/conf/ldap-conn-pass.txt&lt;/value&gt;
&lt;/property&gt;</pre>
</li></ul>
</div>
<div class="section"><h4 class="sectiontitle">操作步骤</h4><ol><li id="ZH-CN_TOPIC_0000001792557040__zh-cn_topic_0000001249935107_li1368863015381"><span>选择<span class="uicontrol" id="ZH-CN_TOPIC_0000001792557040__zh-cn_topic_0000001839142377_uicontrol1225102113916">“<span id="ZH-CN_TOPIC_0000001792557040__zh-cn_topic_0000001839142377_text1125113213390">保护</span> &gt; 大数据 &gt; HDFS”</span>。</span></li><li><span>在<span class="uicontrol">“<span>集群</span>”</span>页面，单击<span class="uicontrol">“<span>注册</span>”</span>，注册HDFS集群。</span><p><p>HDFS集群注册信息如<a href="#ZH-CN_TOPIC_0000001792557040__table164432003147">表1</a>所示。</p>

<div class="tablenoborder"><a name="ZH-CN_TOPIC_0000001792557040__table164432003147"></a><a name="table164432003147"></a><table cellpadding="4" cellspacing="0" summary="" id="ZH-CN_TOPIC_0000001792557040__table164432003147" frame="border" border="1" rules="all"><caption><b>表1 </b>HDFS集群注册信息</caption><colgroup><col style="width:25.03%"><col style="width:74.97%"></colgroup><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="25.03%" id="mcps1.3.3.2.2.2.2.2.3.1.1"><p>参数</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="74.97%" id="mcps1.3.3.2.2.2.2.2.3.1.2"><p>说明</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.2.2.3.1.1 "><p><span>名称</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.2.2.3.1.2 "><p>自定义HDFS集群名称。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.2.2.3.1.1 "><p>hdfs-site.xml</p>
</td>
<td class="cellrowborder" rowspan="2" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.2.2.3.1.2 "><p>将<a href="#ZH-CN_TOPIC_0000001792557040__section10758914153313">前提条件</a>中已获取到的<span class="filepath">“hdfs-site.xml”</span>和<span class="filepath">“core-site.xml”</span>文件上传至管理界面。</p>
<p>该文件用于配置HDFS集群的相关信息，如集群地址、端口等。</p>
<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><ul><li>大数据集群仅支持配置IPv4地址，不支持IPv6地址。请您注意检查配置文件中的配置是否正确。</li><li>上传至管理界面的配置文件信息必须与大数据集群上的配置文件信息一致，请勿在本地对其配置信息进行修改。</li></ul>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.3.2.2.2.2.2.3.1.1 "><p>core-site.xml</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.2.2.3.1.1 "><p><span>认证模式</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.2.2.3.1.2 "><p>配置HDFS集群与<span>OceanProtect</span>通信的认证模式。该配置项根据HDFS集群已配置的认证模式进行配置。</p>
<ul><li><span>Simple认证</span>：当HDFS集群未开启Kerberos认证时，选择该认证模式。该认证模式采用用户名进行认证，安全性较差。</li><li><span>Kerberos认证</span>：当HDFS集群已启用Kerberos认证时，选择该认证模式。HDFS集群与<span>OceanProtect</span>之间采用Kerberos协议进行身份认证。</li></ul>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.2.2.3.1.1 "><p><span>用户名</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.2.2.3.1.2 "><p>当<span class="uicontrol">“<span>认证模式</span>”</span>选择<span class="uicontrol">“<span>Simple认证</span>”</span>时，才需要配置该参数。</p>
<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><ul><li>输入的用户名需要对要访问的资源具备读写权限。</li><li>如果恢复HDFS文件时要同时恢复HDFS ACL信息，那么此处注册的主体名需要具备HDFS超级用户权限。如：您可以在大数据平台将主体名加入supergroup中，使其具备HDFS超级用户权限。</li></ul>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.2.2.3.1.1 "><p><span>Kerberos</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.2.2.3.1.2 "><p>当<span class="uicontrol">“<span>认证模式</span>”</span>选择<span class="uicontrol">“<span>Kerberos认证</span>”</span>时，才需要配置该参数。</p>
<p>选择已创建的Kerberos认证。首次注册HDFS集群时，请单击<span class="uicontrol">“创建”</span>，配置Kerberos认证参数。具体参数说明如<a href="#ZH-CN_TOPIC_0000001792557040__table93413354118">表2</a>。</p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.2.2.3.1.1 "><p><span>代理主机</span></p>
</td>
<td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.2.2.3.1.2 "><p>选择执行数据保护的代理主机。</p>
<div class="note"><span class="notetitle"> 说明： </span><div class="notebody"><p>不允许将同一台代理主机分配给多个配置了不同Kerberos认证的大数据集群或不同认证模式的大数据集群，否则会导致备份/恢复任务失败。</p>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="25.03%" headers="mcps1.3.3.2.2.2.2.2.3.1.1 "><p>ACL备份</p>
</td>
<td class="cellrowborder" valign="top" width="74.97%" headers="mcps1.3.3.2.2.2.2.2.3.1.2 "><p>备份ACL的开关</p>
<p><span style="color:#282B33;">当大数据平台上HDFS ACL配置“dfs.namenode.acls.enabled”和当前开关同时开启时，才会备份ACL。</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p>配置Kerberos认证参数，相关参数说明如<a href="#ZH-CN_TOPIC_0000001792557040__table93413354118">表2</a>。</p>

<div class="tablenoborder"><a name="ZH-CN_TOPIC_0000001792557040__table93413354118"></a><a name="table93413354118"></a><table cellpadding="4" cellspacing="0" summary="" id="ZH-CN_TOPIC_0000001792557040__table93413354118" frame="border" border="1" rules="all"><caption><b>表2 </b>Kerberos认证参数说明</caption><colgroup><col style="width:23.24%"><col style="width:76.75999999999999%"></colgroup><thead align="left"><tr id="ZH-CN_TOPIC_0000001792557040__row434173521115"><th align="left" class="cellrowborder" valign="top" width="23.24%" id="mcps1.3.3.2.2.2.4.2.3.1.1"><p id="ZH-CN_TOPIC_0000001792557040__p1134143591114">参数</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="76.75999999999999%" id="mcps1.3.3.2.2.2.4.2.3.1.2"><p id="ZH-CN_TOPIC_0000001792557040__p1334163541111">说明</p>
</th>
</tr>
</thead>
<tbody><tr id="ZH-CN_TOPIC_0000001792557040__row123412358116"><td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.4.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792557040__p434935141114"><span id="ZH-CN_TOPIC_0000001792557040__text116228195434">名称</span></p>
</td>
<td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.4.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792557040__p334173518110">自定义Kerberos认证名称。</p>
</td>
</tr>
<tr id="ZH-CN_TOPIC_0000001792557040__row83417352118"><td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.4.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792557040__p143513352112"><span id="ZH-CN_TOPIC_0000001792557040__text13420328134312">主体名</span></p>
</td>
<td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.4.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792557040__p16354357116">Kerberos认证的主体名。</p>
<div class="note" id="ZH-CN_TOPIC_0000001792557040__note1997805374919"><span class="notetitle"> 说明： </span><div class="notebody"><ul id="ZH-CN_TOPIC_0000001792557040__ul53571451001"><li id="ZH-CN_TOPIC_0000001792557040__li133577516015">配置为Kerberos服务器上已配置的主体名，并且该主体名需要对要访问的资源具备读写权限。</li><li id="ZH-CN_TOPIC_0000001792557040__li17687183713589">如果恢复HDFS文件时要同时恢复HDFS ACL信息，那么此处注册的主体名需要具备HDFS超级用户权限。举例如下：<ul id="ZH-CN_TOPIC_0000001792557040__ul10684153715580"><li id="ZH-CN_TOPIC_0000001792557040__li176852373586">如果大数据平台为FusionInsight或CDH，您可以在大数据平台将主体名加入supergroup中，使其具备HDFS超级用户权限。</li><li id="ZH-CN_TOPIC_0000001792557040__li986445365918">如果大数据平台为TDH，您可以在大数据平台为主体名添加admin角色，使其具备HDFS超级用户权限。</li></ul>
</li></ul>
</div></div>
</td>
</tr>
<tr id="ZH-CN_TOPIC_0000001792557040__row143514356116"><td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.4.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792557040__p0352355118"><span id="ZH-CN_TOPIC_0000001792557040__text872344194318">配置方式</span></p>
</td>
<td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.4.2.3.1.2 "><div class="p" id="ZH-CN_TOPIC_0000001792557040__p14335165565315">Kerberos认证方式，与Kerberos服务器的配置保持一致。Kerberos支持以下两种认证方式：<ul id="ZH-CN_TOPIC_0000001792557040__ul79681635144315"><li id="ZH-CN_TOPIC_0000001792557040__li1996820353434"><span id="ZH-CN_TOPIC_0000001792557040__text54429228440">密码</span>：通过主体名+密码完成身份认证。</li><li id="ZH-CN_TOPIC_0000001792557040__li20858113704310"><span id="ZH-CN_TOPIC_0000001792557040__text9995192994418">Keytab文件</span>：通过主体+keytab文件完成身份认证。</li></ul>
</div>
</td>
</tr>
<tr id="ZH-CN_TOPIC_0000001792557040__row183523512112"><td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.4.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792557040__p15351835151118"><span id="ZH-CN_TOPIC_0000001792557040__text114821547144418">配置文件</span></p>
</td>
<td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.4.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792557040__p1958995015013">Kerberos认证过程中使用的<span class="filepath" id="ZH-CN_TOPIC_0000001792557040__filepath1558985065011">“.conf”</span>配置文件（如：krb5.conf）。请联系Kerberos服务器管理员从Kerberos服务器获取该文件，单击<span><img id="ZH-CN_TOPIC_0000001792557040__image958945045017" src="zh-cn_image_0000001792397360.png"></span>上传至管理界面。</p>
<div class="p" id="ZH-CN_TOPIC_0000001792557040__p335113531110">由于Kerberos自身的问题，当配置文件中存在<span class="uicontrol" id="ZH-CN_TOPIC_0000001792557040__uicontrol1462119340419">“renew_lifetime”</span>参数时，需将其注释，否则可能导致注册失败。如：<pre class="screen" id="ZH-CN_TOPIC_0000001792557040__screen43313539415">#renew_lifetime = 7d</pre>
</div>
</td>
</tr>
<tr id="ZH-CN_TOPIC_0000001792557040__row12351358112"><td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.4.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792557040__p53510353119"><span id="ZH-CN_TOPIC_0000001792557040__text132368547446">密码</span></p>
</td>
<td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.4.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792557040__p63573513114">当<span class="uicontrol" id="ZH-CN_TOPIC_0000001792557040__uicontrol10967144612199">“<span id="ZH-CN_TOPIC_0000001792557040__text155548915452">配置方式</span>”</span>选择<span class="uicontrol" id="ZH-CN_TOPIC_0000001792557040__uicontrol478945111911">“<span id="ZH-CN_TOPIC_0000001792557040__text953102164617">密码</span>”</span>时，才需要配置该参数。</p>
<p id="ZH-CN_TOPIC_0000001792557040__p1477085011175">配置为<span class="uicontrol" id="ZH-CN_TOPIC_0000001792557040__uicontrol763018714189">“<span id="ZH-CN_TOPIC_0000001792557040__text1997411411465">主体名</span>”</span>的密码。</p>
</td>
</tr>
<tr id="ZH-CN_TOPIC_0000001792557040__row5425131213143"><td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.4.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792557040__p164257122145"><span id="ZH-CN_TOPIC_0000001792557040__text1522326164613">确认密码</span></p>
</td>
<td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.4.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792557040__p1042541281412">确认<span class="uicontrol" id="ZH-CN_TOPIC_0000001792557040__uicontrol9284162064619">“<span id="ZH-CN_TOPIC_0000001792557040__text14284102010469">主体名</span>”</span>的密码。</p>
</td>
</tr>
<tr id="ZH-CN_TOPIC_0000001792557040__row1728863716141"><td class="cellrowborder" valign="top" width="23.24%" headers="mcps1.3.3.2.2.2.4.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792557040__p112881037171415"><span id="ZH-CN_TOPIC_0000001792557040__text19503531104618">Keytab文件</span></p>
</td>
<td class="cellrowborder" valign="top" width="76.75999999999999%" headers="mcps1.3.3.2.2.2.4.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792557040__p374615219184">当<span class="uicontrol" id="ZH-CN_TOPIC_0000001792557040__uicontrol6701435124612">“<span id="ZH-CN_TOPIC_0000001792557040__text1170193513465">配置方式</span>”</span>选择<span class="uicontrol" id="ZH-CN_TOPIC_0000001792557040__uicontrol67464241815">“<span id="ZH-CN_TOPIC_0000001792557040__text8150194415468">Keytab文件</span>”</span>时，才需要配置该参数。Kerberos认证过程中使用的<span class="filepath" id="ZH-CN_TOPIC_0000001792557040__filepath19934532131518">“.keytab”</span>文件（如：krb5.keytab）。</p>
<p id="ZH-CN_TOPIC_0000001792557040__p1836535991910">请联系Kerberos服务器管理员从Kerberos服务器获取该文件，单击<span><img id="ZH-CN_TOPIC_0000001792557040__image2782840141712" src="zh-cn_image_0000001792557096.png"></span>上传至管理界面。</p>
</td>
</tr>
</tbody>
</table>
</div>
</p></li><li><span>单击<span class="uicontrol">“确定”</span>。</span></li></ol>
</div>
</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>父主题：</strong> <a href="zh-cn_topic_0000001792557044.html">备份HDFS文件集</a></div>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">版权所有 &copy; 华为技术有限公司</div></body>
</html>