<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="DC.Type" content="topic">
  <meta name="DC.Title" content="安装ProtectAgent软件（手动方式，适用于Linux OS）">
  <meta name="DC.Format" content="XHTML">
  <meta name="DC.Identifier" content="ZH-CN_TOPIC_0000001839189365">
  <meta name="DC.Language" content="zh-cn">
  <link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
  <title>安装ProtectAgent软件（手动方式，适用于Linux OS）</title>
 </head>
 <body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px">
  <a name="ZH-CN_TOPIC_0000001839189365"></a><a name="ZH-CN_TOPIC_0000001839189365"></a>
  <h1 class="topictitle1">安装ProtectAgent软件（手动方式，适用于Linux OS）</h1>
  <div>
   <p id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001166356758_p77861727131820">您需要在代理主机上安装ProtectAgent软件，ProtectAgent充当<span id="ZH-CN_TOPIC_0000001839189365__text1368810101119">本产品</span>与受保护资源之间的代理进行数据备份和恢复。本节介绍登录代理主机后台手动为其安装ProtectAgent。</p>
   <div class="section">
    <h4 class="sectiontitle">注意事项</h4>
    <p>受保护资源为GaussDB(DWS)时，如果您不需要配置防火墙，可以执行<strong>systemctl stop firewalld</strong>命令关闭防火墙。如果您需要开启GaussDB(DWS)节点或代理主机的防火墙，请先开放GaussDB(DWS)备份恢复所需端口，再开启防火墙，否则可能导致GaussDB(DWS)集群无法正常使用。开放GaussDB(DWS)备份恢复所需端口的相关操作请参见<span>《OceanProtect <span id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001792502994_ph1612593082016">备份一体机 1.5.0-1.6.0</span> 数据备份特性指南(适用于GaussDB(DWS))》</span>中的<span class="uicontrol">“开放GaussDB(DWS)备份恢复所需端口”</span>章节。开启防火墙属于高危操作，请谨慎开启。</p>
   </div>
   <div class="section">
    <h4 class="sectiontitle">操作步骤</h4>
    <ol>
     <li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001191380933_li734156194217"><a name="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001191380933_li734156194217"></a><a name="zh-cn_topic_0000001191380933_li734156194217"></a><span>在OceanProtect管理界面下载ProtectAgent软件包。</span><p></p><p>具体操作可参考<a href="zh-cn_topic_0000001839189405.html">下载ProtectAgent软件包</a>。</p> <p></p></li>
     <li><span>受保护资源是否为HDFS、HBase、Hive、ElasticSearch、Redis或ClickHouse集群，且集群中配置了Kerberos认证。</span><p></p>
      <ul id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_ul0257172810237">
       <li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_li425762810230">是，安装前要确保代理主机、<span id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_text17431185819103">本产品</span>以及Kerberos服务器的时间一致。如果时间不一致，请使用同一NTP服务器，否则可能导致ProtectAgent安装失败。</li>
       <li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_li1669317304237">否，安装前要确保代理主机与<span id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_text49838681316">本产品</span>设备时间一致。</li>
      </ul> <p></p></li>
     <li><span>安装ProtectAgent软件。</span><p></p>
      <ol type="a">
       <li>使用PuTTY，登录需要安装ProtectAgent的主机。</li>
       <li>依次执行以下命令，创建软件包的存放目录并授权。<p><strong>mkdir /opt/install</strong></p> <p><strong>chmod -R 755</strong><em> /</em><em>opt/install</em></p>
        <div class="note">
         <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
         <div class="notebody">
          <ul>
           <li>软件包存放目录的权限需要为755。</li>
           <li>此处以存放目录为<span class="filepath">“/opt/install”</span>为例说明，请根据实际替换。</li>
          </ul>
         </div>
        </div></li>
       <li>使用WinSCP上传软件包至<span class="filepath">“/opt/install”</span>目录。</li>
       <li>进入<span class="filepath">“/opt/install”</span>目录后，执行以下命令解压软件包。
        <div class="p">
         <strong>unzip DataProtect_</strong><em>xxx</em><strong>_client_</strong><em>xxx</em><strong>.zip</strong>
         <div class="note" id="ZH-CN_TOPIC_0000001839189365__note131823521140">
          <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
          <div class="notebody">
           <p id="ZH-CN_TOPIC_0000001839189365__p1818285216413">不同的版本、代理类型、操作系统获取到的ProtectAgent软件包名可能会有差异，请以实际为准。</p>
          </div>
         </div>
        </div></li>
       <li>执行以下命令，进入软件包目录。<p><strong>cd /opt/install/DataProtect_</strong><em>xxx</em><strong>_client_</strong><em>xxx</em><strong>/</strong></p></li>
       <li>执行以下命令，根据回显提示完成软件安装。
        <ul>
         <li>如果使用的是系统管理员账户登录的主机，请执行<strong>sh install.sh</strong>命令。</li>
         <li>如果使用普通用户登录的主机，请执行<strong>sudo sh install.sh</strong>命令。
          <div class="note">
           <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
           <div class="notebody">
            <p>如果该普通用户为sudo非免密用户，请根据提示输入sudo密码。如果该普通用户为sudo免密用户，则无需输入sudo密码。</p>
           </div>
          </div></li>
        </ul>
        <ol class="substepthirdol">
         <li>当回显如下信息时，请根据提示输入ProtectAgent软件的安装目录。系统会自动校验填入的安装目录的有效性，默认安装在<span class="filepath">“/opt”</span>目录下，选择的安装目录权限需为755，且用户和属组为root。<pre class="screen">Enter the installation directory of the agent. The agent cannot be installed in a directory such as /tmp, /dev, /bin, /usr. Special characters such as [|;&amp;$&gt;&lt;`!]+ are not allowed. By default, the agent is installed in the /opt directory.
Please enter the agent installation directory:</pre></li>
         <li>当回显类似如下信息时，请确认主机与<span>本产品</span>设备时间一致，并输入<span class="parmvalue">“y”</span>。<pre class="screen">The current host time and time zone are 2023/08/31-17:17:49[CST]. Check whether the time and time zone are the same as those on DataBackup time:(y/n):
Your choice:</pre></li>
         <li>当回显如下信息时，请输入<a href="#ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001191380933_li734156194217">1</a>中设置的私钥密码。<pre class="screen">Enter password:</pre></li>
         <li>对于1.6.0及后续版本，当回显如下信息时，请选择是否开启源端重删功能。<pre class="screen">Whether to enable the dataturbo service:(y|n), default(n)
Your choice:</pre>
          <ul>
           <li>如果输入<span class="parmvalue">“y”</span>，则开启源端重删功能，请确保代理主机空闲内存大于2GB，系统会自动安装OceanStor DataTurbo客户端。支持源端重删的操作系统请查看<a href="https://info.support.huawei.com/storage/comp/#/oceanprotect" target="_blank" rel="noopener noreferrer">兼容性查询工具</a>。</li>
           <li>如果输入<span class="parmvalue">“n”</span>，则不开启源端重删功能。在ProtectAgent安装完成后也可手动安装OceanStor DataTurbo客户端，具体操作请参考<a href="zh-cn_topic_0000001936780456.html">安装OceanStor DataTurbo客户端（适用于1.6.0及后续版本）</a>章节。</li>
          </ul>
          <div class="note">
           <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
           <div class="notebody">
            <p id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001936780456_p1942121419116">开启源端重删功能后，请在首次备份前将源端重删用户加到sudoers中，具体操作请参见<a href="zh-cn_topic_0000001792390228.html">添加源端重删用户到sudoers</a>。</p>
           </div>
          </div></li>
        </ol> <p>当回显如下信息时，表示ProtectAgent安装成功。</p> <pre class="screen">DataBackup ProtectAgent is successfully installed on the host. </pre>
        <div class="note">
         <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
         <div class="notebody">
          <ul>
           <li>安装ProtectAgent软件时，系统自动检测环境中是否已安装net-tools工具包、iproute工具包，如检测到未安装会提示安装。</li>
           <li>安装过程中，系统会检查当前主机已配置的业务网络IP，如果检查到已配置多个业务网络IP，会提示用户选择其中一个业务IP用于代理主机备份恢复业务。</li>
           <li>安装过程中，如果系统检测到OceanProtect管理界面上存在相同IP地址但UUID不同的主机时，会提示是否覆盖OceanProtect管理界面的原主机：
            <ul>
             <li>当选择覆盖时，新安装的主机将继承原主机的副本信息，并且更新新主机的UUID与原主机相同。</li>
             <li>当选择不覆盖时，您需要先<a href="zh-cn_topic_0000001792549964.html#ZH-CN_TOPIC_0000001792549964__zh-cn_topic_0000001166835234_li1849451112587">在OceanProtect管理界面删除原主机</a>后，重新安装。</li>
            </ul></li>
          </ul>
         </div>
        </div></li>
      </ol> <p></p></li>
     <li><span>主机安装ProtectAgent软件后，OceanProtect管理界面会自动发现该主机，执行如下步骤进行检查。</span><p></p>
      <ol type="a">
       <li>选择<span class="uicontrol" id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839142377_uicontrol08941439165212">“<span id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839142377_text22651956143811">保护</span> &gt; 客户端”</span>。</li>
       <li>查看已安装ProtectAgent的主机是否已存在于OceanProtect管理界面。</li>
      </ol> <p></p></li>
    </ol>
    <ol start="5">
     <li><span>重复以上步骤为其他代理主机安装ProtectAgent软件。</span><p></p>
      <div class="note">
       <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
       <div class="notebody">
        <p>代理主机注册成功后请等待5分钟再使用该代理主机。</p>
       </div>
      </div> <p></p></li>
    </ol>
   </div>
  </div>
 </body>
</html>