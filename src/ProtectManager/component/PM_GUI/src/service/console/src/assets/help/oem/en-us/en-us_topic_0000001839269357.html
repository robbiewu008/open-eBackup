<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="DC.Type" content="topic">
  <meta name="DC.Title" content="Adding an Agent Host to Huawei Scale-Out Storage OceanStor Pacific (Applicable to FusionCompute)">
  <meta name="DC.Format" content="XHTML">
  <meta name="DC.Identifier" content="EN-US_TOPIC_0000001839269357">
  <meta name="DC.Language" content="en-us">
  <link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
  <title>Adding an Agent Host to Huawei Scale-Out Storage OceanStor Pacific (Applicable to FusionCompute)</title>
 </head>
 <body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px">
  <a name="EN-US_TOPIC_0000001839269357"></a><a name="EN-US_TOPIC_0000001839269357"></a>
  <h1 class="topictitle1">Adding an Agent Host to Huawei Scale-Out Storage OceanStor Pacific (Applicable to FusionCompute)</h1>
  <div>
   <p>If the production storage of FusionCompute (the protected environment) is a Huawei scale-out block storage cluster, add the agent host to the scale-out block storage cluster to back up FusionCompute. This section uses OceanStor Pacific 8.1.<em>x</em> as an example.</p>
   <div class="section">
    <h4 class="sectiontitle">Installing VBS</h4>
    <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_p04301219055">For details about how to install the VBS service, see section "Allocating Storage Space (SCSI Protocol-Linux)" &gt; "Creating VBS on Compute Nodes" in <em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_i847618142122">Product Documentation</em> of the corresponding storage product version. A compute node is an agent host. Set the following parameters as required. Set other parameters based on the document requirements.</p>
    <ul id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_ul996111581773">
     <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_li1096110589719"><strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_b1046454115581">Management IP Address</strong>: Enter the management IP address of the agent host.</li>
     <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_li149611258279"><strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_b1040995525818">Cabinet</strong>: Specify the cabinet where the agent host is located. It can be any value.</li>
     <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_li49619581879"><strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_b19708985915">Node Role</strong>: Select <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_b1363373045810">Compute</strong>.</li>
     <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_li119612582075"><strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_b892811256173">Installation Mode</strong>: Select <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549972_b1693082531719">Regular installation</strong>.</li>
    </ul>
   </div>
   <div class="section">
    <h4 class="sectiontitle">Replacing OceanStor Pacific Certificates</h4>
    <ol>
     <li><span>Log in to the technical support website and obtain the OceanStor Pacific API package for Huawei Cloud Stack.</span><p></p>
      <div class="p" id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_p560372712219">
       To obtain the API package, go to the following path:
       <ul id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_ul46031271529">
        <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_li2060382719212">For enterprise users: <a href="https://support.huawei.com/enterprise/en/distributed-storage/oceanstor-pacific-9520-pid-251711061/software" target="_blank" rel="noopener noreferrer">Click here.</a></li>
        <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_li5603102711218">For carrier users: <a href="https://support.huawei.com/carrier/productNewOffering?col=product&amp;path=PBI1-21430725/PBI1-251363742/PBI1-21431663/PBI1-251366323/PBI1-251711061&amp;resTab=SW" target="_blank" rel="noopener noreferrer">Click here.</a></li>
       </ul>
      </div> <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_p142401833143418">The API package name is <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b15114735164219">OceanStor-Pacific_</strong><em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_i5114835154212">xxx</em><strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b13114153524219">_API.tar.gz</strong>, for example, <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b7114123513424">OceanStor-Pacific_8.1.2_API.tar.gz</strong>.</p>
      <div class="p" id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_p5603927626">
       <em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_i137061746164219">xxx</em> indicates the product version. The API software package name may be in uppercase or lowercase, depending on the version.
       <div class="note" id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_note15603527525">
        <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
        <div class="notebody">
         <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_p1456922318392">To prevent the software package from being maliciously tampered with during transmission or storage, download the corresponding digital signature file for integrity verification while downloading the software package.</p>
         <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_p156932333915">After the software package is downloaded from the Huawei Support website, verify the PGP digital signature by referring to the <em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_i196531028162319">OpenPGP Signature Verification Guide</em>. If the verification fails, do not use the software package, and contact Huawei technical support.</p>
         <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_p4569152323915">Before a software package is used in installation or upgrade, its digital signature also needs to be verified according to the <em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_i178983813268">OpenPGP Signature Verification Guide</em> to ensure that the software package is not tampered with. Visit either of the following websites to obtain the <em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_i148991289269">OpenPGP Signature Verification Guide</em>:</p>
         <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_p145691623163911">For carrier users, visit <a href="https://support.huawei.com/carrier/digitalSignatureAction" target="_blank" rel="noopener noreferrer">https://support.huawei.com/carrier/digitalSignatureAction</a>.</p>
         <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_p1256922316392">For enterprise users, visit <a href="https://support.huawei.com/enterprise/en/tool/pgp-verify-TL1000000054" target="_blank" rel="noopener noreferrer">https://support.huawei.com/enterprise/en/tool/pgp-verify-TL1000000054</a>.</p>
        </div>
       </div>
      </div> <p></p></li>
     <li><span>Back up the <span class="filepath"><b>/vbstool</b></span> directory of the agent host to <span class="filepath"><b>/opt</b></span>.</span><p></p>
      <div class="note">
       <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
       <div class="notebody">
        <p>For the following operations, assume that ProtectAgent is installed in the <span class="filepath"><b>/opt</b></span> directory. Replace it with the actual installation directory.</p>
       </div>
      </div> <p>For example, run the following command to back up the <span class="filepath"><b>/vbstool</b></span> directory to the <span class="filepath"><b>/opt</b></span> directory:</p> <pre class="screen">cp -r /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/ /opt/</pre> <p></p></li>
     <li><span>Log in to the scale-out storage management node to obtain the certificates.</span><p></p>
      <ol type="a">
       <li>Use PuTTY to log in to the scale-out storage management node as user <strong>fsadmin</strong> through the floating IP address.
        <div class="note">
         <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
         <div class="notebody">
          <p>If CLI portal information is displayed, you have logged in to the CLI. If you have not logged in to the CLI, run the <strong>su - root</strong> command to log in to the CLI.</p>
         </div>
        </div></li>
       <li>Run the following command and enter the password of user <strong>admin</strong> to log in to the CLI.<pre class="screen">ismcli -u admin</pre></li>
       <li id="EN-US_TOPIC_0000001839269357__li2257105253815"><a name="EN-US_TOPIC_0000001839269357__li2257105253815"></a><a name="li2257105253815"></a>Perform the following operations to obtain FSM's certificate and key files.<p><a name="EN-US_TOPIC_0000001839269357__li2257105253815"></a><a name="li2257105253815"></a>Run the <strong>export fsm certificate</strong> command to export the certificate and key files.</p> <p>A password used to encrypt the exported files needs to be set during the export.</p>
        <div class="p">
         Command output similar to the following is displayed:
         <pre class="screen">admin:/&gt;export fsm certificate 
Export password:****** 
Reenter password:******      
fsm certificate path : /home/dsware/fsm_cert/fsm-server.pem    
fsm key path         : /home/dsware/fsm_cert/fsm-server.key    
ca certificate path  : /home/dsware/fsm_cert/ca.pem </pre>
        </div></li>
      </ol> <p></p></li>
     <li><span>Use WinSCP to log in to the scale-out block storage management node as user <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b1242463081510">fsadmin</strong> through the management IP address and download FSM's certificate and key files (<strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b154241730161516">fsm-server.pem</strong>, <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b34240304159">fsm-server.key</strong>, and <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b9424173031515">ca.pem</strong>) to a local directory.</span><p></p>
      <div class="note" id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_note1111311043017">
       <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
       <div class="notebody">
        <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_p41131804301">If user <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b12625331191510">fsadmin</strong> does not have the read and write permissions on FSM's certificate and key files (<strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b146251131121514">fsm-server.pem</strong>, <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b5625143151519">fsm-server.key</strong>, and <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b11625123110155">ca.pem</strong>), use user <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b15625931111511">root</strong> to enable the read and write permissions on FSM's certificate and key files for user <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b7625133121515">fsadmin</strong>, copy the files to the <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b12625153110154">/home/fsadmin</strong> directory, and download them to a local directory.</p>
       </div>
      </div> <p></p></li>
     <li><span>Use PuTTY to log in to the agent host.</span><p></p>
      <div class="note">
       <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
       <div class="notebody">
        <p>Perform the following operations on all agent hosts in sequence.</p>
       </div>
      </div>
      <ol type="a">
       <li>Run the following command to create the <span class="filepath"><b>/scripts</b></span> directory:<pre class="screen">mkdir -p /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/</pre></li>
       <li>Use WinSCP to upload the certificate and key files obtained in <a href="#EN-US_TOPIC_0000001839269357__li2257105253815">3.c</a> to the <span class="filepath"><b>/opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts</b></span> directory.</li>
       <li>Run the following commands to decompress the <strong>jre</strong> file.<pre class="screen">mkdir -p /opt/DataBackup/ProtectClient/Plugins/tmp/javarunenv/</pre> <pre class="screen">tar -zmxvf /opt/dsware/agent/jre-*.tar.gz -C /opt/DataBackup/ProtectClient/Plugins/tmp/javarunenv/</pre></li>
       <li>Use WinSCP to upload <strong>OceanStor-Pacific_8.</strong><em>x</em>.<em>x</em><strong>_api.tar.gz</strong> to the corresponding directory on the agent host and run the following command to decompress the package:<pre class="screen">tar -zxvf /home/OceanStor-Pacific_*_api.tar.gz</pre></li>
       <li id="EN-US_TOPIC_0000001839269357__li9225121913311"><a name="EN-US_TOPIC_0000001839269357__li9225121913311"></a><a name="li9225121913311"></a>Run the following commands in sequence in the <span class="uicontrol"><b>/home</b></span> directory to copy the corresponding files:
        <div class="note">
         <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
         <div class="notebody">
          <p>In the command, <em>xxx</em> indicates the directory generated after the API package is decompressed. Change it based on the site requirements. For example, if the API package is <strong>OceanStor-Pacific_8.1.2_API.tar.gz</strong>, the directory generated after the decompression is <strong>OceanStor-Pacific_8.1.2_API</strong>.</p>
         </div>
        </div>
        <ul>
         <li>For OceanStor Pacific 8.1.2 and earlier versions, run the following commands:<pre class="screen">cd<strong> </strong><em>xxx</em></pre> <pre class="screen">rm -rf lib/log4j-*</pre> <pre class="screen">/bin/cp client_self.keystore client_trust.keystore dsware-api.properties fsa_server.key manager-ssl.properties primary_ks.key standby_ks.key /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/</pre> <pre class="screen">/bin/cp dr_cli.xml readme.txt version zk-client.jks /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool</pre> <pre class="screen">/bin/cp dsware-api-*.jar /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre> <pre class="screen">/bin/cp primary_ks.key standby_ks.key /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre> <pre class="screen">/bin/cp -r scripts/* /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/</pre> <pre class="screen">/bin/cp -r lib/* /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre></li>
         <li>For OceanStor Pacific 8.1.3 and later versions, run the following commands:<pre class="screen">cd<strong> </strong><em>xxx</em></pre> <pre class="screen">rm -rf lib/log4j-*</pre> <pre class="screen">/bin/cp client_self.keystore client_trust.keystore dsware-api.properties manager-ssl.properties primary_ks.key standby_ks.key /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/</pre> <pre class="screen">/bin/cp dr_cli.xml readme.txt version zk-client.jks /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool</pre> <pre class="screen">/bin/cp dsware-api-*.jar /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre> <pre class="screen">/bin/cp primary_ks.key standby_ks.key /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre> <pre class="screen">/bin/cp -r scripts/* /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/</pre> <pre class="screen">/bin/cp -r lib/* /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre>
          <div class="note">
           <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
           <div class="notebody">
            <p>During the command execution, if a message is displayed indicating that the <strong>client_self.keystore</strong>, <strong>client_trust.keystore</strong>, or <strong>zk-client.jks</strong> file does not exist, ignore it.</p>
           </div>
          </div></li>
        </ul></li>
       <li>Run the following command to create the <strong>storage_port.ini</strong> file.<pre class="screen">touch /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/storage_port.ini</pre></li>
       <li>Run the following command to copy the <strong>so</strong> file.
        <ul>
         <li>If the agent host uses the x86 architecture:<pre class="screen">/bin/cp -r /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/linux-x86-64/* /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre></li>
         <li>If the agent host uses the Arm architecture:<pre class="screen">/bin/cp -r /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/linux-aarch64/* /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre></li>
        </ul></li>
       <li id="EN-US_TOPIC_0000001839269357__li1122591916320"><a name="EN-US_TOPIC_0000001839269357__li1122591916320"></a><a name="li1122591916320"></a>Run the following command to import environment variables.
        <ul>
         <li>If the agent host uses the x86 architecture:<pre class="screen">export LD_LIBRARY_PATH=/usr/lib64:/opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/linux-x86-64</pre></li>
         <li>If the agent host uses the Arm architecture:<pre class="screen">export LD_LIBRARY_PATH=/usr/lib64:/opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/linux-aarch64</pre></li>
        </ul></li>
       <li>Run the following commands in sequence to set the environment variables of the agent host to avoid conflicts with the certificate environment variables:<pre class="screen">VBSTOOL_PATH=/opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib</pre> <pre class="screen">sed -i "s#export LD_LIBRARY_PATH=.*#export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$VBSTOOL_PATH#g" /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vrmVBSTool.sh</pre></li>
       <li id="EN-US_TOPIC_0000001839269357__li112265193319"><a name="EN-US_TOPIC_0000001839269357__li112265193319"></a><a name="li112265193319"></a>Run the following commands in sequence to replace certificates.<pre class="screen">JAVA_HOME=$(find /opt/DataBackup/ProtectClient/Plugins/tmp/javarunenv/ -mindepth 1 -maxdepth 1 -type d)</pre> <pre class="screen">sh /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/replace_cert.sh -s /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/fsm-server.pem -c /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/ca.pem -k /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/fsm-server.key -f <em>FSM floating IP address</em> -j $JAVA_HOME</pre>
        <div class="note">
         <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
         <div class="notebody">
          <p>During the replacement, you need to enter the certificate password, which is the password set in <a href="#EN-US_TOPIC_0000001839269357__li2257105253815">3.c</a>.</p>
         </div>
        </div>
        <ul>
         <li>For OceanStor Pacific 8.1.2 and earlier versions, if <strong>client_self.keystore</strong>, <strong>client_trust.keystore</strong>, and <strong>dsware-api.properties</strong> exist in the <strong>/opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/cert/</strong><em>FSM floating IP address</em><strong>/</strong> directory, the certificates are successfully imported.</li>
         <li>For OceanStor Pacific 8.1.3 and later versions, if <strong>dsware-api.properties</strong> exists in the <strong>/opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/cert/</strong><em>FSM floating IP address</em><strong>/</strong> directory, the certificate is successfully imported.</li>
        </ul></li>
       <li>For OceanStor Pacific 8.1.3, run the following command to adapt to the new interface. Otherwise, skip this step.<pre class="screen">sed -i '/deleteVolume)/{n;s/"$@"/${@:1:9} 0/;}' /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vrmVBSTool.sh</pre></li>
       <li>If the system displays a message indicating that the <strong>client_self.keystore</strong> and <strong>client_trust.keystore</strong> files do not exist in <a href="#EN-US_TOPIC_0000001839269357__li9225121913311">5.e</a>, run the following commands to copy the files: In other scenarios, skip this step.<pre class="screen">cd /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/cert/<em>FSM floating IP address</em>/
cp client_self.keystore client_trust.keystore /opt/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/</pre></li>
      </ol> <p></p></li>
    </ol>
   </div>
  </div>
 </body>
</html>