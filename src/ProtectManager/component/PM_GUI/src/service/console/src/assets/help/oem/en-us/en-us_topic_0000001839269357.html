<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="DC.Type" content="topic">
  <meta name="DC.Title" content="Adding an Agent Host to Huawei Scale-Out Storage OceanStor Pacific (Applicable to FusionCompute)">
  <meta name="DC.Format" content="XHTML">
  <meta name="DC.Identifier" content="EN-US_TOPIC_0000001839269357">
  <meta name="DC.Language" content="en-us">
  <link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
  <title>Adding an Agent Host to Huawei Scale-Out Storage OceanStor Pacific (Applicable to FusionCompute)</title>
 </head>
 <body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px">
  <a name="EN-US_TOPIC_0000001839269357"></a><a name="EN-US_TOPIC_0000001839269357"></a>
  <h1 class="topictitle1"><span id="ph14645154613222">Adding an Agent Host to Huawei Scale-Out Storage OceanStor Pacific (Applicable to FusionCompute)</span></h1>
  <div id="body0000001422987361">
   <p id="EN-US_TOPIC_0000001839269357__p10874162716311">If the production storage of FusionCompute (the protected environment) is a Huawei scale-out block storage cluster, add the agent host to the scale-out block storage cluster to back up FusionCompute. This section uses OceanStor Pacific 8.1.<em id="EN-US_TOPIC_0000001839269357__i797073720353">x</em> as an example.</p>
   <div class="section" id="EN-US_TOPIC_0000001839269357__section11855925204414">
    <h4 class="sectiontitle">Installing VBS on the Agent Host</h4>
    <div class="note" id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_note69529359463">
     <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
     <div class="notebody">
      <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_p168872019505">If the compute node where VBS is to be installed does not run the scale-out storage OS, install the OS dependency package on the compute node before installing VBS. For details, see <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b18333450123410">Basic Service Configuration Guide for Block</strong> &gt; <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b9333115019348">Appendix</strong> &gt; <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b1533314505347">Installing the OS Dependency Package</strong> in the product documentation of the corresponding storage device version.</p>
     </div>
    </div>
    <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_p04301219055">For details about how to install the VBS service, see "Allocating Storage Space (SCSI Protocol-Linux) &gt; Creating VBS on Compute Nodes" in the OceanStor Pacific product documentation of the corresponding version. A compute node is an agent host. Set the following parameters as required. Set other parameters based on the document requirements. To obtain the OceanStor Pacific product documentation of the corresponding version, go to <a href="https://support.huawei.com/enterprise/en/distributed-storage/oceanstor-pacific-series-pid-262589930" target="_blank" rel="noopener noreferrer">OceanStor Pacific Series</a> and select the corresponding model.</p>
    <ul id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_ul996111581773">
     <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_li1096110589719"><strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b564693992317">Management IP Address</strong>: Enter the management IP address of the agent host.</li>
     <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_li149611258279"><strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b196154113231">Cabinet</strong>: Specify the cabinet where the agent host is located. It can be any value.</li>
     <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_li49619581879"><strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b1970444312234">Node Role</strong>: Select <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b1370454342310">Compute</strong>.</li>
     <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_li119612582075"><strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b2699174517232">Installation Mode</strong>: Select <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b169974572311">Regular installation</strong>.</li>
    </ul>
   </div>
   <div class="section" id="EN-US_TOPIC_0000001839269357__section0136124621916">
    <a name="EN-US_TOPIC_0000001839269357__section0136124621916"></a><a name="section0136124621916"></a>
    <h4 class="sectiontitle">Replacing OceanStor Pacific Certificates</h4>
    <ol id="EN-US_TOPIC_0000001839269357__ol1257024112544">
     <li id="EN-US_TOPIC_0000001839269357__li109081022115013"><a name="EN-US_TOPIC_0000001839269357__li109081022115013"></a><a name="li109081022115013"></a><span>Log in to the technical support website and obtain the OceanStor Pacific API package.</span><p></p>
      <div class="p" id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_p560372712219">
       To obtain the API package, go to the following path:
       <ul id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_ul46031271529">
        <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_li2060382719212">For enterprise users: <a href="https://support.huawei.com/enterprise/en/distributed-storage/oceanstor-pacific-9520-pid-251711061/software" target="_blank" rel="noopener noreferrer">Click here.</a></li>
        <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_li5603102711218">For carrier users: <a href="https://support.huawei.com/carrier/productNewOffering?col=product&amp;path=PBI1-21430725/PBI1-251363742/PBI1-21431663/PBI1-251366323/PBI1-251711061&amp;resTab=SW" target="_blank" rel="noopener noreferrer">Click here.</a></li>
       </ul>
      </div> <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_p142401833143418">The API package name is <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b15114735164219">OceanStor-Pacific_</strong><em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_i5114835154212">xxx</em><strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b13114153524219">_API.tar.gz</strong>, for example, <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b7114123513424">OceanStor-Pacific_8.1.2_API.tar.gz</strong>.</p>
      <div class="p" id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_p5603927626">
       <em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_i137061746164219">xxx</em> indicates the product version. The API software package name may be in uppercase or lowercase, depending on the version.
       <div class="note" id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_note15603527525">
        <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
        <div class="notebody">
         <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_p1456922318392">To prevent the software package from being maliciously tampered with during transmission or storage, download the corresponding digital signature file for integrity verification while downloading the software package.</p>
         <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_p156932333915">After the software package is downloaded from the Huawei Support website, verify the PGP digital signature by referring to the <em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_i196531028162319">OpenPGP Signature Verification Guide</em>. If the verification fails, do not use the software package, and contact Huawei technical support engineers.</p>
         <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_p4569152323915">Before a software package is used in installation or upgrade, its digital signature also needs to be verified according to the <em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_i178983813268">OpenPGP Signature Verification Guide</em> to ensure that the software package is not tampered with. Visit either of the following websites to obtain the <em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_i148991289269">OpenPGP Signature Verification Guide</em>:</p>
         <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_p145691623163911">For carrier users, visit <a href="https://support.huawei.com/carrier/digitalSignatureAction" target="_blank" rel="noopener noreferrer">https://support.huawei.com/carrier/digitalSignatureAction</a>.</p>
         <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792549972_p1256922316392">For enterprise users, visit <a href="https://support.huawei.com/enterprise/en/tool/pgp-verify-TL1000000054" target="_blank" rel="noopener noreferrer">https://support.huawei.com/enterprise/en/tool/pgp-verify-TL1000000054</a>.</p>
        </div>
       </div>
      </div> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li17397160185719"><span>Back up the <span class="filepath" id="EN-US_TOPIC_0000001839269357__filepath133976095710"><b>/vbstool</b></span> directory of the agent host to <span class="filepath" id="EN-US_TOPIC_0000001839269357__filepath163971802577"><b>/opt</b></span>.</span><p></p>
      <div class="note" id="EN-US_TOPIC_0000001839269357__note116503418570">
       <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
       <div class="notebody">
        <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792390300_p28641722154719">Replace <em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792390300_i52297565417">/opt</em> in the command with the actual ProtectAgent installation directory.</p>
       </div>
      </div> <p id="EN-US_TOPIC_0000001839269357__p16623111133412">For example, run the following command to back up the <span class="filepath" id="EN-US_TOPIC_0000001839269357__filepath154419355476"><b>/vbstool</b></span> directory to the <span class="filepath" id="EN-US_TOPIC_0000001839269357__filepath104463574712"><b>/opt</b></span> directory:</p> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen349741985211">cp -r <em id="EN-US_TOPIC_0000001839269357__i129761042193918">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/ /opt/</pre> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li19113629133519"><a name="EN-US_TOPIC_0000001839269357__li19113629133519"></a><a name="li19113629133519"></a><span>Obtain OceanStor Pacific certificate and key files.</span><p></p>
      <ul id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_ul326710393259">
       <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_li175411614142720">For OceanStor Pacific 8.1.2 and earlier versions, obtain certificate and key files by referring to "export fsm certificate" in the OceanStor Pacific product documentation of the corresponding version.</li>
       <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_li0138150103014">For OceanStor Pacific 8.2.0 and later versions, obtain certificate and key files by referring to "Obtaining the dsware-api Certificate File for Interconnecting with OceanStor Pacific" in the OceanStor Pacific product documentation of the corresponding version.</li>
       <li id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_li36921858193210">For other OceanStor Pacific versions, obtain certificate and key files by referring to "Obtaining the dsware-api Certificate File for Interconnecting with Distributed Storage" in the OceanStor Pacific product documentation of the corresponding version.</li>
      </ul>
      <div class="note" id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_note18638114219404">
       <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
       <div class="notebody">
        <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_p1464020429407">To obtain the OceanStor Pacific product documentation of the corresponding version, go to <a href="https://support.huawei.com/enterprise/en/distributed-storage/oceanstor-pacific-series-pid-262589930" target="_blank" rel="noopener noreferrer">OceanStor Pacific Series</a> and select the corresponding model.</p>
        <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_p981443413549"><span><img id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_image428153510568" src="en-us_image_0000002115714257.png"></span></p>
       </div>
      </div> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li15322111015432"><span>Log in to the agent host as user <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_en-us_topic_0000001792390248_b1489107134913">root</strong> using PuTTY.</span></li>
     <li id="EN-US_TOPIC_0000001839269357__li55249916443"><span>Run the following command to create the <span class="filepath" id="EN-US_TOPIC_0000001839269357__filepath28751630105319"><b>/scripts</b></span> directory:</span><p></p><pre class="screen" id="EN-US_TOPIC_0000001839269357__screen1052419918441">mkdir -p <em id="EN-US_TOPIC_0000001839269357__i16231135153919">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/</pre> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li106379125444"><span>Use WinSCP to upload the certificate and key files obtained in <a href="#EN-US_TOPIC_0000001839269357__li19113629133519">3</a> to the <em id="EN-US_TOPIC_0000001839269357__i19703714194010">/opt</em><strong id="EN-US_TOPIC_0000001839269357__b6756141116547">/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts</strong> directory.</span></li>
     <li id="EN-US_TOPIC_0000001839269357__li87621079456"><span>Run the following commands to query and decompress the JRE file.</span><p></p>
      <ol type="a" id="EN-US_TOPIC_0000001839269357__ol67381447481">
       <li id="EN-US_TOPIC_0000001839269357__li137381413488"><a name="EN-US_TOPIC_0000001839269357__li137381413488"></a><a name="li137381413488"></a>Run the following commands to query the JRE file:<pre class="screen" id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_screen85472042174814"><em id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_i19991184213486">cd /opt</em>/dsware/agent</pre> <pre class="screen" id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_screen11285547484">ll</pre> <p id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_p182934454911">Information similar to the following is displayed. Multiple JRE files may exist in the directory due to reasons such as upgrade. If multiple JRE files exist, obtain the JRE file name corresponding to the latest time.</p> <pre class="screen" id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_screen7501159195011">total 171116
drwx------. 2 root oam        49 Aug 31  2022 bin
drwx------. 4 omm  oam        28 Aug 31  2022 conf
-rwx------. 1 root root 81067968 Sep  9  2022 jre-8u302-linux-x64.tar.gz
-rwx------. 1 root root 94152417 Jul 23 20:03 <strong id="EN-US_TOPIC_0000001839269357__en-us_topic_0000001792549932_b147351761517">jre-8u392-linux-x64.tar.gz</strong>
drwxr-xr-x. 2 root oam        49 Jul 17 11:33 script
drwxr-x---. 2 root oam        31 Aug 31  2022 tool</pre></li>
       <li id="EN-US_TOPIC_0000001839269357__li1560937154813">Run the following commands to decompress the JRE file:<pre class="screen" id="EN-US_TOPIC_0000001839269357__screen107625715453">mkdir -p <em id="EN-US_TOPIC_0000001839269357__i13439181724012">/opt</em>/DataBackup/ProtectClient/Plugins/tmp/javarunenv/</pre> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen6762374458">tar -zmxvf <em id="EN-US_TOPIC_0000001839269357__i65211119184013">/opt</em>/dsware/agent/<em id="EN-US_TOPIC_0000001839269357__i1843175112510">jre-8u392-linux-x64.tar.gz</em> -C <em id="EN-US_TOPIC_0000001839269357__i1586412013406">/opt</em>/DataBackup/ProtectClient/Plugins/tmp/javarunenv/</pre>
        <div class="note" id="EN-US_TOPIC_0000001839269357__note137621755125110">
         <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
         <div class="notebody">
          <p id="EN-US_TOPIC_0000001839269357__p176217553514">Replace <em id="EN-US_TOPIC_0000001839269357__i6643612135214">jre-8u392-linux-x64.tar.gz</em> in the command with the actual JRE file name obtained in <a href="#EN-US_TOPIC_0000001839269357__li137381413488">7.a</a>.</p>
         </div>
        </div></li>
      </ol> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li884501185719"><span>Use WinSCP to log in to the agent host as user <strong id="EN-US_TOPIC_0000001839269357__b084516117578">root</strong> through the management IP address and upload the obtained API package to the <strong id="EN-US_TOPIC_0000001839269357__b45191432115515">/home</strong> directory on the agent host.</span></li>
     <li id="EN-US_TOPIC_0000001839269357__li139461124194516"><span>Run the following command to decompress the API package.</span><p></p>
      <div class="note" id="EN-US_TOPIC_0000001839269357__note1269320166163">
       <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
       <div class="notebody">
        <p id="EN-US_TOPIC_0000001839269357__p969391631619">In the command, <em id="EN-US_TOPIC_0000001839269357__i1951783353">OceanStor-Pacific_</em><em id="EN-US_TOPIC_0000001839269357__i72175161589">xxx</em><em id="EN-US_TOPIC_0000001839269357__i119511885350">_API.tar.gz</em> indicates the API package obtained in <a href="#EN-US_TOPIC_0000001839269357__li109081022115013">1</a>, and <em id="EN-US_TOPIC_0000001839269357__i119766108362">OceanStor-Pacific_</em><em id="EN-US_TOPIC_0000001839269357__i179761610143615">xxx</em><em id="EN-US_TOPIC_0000001839269357__i19767108364">_API</em> indicates the directory generated after the API package is decompressed. Replace them based on the actual conditions.</p>
       </div>
      </div> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen19946142413453">tar -zxvf /home/<em id="EN-US_TOPIC_0000001839269357__i16970152645710">OceanStor-Pacific_xxx_api.tar.gz</em></pre> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li49889160467"><a name="EN-US_TOPIC_0000001839269357__li49889160467"></a><a name="li49889160467"></a><span>Run the following commands in sequence in the <span class="uicontrol" id="EN-US_TOPIC_0000001839269357__uicontrol19973567565"><b>/home</b></span> directory to copy the corresponding files:</span><p></p>
      <div class="note" id="EN-US_TOPIC_0000001839269357__note1988116104615">
       <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
       <div class="notebody">
        <ul id="EN-US_TOPIC_0000001839269357__ul16317193394616">
         <li id="EN-US_TOPIC_0000001839269357__li113171833164613">In the command, <em id="EN-US_TOPIC_0000001839269357__i1580411521021">xxx</em> indicates the directory generated after the API package is decompressed. Change it based on the actual conditions. For example, if the API package is <strong id="EN-US_TOPIC_0000001839269357__b2624164255718">OceanStor-Pacific_8.1.2_API.tar.gz</strong>, the directory generated after the decompression is <strong id="EN-US_TOPIC_0000001839269357__b1062494275717">OceanStor-Pacific_8.1.2_API</strong>.</li>
         <li id="EN-US_TOPIC_0000001839269357__li176341959104617">During the command execution, if a message is displayed indicating that the <strong id="EN-US_TOPIC_0000001839269357__b14838327122812">fsa_server.key</strong>, <strong id="EN-US_TOPIC_0000001839269357__b8540182175818">client_self.keystore</strong>, <strong id="EN-US_TOPIC_0000001839269357__b15541112165819">client_trust.keystore</strong>, or <strong id="EN-US_TOPIC_0000001839269357__b35411920584">zk-client.jks</strong> file does not exist, ignore it.</li>
        </ul>
       </div>
      </div> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen19881016184615">cd<strong id="EN-US_TOPIC_0000001839269357__b09881016174619"> </strong><em id="EN-US_TOPIC_0000001839269357__i3988111611461">xxx</em></pre> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen159881164465">rm -rf lib/log4j-*</pre> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen6988516184616">/bin/cp client_self.keystore client_trust.keystore dsware-api.properties fsa_server.key manager-ssl.properties primary_ks.key standby_ks.key <em id="EN-US_TOPIC_0000001839269357__i11537145113406">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/</pre> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen2098861674620">/bin/cp dr_cli.xml readme.txt version zk-client.jks <em id="EN-US_TOPIC_0000001839269357__i11871753164016">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool</pre> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen9988121610461">/bin/cp dsware-api-*.jar <em id="EN-US_TOPIC_0000001839269357__i1729515574014">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen8988181616467">/bin/cp primary_ks.key standby_ks.key <em id="EN-US_TOPIC_0000001839269357__i9431556194015">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen11988131694616">/bin/cp -r scripts/* <em id="EN-US_TOPIC_0000001839269357__i6488057134015">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/</pre> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen9988716164615">/bin/cp -r lib/* <em id="EN-US_TOPIC_0000001839269357__i204151958124020">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li9622193074711"><span>Run the following command to create the <strong id="EN-US_TOPIC_0000001839269357__b10680730165817">storage_port.ini</strong> file.</span><p></p><pre class="screen" id="EN-US_TOPIC_0000001839269357__screen6622113024712">touch <em id="EN-US_TOPIC_0000001839269357__i56471959134013">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/storage_port.ini</pre> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li56229301478"><span>Run the following command to copy the <strong id="EN-US_TOPIC_0000001839269357__b14800400583">so</strong> file.</span><p></p>
      <ul id="EN-US_TOPIC_0000001839269357__ul66221230134716">
       <li id="EN-US_TOPIC_0000001839269357__li9622133016477">If the agent host uses the x86 architecture:<pre class="screen" id="EN-US_TOPIC_0000001839269357__screen1762216304475">/bin/cp -r <em id="EN-US_TOPIC_0000001839269357__i270430164119">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/linux-x86-64/* <em id="EN-US_TOPIC_0000001839269357__i18823811415">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre></li>
       <li id="EN-US_TOPIC_0000001839269357__li19622173054718">If the agent host uses the Arm architecture:<pre class="screen" id="EN-US_TOPIC_0000001839269357__screen2622103020470">/bin/cp -r <em id="EN-US_TOPIC_0000001839269357__i740232419">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/linux-aarch64/* <em id="EN-US_TOPIC_0000001839269357__i16871193164117">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre></li>
      </ul> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li362273084712"><span>Run the following command to import environment variables.</span><p></p>
      <ul id="EN-US_TOPIC_0000001839269357__ul12622830174719">
       <li id="EN-US_TOPIC_0000001839269357__li1362213309475">If the agent host uses the x86 architecture:<pre class="screen" id="EN-US_TOPIC_0000001839269357__screen146224300471">export LD_LIBRARY_PATH=/usr/lib64:<em id="EN-US_TOPIC_0000001839269357__i816710574110">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/linux-x86-64</pre></li>
       <li id="EN-US_TOPIC_0000001839269357__li14622153015477">If the agent host uses the Arm architecture:<pre class="screen" id="EN-US_TOPIC_0000001839269357__screen462210301474">export LD_LIBRARY_PATH=/usr/lib64:<em id="EN-US_TOPIC_0000001839269357__i51121864412">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/linux-aarch64</pre></li>
      </ul> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li86221030104715"><span>Run the following commands in sequence to set the environment variables of the agent host to avoid conflicts with the certificate environment variables:</span><p></p><pre class="screen" id="EN-US_TOPIC_0000001839269357__screen146221430174718">VBSTOOL_PATH=<em id="EN-US_TOPIC_0000001839269357__i297510624118">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib</pre> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen14622153024718">sed -i "s#export LD_LIBRARY_PATH=.*#export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$VBSTOOL_PATH#g" <em id="EN-US_TOPIC_0000001839269357__i29031975417">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vrmVBSTool.sh</pre> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li176229305474"><span>Run the following commands in sequence to replace certificates.</span><p></p>
      <div class="note" id="EN-US_TOPIC_0000001839269357__note062273018470">
       <img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span>
       <div class="notebody">
        <ul id="EN-US_TOPIC_0000001839269357__ul15873456202014">
         <li id="EN-US_TOPIC_0000001839269357__li4873205682018">During the replacement, you need to enter the certificate password, which is the password set in <a href="#EN-US_TOPIC_0000001839269357__li19113629133519">3</a>.</li>
         <li id="EN-US_TOPIC_0000001839269357__li15276210193017">In the command, <em id="EN-US_TOPIC_0000001839269357__i13888563307">fsm-server.pem</em> is the certificate file, <em id="EN-US_TOPIC_0000001839269357__i740745103115">fsm-server.key</em> is the key file, and <em id="EN-US_TOPIC_0000001839269357__i557165003">ca.pem</em> is the CA certificate. Replace them with the file names obtained in <a href="#EN-US_TOPIC_0000001839269357__li19113629133519">3</a>.</li>
         <li id="EN-US_TOPIC_0000001839269357__li4754111153015">Replace <em id="EN-US_TOPIC_0000001839269357__i8798104516018">FSM floating IP address</em> in the commands with the actual IP address.</li>
        </ul>
       </div>
      </div> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen762293014713">JAVA_HOME=$(find <em id="EN-US_TOPIC_0000001839269357__i103979134116">/opt</em>/DataBackup/ProtectClient/Plugins/tmp/javarunenv/ -mindepth 1 -maxdepth 1 -type d)</pre> <pre class="screen" id="EN-US_TOPIC_0000001839269357__screen2622173044715">sh <em id="EN-US_TOPIC_0000001839269357__i81445109415">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/replace_cert.sh -s <em id="EN-US_TOPIC_0000001839269357__i69111510204119">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/<em id="EN-US_TOPIC_0000001839269357__i11496142172111">fsm-server.pem</em> -c <em id="EN-US_TOPIC_0000001839269357__i8775191111412">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/<em id="EN-US_TOPIC_0000001839269357__i885232710271">ca.pem</em> -k <em id="EN-US_TOPIC_0000001839269357__i1253601234114">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/<em id="EN-US_TOPIC_0000001839269357__i168751625132710">fsm-server.key</em> -f <em id="EN-US_TOPIC_0000001839269357__i1962293024710">FSM floating IP address</em> -j $JAVA_HOME</pre>
      <ul id="EN-US_TOPIC_0000001839269357__ul5622530184712">
       <li id="EN-US_TOPIC_0000001839269357__li16623153014474">For OceanStor Pacific 8.1.2 and earlier versions, if <strong id="EN-US_TOPIC_0000001839269357__b224216391616">client_self.keystore</strong>, <strong id="EN-US_TOPIC_0000001839269357__b1524211397117">client_trust.keystore</strong>, and <strong id="EN-US_TOPIC_0000001839269357__b224215397118">dsware-api.properties</strong> exist in the <em id="EN-US_TOPIC_0000001839269357__i1690191413417">/opt</em><strong id="EN-US_TOPIC_0000001839269357__b465212224214">/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/cert/</strong><em id="EN-US_TOPIC_0000001839269357__i962353013479">FSM floating IP address</em><strong id="EN-US_TOPIC_0000001839269357__b643015251827">/</strong> directory, the certificates are successfully imported.</li>
       <li id="EN-US_TOPIC_0000001839269357__li136231530114710">For OceanStor Pacific 8.1.3 and later versions, if <strong id="EN-US_TOPIC_0000001839269357__b10962149927">dsware-api.properties</strong> exists in the <em id="EN-US_TOPIC_0000001839269357__i523141717410">/opt</em><strong id="EN-US_TOPIC_0000001839269357__b995816405315">/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/cert/</strong><em id="EN-US_TOPIC_0000001839269357__i1562313306475">FSM floating IP address</em><strong id="EN-US_TOPIC_0000001839269357__b970318522312">/</strong> directory, the certificates are successfully imported.</li>
      </ul> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li176231303477"><span>For 1.5.0, if the OceanStor Pacific version is 8.1.3 or later, run the following command to adapt to the new interface. In other scenarios, skip this step.</span><p></p><pre class="screen" id="EN-US_TOPIC_0000001839269357__screen162311304477">sed -i '/deleteVolume)/{n;s/"$@"/${@:1:9} 0/;}' <em id="EN-US_TOPIC_0000001839269357__i1135121854113">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vrmVBSTool.sh</pre> <p></p></li>
     <li id="EN-US_TOPIC_0000001839269357__li06231130114714"><span>If the system displays a message indicating that the <strong id="EN-US_TOPIC_0000001839269357__b57598305411">client_self.keystore</strong> and <strong id="EN-US_TOPIC_0000001839269357__b19759930940">client_trust.keystore</strong> files do not exist in <a href="#EN-US_TOPIC_0000001839269357__li49889160467">10</a>, run the following commands to copy the files. In other scenarios, skip this step.</span><p></p><pre class="screen" id="EN-US_TOPIC_0000001839269357__screen1162383014717">cd <em id="EN-US_TOPIC_0000001839269357__i20151021124114">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/cert/<em id="EN-US_TOPIC_0000001839269357__i18623153015476">FSM floating IP address</em>/
cp client_self.keystore client_trust.keystore <em id="EN-US_TOPIC_0000001839269357__i1864922144112">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/</pre> <p></p></li>
    </ol>
   </div>
  </div>
 </body>
</html>