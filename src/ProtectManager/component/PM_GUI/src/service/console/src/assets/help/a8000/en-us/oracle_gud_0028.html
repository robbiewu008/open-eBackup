<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->


<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-us" xml:lang="en-us">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="Step 9: Performing Backup">
<meta name="product" content="">
<meta name="DC.Relation" scheme="URI" content="oracle_gud_0013.html">
<meta name="prodname" content="">
<meta name="version" content="">
<meta name="brand" content="30-OceanProtect Appliance 1.5.0-1.6.0 Help Center">
<meta name="DC.Publisher" content="20241029">
<meta name="prodname" content="csbs">
<meta name="documenttype" content="usermanual">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="oracle_gud_0028">
<meta name="DC.Language" content="en-us">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<title>Step 9: Performing Backup</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="oracle_gud_0028"></a><a name="oracle_gud_0028"></a>

<h1 class="topictitle1">Step 9: Performing Backup</h1>
<div><p>Before performing backup, you need to associate the resources to be protected with a specified SLA policy. The system protects the resources based on the SLA policy and periodically performs backup jobs based on the SLA policy. You can perform a backup job immediately through manual backup.</p>
<div class="section"><h4 class="sectiontitle">Precautions</h4><ul><li>If a full backup fails and the next backup is a log backup, the log backup will fail because the log backup depends on the copy generated in the last successful full backup. In this case, manually perform a full backup once.</li></ul>
<ul><li>During a manual backup, the parameters (except <span class="uicontrol"><b><span><strong>Automatic Retry</strong></span></b></span>) defined in the SLA, such as <span class="uicontrol"><b><span><strong>Channels</strong></span></b></span>, <span class="uicontrol"><b><span><strong>Rate Limiting Policies</strong></span></b></span>, and <span class="uicontrol"><b><span><strong>Transmission and Data Encryption</strong></span></b></span>, are applied to the manual backup job.</li><li>Copies generated by manual backup are retained for the duration defined in the SLA.</li><li>If a replication or archive policy has been defined in the SLA, the system will perform replication or archiving once based on the SLA when you perform manual backup.</li><li>If no log backup is defined in the SLA, log backup cannot be manually executed.</li><li>Start the Oracle database with an spfile. Otherwise, the backup job will fail. </li></ul>
</div>
<div class="section"><h4 class="sectiontitle">Prerequisites</h4><ul><li>You are advised to disable KRB trace of the database. Otherwise, a large number of KRB trace files will be generated during the backup, occupying the storage space of the host. </li><li>For 1.6.0 and later versions, if you need to perform snapshot-based backup at the storage layer in ASM scenarios, contact technical support engineers to configure Udev in the production environment. </li><li>For 1.6.0 and later versions, if you need to perform snapshot-based backup at the storage layer in non-ASM scenarios, ensure that the directories where the data, control, and log files, as well as pfile and spfile parameter files of the Oracle database reside have been mounted to OceanStor Dorado.</li></ul>
</div>
<div class="section"><h4 class="sectiontitle">Procedure</h4><ol><li><span>Choose <span class="uicontrol" id="oracle_gud_0028__en-us_topic_0000001839142377_uicontrol49641842919"><b><span id="oracle_gud_0028__en-us_topic_0000001839142377_text63901566195"><strong>Protection</strong></span> &gt; Databases &gt; Oracle</b></span>.</span></li><li><span>On the <span class="uicontrol" id="oracle_gud_0028__en-us_topic_0000001792503842_uicontrol13647121671614"><b><span id="oracle_gud_0028__en-us_topic_0000001792503842_text4647616121615"><strong>Databases</strong></span></b></span> tab page, select the database that you want to protect and click <span class="uicontrol" id="oracle_gud_0028__en-us_topic_0000001792503842_uicontrol851716476568"><b><span id="oracle_gud_0028__en-us_topic_0000001792503842_text5546154284118"><strong>Protect</strong></span></b></span>. </span><p><p id="oracle_gud_0028__en-us_topic_0000001792503842_p1478765116562">You can also select multiple databases for batch protection.</p>
</p></li><li><span>Select an SLA.</span><p><div class="p" id="oracle_gud_0028__en-us_topic_0000001964713008_p16181740836">You can also click <span class="uicontrol" id="oracle_gud_0028__en-us_topic_0000001964713008_uicontrol169554520714"><b><span id="oracle_gud_0028__en-us_topic_0000001964713008_text179554516717"><strong>Create</strong></span></b></span> to create an SLA.<div class="note" id="oracle_gud_0028__en-us_topic_0000001964713008_note25947145710"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="oracle_gud_0028__en-us_topic_0000001964713008_p125947145711"><span id="oracle_gud_0028__en-us_topic_0000001964713008_ph1413818422327">If a WORM policy has been configured for the resources to be protected, select an SLA without a WORM policy to avoid WORM policy conflicts.</span></p>
</div></div>
</div>
</p></li><li id="oracle_gud_0028__li164660725814"><a name="oracle_gud_0028__li164660725814"></a><a name="li164660725814"></a><span>Set the advanced parameters for backing up the Oracle database.</span><p><div class="p"><a href="#oracle_gud_0028__table354613271506">Table 1</a> describes the related parameters.
<div class="tablenoborder"><a name="oracle_gud_0028__table354613271506"></a><a name="table354613271506"></a><table cellpadding="4" cellspacing="0" summary="" id="oracle_gud_0028__table354613271506" frame="border" border="1" rules="all"><caption><b>Table 1 </b>Advanced parameters for backing up the Oracle database</caption><colgroup><col style="width:22.11%"><col style="width:77.89%"></colgroup><thead align="left"><tr><th align="left" class="cellrowborder" valign="top" width="22.11%" id="mcps1.3.4.2.4.2.1.2.2.3.1.1"><p>Parameter</p>
</th>
<th align="left" class="cellrowborder" valign="top" width="77.89%" id="mcps1.3.4.2.4.2.1.2.2.3.1.2"><p>Description</p>
</th>
</tr>
</thead>
<tbody><tr><td class="cellrowborder" valign="top" width="22.11%" headers="mcps1.3.4.2.4.2.1.2.2.3.1.1 "><p><strong>Delete Archive Logs</strong></p>
</td>
<td class="cellrowborder" valign="top" width="77.89%" headers="mcps1.3.4.2.4.2.1.2.2.3.1.2 "><p>This function takes effect only for log backup jobs. After this function is enabled, archive logs of the database in the production environment are deleted after log backup is complete. The following deletion policies are available:</p>
<ul><li>Deleting all archive logs of the databases to be backed up</li><li>Deleting archive logs generated before <em>xx</em> hours/days/weeks/months/years for the database to be backed up<p>For example, if you select <strong>1 hour</strong>, the system will delete all archive logs generated before 1 hour for the database to be backed up and retains only the archive logs generated in the latest hour.</p>
</li></ul>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><ul><li>For versions earlier than 1.5.0.SPC22, this parameter is displayed as <span><strong>Delete Archived Logs Immediately After Backup</strong></span> on the GUI.</li><li>In versions earlier than 1.5.0.SPC22, archive logs cannot be deleted by time segment. After this function is enabled, all archive logs of the database in the production environment are deleted.</li></ul>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="22.11%" headers="mcps1.3.4.2.4.2.1.2.2.3.1.1 "><p><strong>Snapshot-based Backup at the Storage Layer</strong></p>
</td>
<td class="cellrowborder" valign="top" width="77.89%" headers="mcps1.3.4.2.4.2.1.2.2.3.1.2 "><p>After this function is enabled, data is backed up in storage-layer backup mode. After snapshot-based backup at the storage layer is enabled, you can select a built-in or external agent host to back up the database using snapshots at the storage layer.</p>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><ul><li>Only 1.6.0 and later versions support this function.</li><li>If no independent ASM disk group is configured for storing OCR and voting disk data in the Oracle cluster, you are advised not to enable snapshot-based backup at the storage layer. Otherwise, generated copies cannot be used for restoration to a new location.</li><li>In the Oracle single-node scenario, if the selected SLA contains the differential backup policy, snapshot-based backup at the storage layer cannot be enabled.</li><li>In the Oracle cluster scenario, if the selected SLA contains the differential backup policy, snapshot-based backup at the storage layer cannot be enabled.</li><li>Ensure that the ASM disk group where the database resources to be protected reside does not have other database instances. Otherwise, snapshot-based backup at the storage layer is not supported.</li><li>For Windows:<ul><li>After snapshot-based backup at the storage layer is enabled, select a built-in agent host or an external Linux agent host where the Oracle plug-in is installed.</li><li>Enable the script execution permission for Windows PowerShell. For details, see <a href="oracle_gud_0132_1.html">Setting Permissions for Windows PowerShell (Applicable to Snapshot-based Backup at the Storage Layer)</a>.</li></ul>
</li><li>If Oracle version 11 is used, the system automatically enables the storage-layer backup mode of the Oracle database during snapshot creation.</li><li>If the quantity or size of LUNs to be backed up in the backup job is different from that in the previous backup job, the log backup or incremental backup job automatically changes to full backup.</li></ul>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="22.11%" headers="mcps1.3.4.2.4.2.1.2.2.3.1.1 "><p><span><strong>Agent Host</strong></span></p>
</td>
<td class="cellrowborder" valign="top" width="77.89%" headers="mcps1.3.4.2.4.2.1.2.2.3.1.2 "><p>If the Oracle database to be backed up is deployed in cluster mode, you can select one or more agent hosts for backup. If this parameter is not set, the system selects one agent host by default.</p>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><ul><li>If you manually select an agent host, the database authentication mode must be <strong>Database authentication</strong>. Otherwise, backup and restoration jobs will fail.</li><li>If this parameter is automatically specified by the system and the database authentication mode is set to <strong>Database authentication</strong> or <strong>OS authentication</strong>, backup and restoration jobs are not affected.</li></ul>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" width="22.11%" headers="mcps1.3.4.2.4.2.1.2.2.3.1.1 "><p><span><strong>Script to Run Before Backup</strong></span></p>
</td>
<td class="cellrowborder" rowspan="3" valign="top" width="77.89%" headers="mcps1.3.4.2.4.2.1.2.2.3.1.2 "><p>You can configure <span><strong>Script to Run Before Backup</strong></span>, <span><strong>Script to Run upon Backup Success</strong></span>, and <span><strong>Script to Run upon Backup Failure</strong></span> based on actual requirements. When the message "ProtectAgent started executing the prerequisite task." is displayed in the backup job event, the configured script will be executed in the corresponding scenario.</p>
<ul><li>If the Linux OS is used, enter the script name, which ends with <strong>.sh</strong>. Ensure that the script has been stored in the <span class="filepath"><b>DataBackup/ProtectClient/ProtectClient-E/sbin/thirdparty</b></span> directory in the ProtectAgent installation directory and the user (user <strong>root</strong> by default) who has logged in to the database host is permitted to execute the script. If the user has no execution permission, run the following commands in sequence to grant the permission:<p><strong>chown root:root</strong> <em>Script name</em></p>
<p><strong>chmod 500</strong><strong> </strong><em>Script name</em></p>
</li><li>If the Windows OS is used, enter the script name, which ends with <strong>.bat</strong>. Ensure that the script has been stored in the <span class="filepath"><b>DataBackup\ProtectClient\ProtectClient-E\bin\thirdparty</b></span> directory in the ProtectAgent installation directory and the user (user <strong>Administrator</strong> by default) who has logged in to the database host is permitted to execute the script. If the user has no execution permission, perform the following operations in sequence to grant the permission:<p>Right-click the script and choose <strong>Properties</strong> &gt; <strong>Security</strong>. In the dialog box that is displayed, select the <strong>Administrator</strong> user and click <strong>Edit</strong> to change the permission.</p>
</li></ul>
<div class="note"><span class="notetitle"> NOTE: </span><div class="notebody"><ul><li>When <span class="uicontrol"><b><span><strong>Script to Run upon Backup Success</strong></span></b></span> is configured, the status of the backup job is displayed as <span class="uicontrol"><b><span><strong>Succeeded</strong></span></b></span> on the management page even if the script fails to be executed. Check whether the job details contain a message indicating that a post-processing script fails to be executed. If yes, modify the script in a timely manner.</li><li>When backing up the database of the Oracle cluster environment, pay attention to the following if the pre-processing or post-processing script is configured:<ul><li>The pre-processing or post-processing script must be stored on all nodes in the cluster.</li><li>By default, the <span>OceanProtect</span> executes this script only on one node in the cluster. If the script needs to be executed on all nodes in the cluster, add the content for logging in to each node in the cluster when compiling the script.</li></ul>
</li></ul>
</div></div>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.4.2.4.2.1.2.2.3.1.1 "><p><span><strong>Script to Run upon Backup Success</strong></span></p>
</td>
</tr>
<tr><td class="cellrowborder" valign="top" headers="mcps1.3.4.2.4.2.1.2.2.3.1.1 "><p><span><strong>Script to Run upon Backup Failure</strong></span></p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</p></li><li><span>Click <span class="uicontrol"><b>OK</b></span>.</span><p><p>If the current system time is later than the start time of the first backup specified in the SLA, you can select <strong id="oracle_gud_0028__en-us_topic_0000001964713008_b9624185216713">Execute manual backup now</strong> in the dialog box that is displayed or choose to perform automatic backup periodically based on the backup policy set in the SLA.</p>
<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><ul><li>You are advised not to restart the ProtectAgent host or ProtectAgent service when performing a backup job. Otherwise, the backup job may be suspended. If the backup job is suspended for a long time after the restart, terminate the job and perform the backup again.</li><li><span id="oracle_gud_0028__ph1559428114314">For 1.5.0.SPC16 and later versions, if the <span id="oracle_gud_0028__text1272255416377">OceanProtect</span> detects data file changes during log backup, the log backup job automatically changes to a full backup job. During the time when a log backup job is automatically changing to a full backup job (assuming 1.6.0 is used, you can select the corresponding backup job on the <strong id="oracle_gud_0028__b1163444120357">Jobs</strong> page to view the job details), the other newly delivered backup jobs will fail to be locked. As a result, the other backup jobs fail to be executed.</span></li></ul>
</div></div>
</p></li></ol><ol start="6"><li><strong>Optional: </strong><span>Execute manual backup.</span><p><div class="p">If you want to execute a backup job immediately, perform manual backup through the following operations. Otherwise, skip this step.<ol type="a"><li>In the row of the target resource, choose <strong id="oracle_gud_0028__en-us_topic_0000001964713008_b146814226353">More</strong> &gt; <span id="oracle_gud_0028__en-us_topic_0000001964713008_text18439122416533"><strong>Manual Backup</strong></span>.<div class="note" id="oracle_gud_0028__en-us_topic_0000001964713008_note1527151103"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="oracle_gud_0028__en-us_topic_0000001964713008_en-us_topic_0000001607531736_p870125314544">You can select multiple resources to perform manual backup in batches. Select multiple protected resources and choose <strong id="oracle_gud_0028__en-us_topic_0000001964713008_b1657653183519">More</strong> &gt; <span id="oracle_gud_0028__en-us_topic_0000001964713008_text122852865419"><strong>Manual Backup</strong></span> in the upper left corner of the resource list.</p>
</div></div>
</li><li>Set the name of the copy generated during manual backup.<p id="oracle_gud_0028__en-us_topic_0000001964713008_p444210492470">If this parameter is left unspecified, the system sets the copy name to <strong id="oracle_gud_0028__en-us_topic_0000001964713008_b17709174711816">backup_</strong><em id="oracle_gud_0028__en-us_topic_0000001964713008_i1371044717814">Timestamp</em> by default.</p>
</li><li>Select a protection policy, which can be <span><strong>Full backup</strong></span>, <span><strong>Incremental backup</strong></span>, <span><strong>Differential Backup</strong></span>, or <span><strong>Log Backup</strong></span>.<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p id="oracle_gud_0028__en-us_topic_0000001964713008_p13522118194919"><span id="oracle_gud_0028__en-us_topic_0000001964713008_ph19374310343">For 1.6.0 and later versions, if the selected protection policy is different from that configured in the associated SLA, the WORM configuration does not take effect.</span></p>
</div></div>
</li><li>Click <span class="uicontrol"><b><span><strong>OK</strong></span></b></span>.<div class="note"><img src="public_sys-resources/note_3.0-en-us.png"><span class="notetitle"> </span><div class="notebody"><p><span>For 1.5.0.SPC16 and later versions, if the <span id="oracle_gud_0028__oracle_gud_0028_text1272255416377">OceanProtect</span> detects data file changes during log backup, the log backup job automatically changes to a full backup job. During the time when a log backup job is automatically changing to a full backup job (assuming 1.6.0 is used, you can select the corresponding backup job on the <strong id="oracle_gud_0028__oracle_gud_0028_b1163444120357">Jobs</strong> page to view the job details), the other newly delivered backup jobs will fail to be locked. As a result, the other backup jobs fail to be executed.</span></p>
</div></div>
</li></ol>
</div>
</p></li></ol>
</div>
</div>
<div>
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong> <a href="oracle_gud_0013.html">Backing Up an Oracle Database</a></div>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">Copyright &copy; Huawei Technologies Co., Ltd.</div></body>
</html>