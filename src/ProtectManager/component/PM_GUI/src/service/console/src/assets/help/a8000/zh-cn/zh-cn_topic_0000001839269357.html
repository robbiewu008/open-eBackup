
<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->

<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="将代理主机加入华为分布式存储OceanStor Pacific（适用于FusionCompute）">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ZH-CN_TOPIC_0000001839269357">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<title>将代理主机加入华为分布式存储OceanStor Pacific（适用于FusionCompute）</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="ZH-CN_TOPIC_0000001839269357"></a><a name="ZH-CN_TOPIC_0000001839269357"></a>

<h1 class="topictitle1"><span id="ph14645154613222">将代理主机加入华为分布式存储OceanStor Pacific（适用于FusionCompute）</span></h1>
<div id="body0000001422987361"><p id="ZH-CN_TOPIC_0000001839269357__p10874162716311">当受保护环境FusionCompute的生产存储为华为分布式块存储集群时，需将代理主机加入华为分布式块存储集群，以便对FusionCompute进行备份。本节为华为分布式块存储为OceanStor Pacific 8.1.x为例说明。</p>
<div class="section" id="ZH-CN_TOPIC_0000001839269357__section11855925204414"><h4 class="sectiontitle">在代理主机上安装VBS</h4><div class="note" id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_note69529359463"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_p168872019505">如果待安装VBS的计算节点的操作系统不是分布式存储OS操作系统，安装VBS前请先参考存储设备对应版本的《产品文档》中的“块服务基础业务配置指南 &gt; 附录 &gt; 安装操作系统依赖包”章节，对计算节点安装操作系统依赖包。</p>
</div></div>
<p id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_p04301219055">安装VBS服务的详细操作，请参见OceanStor Pacific对应型号版本的《产品文档》中的“分配存储空间（SCSI协议-Linux）&gt; 在计算节点上创建VBS”章节。计算节点，即为代理主机。其中部分配置参数说明如下，其余参数请按文档要求填写。OceanStor Pacific对应版本《产品文档》可进入<a href="https://support.huawei.com/enterprise/zh/distributed-storage/oceanstor-pacific-series-pid-262589930" target="_blank" rel="noopener noreferrer">OceanStor Pacific 系列</a>，选择对应的型号获取。</p>
<ul id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_ul996111581773"><li id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_li1096110589719">管理IP地址：代理主机管理IP地址</li><li id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_li149611258279">机柜：代理主机所在机柜【任意值】</li><li id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_li49619581879">节点角色：计算</li><li id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_li119612582075">安装模式：常规安装</li></ul>
</div>
<div class="section" id="ZH-CN_TOPIC_0000001839269357__section0136124621916"><a name="ZH-CN_TOPIC_0000001839269357__section0136124621916"></a><a name="section0136124621916"></a><h4 class="sectiontitle">替换OceanStor Pacific证书</h4><ol id="ZH-CN_TOPIC_0000001839269357__ol1257024112544"><li id="ZH-CN_TOPIC_0000001839269357__li109081022115013"><a name="ZH-CN_TOPIC_0000001839269357__li109081022115013"></a><a name="li109081022115013"></a><span>登录技术支持网站，获取OceanStor Pacific的API包。</span><p><div class="p" id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_p560372712219">API包获取路径如下：<ul id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_ul46031271529"><li id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_li2060382719212">企业网：<a href="https://support.huawei.com/enterprise/zh/distributed-storage/oceanstor-pacific-9520-pid-251711061/software" target="_blank" rel="noopener noreferrer">点此进入</a></li><li id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_li5603102711218">运营商网站：<a href="https://support.huawei.com/carrier/productNewOffering?col=product&amp;path=PBI1-21430725/PBI1-251363742/PBI1-21431663/PBI1-251366323/PBI1-251711061&amp;resTab=SW" target="_blank" rel="noopener noreferrer">点此进入</a></li></ul>
</div>
<p id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_p142401833143418">API包名称为“OceanStor-Pacific_<em id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_i850443125714">xxx</em>_API.tar.gz”，如OceanStor-Pacific_8.1.2_API.tar.gz。</p>
<div class="p" id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_p5603927626"><em id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_i2815510563">xxx</em>表示产品版本号。不同版本的软件包名称中的API大小写略有差异。<div class="note" id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_note15603527525"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_p1456922318392">为了防止软件包在传递过程或存储期间被恶意篡改，下载软件包时需下载对应的数字签名文件用于完整性验证。</p>
<p id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_p156932333915">在软件包下载之后，请参考《OpenPGP签名验证指南》，对从Support网站下载的软件包进行PGP数字签名校验。如果校验失败，请不要使用该软件包，先联系华为技术支持工程师解决。</p>
<p id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_p4569152323915">使用软件包安装/升级之前，也需要按上述过程先验证软件包的数字签名，确保软件包未被篡改。</p>
<p id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_p145691623163911">运营商客户请访问：<a href="https://support.huawei.com/carrier/digitalSignatureAction" target="_blank" rel="noopener noreferrer">https://support.huawei.com/carrier/digitalSignatureAction</a></p>
<p id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792549972_p1256922316392">企业客户请访问：<a href="https://support.huawei.com/enterprise/zh/tool/pgp-verify-TL1000000054" target="_blank" rel="noopener noreferrer">https://support.huawei.com/enterprise/zh/tool/pgp-verify-TL1000000054</a></p>
</div></div>
</div>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li17397160185719"><span>备份代理主机的<span class="filepath" id="ZH-CN_TOPIC_0000001839269357__filepath133976095710">“/vbstool”</span>目录至<span class="filepath" id="ZH-CN_TOPIC_0000001839269357__filepath163971802577">“/opt”</span>。</span><p><div class="note" id="ZH-CN_TOPIC_0000001839269357__note116503418570"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792390300_p28641722154719">命令中的<em id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792390300_i2153220484">/opt</em>请根据ProtectAgent的实际安装目录替换。</p>
</div></div>
<p id="ZH-CN_TOPIC_0000001839269357__p16623111133412">示例：执行以下命令备份<span class="filepath" id="ZH-CN_TOPIC_0000001839269357__filepath88517105553">“/vbstool”</span>目录至<span class="filepath" id="ZH-CN_TOPIC_0000001839269357__filepath14386161495510">“/opt”</span>目录：</p>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen349741985211">cp -r <em id="ZH-CN_TOPIC_0000001839269357__i129761042193918">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/ /opt/</pre>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li19113629133519"><a name="ZH-CN_TOPIC_0000001839269357__li19113629133519"></a><a name="li19113629133519"></a><span>获取OceanStor Pacific证书和密钥文件。</span><p><ul id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_ul326710393259"><li id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_li175411614142720">对于OceanStor Pacific 8.1.2及之前版本，请参考OceanStor Pacific对应版本《产品文档》中的“export fsm certificate”章节获取证书和密钥文件。</li><li id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_li0138150103014">对于OceanStor Pacific 8.2.0及后续版本，请参考OceanStor Pacific对应版本《产品文档》中的“获取对接OceanStor Pacific的dsware-api证书文件”章节获取证书和密钥文件。</li><li id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_li36921858193210">对于其他OceanStor Pacific版本，请参考OceanStor Pacific对应版本《产品文档》中的“获取对接分布式存储的dsware-api证书文件”章节获取证书和密钥文件。</li></ul>
<div class="note" id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_note18638114219404"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_p1464020429407">OceanStor Pacific对应版本《产品文档》可进入<a href="https://support.huawei.com/enterprise/zh/distributed-storage/oceanstor-pacific-series-pid-262589930" target="_blank" rel="noopener noreferrer">OceanStor Pacific 系列</a>，选择对应的型号获取。</p>
</div></div>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li15322111015432"><span>使用PuTTY工具通过管理IP地址以<strong id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_zh-cn_topic_0000001792390248_b916917212">root</strong>账户登录代理主机。</span></li><li id="ZH-CN_TOPIC_0000001839269357__li55249916443"><span>执行以下命令，创建<span class="filepath" id="ZH-CN_TOPIC_0000001839269357__filepath11524993440">“/scripts”</span>目录。</span><p><pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen1052419918441">mkdir -p <em id="ZH-CN_TOPIC_0000001839269357__i16231135153919">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/</pre>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li106379125444"><span>使用WinSCP，将<a href="#ZH-CN_TOPIC_0000001839269357__li19113629133519">3</a>中获取到的证书及密钥文件上传至“<em id="ZH-CN_TOPIC_0000001839269357__i19703714194010">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts”目录。</span></li><li id="ZH-CN_TOPIC_0000001839269357__li87621079456"><span>执行以下命令，查询并解压jre文件。</span><p><ol type="a" id="ZH-CN_TOPIC_0000001839269357__ol67381447481"><li id="ZH-CN_TOPIC_0000001839269357__li137381413488"><a name="ZH-CN_TOPIC_0000001839269357__li137381413488"></a><a name="li137381413488"></a>执行以下命令，查询jre文件。<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_screen85472042174814"><em id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_i19991184213486">cd /opt</em>/dsware/agent</pre>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_screen11285547484">ll</pre>
<p id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_p182934454911">回显类似如下，由于升级等原因，路径下可能存在多个jre文件，如果存在多个jre文件时，请获取最新时间对应的jre文件名。</p>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_screen7501159195011">total 171116
drwx------. 2 root oam        49 Aug 31  2022 bin
drwx------. 4 omm  oam        28 Aug 31  2022 conf
-rwx------. 1 root root 81067968 Sep  9  2022 jre-8u302-linux-x64.tar.gz
-rwx------. 1 root root 94152417 Jul 23 20:03 <strong id="ZH-CN_TOPIC_0000001839269357__zh-cn_topic_0000001792549932_b147351761517">jre-8u392-linux-x64.tar.gz</strong>
drwxr-xr-x. 2 root oam        49 Jul 17 11:33 script
drwxr-x---. 2 root oam        31 Aug 31  2022 tool</pre>
</li><li id="ZH-CN_TOPIC_0000001839269357__li1560937154813">执行以下命令，解压jre文件。<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen107625715453">mkdir -p <em id="ZH-CN_TOPIC_0000001839269357__i13439181724012">/opt</em>/DataBackup/ProtectClient/Plugins/tmp/javarunenv/</pre>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen6762374458">tar -zmxvf <em id="ZH-CN_TOPIC_0000001839269357__i65211119184013">/opt</em>/dsware/agent/<em id="ZH-CN_TOPIC_0000001839269357__i1843175112510">jre-8u392-linux-x64.tar.gz</em> -C <em id="ZH-CN_TOPIC_0000001839269357__i1586412013406">/opt</em>/DataBackup/ProtectClient/Plugins/tmp/javarunenv/</pre>
<div class="note" id="ZH-CN_TOPIC_0000001839269357__note137621755125110"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p id="ZH-CN_TOPIC_0000001839269357__p176217553514">命令中的<em id="ZH-CN_TOPIC_0000001839269357__i6643612135214">jre-8u392-linux-x64.tar.gz</em>请根据<a href="#ZH-CN_TOPIC_0000001839269357__li137381413488">7.a</a>中获取的实际jre文件名替换。</p>
</div></div>
</li></ol>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li884501185719"><span>使用WinSCP，通过管理IP地址，以<strong id="ZH-CN_TOPIC_0000001839269357__b084516117578">root</strong>账号登录代理主机，将获取到的API包上传到代理主机的“/home”目录。</span></li><li id="ZH-CN_TOPIC_0000001839269357__li139461124194516"><span>执行以下命令解压API包。</span><p><div class="note" id="ZH-CN_TOPIC_0000001839269357__note1269320166163"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p id="ZH-CN_TOPIC_0000001839269357__p969391631619">命令中的<em id="ZH-CN_TOPIC_0000001839269357__i1951783353">OceanStor-Pacific_</em><em id="ZH-CN_TOPIC_0000001839269357__i72175161589">xxx</em><em id="ZH-CN_TOPIC_0000001839269357__i119511885350">_API.tar.gz</em>是<a href="#ZH-CN_TOPIC_0000001839269357__li109081022115013">1</a>中获取的API包，<em id="ZH-CN_TOPIC_0000001839269357__i119766108362">OceanStor-Pacific_</em><em id="ZH-CN_TOPIC_0000001839269357__i179761610143615">xxx</em><em id="ZH-CN_TOPIC_0000001839269357__i19767108364">_API</em>为API包解压后的目录，请根据实际替换。</p>
</div></div>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen19946142413453">tar -zxvf /home/<em id="ZH-CN_TOPIC_0000001839269357__i16970152645710">OceanStor-Pacific_xxx_api.tar.gz</em></pre>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li49889160467"><a name="ZH-CN_TOPIC_0000001839269357__li49889160467"></a><a name="li49889160467"></a><span>在<span class="uicontrol" id="ZH-CN_TOPIC_0000001839269357__uicontrol1798813161460">“/home”</span>目录下依次执行以下命令，拷贝相应文件。</span><p><div class="note" id="ZH-CN_TOPIC_0000001839269357__note1988116104615"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><ul id="ZH-CN_TOPIC_0000001839269357__ul16317193394616"><li id="ZH-CN_TOPIC_0000001839269357__li113171833164613">命令中的<em id="ZH-CN_TOPIC_0000001839269357__i139881416154612">xxx</em>表示API包解压后的目录，请根据实际替换。例如API包为OceanStor-Pacific_8.1.2_API.tar.gz，解压后的目录为OceanStor-Pacific_8.1.2_API。</li><li id="ZH-CN_TOPIC_0000001839269357__li176341959104617">如果命令执行过程中提示<strong id="ZH-CN_TOPIC_0000001839269357__b14838327122812">fsa_server.key</strong>、<strong id="ZH-CN_TOPIC_0000001839269357__b14988131684611">client_self.keystore</strong>、<strong id="ZH-CN_TOPIC_0000001839269357__b159885162467">client_trust.keystore</strong>或<strong id="ZH-CN_TOPIC_0000001839269357__b169895164466">zk-client.jks</strong>文件不存在，请先忽略。</li></ul>
</div></div>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen19881016184615">cd<strong id="ZH-CN_TOPIC_0000001839269357__b09881016174619"> </strong><em id="ZH-CN_TOPIC_0000001839269357__i3988111611461">xxx</em></pre>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen159881164465">rm -rf lib/log4j-*</pre>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen6988516184616">/bin/cp client_self.keystore client_trust.keystore dsware-api.properties fsa_server.key manager-ssl.properties primary_ks.key standby_ks.key <em id="ZH-CN_TOPIC_0000001839269357__i11537145113406">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/</pre>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen2098861674620">/bin/cp dr_cli.xml readme.txt version zk-client.jks <em id="ZH-CN_TOPIC_0000001839269357__i11871753164016">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool</pre>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen9988121610461">/bin/cp dsware-api-*.jar <em id="ZH-CN_TOPIC_0000001839269357__i1729515574014">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen8988181616467">/bin/cp primary_ks.key standby_ks.key <em id="ZH-CN_TOPIC_0000001839269357__i9431556194015">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen11988131694616">/bin/cp -r scripts/* <em id="ZH-CN_TOPIC_0000001839269357__i6488057134015">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/</pre>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen9988716164615">/bin/cp -r lib/* <em id="ZH-CN_TOPIC_0000001839269357__i204151958124020">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li9622193074711"><span>执行以下命令，创建storage_port.ini文件。</span><p><pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen6622113024712">touch <em id="ZH-CN_TOPIC_0000001839269357__i56471959134013">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/storage_port.ini</pre>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li56229301478"><span>执行以下命令，拷贝so文件。</span><p><ul id="ZH-CN_TOPIC_0000001839269357__ul66221230134716"><li id="ZH-CN_TOPIC_0000001839269357__li9622133016477">代理主机为x86架构：<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen1762216304475">/bin/cp -r <em id="ZH-CN_TOPIC_0000001839269357__i270430164119">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/linux-x86-64/* <em id="ZH-CN_TOPIC_0000001839269357__i18823811415">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre>
</li><li id="ZH-CN_TOPIC_0000001839269357__li19622173054718">代理主机为ARM架构：<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen2622103020470">/bin/cp -r <em id="ZH-CN_TOPIC_0000001839269357__i740232419">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/linux-aarch64/* <em id="ZH-CN_TOPIC_0000001839269357__i16871193164117">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/</pre>
</li></ul>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li362273084712"><span>执行以下命令，导入环境变量。</span><p><ul id="ZH-CN_TOPIC_0000001839269357__ul12622830174719"><li id="ZH-CN_TOPIC_0000001839269357__li1362213309475">代理主机为x86架构：<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen146224300471">export LD_LIBRARY_PATH=/usr/lib64:<em id="ZH-CN_TOPIC_0000001839269357__i816710574110">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/linux-x86-64</pre>
</li><li id="ZH-CN_TOPIC_0000001839269357__li14622153015477">代理主机为ARM架构：<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen462210301474">export LD_LIBRARY_PATH=/usr/lib64:<em id="ZH-CN_TOPIC_0000001839269357__i51121864412">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/linux-aarch64</pre>
</li></ul>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li86221030104715"><span>依次执行以下命令，设置代理主机的环境变量，避免与证书环境变量冲突。</span><p><pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen146221430174718">VBSTOOL_PATH=<em id="ZH-CN_TOPIC_0000001839269357__i297510624118">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib</pre>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen14622153024718">sed -i "s#export LD_LIBRARY_PATH=.*#export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$VBSTOOL_PATH#g" <em id="ZH-CN_TOPIC_0000001839269357__i29031975417">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vrmVBSTool.sh</pre>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li176229305474"><span>依次执行以下命令，替换证书。</span><p><div class="note" id="ZH-CN_TOPIC_0000001839269357__note062273018470"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><ul id="ZH-CN_TOPIC_0000001839269357__ul15873456202014"><li id="ZH-CN_TOPIC_0000001839269357__li4873205682018">替换过程中需要输入证书的密码，该密码为<a href="#ZH-CN_TOPIC_0000001839269357__li19113629133519">3</a>中设置的密码。</li><li id="ZH-CN_TOPIC_0000001839269357__li15276210193017">命令中的<em id="ZH-CN_TOPIC_0000001839269357__i13888563307">fsm-server.pem</em>为证书文件<em id="ZH-CN_TOPIC_0000001839269357__i1840717573119">，fsm-server.key</em>为密钥文件<em id="ZH-CN_TOPIC_0000001839269357__i740745103115">，ca.pem</em>为CA证书，请根据<a href="#ZH-CN_TOPIC_0000001839269357__li19113629133519">3</a>中获取的实际文件名称替换。</li><li id="ZH-CN_TOPIC_0000001839269357__li4754111153015">命令中的<em id="ZH-CN_TOPIC_0000001839269357__i189671819103015">FSM浮动IP</em>请根据实际IP替换。</li></ul>
</div></div>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen762293014713">JAVA_HOME=$(find <em id="ZH-CN_TOPIC_0000001839269357__i103979134116">/opt</em>/DataBackup/ProtectClient/Plugins/tmp/javarunenv/ -mindepth 1 -maxdepth 1 -type d)</pre>
<pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen2622173044715">sh <em id="ZH-CN_TOPIC_0000001839269357__i81445109415">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/replace_cert.sh -s <em id="ZH-CN_TOPIC_0000001839269357__i69111510204119">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/<em id="ZH-CN_TOPIC_0000001839269357__i11496142172111">fsm-server.pem</em> -c <em id="ZH-CN_TOPIC_0000001839269357__i8775191111412">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/<em id="ZH-CN_TOPIC_0000001839269357__i885232710271">ca.pem</em> -k <em id="ZH-CN_TOPIC_0000001839269357__i1253601234114">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/lib/scripts/<em id="ZH-CN_TOPIC_0000001839269357__i168751625132710">fsm-server.key</em> -f <em id="ZH-CN_TOPIC_0000001839269357__i1962293024710">FSM浮动IP</em> -j $JAVA_HOME</pre>
<ul id="ZH-CN_TOPIC_0000001839269357__ul5622530184712"><li id="ZH-CN_TOPIC_0000001839269357__li16623153014474">对于OceanStor Pacific 8.1.2及之前版本，当“<em id="ZH-CN_TOPIC_0000001839269357__i1690191413417">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/cert/<em id="ZH-CN_TOPIC_0000001839269357__i962353013479">FSM浮动IP地址</em>/”目录下存在client_self.keystore、client_trust.keystore以及dsware-api.properties时，表示证书导入成功。</li><li id="ZH-CN_TOPIC_0000001839269357__li136231530114710">对于OceanStor Pacific 8.1.3及之后版本，当“<em id="ZH-CN_TOPIC_0000001839269357__i523141717410">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/cert/<em id="ZH-CN_TOPIC_0000001839269357__i1562313306475">FSM浮动IP地址</em>/”目录下存在dsware-api.properties时，表示证书导入成功。</li></ul>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li176231303477"><span>对于OceanStor Pacific 8.1.3版本，请执行以下命令适配新接口。其他版本请跳过本步骤。</span><p><pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen162311304477">sed -i '/deleteVolume)/{n;s/"$@"/${@:1:9} 0/;}' <em id="ZH-CN_TOPIC_0000001839269357__i1135121854113">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vrmVBSTool.sh</pre>
</p></li><li id="ZH-CN_TOPIC_0000001839269357__li06231130114714"><span>如果<a href="#ZH-CN_TOPIC_0000001839269357__li49889160467">10</a>中提示<strong id="ZH-CN_TOPIC_0000001839269357__b96239307473">client_self.keystore</strong>和<strong id="ZH-CN_TOPIC_0000001839269357__b14623153004715">client_trust.keystore</strong>文件不存在，请执行以下命令拷贝文件。其他场景请跳过本步骤。</span><p><pre class="screen" id="ZH-CN_TOPIC_0000001839269357__screen1162383014717">cd <em id="ZH-CN_TOPIC_0000001839269357__i20151021124114">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/cert/<em id="ZH-CN_TOPIC_0000001839269357__i18623153015476">FSM浮动IP地址</em>/
cp client_self.keystore client_trust.keystore <em id="ZH-CN_TOPIC_0000001839269357__i1864922144112">/opt</em>/DataBackup/ProtectClient/Plugins/FusionComputePlugin/bin/vbstool/conf/</pre>
</p></li></ol>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">版权所有 &copy; 华为技术有限公司</div></body>
</html>