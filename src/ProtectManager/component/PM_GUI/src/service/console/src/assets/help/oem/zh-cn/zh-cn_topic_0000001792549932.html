<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="DC.Type" content="topic">
  <meta name="DC.Title" content="将代理主机加入华为分布式存储OceanStor Pacific（适用于华为云Stack）">
  <meta name="DC.Format" content="XHTML">
  <meta name="DC.Identifier" content="ZH-CN_TOPIC_0000001792549932">
  <meta name="DC.Language" content="zh-cn">
  <link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
  <title>将代理主机加入华为分布式存储OceanStor Pacific（适用于华为云Stack）</title>
 </head>
 <body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px">
  <a name="ZH-CN_TOPIC_0000001792549932"></a><a name="ZH-CN_TOPIC_0000001792549932"></a>
  <h1 class="topictitle1"><span id="ph26779362412">将代理主机加入华为分布式存储OceanStor Pacific（适用于华为云Stack）</span></h1>
  <div id="body0000001814258413">
   <p id="ZH-CN_TOPIC_0000001792549932__p8060118">当华为云Stack的存储资源为华为分布式块存储OceanStor Pacific，且配置了反向代理时，请参考本节配置，将代理主机作为VBS客户端接入华为分布式存储，并替换证书，确保代理主机能够访问华为分布式块存储。</p>
   <div class="section" id="ZH-CN_TOPIC_0000001792549932__section11855925204414">
    <h4 class="sectiontitle">在代理主机上安装VBS</h4>
    <div class="note" id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_note69529359463">
     <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
     <div class="notebody">
      <p id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_p168872019505">如果待安装VBS的计算节点的操作系统不是分布式存储OS操作系统，安装VBS前请先参考存储设备对应版本的《产品文档》中的“块服务基础业务配置指南 &gt; 附录 &gt; 安装操作系统依赖包”章节，对计算节点安装操作系统依赖包。</p>
     </div>
    </div>
    <p id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_p04301219055">安装VBS服务的详细操作，请参见OceanStor Pacific对应型号版本的《产品文档》中的“分配存储空间（SCSI协议-Linux）&gt; 在计算节点上创建VBS”章节。计算节点，即为代理主机。其中部分配置参数说明如下，其余参数请按文档要求填写。OceanStor Pacific对应版本《产品文档》可进入<a href="https://support.huawei.com/enterprise/zh/distributed-storage/oceanstor-pacific-series-pid-262589930" target="_blank" rel="noopener noreferrer">OceanStor Pacific 系列</a>，选择对应的型号获取。</p>
    <ul id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_ul996111581773">
     <li id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_li1096110589719">管理IP地址：代理主机管理IP地址</li>
     <li id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_li149611258279">机柜：代理主机所在机柜【任意值】</li>
     <li id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_li49619581879">节点角色：计算</li>
     <li id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_li119612582075">安装模式：常规安装</li>
    </ul>
   </div>
   <div class="section" id="ZH-CN_TOPIC_0000001792549932__section10625236164517">
    <a name="ZH-CN_TOPIC_0000001792549932__section10625236164517"></a><a name="section10625236164517"></a>
    <h4 class="sectiontitle">替换OceanStor Pacific证书</h4>
    <ol id="ZH-CN_TOPIC_0000001792549932__ol1563385610506">
     <li id="ZH-CN_TOPIC_0000001792549932__li116039278213"><a name="ZH-CN_TOPIC_0000001792549932__li116039278213"></a><a name="li116039278213"></a><span>登录技术支持网站，获取OceanStor Pacific的API包。</span><p></p>
      <div class="p" id="ZH-CN_TOPIC_0000001792549932__p560372712219">
       API包获取路径如下：
       <ul id="ZH-CN_TOPIC_0000001792549932__ul46031271529">
        <li id="ZH-CN_TOPIC_0000001792549932__li2060382719212">企业网：<a href="https://support.huawei.com/enterprise/zh/distributed-storage/oceanstor-pacific-9520-pid-251711061/software" target="_blank" rel="noopener noreferrer">点此进入</a></li>
        <li id="ZH-CN_TOPIC_0000001792549932__li5603102711218">运营商网站：<a href="https://support.huawei.com/carrier/productNewOffering?col=product&amp;path=PBI1-21430725/PBI1-251363742/PBI1-21431663/PBI1-251366323/PBI1-251711061&amp;resTab=SW" target="_blank" rel="noopener noreferrer">点此进入</a></li>
       </ul>
      </div> <p id="ZH-CN_TOPIC_0000001792549932__p142401833143418">API包名称为“OceanStor-Pacific_<em id="ZH-CN_TOPIC_0000001792549932__i850443125714">xxx</em>_API.tar.gz”，如OceanStor-Pacific_8.1.2_API.tar.gz。</p>
      <div class="p" id="ZH-CN_TOPIC_0000001792549932__p5603927626">
       <em id="ZH-CN_TOPIC_0000001792549932__i2815510563">xxx</em>表示产品版本号。不同版本的软件包名称中的API大小写略有差异。
       <div class="note" id="ZH-CN_TOPIC_0000001792549932__note15603527525">
        <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
        <div class="notebody">
         <p id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_p1456922318392">为了防止软件包在传递过程或存储期间被恶意篡改，下载软件包时需下载对应的数字签名文件用于完整性验证。</p>
         <p id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_p156932333915">在软件包下载之后，请参考《OpenPGP签名验证指南》，对从Support网站下载的软件包进行PGP数字签名校验。如果校验失败，请不要使用该软件包，先联系华为技术支持工程师解决。</p>
         <p id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_p4569152323915">使用软件包安装/升级之前，也需要按上述过程先验证软件包的数字签名，确保软件包未被篡改。</p>
         <p id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_p145691623163911">运营商客户请访问：<a href="https://support.huawei.com/carrier/digitalSignatureAction" target="_blank" rel="noopener noreferrer">https://support.huawei.com/carrier/digitalSignatureAction</a></p>
         <p id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_p1256922316392">企业客户请访问：<a href="https://support.huawei.com/enterprise/zh/tool/pgp-verify-TL1000000054" target="_blank" rel="noopener noreferrer">https://support.huawei.com/enterprise/zh/tool/pgp-verify-TL1000000054</a></p>
        </div>
       </div>
      </div> <p></p></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li51261828132511"><a name="ZH-CN_TOPIC_0000001792549932__li51261828132511"></a><a name="li51261828132511"></a><span>获取OceanStor Pacific证书和密钥文件。</span><p></p>
      <ul id="ZH-CN_TOPIC_0000001792549932__ul326710393259">
       <li id="ZH-CN_TOPIC_0000001792549932__li175411614142720">对于OceanStor Pacific 8.1.2及之前版本，请参考OceanStor Pacific对应版本《产品文档》中的“export fsm certificate”章节获取证书和密钥文件。</li>
       <li id="ZH-CN_TOPIC_0000001792549932__li0138150103014">对于OceanStor Pacific 8.2.0及后续版本，请参考OceanStor Pacific对应版本《产品文档》中的“获取对接OceanStor Pacific的dsware-api证书文件”章节获取证书和密钥文件。</li>
       <li id="ZH-CN_TOPIC_0000001792549932__li36921858193210">对于其他OceanStor Pacific版本，请参考OceanStor Pacific对应版本《产品文档》中的“获取对接分布式存储的dsware-api证书文件”章节获取证书和密钥文件。</li>
      </ul>
      <div class="note" id="ZH-CN_TOPIC_0000001792549932__note18638114219404">
       <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
       <div class="notebody">
        <p id="ZH-CN_TOPIC_0000001792549932__p1464020429407">OceanStor Pacific对应版本《产品文档》可进入<a href="https://support.huawei.com/enterprise/zh/distributed-storage/oceanstor-pacific-series-pid-262589930" target="_blank" rel="noopener noreferrer">OceanStor Pacific 系列</a>，选择对应的型号获取。</p>
        <p id="ZH-CN_TOPIC_0000001792549932__p981443413549"><span><img id="ZH-CN_TOPIC_0000001792549932__image428153510568" src="zh-cn_image_0000002115714257.png"></span></p>
       </div>
      </div> <p></p></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li565294811410"><span>使用PuTTY工具以<strong id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792390248_b916917212">root</strong>账户登录代理主机。</span></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li49701447195115"><span>执行如下命令，创建“/scripts”目录。</span><p></p>
      <div class="note" id="ZH-CN_TOPIC_0000001792549932__note92888313510">
       <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
       <div class="notebody">
        <p id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_p28641722154719">命令中的<em id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_i2153220484">/opt</em>为ProtectAgent的安装目录，请根据实际替换。</p>
       </div>
      </div> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen113053645210">mkdir -p <em id="ZH-CN_TOPIC_0000001792549932__i1073513486712">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/scripts/</pre> <p></p></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li123914241463"><span>使用WinSCP工具，通过管理IP地址，以<strong id="ZH-CN_TOPIC_0000001792549932__b1614865112119">root</strong>账号登录代理主机，将<a href="#ZH-CN_TOPIC_0000001792549932__li51261828132511">2</a>获取到的证书及密钥文件上传到“<em id="ZH-CN_TOPIC_0000001792549932__i53261823153616">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/scripts/”目录。</span></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li813153615524"><span>执行如下命令，查询并解压jre文件。</span><p></p>
      <ol type="a" id="ZH-CN_TOPIC_0000001792549932__ol85762048571">
       <li id="ZH-CN_TOPIC_0000001792549932__li137381413488"><a name="ZH-CN_TOPIC_0000001792549932__li137381413488"></a><a name="li137381413488"></a>执行以下命令，查询jre文件。<pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen85472042174814"><em id="ZH-CN_TOPIC_0000001792549932__i19991184213486">cd /opt</em>/dsware/agent</pre> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen11285547484">ll</pre> <p id="ZH-CN_TOPIC_0000001792549932__p182934454911">回显类似如下，由于升级等原因，路径下可能存在多个jre文件，如果存在多个jre文件时，请获取最新时间对应的jre文件名。</p> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen7501159195011">total 171116
drwx------. 2 root oam        49 Aug 31  2022 bin
drwx------. 4 omm  oam        28 Aug 31  2022 conf
-rwx------. 1 root root 81067968 Sep  9  2022 jre-8u302-linux-x64.tar.gz
-rwx------. 1 root root 94152417 Jul 23 20:03 <strong id="ZH-CN_TOPIC_0000001792549932__b147351761517">jre-8u392-linux-x64.tar.gz</strong>
drwxr-xr-x. 2 root oam        49 Jul 17 11:33 script
drwxr-x---. 2 root oam        31 Aug 31  2022 tool</pre></li>
       <li id="ZH-CN_TOPIC_0000001792549932__li172591312779">执行以下命令，解压jre文件<pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen1514085312538">mkdir -p <em id="ZH-CN_TOPIC_0000001792549932__i6735114819715">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/javarunenv/</pre> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen86233198547">tar -zmxvf <em id="ZH-CN_TOPIC_0000001792549932__i573519481870">/opt</em>/dsware/agent/<em id="ZH-CN_TOPIC_0000001792549932__i750918788">jre-8u392-linux-x64.tar.gz</em> -C <em id="ZH-CN_TOPIC_0000001792549932__i37351148371">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/javarunenv/</pre>
        <div class="note" id="ZH-CN_TOPIC_0000001792549932__note278320499716">
         <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
         <div class="notebody">
          <p id="ZH-CN_TOPIC_0000001792549932__p2078404911714">命令中的<em id="ZH-CN_TOPIC_0000001792549932__i103074231788">jre-8u392-linux-x64.tar.gz</em>请根据<a href="#ZH-CN_TOPIC_0000001792549932__li137381413488">6.a</a>中查询的实际jre文件名替换。</p>
         </div>
        </div></li>
      </ol> <p></p></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li18989104112161"><span>执行如下命令，创建“OceanStor-Pacific_api”目录。</span><p></p><pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen1418151918174">mkdir -p <em id="ZH-CN_TOPIC_0000001792549932__i173584813716">/opt</em>/OceanStor-Pacific_api</pre> <p></p></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li171886259139"><span>使用WinSCP工具，通过管理IP地址，以<strong id="ZH-CN_TOPIC_0000001792549932__b11900165502117">root</strong>账号登录代理主机，将获取到的API包（OceanStor-Pacific_<em id="ZH-CN_TOPIC_0000001792549932__i262211599215">xxx</em>_API.tar.gz）上传到“<em id="ZH-CN_TOPIC_0000001792549932__i1788622903610">/opt</em>/OceanStor-Pacific_api”目录。</span></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li964511303126"><span>执行如下命令，解压API包。</span><p></p>
      <div class="note" id="ZH-CN_TOPIC_0000001792549932__note1269320166163">
       <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
       <div class="notebody">
        <p id="ZH-CN_TOPIC_0000001792549932__p969391631619">命令中的<em id="ZH-CN_TOPIC_0000001792549932__i1951783353">OceanStor-Pacific_</em><em id="ZH-CN_TOPIC_0000001792549932__i72175161589">xxx</em><em id="ZH-CN_TOPIC_0000001792549932__i119511885350">_API.tar.gz</em>是<a href="#ZH-CN_TOPIC_0000001792549932__li116039278213">1</a>中获取的API包，请根据实际替换。</p>
       </div>
      </div> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen162111210196">cd <em id="ZH-CN_TOPIC_0000001792549932__i478293217366">/opt</em>/OceanStor-Pacific_api</pre> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen2521058198">tar -zmxvf <em id="ZH-CN_TOPIC_0000001792549932__i128441435173712">OceanStor-Pacific_xxx_API.tar.gz</em></pre> <p></p></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li121290407536"><a name="ZH-CN_TOPIC_0000001792549932__li121290407536"></a><a name="li121290407536"></a><span>请执行如下命令，拷贝文件。</span><p></p>
      <div class="note" id="ZH-CN_TOPIC_0000001792549932__note2030917572551">
       <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
       <div class="notebody">
        <ul id="ZH-CN_TOPIC_0000001792549932__ul638222817376">
         <li id="ZH-CN_TOPIC_0000001792549932__li13383928163712">命令中的<em id="ZH-CN_TOPIC_0000001792549932__i434135153618">OceanStor-Pacific_</em><em id="ZH-CN_TOPIC_0000001792549932__i17341451203617">xxx</em><em id="ZH-CN_TOPIC_0000001792549932__i1434119516366">_API</em>为API包解压后的目录，请根据实际替换。例如API包为OceanStor-Pacific_8.1.2_API.tar.gz，解压后的目录为OceanStor-Pacific_8.1.2_API。</li>
         <li id="ZH-CN_TOPIC_0000001792549932__li1780733913718">如果命令执行过程中提示<strong id="ZH-CN_TOPIC_0000001792549932__b1853411238448">fsa_server.key、client_self.keystore</strong>、<strong id="ZH-CN_TOPIC_0000001792549932__b557132514446">client_trust.keystore</strong>或<strong id="ZH-CN_TOPIC_0000001792549932__b7752142664411">zk-client.jks</strong>文件不存在，请先忽略。</li>
        </ul>
       </div>
      </div> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen37081928141914">cd <em id="ZH-CN_TOPIC_0000001792549932__i2788184223610">OceanStor-Pacific_</em><em id="ZH-CN_TOPIC_0000001792549932__i678884293615">xxx</em><em id="ZH-CN_TOPIC_0000001792549932__i147883422366">_API</em></pre> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen187910279119">rm -rf lib/log4j-*</pre> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen6988111212197">cp client_self.keystore client_trust.keystore dsware-api.properties fsa_server.key manager-ssl.properties primary_ks.key standby_ks.key <em id="ZH-CN_TOPIC_0000001792549932__i141271234183614">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/conf</pre> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen498861218196">cp dr_cli.xml readme.txt version zk-client.jks <em id="ZH-CN_TOPIC_0000001792549932__i3182143514364">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/conf</pre> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen179891126195">cp dsware-api-*.jar <em id="ZH-CN_TOPIC_0000001792549932__i1533403613365">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/</pre> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen1798912121192">cp primary_ks.key standby_ks.key <em id="ZH-CN_TOPIC_0000001792549932__i8422837143618">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/</pre> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen1998913123192">cp -r scripts/* <em id="ZH-CN_TOPIC_0000001792549932__i73981838163617">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/scripts/</pre> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen19989212161913">cp -r lib/* <em id="ZH-CN_TOPIC_0000001792549932__i1942512395363">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/</pre> <p></p></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li1797645185314"><span>执行如下命令，拷贝so文件。</span><p></p>
      <ul id="ZH-CN_TOPIC_0000001792549932__ul161772219596">
       <li id="ZH-CN_TOPIC_0000001792549932__li1417922105910">ProtectAgent为x86架构，请执行以下命令：<pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen1234916519598">cp -r <em id="ZH-CN_TOPIC_0000001792549932__i12686740163612">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/linux-x86-64/* <em id="ZH-CN_TOPIC_0000001792549932__i27101541103610">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/</pre></li>
      </ul>
      <ul id="ZH-CN_TOPIC_0000001792549932__ul19680142425914">
       <li id="ZH-CN_TOPIC_0000001792549932__li568192415912">ProtectAgent为ARM架构，请执行以下命令：<pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen719015103598">cp -r <em id="ZH-CN_TOPIC_0000001792549932__i168625428367">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/linux-aarch64/* <em id="ZH-CN_TOPIC_0000001792549932__i14758343173611">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/</pre></li>
      </ul> <p></p></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li1866134635319"><span>执行如下命令，导入环境变量。</span><p></p>
      <ul id="ZH-CN_TOPIC_0000001792549932__ul13371657165810">
       <li id="ZH-CN_TOPIC_0000001792549932__li123918574580">ProtectAgent为x86架构，请执行以下命令：<pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen1697913395013">export LD_LIBRARY_PATH=/usr/lib64:<em id="ZH-CN_TOPIC_0000001792549932__i14102645133610">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/linux-x86-64</pre></li>
       <li id="ZH-CN_TOPIC_0000001792549932__li153995785812">ProtectAgent为ARM架构，请执行以下命令：<pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen2017816453019">export LD_LIBRARY_PATH=/usr/lib64:<em id="ZH-CN_TOPIC_0000001792549932__i123964653616">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/linux-aarch64</pre></li>
      </ul> <p></p></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li4984185795917"><span>执行如下命令，替换证书。</span><p></p>
      <div class="note" id="ZH-CN_TOPIC_0000001792549932__note768748210">
       <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
       <div class="notebody">
        <ul id="ZH-CN_TOPIC_0000001792549932__ul4297114519381">
         <li id="ZH-CN_TOPIC_0000001792549932__li1929734517385">替换过程中需要输入证书的密码，该密码为<a href="#ZH-CN_TOPIC_0000001792549932__li51261828132511">2</a>中设置的密码。</li>
         <li id="ZH-CN_TOPIC_0000001792549932__li15276210193017">命令中的<em id="ZH-CN_TOPIC_0000001792549932__i13888563307">fsm-server.pem</em>为证书文件<em id="ZH-CN_TOPIC_0000001792549932__i1840717573119">，fsm-server.key</em>为密钥文件<em id="ZH-CN_TOPIC_0000001792549932__i740745103115">，ca.pem</em>为CA证书，请根据<a href="#ZH-CN_TOPIC_0000001792549932__li51261828132511">2</a>中获取的实际名称替换。</li>
         <li id="ZH-CN_TOPIC_0000001792549932__li4754111153015">命令中的<em id="ZH-CN_TOPIC_0000001792549932__i189671819103015">FSM浮动IP</em>请根据实际IP替换。</li>
        </ul>
       </div>
      </div> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen1833418223111">JAVA_HOME=$(find <em id="ZH-CN_TOPIC_0000001792549932__i11326547103612">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/javarunenv -mindepth 1 -maxdepth 1 -type d)</pre> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen18210727214">sh <em id="ZH-CN_TOPIC_0000001792549932__i83345482368">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/scripts/replace_cert.sh -s <em id="ZH-CN_TOPIC_0000001792549932__i61981849173610">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/scripts/<em id="ZH-CN_TOPIC_0000001792549932__i968101013818">fsm-server.pem</em> -c <em id="ZH-CN_TOPIC_0000001792549932__i1175550163616">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/scripts/<em id="ZH-CN_TOPIC_0000001792549932__i19644121143810">ca.pem</em> -k <em id="ZH-CN_TOPIC_0000001792549932__i9708513360">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/lib/scripts/<em id="ZH-CN_TOPIC_0000001792549932__i470718134385">fsm-server.key</em> -f <em id="ZH-CN_TOPIC_0000001792549932__i1279917345116">FSM浮动IP</em> -j $JAVA_HOME</pre>
      <ul id="ZH-CN_TOPIC_0000001792549932__ul133438311958">
       <li id="ZH-CN_TOPIC_0000001792549932__li33431131157">对于OceanStor Pacific 8.1.2及之前版本，当“<em id="ZH-CN_TOPIC_0000001792549932__i1951995213615">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/conf/cert/<em id="ZH-CN_TOPIC_0000001792549932__i654585122711">FSM浮动IP地址</em>/”目录下存在client_self.keystore、client_trust.keystore以及dsware-api.properties时，表示证书导入成功。</li>
       <li id="ZH-CN_TOPIC_0000001792549932__li416819337518">对于OceanStor Pacific 8.1.3及之后版本，当“<em id="ZH-CN_TOPIC_0000001792549932__i452095317362">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/conf/cert/<em id="ZH-CN_TOPIC_0000001792549932__i81821454132716">FSM浮动IP地址</em>/”目录下存在dsware-api.properties时，表示证书导入成功。</li>
      </ul> <p></p></li>
     <li id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001839269357_li9226919239"><span>对于1.5.0版本，如果OceanStor Pacific为8.1.3及以上版本，请执行以下命令适配新接口。其他场景请跳过本步骤。</span><p></p><pre class="screen" id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001839269357_screen14651104761816">sed -i '/deleteVolume)/{n;s/"$@"/${@:1:9} 0/;}' <em id="ZH-CN_TOPIC_0000001792549932__i1255855412362">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/vrmVBSTool.sh</pre> <p></p></li>
     <li id="ZH-CN_TOPIC_0000001792549932__li78487520572"><span>如果<a href="#ZH-CN_TOPIC_0000001792549932__li121290407536">10</a>中提示<strong id="ZH-CN_TOPIC_0000001792549932__b18919405285">client_self.keystore</strong>和<strong id="ZH-CN_TOPIC_0000001792549932__b1491917062812">client_trust.keystore</strong>文件不存在，请执行以下命令拷贝文件。其他场景请跳过本步骤。</span><p></p><pre class="screen" id="ZH-CN_TOPIC_0000001792549932__screen169492935912">cd <em id="ZH-CN_TOPIC_0000001792549932__i146621055163610">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/conf/cert/<em id="ZH-CN_TOPIC_0000001792549932__i1743139132816">FSM浮动IP地址</em>/
cp client_self.keystore client_trust.keystore <em id="ZH-CN_TOPIC_0000001792549932__i195421556163610">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/vbstool/conf</pre> <p></p></li>
    </ol>
   </div>
   <div class="section" id="ZH-CN_TOPIC_0000001792549932__section941381221317">
    <h4 class="sectiontitle">修改备份方式</h4>
    <p id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_p142672913815">ProtectAgent部署到独立代理主机时，备份方式默认为<span class="parmvalue" id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_parmvalue966217234463">“VBS”</span>，如果需要使用同一代理主机对接多套OceanStor Pacific集群，则需指定备份方式为<span class="parmvalue" id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_parmvalue56141130114610">“ISCSI”</span>，修改操作如下：</p>
    <ol id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_ol1613614033819">
     <li id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001356308068_li152465173517"><span>使用PuTTY工具以<strong id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_zh-cn_topic_0000001792390308_zh-cn_topic_0000001792390248_b916917212">root</strong>账户登录代理主机。</span></li>
     <li id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_li196517513393"><span>执行以下命令，设置配置文件中的<span class="parmname" id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_parmname15271411115">“FusionStorageApiMode”</span>配置项为<span class="parmvalue" id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_parmvalue14880145816019">“ISCSI”</span>。</span><p></p><pre class="screen" id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_screen19112141316">vi <em id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_i193771211818">/opt</em>/DataBackup/ProtectClient/Plugins/VirtualizationPlugin/conf/hcpconf.ini</pre>
      <div class="note" id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_note88645224472">
       <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
       <div class="notebody">
        <p id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_p28641722154719_1">命令中的<em id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_i2153220484_1">/opt</em>为ProtectAgent的安装目录，请根据实际替换。</p>
       </div>
      </div> <p id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_p15116171715211">示例：</p> <pre class="screen" id="ZH-CN_TOPIC_0000001792549932__zh-cn_topic_0000001792549972_screen19257231522">FusionStorageApiMode=ISCSI</pre> <p></p></li>
    </ol>
   </div>
  </div>
 </body>
</html>