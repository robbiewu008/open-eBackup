<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->


<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="安装ProtectAgent软件（手动方式，适用于Linux OS/AIX OS）">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ZH-CN_TOPIC_0000001839189365">
<meta name="DC.Language" content="zh-cn">
<link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
<title>安装ProtectAgent软件（手动方式，适用于Linux OS/AIX OS）</title>
</head>
<body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px"><a name="ZH-CN_TOPIC_0000001839189365"></a><a name="ZH-CN_TOPIC_0000001839189365"></a>

<h1 class="topictitle1">安装ProtectAgent软件（手动方式，适用于Linux OS/AIX OS）</h1>
<div><p id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001166356758_p77861727131820">您需要在代理主机上安装ProtectAgent软件，ProtectAgent充当<span id="ZH-CN_TOPIC_0000001839189365__text989115315218">OceanProtect</span>与受保护资源之间的代理进行数据备份和恢复。本节介绍登录代理主机后台手动为其安装ProtectAgent。</p>
<div class="section"><h4 class="sectiontitle">前提条件</h4><p id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001657025025_zh-cn_topic_0000001792549964_p11178191432914">如果在代理主机上设置了<strong id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001657025025_zh-cn_topic_0000001792549964_b1217817142295">rm</strong>、<strong id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001657025025_zh-cn_topic_0000001792549964_b1479094817301">cp</strong>、<strong id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001657025025_zh-cn_topic_0000001792549964_b1646412133117">mv</strong>等命令需要交互式输入的别名（例如：设置<strong id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001657025025_zh-cn_topic_0000001792549964_b12670182171315">mv=mv -i</strong>，<strong id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001657025025_zh-cn_topic_0000001792549964_b5246558114412">mv</strong>命令默认以<strong id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001657025025_zh-cn_topic_0000001792549964_b92462058164413">-i</strong>参数执行），请先取消别名设置，否则会导致安装失败。</p>
</div>
<div class="section"><h4 class="sectiontitle">注意事项</h4><p>受保护资源为GaussDB(DWS)时，如果您不需要配置防火墙，可以执行<strong>systemctl stop firewalld</strong>命令关闭防火墙。如果您需要开启GaussDB(DWS)节点或代理主机的防火墙，请先开放GaussDB(DWS)备份恢复所需端口，再开启防火墙，否则可能导致GaussDB(DWS)集群无法正常使用。开放GaussDB(DWS)备份恢复所需端口具体请参见<a href="https://support.huawei.com/enterprise/zh/doc/EDOC1100385841?idPath=7919749|251366268|250389224|251366267|258115661" target="_blank" rel="noopener noreferrer">通信矩阵</a>。开启防火墙属于高危操作，请谨慎开启。</p>
</div>
<div class="section"><h4 class="sectiontitle">操作步骤</h4><ol><li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001191380933_li734156194217"><a name="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001191380933_li734156194217"></a><a name="zh-cn_topic_0000001191380933_li734156194217"></a><span>在<span>OceanProtect</span>管理界面下载ProtectAgent软件包。</span><p><p>具体操作可参考<a href="zh-cn_topic_0000001839189405.html">下载ProtectAgent软件包</a>。</p>
</p></li><li><span>受保护资源是否为HDFS、HBase、Hive、ElasticSearch、Redis或ClickHouse集群，且集群中配置了Kerberos认证。</span><p><ul id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_ul0257172810237"><li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_li425762810230">是，安装前要确保代理主机、<span id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_text17431185819103">OceanProtect</span>以及Kerberos服务器的时间一致。如果时间不一致，请使用同一NTP服务器，否则可能导致ProtectAgent安装失败。</li><li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_li1669317304237">否，安装前要确保代理主机与<span id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_text49838681316">OceanProtect</span>设备时间一致。<ul id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_ul274421882011"><li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_li11744161816202">对于OceanProtect X系列备份一体机，参考以下步骤查看<span id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_text3456181418112">OceanProtect</span>设备时间：<ol type="a" id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_zh-cn_topic_0000001143474500_zh-cn_topic_0000001142182722_zh-cn_topic_0000001187942849_zh-cn_topic_0000001087149498_zh-cn_topic_0000001087149498_ol2172145813485"><li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_zh-cn_topic_0000001839223165_li84033442337">选择“系统 &gt; 基础设施 &gt; 集群管理”。</li><li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_li365813483918">在“备份集群”页签的“本地集群节点”区域，单击节点名称。</li><li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_zh-cn_topic_0000001143474500_zh-cn_topic_0000001142182722_zh-cn_topic_0000001187942849_zh-cn_topic_0000001087149498_zh-cn_topic_0000001087149498_li929117916361">在弹出的<span class="uicontrol" id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_uicontrol626919191738">“<span id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_text8269719131">节点详情</span>”</span>界面，查看当前设备时间。<p id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_zh-cn_topic_0000001143474500_zh-cn_topic_0000001142182722_zh-cn_topic_0000001187942849_zh-cn_topic_0000001087149498_zh-cn_topic_0000001087149498_p3985106145415">如果时间不一致，请修改代理主机时间，否则可能导致ProtectAgent安装失败，具体操作请参考<a href="zh-cn_topic_0000002128909289.html">如何修改代理主机时区和时间</a>。</p>
</li></ol>
</li></ul>
</li></ul>
</p></li><li><span>安装ProtectAgent软件。</span><p><ol type="a"><li>使用PuTTY工具以<strong id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189401_b916917212">root</strong>账户登录需要安装ProtectAgent的代理主机。</li><li>依次执行以下命令，创建软件包的存放目录并授权。<pre class="screen">mkdir /opt/install</pre>
<pre class="screen">chmod -R 755<em> /</em><em>opt/install</em></pre>
<div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><ul><li>软件包存放目录的权限需要为755。</li><li>此处以存放目录为<span class="filepath">“/opt/install”</span>为例说明，请根据实际替换。</li></ul>
</div></div>
</li><li>使用WinSCP上传软件包至<span class="filepath">“/opt/install”</span>目录。</li><li>进入<span class="filepath">“/opt/install”</span>目录后，执行以下命令解压软件包。<pre class="screen">unzip DataProtect_<em>xxx</em>_client_<em>xxx</em>.zip</pre>
<div class="note" id="ZH-CN_TOPIC_0000001839189365__note131823521140"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p id="ZH-CN_TOPIC_0000001839189365__p1818285216413">不同的版本、代理类型、操作系统获取到的ProtectAgent软件包名可能会有差异，请以实际为准。</p>
</div></div>
</li><li>执行以下命令，进入软件包目录。<pre class="screen">cd /opt/install/DataProtect_<em>xxx</em>_client_<em>xxx</em>/</pre>
</li><li>执行以下命令，根据回显提示完成软件安装。<ul><li>如果使用的是系统管理员账户登录的主机，请执行<strong>sh install.sh</strong>命令。</li><li>如果使用普通用户登录的主机，请执行<strong>sudo sh install.sh</strong>命令。<div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p>如果该普通用户为sudo非免密用户，请根据提示输入sudo密码。如果该普通用户为sudo免密用户，则无需输入sudo密码。</p>
</div></div>
</li></ul>
<ol class="substepthirdol"><li>当回显如下信息时，请根据提示输入ProtectAgent软件的安装目录。系统会自动校验填入的安装目录的有效性，默认安装在<span class="filepath">“/opt”</span>目录下，选择的安装目录权限需为755，且用户和属组为root。<pre class="screen">Enter the installation directory of the agent. The agent cannot be installed in a directory such as /tmp, /dev, /bin, /usr. Special characters such as [|;&amp;$&gt;&lt;`!]+ are not allowed. By default, the agent is installed in the /opt directory.
Please enter the agent installation directory:</pre>
</li><li>当回显类似如下信息时，请确认主机与<span>OceanProtect</span>设备时间一致，并输入<span class="parmvalue">“y”</span>。<pre class="screen">The current host time and time zone are 2023/08/31-17:17:49[CST]. Check whether the time and time zone are the same as those on DataBackup time:(y/n):
Your choice:</pre>
</li><li>当回显如下信息时，请输入<a href="#ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001191380933_li734156194217">1</a>中设置的私钥密码。<pre class="screen">Enter password:</pre>
</li><li>对于1.5.0SPC19及后续版本，当回显如下信息时，请选择是否开启源端重删功能。<pre class="screen">Whether Open Dataturbo Service:(y|n), default(n)
Your choice:</pre>
<ul><li>如果输入<span class="parmvalue">“y”</span>，则开启源端重删功能，请确保代理主机空闲内存大于2GB，系统会自动安装OceanStor DataTurbo客户端。支持源端重删的操作系统请查看<a href="https://info.support.huawei.com/storage/comp/#/oceanprotect" target="_blank" rel="noopener noreferrer">OceanProtect兼容性查询</a>工具。</li><li>如果输入<span class="parmvalue">“n”</span>，则不开启源端重删功能。在ProtectAgent安装完成后也可手动安装OceanStor DataTurbo客户端，具体操作请参考<a href="zh-cn_topic_0000001936780456.html">安装OceanStor DataTurbo客户端</a>章节。</li></ul>
</li><li>对于1.5.0SPC19及后续版本，当回显如下信息时，请根据实际场景选择是否使用EIP。<pre class="screen">Check where the host is an EIP node:(y|n), default(n)
Your choice:</pre>
<ul><li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_li8258810141315">如果为EIP映射到虚拟私有云（VPC）IP场景，请输入EIP。</li><li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839189313_li1225811101134">如果为内大网IP映射到虚拟私有云（VPC）IP场景，请输入内大网IP。</li></ul>
</li></ol>
<p>当回显如下信息时，表示ProtectAgent安装成功。</p>
<pre class="screen">DataBackup ProtectAgent is successfully installed on the host. </pre>
<div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><ul><li>安装ProtectAgent软件时，系统自动检测环境中是否已安装net-tools工具包、iproute工具包，如检测到未安装会提示安装。</li><li>安装过程中，系统会检查当前主机已配置的业务网络IP，如果检查到已配置多个业务网络IP，会提示用户选择其中一个业务IP用于代理主机备份恢复业务。</li><li>安装过程中，如果系统检测到<span>OceanProtect</span>管理界面上存在相同IP地址但UUID不同的主机时，会提示是否覆盖<span>OceanProtect</span>管理界面的原主机：<ul><li>当选择覆盖时，新安装的主机将继承原主机的副本信息，并且更新新主机的UUID与原主机相同。</li><li>当选择不覆盖时，您需要先<a href="zh-cn_topic_0000001792549964.html#ZH-CN_TOPIC_0000001792549964__zh-cn_topic_0000001166835234_li1849451112587">在OceanProtect管理界面删除原主机</a>后，重新安装。</li></ul>
</li><li>安装完成后系统会自动创建<strong>rdadmin</strong>用户，该用户的用户目录为“ /home/rdadmin”，请勿删除或修改此用户及用户目录。</li></ul>
</div></div>
</li></ol>
</p></li><li><span>代理主机安装ProtectAgent软件后，<span>OceanProtect</span>管理界面会自动发现该代理主机，执行如下步骤进行检查。</span><p><ol type="a"><li>选择<span class="uicontrol" id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839142377_uicontrol08941439165212">“<span id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001839142377_text22651956143811">保护</span> &gt; 客户端 &gt; 客户端”</span>。</li><li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001187942849_li162702510381">查看已安装ProtectAgent的主机是否已存在于<span id="ZH-CN_TOPIC_0000001839189365__text1857815461628">OceanProtect</span>管理界面。<div class="p" id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001187942849_p19934115894410">如果在OceanProtect管理界面上未发现已安装ProtectAgent的代理主机，请联系系统管理员为该用户进行资源授权。<ul id="ZH-CN_TOPIC_0000001839189365__ul11315151683118"><li id="ZH-CN_TOPIC_0000001839189365__li7489102073110">对于1.5.0版本，请执行以下操作：<ol class="substepthirdol" id="ZH-CN_TOPIC_0000001839189365__ol52668371313"><li id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001187942849_li13303622114615">在“客户端”界面该主机所在行，单击<span class="uicontrol" id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001187942849_uicontrol183035225468">“<span id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001187942849_text18303422124612">更多</span> &gt; <span id="ZH-CN_TOPIC_0000001839189365__zh-cn_topic_0000001187942849_text330392284615">资源授权</span>”</span>。</li><li id="ZH-CN_TOPIC_0000001839189365__li12823859173115">将该主机授权给相应的用户。</li></ol>
</li><li id="ZH-CN_TOPIC_0000001839189365__li1431512169316">对于1.6.0及后续版本，请执行以下操作：<ol class="substepthirdol" id="ZH-CN_TOPIC_0000001839189365__ol156361033313"><li id="ZH-CN_TOPIC_0000001839189365__li2850165311349">选择“系统 &gt; 安全 &gt; RBAC”。</li><li id="ZH-CN_TOPIC_0000001839189365__li17341115143513">在“用户”页签相应的用户所在行，单击“修改”。</li><li id="ZH-CN_TOPIC_0000001839189365__li1660463123511">在“修改用户”界面，单击“下一步”。</li><li id="ZH-CN_TOPIC_0000001839189365__li5421154015356">单击“创建资源集”。</li><li id="ZH-CN_TOPIC_0000001839189365__li1749893713610"><a name="ZH-CN_TOPIC_0000001839189365__li1749893713610"></a><a name="li1749893713610"></a>设置资源集名称，并在“客户端”页签选择对应的代理主机。</li><li id="ZH-CN_TOPIC_0000001839189365__li43218366416">单击“确定”。</li><li id="ZH-CN_TOPIC_0000001839189365__li11991352174115">勾选<a href="#ZH-CN_TOPIC_0000001839189365__li1749893713610">4.b.v</a>中创建的资源集，并单击“下一步”。</li><li id="ZH-CN_TOPIC_0000001839189365__li11197205624116">单击“完成”。</li></ol>
</li></ul>
</div>
</li></ol>
</p></li></ol><ol start="5"><li><span>重复以上步骤为其他代理主机安装ProtectAgent软件。</span><p><div class="note"><img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span><div class="notebody"><p>代理主机注册成功后请等待5分钟再使用该代理主机。</p>
</div></div>
</p></li></ol>
</div>
<div class="section"><h4 class="sectiontitle">后续操作</h4><p>成功安装ProtectAgent后，如果您需释放系统空间，可执行以下命令删除软件包存放目录。</p>
<pre class="screen">rm -r /opt/install</pre>
</div>
</div>

<div class="hrcopyright"><hr size="2"></div><div class="hwcopyright">版权所有 &copy; 华为技术有限公司</div></body>
</html>