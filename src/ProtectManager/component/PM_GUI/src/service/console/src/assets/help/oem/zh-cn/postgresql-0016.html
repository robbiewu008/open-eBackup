<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="DC.Type" content="topic">
  <meta name="DC.Title" content="步骤8：执行备份">
  <meta name="product" content="">
  <meta name="DC.Relation" scheme="URI" content="postgresql-0009.html">
  <meta name="prodname" content="">
  <meta name="version" content="">
  <meta name="brand" content="">
  <meta name="DC.Publisher" content="20250306">
  <meta name="prodname" content="csbs">
  <meta name="documenttype" content="usermanual">
  <meta name="DC.Format" content="XHTML">
  <meta name="DC.Identifier" content="postgresql-0016">
  <meta name="DC.Language" content="zh-cn">
  <link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
  <title>步骤8：执行备份</title>
 </head>
 <body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px">
  <a name="postgresql-0016"></a><a name="postgresql-0016"></a>
  <h1 class="topictitle1">步骤8：执行备份</h1>
  <div>
   <p>执行备份前将需要保护的资源关联到指定SLA策略，系统将对这些资源按照SLA策略进行保护，并根据SLA策略周期性自动执行备份任务。如需立即执行一次备份任务时，可以通过手动备份实现。</p>
   <div class="section">
    <h4 class="sectiontitle">注意事项</h4>
    <ul>
     <li>手动备份产生的副本保留时长按照SLA中的定义进行保留。</li>
     <li>如果SLA中定义了复制策略或归档策略，则执行手动备份时，<span>本产品</span>会按照SLA的定义执行一次复制或归档。</li>
     <li>如果SLA中未定义日志备份，则无法自动执行日志备份。</li>
     <li>请确保PostgreSQL数据库实例可以正常运行，当PostgreSQL数据库实例停止运行时，将会触发备份任务执行失败。</li>
    </ul>
   </div>
   <div class="section">
    <h4 class="sectiontitle">操作步骤</h4>
    <ol>
     <li><span>选择<span class="uicontrol" id="postgresql-0016__zh-cn_topic_0000002199964685_uicontrol1389612810362">“<span id="postgresql-0016__zh-cn_topic_0000002199964685_text1089610893610">保护</span> &gt; 数据库 &gt; PostgreSQL”</span>。</span></li>
     <li><span>在<span class="uicontrol">“实例”</span>页签，选择需要保护的数据库，单击<span class="uicontrol">“<span>保护</span>”</span>。</span><p></p><p>您也可以勾选多个数据库进行批量保护。</p> <p></p></li>
     <li><span>选择SLA。</span><p></p><p>您也可以单击<span class="uicontrol">“<span>创建</span>”</span>，创建新的SLA。</p>
      <div class="note">
       <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
       <div class="notebody">
        <p id="postgresql-0016__zh-cn_topic_0000002200146973_p125947145711"><span id="postgresql-0016__zh-cn_topic_0000002200146973_ph1413818422327">如果待保护的资源已设置WORM策略，为避免WORM策略冲突，请选择不包含WORM策略的SLA创建保护。</span></p>
       </div>
      </div> <p></p></li>
     <li><span>配置备份策略高级参数。</span><p></p>
      <div class="p">
       相关参数说明如<a href="#postgresql-0016__zh-cn_topic_0000001349147581_zh-cn_topic_0000001263775382_table354613271506">表1</a>所示。 
       <div class="tablenoborder">
        <a name="postgresql-0016__zh-cn_topic_0000001349147581_zh-cn_topic_0000001263775382_table354613271506"></a><a name="zh-cn_topic_0000001349147581_zh-cn_topic_0000001263775382_table354613271506"></a>
        <table cellpadding="4" cellspacing="0" summary="" id="postgresql-0016__zh-cn_topic_0000001349147581_zh-cn_topic_0000001263775382_table354613271506" frame="border" border="1" rules="all">
         <caption>
          <b>表1 </b>备份策略高级参数说明
         </caption>
         <colgroup>
          <col style="width:30.06%">
          <col style="width:69.94%">
         </colgroup>
         <thead align="left">
          <tr>
           <th align="left" class="cellrowborder" valign="top" width="30.06%" id="mcps1.3.3.2.4.2.1.2.2.3.1.1"><p>参数</p></th>
           <th align="left" class="cellrowborder" valign="top" width="69.94%" id="mcps1.3.3.2.4.2.1.2.2.3.1.2"><p>说明</p></th>
          </tr>
         </thead>
         <tbody>
          <tr>
           <td class="cellrowborder" valign="top" width="30.06%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p>指定目标位置</p></td>
           <td class="cellrowborder" valign="top" width="69.94%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 ">
            <div class="p">
             如果您部署了集群高可用特性，该参数才显示，请指定备份副本的目标存储位置。如不指定，则系统通过智能均衡自动选择备份目标存储单元。
             <ul>
              <li>备份存储单元：对应于备份集群节点。选择备份存储单元后，副本将存储至该存储单元。存储单元容量不足时，备份任务将会失败。</li>
              <li>备份存储单元组：是备份存储单元的集合。选择备份存储单元组后，系统根据存储单元组的存储策略自动选择备份目标存储单元。</li>
             </ul>
            </div></td>
          </tr>
          <tr>
           <td class="cellrowborder" valign="top" width="30.06%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>限速策略</span></p></td>
           <td class="cellrowborder" valign="top" width="69.94%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 "><p>备份任务平均每秒最大传输的数据量。</p></td>
          </tr>
          <tr>
           <td class="cellrowborder" valign="top" width="30.06%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>源端重删</span></p></td>
           <td class="cellrowborder" valign="top" width="69.94%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 ">
            <div class="p">
             开启后，可以减少传输的数据量，但会增加客户端的资源占用。
             <div class="note">
              <span class="notetitle"> 说明： </span>
              <div class="notebody">
               <ul id="postgresql-0016__zh-cn_topic_0000002164820434_ul5885426132914">
                <li id="postgresql-0016__zh-cn_topic_0000002164820434_li10885172616299">由于同一个客户端只能和一个存储单元建链，如果开启源端重删，<span class="parmname" id="postgresql-0016__zh-cn_topic_0000002164820434_parmname1288482662917">“指定目标位置”</span>请选择<span class="parmvalue" id="postgresql-0016__zh-cn_topic_0000002164820434_parmvalue118843260299">“备份存储单元”</span>。否则，由于智能均衡可能会选择到未建链的存储单元，导致源端重删启用失败。如果不同受保护对象关联了不同SLA，且SLA中指定不同的备份存储单元，请为受保护对象选择不同客户端，否则将会导致部分备份任务源端重删启用失败。</li>
                <li id="postgresql-0016__zh-cn_topic_0000002164820434_li9885182662911">如果客户端已经与一个存储单元建链，当该客户端未执行源端重删备份任务时，可以在客户端所在主机上执行<strong id="postgresql-0016__zh-cn_topic_0000002164820434_b9845163710167">dataturbo delete storage_object storage_name=</strong><em id="postgresql-0016__zh-cn_topic_0000002164820434_i19447038131614">?</em>命令（命令中的<strong id="postgresql-0016__zh-cn_topic_0000002164820434_b1050314315162">storage_name=</strong><em id="postgresql-0016__zh-cn_topic_0000002164820434_i1237554410161">?</em>可以通过<strong id="postgresql-0016__zh-cn_topic_0000002164820434_b11885726112912">dataturbo show storage_object</strong>命令查询），删除与存储单元的源端重删链接。再选择该客户端执行源端重删备份任务，则可以成功与新的存储单元建链。</li>
                <li id="postgresql-0016__zh-cn_topic_0000002164820434_li11885142615297">请查看产品兼容性确认客户端所在主机的操作系统是否支持源端重删。若不支持，配置源端重删后将不会生效。</li>
                <li id="postgresql-0016__zh-cn_topic_0000002164820434_li7883549153219">若使用内置客户端（即客户端合并部署到<span id="postgresql-0016__zh-cn_topic_0000002164820434_text13835155817114">本产品</span>）进行备份，配置源端重删后将不会生效。</li>
               </ul>
              </div>
             </div>
            </div></td>
          </tr>
          <tr>
           <td class="cellrowborder" valign="top" width="30.06%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>任务失败告警</span></p></td>
           <td class="cellrowborder" valign="top" width="69.94%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 "><p>开启后，任务执行失败后自动发送告警，下次任务成功后告警自动清除。</p></td>
          </tr>
          <tr>
           <td class="cellrowborder" valign="top" width="30.06%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.1 "><p><span>失败后自动重试</span></p></td>
           <td class="cellrowborder" valign="top" width="69.94%" headers="mcps1.3.3.2.4.2.1.2.2.3.1.2 "><p>开启后，备份任务失败后系统自动重试。</p>
            <div class="p">
             支持重试次数为1~5次，等待时长为1~30分钟。如设置为重试3次，等待5分钟，即每5分钟后重试一次，总共重试3次。
             <div class="note">
              <span class="notetitle"> 说明： </span>
              <div class="notebody">
               <p>自动重试时系统会创建一个新的备份任务，如果该备份任务不在设定的时间窗内则不会执行，此次备份失败。</p>
              </div>
             </div>
            </div></td>
          </tr>
         </tbody>
        </table>
       </div>
      </div> <p></p></li>
     <li><span>单击<span class="uicontrol" id="postgresql-0016__zh-cn_topic_0000002200146973_zh-cn_topic_0000001656691397_uicontrol471113581111">“确定”</span>。</span><p></p><p id="postgresql-0016__zh-cn_topic_0000002200146973_zh-cn_topic_0000001656691397_p25041111535">如果当前系统时间已晚于SLA首次备份的开始时间，可以在弹出的对话框中选择立即执行手动备份或者根据SLA中设置的备份策略周期性自动执行备份。</p> <p></p></li>
     <li><strong>可选：</strong><span>执行手动备份。</span><p></p>
      <div class="p">
       当需要立即执行一次备份任务时，可以执行以下操作进行手动备份。否则，可跳过本步骤。
       <ol type="a">
        <li>在需要备份的数据库所在行单击<span class="uicontrol" id="postgresql-0016__zh-cn_topic_0000001607531736_uicontrol58631047392">“<span id="postgresql-0016__zh-cn_topic_0000001607531736_text1648763311257">更多</span> &gt; <span id="postgresql-0016__zh-cn_topic_0000001607531736_text109939110248">手动备份</span>”</span>。
         <div class="note" id="postgresql-0016__zh-cn_topic_0000001607531736_note187025312547">
          <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
          <div class="notebody">
           <p id="postgresql-0016__zh-cn_topic_0000001607531736_p870125314544">支持选择多个资源批量进行手动备份。勾选多个资源，在页面左上角选择<span class="uicontrol" id="postgresql-0016__zh-cn_topic_0000001607531736_uicontrol14182155715711">“<span id="postgresql-0016__zh-cn_topic_0000001607531736_text662114113158">更多</span> &gt; <span id="postgresql-0016__zh-cn_topic_0000001607531736_text1068159191519">手动备份</span>”</span>。</p>
          </div>
         </div></li>
        <li>设置手动备份产生的副本名称。<p>如果您不设置，系统默认设置副本名称为：backup_时间戳。</p></li>
        <li>选择保护策略：<span>全量备份</span>或<span>日志备份</span>。
         <div class="note">
          <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
          <div class="notebody">
           <p id="postgresql-0016__zh-cn_topic_0000002200146973_p13522118194919"><span id="postgresql-0016__zh-cn_topic_0000002200146973_ph19374310343">对于1.6.0及后续版本，如果选择的保护策略与关联的SLA中配置的保护策略不一致，则WORM配置不生效。</span></p>
          </div>
         </div></li>
        <li>单击<span class="uicontrol">“确定”</span>。</li>
       </ol>
      </div> <p></p></li>
    </ol>
   </div>
  </div>
  <div>
   <div class="familylinks">
    <div class="parentlink">
     <strong>父主题：</strong> <a href="postgresql-0009.html">备份PostgreSQL</a>
    </div>
   </div>
  </div>
 </body>
</html>