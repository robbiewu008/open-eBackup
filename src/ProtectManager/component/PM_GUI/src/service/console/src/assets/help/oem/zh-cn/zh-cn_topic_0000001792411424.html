<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->

<!--
  This file is a part of the open-eBackup project.
  This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0.
  If a copy of the MPL was not distributed with this file, You can obtain one at
  http://mozilla.org/MPL/2.0/.
  
  Copyright (c) [2024] Huawei Technologies Co.,Ltd.
  
  THIS SOFTWARE IS PROVIDED ON AN "AS IS" BASIS, WITHOUT WARRANTIES OF ANY KIND,
  EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO NON-INFRINGEMENT,
  MERCHANTABILITY OR FIT FOR A PARTICULAR PURPOSE.
  -->

<html lang="zh-cn" xml:lang="zh-cn">
 <head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="DC.Type" content="topic">
  <meta name="DC.Title" content="恢复TDSQL数据库">
  <meta name="product" content="">
  <meta name="DC.Relation" scheme="URI" content="zh-cn_topic_0000001839290553.html">
  <meta name="prodname" content="">
  <meta name="version" content="">
  <meta name="brand" content="30-OceanProtect 备份一体机 1.5.0-1.6.0 帮助中心">
  <meta name="DC.Publisher" content="20240320">
  <meta name="DC.Format" content="XHTML">
  <meta name="DC.Identifier" content="ZH-CN_TOPIC_0000001792411424">
  <meta name="DC.Language" content="zh-cn">
  <link rel="stylesheet" type="text/css" href="public_sys-resources/commonltr.css">
  <title>恢复TDSQL数据库</title>
 </head>
 <body style="clear:both; padding-left:10px; padding-top:5px; padding-right:5px; padding-bottom:5px">
  <a name="ZH-CN_TOPIC_0000001792411424"></a><a name="ZH-CN_TOPIC_0000001792411424"></a>
  <h1 class="topictitle1">恢复TDSQL数据库</h1>
  <div>
   <p>当需要对已备份的数据库进行恢复时，可以参考本节使用副本恢复数据库。</p>
   <div class="section">
    <h4 class="sectiontitle">前提条件</h4>
    <ul>
     <li><span>集群已开启NTP服务且时钟源配置相同。</span></li>
     <li>集群实例恢复时，需要保证恢复目标集群的数据同步用户在副本里存在，否则恢复会失败。</li>
    </ul>
   </div>
   <div class="section">
    <h4 class="sectiontitle">操作步骤</h4>
    <ol>
     <li id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001263614142_li10796132225712"><span>选择<span class="uicontrol" id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001839142377_uicontrol8687163819368">“<span id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001839142377_text176879387363">数据利用</span> &gt; <span id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001839142377_text156881638113617">副本数据</span> &gt; <span id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001839142377_text49981969503">数据库</span> &gt; TDSQL”</span>。</span></li>
     <li><span>您可以以TDSQL资源维度或以副本维度查找副本，本节以资源维度为例进行说明。</span><p></p><p>在<span class="uicontrol">“<span>资源</span>”</span>页签，根据资源名称查找到需要恢复的资源，并单击资源名称。</p> <p></p></li>
     <li><span>依次选择年、月、天找到副本。</span><p></p><p>当时间上显示<span><img src="zh-cn_image_0000001839210621.png"></span>，即表示该月、该天存在副本。</p> <p></p></li>
     <li><span>指定副本或时间点进行恢复。</span><p></p>
      <div class="p">
       您可以指定某个副本或两个副本之间的任意时间点进行恢复。
       <ol type="a">
        <li>在“<span>时间选择</span>”页签依次选择年、月、天查找副本。<p>当时间上显示<span><img src="zh-cn_image_0000001839290573.png"></span>，即表示该月、该天存在副本。</p></li>
        <li>指定某个副本或指定时间点进行恢复。
         <ul>
          <li>指定某个副本进行恢复<p><span><img class="eddx" src="zh-cn_image_0000001839290581.png"></span></p></li>
          <li>指定时间点进行恢复。<p>时间轴上蓝色覆盖区域均可进行时间点恢复，<span><img src="zh-cn_image_0000001886074353.png"></span>表示该时间点存在副本。没有备份归档日志的时间点无法进行时间点恢复。</p> <p><span><img class="eddx" src="zh-cn_image_0000001839290565.png"></span></p> <p></p>
           <div class="note">
            <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
            <div class="notebody">
             <ul id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001839188281_ul75802612312">
              <li id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001839188281_li1497342618234">对于1.5.0版本，时间轴上最多仅展示100个副本，单击<span><img id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001839188281_image173544102299" src="zh-cn_image_0000001886153709.png"></span>可以查看所有副本。</li>
              <li id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001839188281_li95818264231">执行时间点恢复时，由于管理界面无法获取恢复时所使用的副本信息，因此，在恢复任务和相关的事件页面，用户无法看到该恢复任务的副本信息。</li>
             </ul>
            </div>
           </div></li>
         </ul></li>
        <li>恢复TDSQL数据库。
         <ul>
          <li>恢复非分布式实例：
           <ul>
            <li>恢复TDSQL数据库至原位置。
             <ol class="substepthirdol">
              <li>选择恢复至<span class="uicontrol">“<span>原位置</span>”</span>。</li>
              <li>单击<span class="uicontrol">“<span>确定</span>”</span>。</li>
             </ol></li>
            <li>恢复TDSQL数据库至新位置。
             <ol class="substepthirdol">
              <li>选择恢复至<span class="uicontrol">“<span>新位置</span>”</span>。</li>
              <li>选择恢复到的<span class="parmname">“<span>目标集群</span>”</span>和<span class="parmname">“<span>目标实例</span>”</span>。
               <div class="note">
                <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
                <div class="notebody">
                 <p>对于1.6.0及后续版本，目标实例的数据库版本号需要和原实例保持一致。</p>
                </div>
               </div></li>
              <li>单击<span class="uicontrol">“<span>确定</span>”</span>。</li>
             </ol></li>
           </ul></li>
          <li>恢复分布式实例：
           <ul>
            <li>恢复TDSQL数据库至原集群。
             <ol class="substepthirdol">
              <li>选择恢复至<span class="uicontrol">“原集群”</span>。</li>
              <li id="ZH-CN_TOPIC_0000001792411424__li1545975010612">选择恢复的<span class="parmname" id="ZH-CN_TOPIC_0000001792411424__parmname4364123931018">“容灾模式”</span>。
               <div class="note" id="ZH-CN_TOPIC_0000001792411424__note1427914498213">
                <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
                <div class="notebody">
                 <p id="ZH-CN_TOPIC_0000001792411424__p2279349628">仅支持选择不超过目标集群数据节点数量的容灾模式。</p>
                </div>
               </div></li>
              <li id="ZH-CN_TOPIC_0000001792411424__li850010299118">在<span class="wintitle" id="ZH-CN_TOPIC_0000001792411424__wintitle1567142671910">“数据节点”</span>区域，为TDSQL业务节点选择所属的代理主机。</li>
              <li id="ZH-CN_TOPIC_0000001792411424__li1473317682215">配置高级参数，参数说明请参见<a href="#ZH-CN_TOPIC_0000001792411424__table18661192115247">表1</a>。
               <div class="note" id="ZH-CN_TOPIC_0000001792411424__note839823416220">
                <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
                <div class="notebody">
                 <p id="ZH-CN_TOPIC_0000001792411424__p939843418226">如不配置高级参数，则默认使用原实例的配置进行恢复。</p>
                </div>
               </div>
               <div class="tablenoborder">
                <a name="ZH-CN_TOPIC_0000001792411424__table18661192115247"></a><a name="table18661192115247"></a>
                <table cellpadding="4" cellspacing="0" summary="" id="ZH-CN_TOPIC_0000001792411424__table18661192115247" frame="border" border="1" rules="all">
                 <caption>
                  <b>表1 </b>高级配置参数说明
                 </caption>
                 <colgroup>
                  <col style="width:50%">
                  <col style="width:50%">
                 </colgroup>
                 <thead align="left">
                  <tr id="ZH-CN_TOPIC_0000001792411424__row36611021192414">
                   <th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.3.3.2.4.2.1.1.3.1.2.1.1.1.4.3.2.3.1.1"><p id="ZH-CN_TOPIC_0000001792411424__p36624213242">参数</p></th>
                   <th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.3.3.2.4.2.1.1.3.1.2.1.1.1.4.3.2.3.1.2"><p id="ZH-CN_TOPIC_0000001792411424__p12662321122419">说明</p></th>
                  </tr>
                 </thead>
                 <tbody>
                  <tr id="ZH-CN_TOPIC_0000001792411424__row96621210246">
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.1.1.4.3.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792411424__p4662162118242">机型</p></td>
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.1.1.4.3.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792411424__p36621521182414">选择目标机型。</p></td>
                  </tr>
                  <tr id="ZH-CN_TOPIC_0000001792411424__row6662132182414">
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.1.1.4.3.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792411424__p186621621162419">CPU（核）</p></td>
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.1.1.4.3.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792411424__p86621521172410">取值范围：1~64。</p></td>
                  </tr>
                  <tr id="ZH-CN_TOPIC_0000001792411424__row26621821122419">
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.1.1.4.3.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792411424__p66628212242">内存大小（GB）</p></td>
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.1.1.4.3.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792411424__p172071437202715">取值范围：1~128。</p></td>
                  </tr>
                  <tr id="ZH-CN_TOPIC_0000001792411424__row266262110245">
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.1.1.4.3.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792411424__p14662152182410">数据磁盘大小（GB）</p></td>
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.1.1.4.3.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792411424__p18104921182913">取值范围：1~800。</p></td>
                  </tr>
                  <tr id="ZH-CN_TOPIC_0000001792411424__row116886327298">
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.1.1.4.3.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792411424__p156881932182912">日志磁盘大小（GB）</p></td>
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.1.1.4.3.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792411424__p8456447102919">取值范围：1~800。</p></td>
                  </tr>
                 </tbody>
                </table>
               </div></li>
              <li>单击<span class="uicontrol">“<span>确定</span>”</span>。</li>
             </ol></li>
            <li>恢复TDSQL数据库至新集群。
             <ol class="substepthirdol">
              <li>选择恢复至<span class="uicontrol">“新集群”</span>。</li>
              <li>选择恢复到的<span class="parmname">“<span>目标集群</span>”</span>。
               <div class="note">
                <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
                <div class="notebody">
                 <p>选择的目标集群必须打开zkmeta自动备份功能，否则会导致恢复失败。</p>
                </div>
               </div></li>
              <li>选择恢复的<span class="parmname" id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_parmname4364123931018">“容灾模式”</span>。
               <div class="note" id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_note1427914498213">
                <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
                <div class="notebody">
                 <p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p2279349628">仅支持选择不超过目标集群数据节点数量的容灾模式。</p>
                </div>
               </div></li>
              <li>在<span class="wintitle" id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_wintitle1567142671910">“数据节点”</span>区域，为TDSQL业务节点选择所属的代理主机。</li>
              <li>配置高级参数，参数说明请参见<a href="#ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_table18661192115247">表2</a>。
               <div class="note" id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_note839823416220">
                <img src="public_sys-resources/note_3.0-zh-cn.png"><span class="notetitle"> </span>
                <div class="notebody">
                 <p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p939843418226">如不配置高级参数，则默认使用原实例的配置进行恢复。</p>
                </div>
               </div>
               <div class="tablenoborder">
                <a name="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_table18661192115247"></a><a name="zh-cn_topic_0000001792411424_table18661192115247"></a>
                <table cellpadding="4" cellspacing="0" summary="" id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_table18661192115247" frame="border" border="1" rules="all">
                 <caption>
                  <b>表2 </b>高级配置参数说明
                 </caption>
                 <colgroup>
                  <col style="width:50%">
                  <col style="width:50%">
                 </colgroup>
                 <thead align="left">
                  <tr id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_row36611021192414">
                   <th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.3.3.2.4.2.1.1.3.1.2.1.2.1.5.3.2.3.1.1"><p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p36624213242">参数</p></th>
                   <th align="left" class="cellrowborder" valign="top" width="50%" id="mcps1.3.3.2.4.2.1.1.3.1.2.1.2.1.5.3.2.3.1.2"><p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p12662321122419">说明</p></th>
                  </tr>
                 </thead>
                 <tbody>
                  <tr id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_row96621210246">
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.2.1.5.3.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p4662162118242">机型</p></td>
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.2.1.5.3.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p36621521182414">选择目标机型。</p></td>
                  </tr>
                  <tr id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_row6662132182414">
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.2.1.5.3.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p186621621162419">CPU（核）</p></td>
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.2.1.5.3.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p86621521172410">取值范围：1~64。</p></td>
                  </tr>
                  <tr id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_row26621821122419">
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.2.1.5.3.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p66628212242">内存大小（GB）</p></td>
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.2.1.5.3.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p172071437202715">取值范围：1~128。</p></td>
                  </tr>
                  <tr id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_row266262110245">
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.2.1.5.3.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p14662152182410">数据磁盘大小（GB）</p></td>
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.2.1.5.3.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p18104921182913">取值范围：1~800。</p></td>
                  </tr>
                  <tr id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_row116886327298">
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.2.1.5.3.2.3.1.1 "><p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p156881932182912">日志磁盘大小（GB）</p></td>
                   <td class="cellrowborder" valign="top" width="50%" headers="mcps1.3.3.2.4.2.1.1.3.1.2.1.2.1.5.3.2.3.1.2 "><p id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_p8456447102919">取值范围：1~800。</p></td>
                  </tr>
                 </tbody>
                </table>
               </div></li>
              <li>单击<span class="uicontrol">“<span>确定</span>”</span>。</li>
             </ol></li>
           </ul></li>
         </ul></li>
       </ol>
      </div> <p></p></li>
     <li id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001263614142_li1481714307166"><span>单击<span class="uicontrol" id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001263614142_uicontrol194684162818">“<span id="ZH-CN_TOPIC_0000001792411424__text5761862442">确定</span>”</span>。</span></li>
    </ol>
   </div>
   <div class="section">
    <h4 class="sectiontitle">后置操作</h4>
    <p>非分布式实例恢复后，目标实例的用户名和密码将被副本对应实例的用户名和密码覆盖。如果目标实例状态为<span class="uicontrol">“<span>离线</span>”</span>，请更新目标实例的用户名和密码。</p>
    <ol>
     <li><span>选择<span class="uicontrol" id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001839142377_uicontrol123821426193719">“<span id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001839142377_text3382726113718">保护</span> &gt; 数据库 &gt; TDSQL”</span>。</span></li>
     <li><span>选择<span class="uicontrol" id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001839210573_zh-cn_topic_0000001311214069_uicontrol47381735103817">“<span id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001839210573_text1668605291117">非分布式实例</span>”</span>页签。</span></li>
     <li><span>单击目标实例名称。</span></li>
     <li><span>在弹出的界面右上角单击<span class="uicontrol">“<span>操作</span> &gt; <span>修改</span>”</span>。</span></li>
     <li><span>在弹出的<span class="wintitle">“<span>修改</span>”</span>页面中更新用户名和密码。</span></li>
     <li><span>单击<span class="uicontrol" id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_zh-cn_topic_0000001263614142_uicontrol194684162818">“<span id="ZH-CN_TOPIC_0000001792411424__zh-cn_topic_0000001792411424_text5761862442">确定</span>”</span>。</span></li>
    </ol>
   </div>
  </div>
  <div>
   <div class="familylinks">
    <div class="parentlink">
     <strong>父主题：</strong> <a href="zh-cn_topic_0000001839290553.html">恢复</a>
    </div>
   </div>
  </div>
 </body>
</html>