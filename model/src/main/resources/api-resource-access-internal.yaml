swagger: '2.0'
info:
  version: v1
  title: 系统管理接口
  description: GroupDesc
schemes:
  - https
host: localhost.com
basePath: /
tags:
  - name: protected-resource-api
  - name: protected-environment-api
paths:
  /v2/internal/resources/{resourceId}:
    get:
      x-product: OceanProtect X
      tags:
        - protected-resource-api
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 30081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'N'
      x-sysadmin-role: 'N'
      description: 查询单个资源信息v2版本对内查询
      operationId: ShowResourcev2
      parameters:
        - name: resourceId
          in: path
          required: true
          type: string
        - name: resourceId
          in: query
          required: true
          description: 资源id
          type: string
      responses:
        '200':
          description: 资源信息
          schema:
            type: object
          examples:
            application/json:
              uuid: string
              name: string
              type: string
              subType: string
              path: string
              rootUuid: string
              parentUuid: string
              extendInfo:
                additionalProp1: string
                additionalProp2: string
                additionalProp3: string
              createdTime: '2022-06-25T03:24:32.824Z'
              version: string
              parentName: string
              userId: string
              authorizedUser: string
              protectedObject:
                slaId: string
                slaName: string
                slaCompliance: true
                status: 0
                envId: string
                envType: string
                resourceId: string
                extParameters:
                  additionalProp1: {}
                  additionalProp2: {}
                  additionalProp3: {}
                latestTime: '2022-06-25T03:24:32.824Z'
                earliestTime: '2022-06-25T03:24:32.824Z'
                chainId: string
              environment:
                endpoint: string
                port: 0
                linkStatus: string
                userName: string
                location: string
                osType: string
                osName: string
                scanInterval: string
              auth:
                authType: 0
  /v2/internal/environments:
    post:
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'N'
      x-sysadmin-role: 'N'
      tags:
        - protected-environment-api
      description: 内部注册受保护环境
      operationId: RegisterProtectedEnviroment
      parameters:
        - name: RegisterProtectedEnvironmentRequest
          in: body
          required: false
          schema:
            $ref: '#/definitions/RegisterProtectedEnvironmentRequest'
      responses:
        '200':
          description: ''
          schema:
            type: string
  /v2/internal/environments/{envId}:
    delete:
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'N'
      x-sysadmin-role: 'N'
      tags:
        - protected-environment-api
      description: 删除受保护环境,只是更新状态为离线
      operationId: DeleteProtectedEnvironment
      parameters:
        - name: envId
          in: path
          required: true
          type: string
          description: 受保护环境ID
      responses:
        '200':
          description: ''
          schema:
            type: string
  /v2/internal/environments/delete/{envId}:
    delete:
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'N'
      x-sysadmin-role: 'N'
      tags:
        - protected-environment-api
      description: 删除受保护环境
      operationId: DeleteProtectedEnvironmentForInternal
      parameters:
        - name: envId
          in: path
          required: true
          type: string
          description: 受保护环境ID
      responses:
        '200':
          description: ''
          schema:
            type: string
  /v2/internal/environments/host/trust:
    get:
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'N'
      x-sysadmin-role: 'N'
      tags:
        - protected-environment-api
      description: 检查该主机是否受信
      operationId: checkHostBeTrust
      parameters:
        - name: endpoint
          in: query
          required: false
          description: 主机ip
          type: string
      responses:
        '200':
          description: |-
            {
                "IsTrusted":true
            }
          schema:
            type: string
  /v2/internal/environments/host/dmc/trust:
    get:
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'N'
      x-sysadmin-role: 'N'
      tags:
        - protected-environment-api
      description: 检查dmc该主机是否受信
      operationId: checkDmcHostBeTrust
      parameters:
        - name: endpoint
          in: query
          required: false
          description: 主机的ip
          type: string
      responses:
        '200':
          description: |-
            {
                "Data":{
                    "IsTrusted":true
                },
                "Error":{
                    "Code":0,
                    "Description":""
                }
            }
          schema:
            type: string
  /v2/internal/resources{resourceId}/action/clean-next-backup:
    put:
      x-dr-role: 'N'
      x-product: OceanProtect X8000,OceanProtect X6000,OceanProtect X3000
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 30081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'Y'
      x-public-api: 'N'
      x-sysadmin-role: 'Y'
      tags:
        - protected-resource-api
      description: 清除下次备份类型和原因
      operationId: cleanNextBackup
      parameters:
        - name: resourceId
          in: path
          required: true
          type: string
          description: 资源id
      responses:
        '200':
          description: ''
          schema:
            type: string
  /v2/internal/resources{resourceId}/next-backup-type-and-cause:
    get:
      x-dr-role: 'N'
      x-product: OceanProtect X8000,OceanProtect X6000,OceanProtect X3000
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 30081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'Y'
      x-public-api: 'N'
      x-sysadmin-role: 'Y'
      tags:
        - protected-resource-api
      description: 查询下次备份类型和原因
      operationId: QueryNextBackupAndCause
      parameters:
        - name: resourceId
          in: path
          required: true
          type: string
          description: 资源id
      responses:
        '200':
          description: ''
          schema:
            type: string
          examples:
            application/json:
              next_backup_change_cause: restore_success_to_full_label
              next_backup_type: full
  /v2/internal/resources:
    get:
      x-dr-role: 'N'
      x-product: CyberEngine,OceanProtect X8000,OceanProtect X6000,OceanProtect X3000
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 30081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'N'
      x-sysadmin-role: 'N'
      tags:
        - protected-resource-api
      summary: page query protected resource
      description: page query protected resource
      operationId: queryResources
      parameters:
        - name: queryParam
          in: body
          required: false
          description: 内部查询接口参数
          schema:
            $ref: '#/definitions/InternalResourceQueryParam'
      responses:
        '200':
          description: PageListResponse
          schema:
            $ref: '#/definitions/PageListResponse'
  /v2/internal/resources/tenants:
    get:
      x-dr-role: 'N'
      x-product: CyberEngine,OceanProtect X8000,OceanProtect X6000,OceanProtect X3000
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 30081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'N'
      x-sysadmin-role: 'N'
      tags:
        - protected-resource-api
      summary: 查询租户列表
      description: 查询租户列表
      operationId: listTenants
      parameters:
        - name: pageNo
          in: query
          required: false
          type: integer
          format: int32
        - name: pageSize
          in: query
          required: false
          type: integer
          format: int32
        - name: resourceId
          in: query
          required: false
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/PageListResponse'
  /v2/internal/resources/storageInfo:
    get:
      x-dr-role: 'N'
      x-product: CyberEngine,OceanProtect X8000,OceanProtect X6000,OceanProtect X3000
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 30081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'N'
      x-sysadmin-role: 'N'
      tags:
        - protected-resource-api
      summary: 查询存储设备信息
      description: 查询存储设备信息
      operationId: listStorageInfo
      parameters:
        - name: tenantId
          in: query
          required: false
          description: 租户ID
          type: string
        - name: deviceId
          in: query
          required: false
          description: 设备ID
          type: string
      responses:
        '200':
          description: 存储设备信息
          schema:
            $ref: '#/definitions/StorageInfo'
  /v2/internal/resources/fileSystems:
    get:
      x-dr-role: 'N'
      x-product: CyberEngine,OceanProtect X8000,OceanProtect X6000,OceanProtect X3000
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 30081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'N'
      x-sysadmin-role: 'N'
      summary: 查询文件系统信息
      description: 查询文件系统信息
      operationId: listFileSystems
      parameters:
        - name: pageNo
          in: query
          required: false
          description: 页码
          type: integer
          format: int32
        - name: pageSize
          in: query
          required: false
          description: 页面大小
          type: integer
          format: int32
        - name: tenantId
          in: query
          required: false
          description: 租户Id
          type: string
        - name: resourceId
          in: query
          required: false
          description: 文件系统ID
          type: string
      responses:
        '200':
          description: 文件系统列表
          schema:
            $ref: '#/definitions/PageListResponse'
definitions:
  Authentication:
    type: object
    required:
      - authType
    properties:
      authType:
        type: integer
        format: int32
        description: >-
          0-NO_AUTH, 1-OS_PASSWORD, 2-APP_PASSWORD，3-LADP, 4-AKSK, 5-KERBEROS,
          6-TOKEN, 7-OAUTH2, 8-OTHER。1到3,authKey填用户名,authPwd填密码， 4 authKey填AK，
          authPwd填SK, 5,6,7,8认证认证信息在扩展字段中扩充。

          0-NO_AUTH, 1-OS_PASSWORD, 2-APP_PASSWORD，3-LADP, 4-AKSK, 5-KERBEROS,
          6-TOKEN, 7-OAUTH2, 8-OTHER。1到3,authKey填用户名,authPwd填密码， 4 authKey填AK，
          authPwd填SK, 5,6,7,8认证认证信息在扩展字段中扩充
      authKey:
        type: string
        description: 使用用户名密码认证时该字段填用户名，使用AK/SK认证时该字段填充AK
      authPwd:
        type: string
        description: |-
          使用用户名密码认证时该字段填密码，使用AK/SK认证时该字段填充SK
          使用用户名密码认证时该字段填密码，使用AK/SK认证时该字段填充SK
      extendInfo:
        type: object
        additionalProperties:
          type: string
        description: 证扩展信息，使用其他方式认证时，认证信息放在扩展该字段里
  RegisterProtectedEnvironmentRequest:
    type: object
    required:
      - name
      - type
      - subType
    properties:
      name:
        type: string
        description: 受保护环境名称
      type:
        type: string
        description: 环境的类型
      endpoint:
        type: string
        description: 环境的IP地址或域名
      subType:
        type: string
        description: 环境的子类型
      port:
        type: integer
        format: int32
        description: 环境的接入端口
      username:
        type: string
        description: 环境的用户名
      password:
        type: string
        description: 环境的密码
      osType:
        type: string
        description: 环境的操作系统
      version:
        type: string
        description: 环境的版本
      dependencies:
        type: object
        additionalProperties:
          additionalProperties:
            type: string
          type: object
        description: 依赖参数，依赖其他资源
      extendInfo:
        type: string
        description: |-
          环境扩展参数，存放不同环境的自定义扩展属性
          环境扩展参数，存放不同环境的自定义扩展属性
      auth:
        $ref: '#/definitions/Authentication'
  InternalResourceQueryParam:
    type: object
    properties:
      pageNo:
        type: integer
        format: int32
      pageSize:
        type: integer
        format: int32
      conditions:
        type: string
      shouldQueryDependency:
        type: boolean
      orders:
        type: array
        items:
          type: string
  PageListResponse:
    type: object
    properties:
      totalCount:
        type: integer
        format: int32
      records:
        type: array
        items:
          type: object
  PageListResponseTenantInfo:
    type: object
    properties:
      totalCount:
        type: integer
        format: int32
      records:
        type: array
        items:
          type: object
  StorageInfo:
    type: object
    properties:
      tenantId:
        type: string
        description: 租户ID
      deviceId:
        type: string
        description: 设备ID
      endpoint:
        type: string
        description: 地址
      port:
        type: string
        description: 端口
      userName:
        type: string
        description: 用户名
      password:
        type: string
        description: 密码
      type:
        type: string
        description: 类型
      userId:
        type: string
        description: 用户ID
