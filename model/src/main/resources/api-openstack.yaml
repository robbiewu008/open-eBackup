swagger: '2.0'
info:
  version: v1
  title: ApplicationTitle
  description: GroupDesc
schemes:
  - https
host: localhost.com
basePath: /
tags:
  - name: backup
  - name: restore
  - name: copy
  - name: quota
paths:
  /v2/backup_jobs:
    post:
      x-dr-role: 'N'
      x-request-examples-url-1: /v2/backup_jobs
      x-request-examples-text-1:
        backup_jobs:
          - name: backup1
            description: Bckup VM1 weekly
            type: server
            instance_id: VM1 uuid
            auto_retry_times: 3
            auto_retry_wait_minutes: 5
            jobs_schedule:
              type: weeks
              policy:
                days_of_week:
                  - 1
                  - 4
                execute_time: 10
              retention:
                type: number
                count: 5
      x-request-examples-1:
        backup_jobs:
          - name: backup1
            description: Bckup VM1 weekly
            type: server
            instance_id: VM1 uuid
            auto_retry_times: 3
            auto_retry_wait_minutes: 5
            jobs_schedule:
              type: weeks
              policy:
                days_of_week:
                  - 1
                  - 4
                execute_time: 10
              retention:
                type: number
                count: 5
      tags:
        - backup
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      operationId: createBackupJobUsingPost
      consumes:
        - application/json
      summary: 创建备份任务
      description: 创建备份任务
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - in: body
          name: backupJob
          description: 备份任务，支持批量任务创建
          required: true
          schema:
            $ref: '#/definitions/BatchCreateBackupJobDto'
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '201':
          description: Created
          schema:
            items:
              $ref: '#/definitions/OpenStackBackupJobResp'
            type: array
          examples:
            application/json:
              backup_jobs:
                - id: 33ebc900-d277-4a54-8db9-fff33208a480
                  name: backup1
                  description: Bckup VM1 weekly
                  type: server
                  instance_id: VM1 uuid
                  auto_retry_times: 3
                  auto_retry_wait_minutes: 5
                  jobs_schedule:
                    type: weeks
                    policy:
                      start_date: '2022-08-01T08:00:00Z'
                      days_of_week:
                        - 1
                        - 4
                      execute_time: 10
                    retention:
                      type: number
                      count: 5
                  last_result: ''
                  status: scheduling
        '400':
          description: Bad Request
          schema:
            type: string
        '404':
          description: Not Found
          schema:
            type: string
        '500':
          description: Internal Server error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
    get:
      x-dr-role: 'N'
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      tags:
        - backup
      operationId: queryJobsUsingGet
      consumes:
        - application/json
      summary: 查询所有备份任务
      description: 查询所有备份任务
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '200':
          description: Success
          schema:
            items:
              $ref: '#/definitions/OpenStackBackupJobResp'
            type: array
          examples:
            application/json:
              - backup_jobs:
                  - id: 33ebc900-d277-4a54-8db9-fff33208a480
                    name: backup1
                    description: Bckup VM1 weekly
                    type: server
                    instance_id: VM1 uuid
                    auto_retry_times: 3
                    auto_retry_wait_minutes: 5
                    jobs_schedule:
                      type: weeks
                      policy:
                        start_date: '2022-08-01T08:00:00Z'
                        days_of_week:
                          - 1
                          - 4
                        execute_time: 10
                      retention:
                        type: number
                        count: 5
                    result: success
                    status: scheduling
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
  /v2/backup_jobs/{id}:
    get:
      x-dr-role: 'N'
      x-request-examples-url-1: /v2/backup_jobs/33ebc900-d277-4a54-8db9-fff33208a480
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      tags:
        - backup
      operationId: queryJobUsingGet
      consumes:
        - application/json
      summary: 查询单个备份任务
      description: 查询单个备份任务
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          required: true
          type: string
          description: 备份任务id（资源id）
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/OpenStackBackupJobResp'
          examples:
            application/json:
              backup_jobs:
                - id: 33ebc900-d277-4a54-8db9-fff33208a480
                  name: backup1
                  description: Bckup VM1 weekly
                  type: server
                  instance_id: VM1 uuid
                  auto_retry_times: 3
                  auto_retry_wait_minutes: 5
                  jobs_schedule:
                    type: weeks
                    policy:
                      start_date: '2022-08-01T08:00:00Z'
                      days_of_week:
                        - 1
                        - 4
                      execute_time: 10
                    retention:
                      type: number
                      count: 5
                  result: success
                  status: scheduling
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
    put:
      x-dr-role: 'N'
      x-request-examples-url-1: /v2/backup_jobs/33ebc900-d277-4a54-8db9-fff33208a480
      x-request-examples-text-1:
        backup_job:
          description: Bckup VM1 weekly
          jobs_schedule:
            type: days
            policy:
              interval_days: 10
              execute_time: 10
            retention:
              type: number
              count: 5
      x-request-examples-1:
        backup_job:
          description: Bckup VM1 weekly
          jobs_schedule:
            type: days
            policy:
              interval_days: 10
              execute_time: 10
            retention:
              type: number
              count: 5
      tags:
        - backup
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      operationId: modifyBackupJobUsingPut
      consumes:
        - application/json
      summary: 修改备份任务
      description: 修改备份任务
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          required: true
          type: string
          description: 备份任务id（资源id）
        - in: body
          name: backupJob
          description: 备份任务
          required: true
          schema:
            $ref: '#/definitions/OpenStackBackupJobModify'
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '201':
          description: Created
          schema:
            $ref: '#/definitions/OpenStackBackupJobResp'
          examples:
            application/json:
              backup_job:
                name: backup1
                description: Bckup VM1 weekly
                type: server
                instance_id: VM1 uuid
                auto_retry_times: 3
                auto_retry_wait_minutes: 5
                jobs_schedule:
                  type: days
                  policy:
                    interval_days: 10
                    execute_time: 10
                  retention:
                    type: number
                    count: 5
                status: scheduling
        '400':
          description: Bad Request
          schema:
            type: string
        '404':
          description: Not Found
          schema:
            type: string
        '500':
          description: Internal Server error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
    delete:
      x-dr-role: 'N'
      x-request-examples-url-1: /v2/backup_jobs/33ebc900-d277-4a54-8db9-fff33208a480
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      tags:
        - backup
      operationId: deleteJobUsingDelete
      consumes:
        - application/json
      summary: 删除备份任务
      description: 删除备份任务
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          required: true
          type: string
          description: 备份任务id（资源id）
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '200':
          description: 删除成功
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
  /v2/backup_jobs/{id}/action:
    post:
      x-dr-role: 'N'
      x-request-examples-url-1: /v2/backup_jobs/33ebc900-d277-4a54-8db9-fff33208a480/action
      x-request-examples-text-1:
        stop: null
      x-request-examples-1:
        stop: null
      tags:
        - backup
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      operationId: switchBackupJobUsingPost
      consumes:
        - application/json
      summary: 开关备份任务
      description: 开关备份任务
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          required: true
          type: string
          description: 备份任务id（资源id）
        - in: body
          name: action
          description: 备份任务；stop：停止备份任务；start：启动备份任务
          required: true
          schema:
            type: object
            enum:
              - stop
              - start
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '202':
          description: 停止成功
        '400':
          description: Bad Request
          schema:
            type: string
        '404':
          description: Not Found
          schema:
            type: string
        '500':
          description: Internal Server error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
  /v2/backup_copies/{id}:
    delete:
      x-dr-role: 'N'
      tags:
        - copy
      x-request-examples-url-1: /v2/backup_copies/33ebc900-d277-4a54-8db9-fff33208a480
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      operationId: deleteCopyUsingDelete
      consumes:
        - application/json
      summary: 删除副本
      description: 删除副本
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          required: true
          type: string
          description: 副本id
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '200':
          description: 删除成功
        '404':
          description: 查询不到备份副本
          schema:
            type: string
        '500':
          description: Internal Server Error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
    get:
      x-dr-role: 'N'
      x-request-examples-url-1: /v2/backup_copies/33ebc900-d277-4a54-8db9-fff33208a480
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      tags:
        - copy
      operationId: queryCopyUsingGet
      consumes:
        - application/json
      summary: 查询单个副本详情
      description: 查询单个副本详情
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          required: true
          type: string
          description: 副本id
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/OpenStackCopyResp'
          examples:
            application/json: "{\n    \"backup_copies\": { \n\t   \"id\": \"6883573e-ba4e-4fd5-8df5-f59b6c365b5b\",\n        \"backup_job_id\": \"33ebc900-d277-4a54-8db9-fff33208a480\",\n\t   \"generate_time\": \"2022-08-10T10:00:00Z\",\n\t   \"generate_time\": 1,\n\t   \"size\":10,\n        \"is_latest\": True\n    }\n}\n"
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
  /v2/backup_copies:
    get:
      x-dr-role: 'N'
      x-request-examples-url-1: /v2/backup_copies
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      tags:
        - copy
      operationId: queryCopiesUsingGet
      consumes:
        - application/json
      summary: 查询所有副本详情
      description: 查询所有副本详情
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '200':
          description: Success
          schema:
            items:
              $ref: '#/definitions/OpenStackCopyResp'
            type: array
          examples:
            application/json: "[{\n    \"backup_copies\": { \n\t   \"id\": \"6883573e-ba4e-4fd5-8df5-f59b6c365b5b\",\n        \"backup_job_id\": \"33ebc900-d277-4a54-8db9-fff33208a480\",\n\t   \"generate_time\": \"2022-08-10T10:00:00Z\",\n\t   \"generate_time\": 1,\n\t   \"size\":10,\n        \"is_latest\": True\n    }\n}]\n"
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
  /v2/backup_restore:
    post:
      x-dr-role: 'N'
      x-request-examples-url-1: /v2/backup_restore
      x-request-examples-text-1:
        restore_job:
          name: backup1
          description: Bckup VM1 weekly
          type: server
          instance_id: VM1 uuid
          copy_id: 6883573e-ba4e-4fd5-8df5-f59b6c365b5b
      x-request-examples-1:
        restore_job:
          name: backup1
          description: Bckup VM1 weekly
          type: server
          instance_id: VM1 uuid
          copy_id: 6883573e-ba4e-4fd5-8df5-f59b6c365b5b
      tags:
        - restore
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      operationId: createRestoreJobUsingPost
      consumes:
        - application/json
      summary: 创建恢复任务
      description: 创建恢复任务
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - in: body
          name: restoreJob
          description: 恢复任务
          required: true
          schema:
            $ref: '#/definitions/OpenStackRestoreReq'
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '202':
          description: Created
          schema:
            $ref: '#/definitions/OpenStackRestoreResp'
          examples:
            application/json: "{\n\"restore_job\": { \n    \"id\": \"2f5d01a1-1cef-4067-9280-f6dcf086b43c\"\n        \"name\": \"backup1\",\n\t   \"description\": \"Bckup VM1 weekly\",\n\t   \"type\": \"server\",\n\t   \"instance_id\": \"VM1 uuid\",\n        \"copy_id\": \"6883573e-ba4e-4fd5-8df5-f59b6c365b5b\"\n    }\n}\n"
        '400':
          description: Bad Request
          schema:
            type: string
        '404':
          description: Not Found
          schema:
            type: string
        '500':
          description: Internal Server error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
    get:
      x-dr-role: 'N'
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      tags:
        - restore
      operationId: queryRestoreJobsUsingGet
      consumes:
        - application/json
      summary: 查询所有恢复任务
      description: 查询所有恢复任务
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '200':
          description: Success
          schema:
            items:
              $ref: '#/definitions/OpenStackRestoreResp'
            type: array
          examples:
            application/json:
              restore_jobs:
                - id: 33ebc900-d277-4a54-8db9-fff33208a480
                  name: restore1
                  description: restore VM1
                  type: server
                  instance_id: VM1 uuid
                  copy_id: 6883573e-ba4e-4fd5-8df5-f59b6c365b5b
                  status: completed
                  result: success
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
  /v2/backup_restore/{id}:
    get:
      x-dr-role: 'N'
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      tags:
        - restore
      operationId: queryRestoreJobUsingGet
      consumes:
        - application/json
      summary: 查询单个恢复任务
      description: 查询单个恢复任务
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - name: id
          in: path
          required: true
          type: string
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '200':
          description: Success
          schema:
            $ref: '#/definitions/OpenStackRestoreResp'
          examples:
            application/json:
              restore_job:
                id: 33ebc900-d277-4a54-8db9-fff33208a480
                name: restore1
                description: restore VM1
                type: server
                instance_id: VM1 uuid
                copy_id: 6883573e-ba4e-4fd5-8df5-f59b6c365b5b
                status: completed
                result: success
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
  /v2/backup_quota:
    post:
      x-dr-role: 'N'
      x-request-examples-url-1: /v2/backup_quota
      x-request-examples-text-1:
        backup_quota:
          size: 100
      x-request-examples-1:
        backup_quota:
          size: 100
      tags:
        - quota
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      operationId: createQuotaUsingPost
      consumes:
        - application/json
      summary: 创建备份配额
      description: 创建备份配额
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - in: body
          name: quota
          description: 备份配额
          required: true
          schema:
            $ref: '#/definitions/OpenStackQuotaReq'
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '201':
          description: Created
        '400':
          description: Bad Request
          schema:
            type: string
        '403':
          description: 创建备份配额小于已占用配额
          schema:
            type: string
        '404':
          description: Not Found
          schema:
            type: string
        '500':
          description: Internal Server error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
      x-order: 0
    get:
      x-dr-role: 'N'
      x-request-examples-url-1: /v2/backup_quota
      x-product: OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-public-api: 'Y'
      x-sysadmin-role: 'N'
      tags:
        - quota
      operationId: queryQuotaUsingGet
      consumes:
        - application/json
      summary: 查询备份配额
      description: 查询备份配额
      x-is-registered: 'N'
      x-support-sdk: 'N'
      produces:
        - application/json
      parameters:
        - name: X-Auth-Token
          in: header
          required: true
          description: Identity API发放的令牌
          type: string
      responses:
        '200':
          description: Success
          schema:
            items:
              $ref: '#/definitions/OpenStackQuotaResp'
            type: array
          examples:
            application/json: "{\n    \" backup_quota \": { \n\t   \"all\": 100,\n        \"used\": 10,\n    }\n}\n"
        '404':
          description: Not Found
        '500':
          description: Internal Server Error
          schema:
            type: string
        '502':
          description: Bad Gateway
          schema:
            type: string
      x-order: 1
definitions:
  OpenStackBackupJobResp:
    description: 云核OpenStack备份任务Dto
    required:
      - description
      - type
      - instance_id
    properties:
      id:
        type: string
        description: 任务id
        minLength: 32
        maxLength: 36
        readOnly: true
        example: ''
      name:
        type: string
        description: 任务名称
        minLength: 2
        maxLength: 64
        example: backup1
      description:
        type: string
        description: 任务描述
        minLength: 2
        maxLength: 512
        example: Bckup VM1 weekly
      type:
        type: string
        description: 备份对象实例
        enum:
          - server
          - volume
      instance_id:
        type: string
        description: 备份对象实例id，虚拟机id或卷id
      auto_retry_times:
        type: integer
        format: int32
        description: 失败重试次数
        minimum: 1
        maximum: 5
      auto_retry_wait_minutes:
        type: integer
        format: int32
        description: 失败重试等待时间，单位：分钟
        minimum: 1
        maximum: 30
      jobs_schedule:
        description: 备份任务调度策略
        $ref: '#/definitions/JobScheduleDto'
      last_result:
        type: string
        description: 最近一次任务执行结果
      status:
        type: string
        description: 任务状态
    type: object
  ErrorRsp:
    description: 失败时返回的错误对象
    required:
      - error_code
      - error_msg
    properties:
      error_code:
        description: 错误码
        type: string
        minLength: 8
        maxLength: 36
      error_msg:
        description: 错误描述
        type: string
        minLength: 2
        maxLength: 512
  JobScheduleDto:
    type: object
    description: 备份任务调度策略
    required:
      - type
      - policy
      - retention
    properties:
      type:
        type: string
        description: 调度类型；days：每隔N天在指定时间执行；weeks：每周指定某天在指定时间执行
        enum:
          - days
          - weeks
      policy:
        description: 调度策略内容
        $ref: '#/definitions/SchedulePolicyDto'
      retention:
        description: 备份副本保留策略
        $ref: '#/definitions/ScheduleRetentionDto'
  SchedulePolicyDto:
    type: object
    description: 调度策略内容
    required:
      - execute_time
    properties:
      start_date:
        type: string
        description: 开始时间，若为空则从创建任务时开始（当前时间）
      stop_date:
        type: string
        description: 结束时间，若为空则一直调度
      interval_days:
        type: integer
        format: int32
        description: 调度间隔周期
        minimum: 1
        maximum: 30
      days_of_week:
        type: array
        description: 每周几执行，1-7代表周一到周日
        minItems: 1
        maxItems: 7
        items:
          example: ''
          minimum: 1
          maximum: 7
          type: integer
          format: int32
        example:
          - 1
          - 7
      execute_time:
        type: integer
        format: int32
        description: 在一天内某时执行，取值范围0-23
        minimum: 0
        maximum: 23
  ScheduleRetentionDto:
    type: object
    description: 备份副本保留策略
    required:
      - type
      - count
    properties:
      type:
        type: string
        description: 保留策略类型；number：按数量保留；time：按时间保留
        enum:
          - number
          - time
      count:
        type: integer
        format: int32
        description: 保留最近count次备份的副本或保留最近count天产生的备份副本,0为永久保留
        minimum: 0
        maximum: 300
  OpenStackBackupJobReq:
    description: 云核OpenStack备份任务Dto
    required:
      - description
      - type
      - instance_id
    properties:
      id:
        type: string
        description: 任务id
        minLength: 32
        maxLength: 36
        readOnly: true
        example: ''
      name:
        type: string
        description: 任务名称
        minLength: 2
        maxLength: 64
        example: backup1
      description:
        type: string
        description: 任务描述
        minLength: 2
        maxLength: 512
        example: Bckup VM1 weekly
      type:
        type: string
        description: 备份对象实例
        enum:
          - server
          - volume
      instance_id:
        type: string
        description: 备份对象实例id，虚拟机id或卷id
      auto_retry_times:
        type: integer
        format: int32
        description: 失败重试次数
        minimum: 1
        maximum: 5
      auto_retry_wait_minutes:
        type: integer
        format: int32
        description: 失败重试等待时间，单位：分钟
        minimum: 1
        maximum: 30
      jobs_schedule:
        description: 备份任务调度策略
        $ref: '#/definitions/JobScheduleDto'
    type: object
  OpenStackBackupJobModify:
    description: 云核OpenStack备份任务Dto
    required:
      - description
      - type
    properties:
      description:
        type: string
        description: 任务描述
        minLength: 2
        maxLength: 512
        example: Bckup VM1 weekly
      type:
        type: string
        description: 备份对象实例
        enum:
          - server
          - volume
      jobs_schedule:
        description: 备份任务调度策略
        $ref: '#/definitions/JobScheduleDto'
    type: object
  OpenStackCopyResp:
    type: object
    description: OpenStack副本响应体
    required:
      - id
      - backup_job_id
      - generate_time
      - generate_id
      - size
      - is_latest
    properties:
      id:
        type: string
        description: 备份副本id
      backup_job_id:
        type: string
        description: 所属备份任务id（资源id）
      generate_time:
        type: string
        description: 副本生成时间
      generate_id:
        type: integer
        format: int32
        description: 副本生成序列号（在所属备份任务中第几个生成的，从1开始）
      size:
        type: integer
        format: int32
        description: 副本占用空间大小（单位GB）
      is_latest:
        type: boolean
        description: 是否为管理备份任务所生成的最新副本
  OpenStackRestoreReq:
    type: object
    description: 创建恢复任务请求体
    required:
      - name
      - description
      - type
      - instance_id
      - copy_id
    properties:
      name:
        type: string
        description: 恢复任务名称
      description:
        type: string
        description: 恢复任务描述
      type:
        type: string
        description: |-
          备份恢复对象实例：
          “server”：虚拟机备份
          “volume”：卷备份
        enum:
          - server
          - volume
      instance_id:
        type: string
        description: 恢复对象实例id，虚拟机id或卷id
      copy_id:
        type: string
        description: 待恢复的备份副本id
  OpenStackRestoreResp:
    type: object
    description: 创建恢复任务响应体
    required:
      - id
      - name
      - description
      - type
      - instance_id
      - copy_id
    properties:
      id:
        type: string
        description: 恢复任务id
      name:
        type: string
        description: 恢复任务名称
      description:
        type: string
        description: 恢复任务描述
      type:
        type: string
        description: |-
          备份恢复对象实例：
          “server”：虚拟机备份
          “volume”：卷备份
        enum:
          - server
          - volume
      instance_id:
        type: string
        description: 恢复对象实例id，虚拟机id或卷id
      copy_id:
        type: string
        description: 待恢复的备份副本id
  OpenStackQuotaReq:
    type: object
    description: 创建配额请求体
    required:
      - size
    properties:
      size:
        type: integer
        format: int32
        description: 备份配额空间大小，单位为GB
  OpenStackQuotaResp:
    type: object
    description: 查询配额响应体
    properties:
      all:
        type: integer
        format: int32
        description: 备份配额总空间，单位为GB，-1表示无限制
      used:
        type: integer
        format: int32
        description: 备份配额已使用空间，单位为GB
    required:
      - all
      - used
  BatchCreateBackupJobDto:
    type: object
    description: OpenStack批量创建备份任务请求体
    required:
      - backup_jobs
    properties:
      backup_jobs:
        type: array
        items:
          $ref: '#/definitions/OpenStackBackupJobReq'
