swagger: '2.0'
info:
  version: v1
  title: ApplicationTitle
  description: GroupDesc
schemes:
  - https
host: localhost.com
basePath: /
tags:
  - name: task-agent
  - name: task-pm
  - name: sharedResource-agent
  - name: task-dee
  - name: copy-agent
  - name: copy-pm
  - name: copy_archive
paths:
  /v1/dme-unified/tasks/sub-tasks:
    post:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-agent
      description: 用于DME提供给Agent，发布子任务
      operationId: PublishTask
      parameters:
        - name: sub_task_info
          in: body
          required: true
          description: sub task information
          schema:
            items:
              $ref: '#/definitions/SubTask'
            type: array
      responses:
        '200':
          description: 发布成功，无返回值
        '500':
          description: 内部服务器错误，比如数据库访问不通等情况
          schema:
            $ref: '#/definitions/RspMsg'
  '/v1/dme-unified/tasks/{task_id}':
    get:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-agent
      description: 用于DME提供给Agent，请求分配任务
      operationId: AcquireTask
      parameters:
        - name: task_id
          in: path
          required: true
          type: string
          description: main task id
        - name: node_id
          in: query
          required: true
          description: agent node id
          type: string
        - name: task_status
          in: query
          required: true
          description: 0-INITIALIZING，1-RUNNING
          type: integer
          format: int32
      responses:
        '200':
          description: 返回任务列表
          schema:
            items:
              $ref: '#/definitions/ProtectTask'
            type: array
        '400':
          description: 该任务已结束，无可调度的子任务 or 该任务暂时没有可以调度的子任务，通过错误码区分
          schema:
            $ref: '#/definitions/RspMsg'
        '500':
          description: 内部访问数据库不通
          schema:
            $ref: '#/definitions/RspMsg'
  '/v1/dme-unified/tasks/{task_id}/lock':
    get:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-agent
      description: 用于DME提供给Agent，请求锁定任务
      operationId: SubscribeTask
      parameters:
        - name: task_id
          in: path
          required: true
          type: string
          description: 要锁定的任务id
        - name: node_id
          in: query
          required: true
          description: node_id
          type: string
        - name: agent_ip_list
          in: query
          required: false
          description: agent ip list can connnect to responsitory
          type: array
          items:
            type: string
      responses:
        '200':
          description: 锁定任务成功
        '400':
          description: 锁定失败，该任务已被锁定
          schema:
            $ref: '#/definitions/RspMsg'
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  '/v1/dme-unified/tasks/{task_id}/statistic':
    get:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-agent
      description: >-
        用于DME提供给Agent，获取主任务状态和当前任务的统计，包括总的任务数、成功的任务数和失败的任务数，如果不传filter，则返回所有状态的任务数

        返回示例：{

        mainTask: 0,  状态枚举值

        subTask: {'total': 3, 'success': 1, 'failed': 0, 'aborted': 2}  任务数

        }
      operationId: StatisticTask
      parameters:
        - name: task_id
          in: path
          required: true
          type: string
        - name: sub_task_id
          in: query
          required: false
          description: sub task id
          type: string
        - name: filter
          in: query
          required: false
          description: '‘total'', ''success'', ''failed'', ''aborted'''
          type: string
      responses:
        '200':
          description: 字典
          schema:
            $ref: '#/definitions/StatisticTaskResponse'
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  '/v1/dme-unified/copies/{copy_id}':
    delete:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - copy-pm
      description: |-
        用于DME提供给PM，下发删除副本的任务
        如果是本地快照，就让默认agent去执行
      operationId: DeleteCopy
      parameters:
        - name: copy_id
          in: path
          required: true
          type: string
        - name: task_info
          in: body
          required: true
          description: 对于本地保护的快照，需要下发保护环境、存储仓信息
          schema:
            $ref: '#/definitions/DeleteCopyTask'
      responses:
        '200':
          description: 异步接口，成功无返回值
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
    get:
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      x-auth-type: 双向证书认证
      tags:
        - copy-pm
      description: 获取副本详情
      operationId: GetCopyInfo
      parameters:
        - name: copy_id
          in: path
          required: true
          type: string
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/GetCopyInfoResponse'
        '500':
          description: 内部错误
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/shared-resources:
    post:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - sharedResource-agent
      description: 用于DME提供给Agent，创建共享资源
      operationId: AddResource
      parameters:
        - name: resource
          in: body
          required: true
          description: resource
          schema:
            $ref: '#/definitions/Resource'
      responses:
        '200':
          description: 成功无返回值
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/shared-resources/update:
    put:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - sharedResource-agent
      description: 用于DME提供给Agent，更新共享资源
      operationId: UpdateResource
      parameters:
        - name: resource
          in: body
          required: true
          description: resource
          schema:
            $ref: '#/definitions/Resource'
      responses:
        '200':
          description: 成功无返回值
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  '/v1/dme-unified/tasks/{task_id}/details':
    get:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-agent
      description: 用于DME提供给Agent，查询任务的详细信息，以便用于任务续作
      operationId: QueryTaskDetails
      parameters:
        - name: task_id
          in: path
          required: true
          type: string
        - name: sub_task_id
          in: query
          required: false
          description: sub task id
          type: string
      responses:
        '200':
          description: 返回参数详见TaskDetails模型
          schema:
            $ref: '#/definitions/TaskDetails'
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/tasks/backup:
    post:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-pm
      description: |-
        用于DME提供给PM，创建备份任务
        url最好不要体现dme
      operationId: CreateBackupTask
      parameters:
        - name: task_info
          in: body
          required: true
          description: backup task information
          schema:
            $ref: '#/definitions/BackupTask'
      responses:
        '200':
          description: 成功无返回值
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/tasks/restore:
    post:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-pm
      description: 用于DME提供给PM，创建恢复任务
      operationId: CreateRestoreTask
      parameters:
        - name: task_info
          in: body
          required: true
          description: restore task information
          schema:
            $ref: '#/definitions/RestoreTask'
      responses:
        '200':
          description: 成功无返回值
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/tasks/build-index:
    post:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-dee
      description: 用于DME提供给DEE，创建建立索引任务
      operationId: CreateBuildIndexTask
      parameters:
        - name: task_info
          in: body
          required: true
          description: build index task information
          schema:
            $ref: '#/definitions/BuildIndexTask'
      responses:
        '200':
          description: 成功无返回值
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/shared-resources/lock:
    put:
      x-impact-subsystem: 影响
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - sharedResource-agent
      description: 用于DME提供给Agent，请求锁定共享资源
      operationId: AcquireResource
      parameters:
        - name: resource
          in: body
          required: true
          description: resource
          schema:
            $ref: '#/definitions/Resource'
      responses:
        '200':
          description: 锁定成功无返回值
        '400':
          description: 锁定失败，该资源剩余锁定节点数已用完
          schema:
            $ref: '#/definitions/RspMsg'
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/shared-resources/release:
    put:
      x-impact-subsystem: 影响
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - sharedResource-agent
      description: 用于DME提供给Agent，请求释放共享资源
      operationId: ReleaseResource
      parameters:
        - name: resource
          in: body
          required: true
          description: resource
          schema:
            $ref: '#/definitions/Resource'
      responses:
        '200':
          description: 释放资源成功，无返回值
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  '/v1/dme-unified/tasks/{task_id}/abort':
    put:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-pm
      description: 用于DME提供给PM，中止任务
      operationId: AbortTask
      parameters:
        - name: task_id
          in: path
          required: true
          type: string
        - name: request_id
          in: query
          required: true
          description: 请求id
          type: string
      responses:
        '200':
          description: 异步消息，成功接收请求无返回值
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  '/v1/dme-unified/shared-resources/{resourceKey}':
    delete:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - sharedResource-agent
      description: 用于DME提供给PM，删除共享资源
      operationId: DeleteResource
      parameters:
        - name: resourceKey
          in: path
          required: true
          type: string
        - name: scope
          in: query
          required: true
          description: resource scope
          type: integer
          format: int32
        - name: scopeKey
          in: query
          required: true
          description: resource scope key for identifing different scope
          type: string
      responses:
        '200':
          description: 删除成功，无返回值
        '500':
          description: 内部错误，比如无法访问数据库等
          schema:
            $ref: '#/definitions/RspMsg'
    get:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - sharedResource-agent
      description: 用于DME提供给Agent，查询共享资源
      operationId: QueryResource
      parameters:
        - name: resourceKey
          in: path
          required: true
          type: string
        - name: scope
          in: query
          required: true
          description: resource scope
          type: integer
          format: int32
        - name: scopeKey
          in: query
          required: true
          description: resource scope key for identifing different scope
          type: string
      responses:
        '200':
          description: 返回参数详见ResourceStatus模型
          schema:
            $ref: '#/definitions/ResourceStatus'
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/tasks/livemount/cancel:
    post:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-pm
      description: 用于dme提供给pm，创建取消即时挂载任务
      operationId: CancelLiveMount
      parameters:
        - name: task_info
          in: body
          required: true
          description: 挂载模型
          schema:
            $ref: '#/definitions/CancelLiveMountTask'
      responses:
        '200':
          description: 成功无返回值
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  '/v1/dme-unified/tasks/{task_id}/backupdata/rollback':
    post:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-agent
      description: |-
        任务失败之后，DME是否将上一次的副本快照进行回滚，主要目的是为了实现断点续传
        2021/12/8 该接口废弃
      operationId: RollbackDataAfterBackupFailed
      parameters:
        - name: task_id
          in: path
          required: true
          type: string
      responses:
        '200':
          description: 成功后无返回值
          schema:
            type: string
        '500':
          description: 内部错误，比如数据库无法访问
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/tasks/livemount:
    post:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-pm
      description: 用于dme提供给pm，创建即时挂载任务
      operationId: CreateLiveMount
      parameters:
        - name: task_info
          in: body
          required: true
          description: 挂载模型
          schema:
            $ref: '#/definitions/LiveMountTask'
      responses:
        '200':
          description: ''
          schema:
            type: string
        '500':
          description: 内部错误，比如数据库访问不通
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/tasks/backup/clone:
    put:
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      x-auth-type: 双向证书认证
      tags:
        - task-pm
      description: 使用一个备份映像克隆一个新的备份映像
      operationId: CloneBackup
      parameters:
        - name: clone_req
          in: body
          required: true
          description: 参数模型
          schema:
            $ref: '#/definitions/BackupClone'
      responses:
        '200':
          description: ''
          schema:
            type: string
        '500':
          description: 内部错误
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/tasks/backup/mountqos:
    put:
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      x-auth-type: 双向证书认证
      tags:
        - task-pm
      description: 对mount的副本做Qos设置
      operationId: MountQos
      parameters:
        - name: mount_qos_req
          in: body
          required: true
          description: 请求体
          schema:
            $ref: '#/definitions/MountQosModel'
      responses:
        '200':
          description: ''
          schema:
            type: string
  /v1/dme-unified/tasks/details:
    put:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - task-agent
      description: 用于DME提供给Agent，上报任务的详细信息，包括进度，状态等
      operationId: UpdateTaskDetails
      parameters:
        - name: task_details
          in: body
          required: true
          description: task details
          schema:
            $ref: '#/definitions/TaskDetails'
      responses:
        '200':
          description: 成功无返回值
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/protect-object:
    delete:
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      x-auth-type: 双向证书认证
      tags:
        - task-pm
      operationId: deleteProtectObject
      parameters:
        - name: protect_object
          in: body
          required: true
          description: 保护对象信息
          schema:
            $ref: '#/definitions/Application'
      responses:
        '200':
          description: ''
          schema:
            type: string
  '/v1/dme-unified/copies/{task_id}':
    put:
      x-auth-type: 双向证书认证
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - copy-agent
      description: 用于DME提供给Agent，当在远端创建副本之后，将副本信息上传给dme，任务结束后上报
      operationId: UpdateCopyInfo
      parameters:
        - name: task_id
          in: path
          required: true
          type: string
          description: 主任务id
        - name: copy_info
          in: body
          required: true
          description: copy information
          schema:
            $ref: '#/definitions/UpdateCopy'
      responses:
        '200':
          description: 成功无返回值
        '500':
          description: 内部错误，比如数据库访问不通等
          schema:
            $ref: '#/definitions/RspMsg'
  /v1/dme-unified/copies/add:
    post:
      x-access-port: 30065
      x-auth-required: 'Y'
      x-public-api: 'N'
      tags:
        - copy_archive
      description: 归档微服务导入归档副本
      operationId: AddCopy
      parameters:
        - name: copy_data
          in: body
          required: true
          schema:
            type: string
      responses:
        '200':
          description: ''
          schema:
            type: string
        '500':
          description: ''
          schema:
            type: string
definitions:
  DemoInfo:
    description: This is a demo
    required:
      - name
    properties:
      id:
        type: string
        description: 唯一标识ID
        minLength: 32
        maxLength: 36
        readOnly: true
        example: 28f61af50fc9452aa0ed5ea25c3cc3d3
      name:
        type: string
        description: 名称
        minLength: 2
        maxLength: 64
        example: MyDemo
      description:
        type: string
        description: 描述
        minLength: 2
        maxLength: 512
        example: this is a demo
  RspMsg:
    description: 响应模型
    properties:
      errorCode:
        type: string
        description: 错误码，成功是0
      errorMessage:
        type: string
        description: 错误描述信息
      detailParams:
        type: array
        items:
          type: string
        description: 放回参数
    required:
      - errorCode
  Authentication:
    description: >-
      认证信息

      0-NO_AUTH, 1-OS_PASSWORD,  2-APP_PASSWORD, 3-LADP, 4-AKSK, 5-KERBEROS,
      6-TOKEN, 7-OAUTH2, 8-OTHER

      1到3,authKey填用户名,authPwd填密码， 4 authKey填AK， authPwd填SK,
      5,6,7,8认证认证信息在扩展字段中扩充。
    properties:
      authType:
        type: integer
        format: int32
        description: >-
          0-NO_AUTH, 1-OS_PASSWORD,  2-APP_PASSWORD, 3-LADP, 4-AKSK, 5-KERBEROS,
          6-TOKEN, 7-OAUTH2, 8-OTHER
      authKey:
        type: string
        description: 用户名
      authPwd:
        type: string
        description: 密码
      extendInfo:
        type: object
        description: json对象，key_value键值对，扩展信息，kerberos的信息等
    required:
      - authType
  Application:
    description: 应用对象信息
    properties:
      type:
        type: string
        description: 应用类型，用于识别由哪个插件执行任务，比如数据库
      subType:
        type: string
        description: 应用子类型，比如mysql的实例or数据库
      uuid:
        type: string
        description: 应用保护对象的uuid
      name:
        type: string
        description: 应用名称，如果是vmware备份，这个保护对象名称就是虚拟机的名称
      parentUuid:
        type: string
        description: 应用父保护对象的uuid，如果保护对象是数据库，这个父保护对象就是数据库实例
      parentName:
        type: string
        description: 应用父保护对象的name
      auth:
        $ref: '#/definitions/Authentication'
      extendInfo:
        type: object
        description: json对象，扩展信息
    required:
      - type
      - subType
      - uuid
      - name
  AppEnvironment:
    description: 应用环境信息
    properties:
      uuid:
        type: string
        description: 环境的uuid
      name:
        type: string
        description: 环境名称
      type:
        type: string
        description: 比如大数据，类型大数据
      subType:
        type: string
        description: 比如大数据，类型是hdfs、hbase、hive等
      endpoint:
        type: string
        description: 访问地址，ip或者域名
      port:
        type: integer
        format: int32
        description: 端口port
      auth:
        $ref: '#/definitions/Authentication'
      nodes:
        type: array
        items:
          $ref: '#/definitions/AppEnvironment'
        description: 集群节点信息，正常情况为空，如果不为空，就为集群的节点信息
      extendInfo:
        type: object
        description: json对象，扩展信息
    required:
      - uuid
      - name
      - type
      - subType
  AppResource:
    description: 应用资源信息
    properties:
      type:
        type: string
        description: 应用类型，比如数据库
      subType:
        type: string
        description: 资源类型，比如数据库的表
      uuid:
        type: string
        description: 资源的uuid
      name:
        type: string
        description: 资源的名称
      parentUuid:
        type: string
        description: 父资源的uuid，比如备份数据库，这个是数据库实例的uuid
      parentName:
        type: string
        description: 父资源的名称
      extendInfo:
        type: object
        description: json对象，扩展信息
    required:
      - type
      - subType
      - name
  StorageRepository:
    description: |-
      数据存储仓库信息

      path字段 ：如果是nas，就是文件系统的共享名称加上路径名；如果是S3，就是桶名加上路径名

      多文件系统：

      构建两个结构体，抽取出remotePath

      删除副本的时候，只需要auth和endpoint信息
    properties:
      type:
        type: integer
        format: int32
        description: >-
          0-META_REPOSITORY，1-DATA_REPOSITORY，2-CACHE_REPOSITORY，
          3-LOG_REPOSITORY
      isLocal:
        type: boolean
        description: 是否为本地a8000存储
      path:
        type: string
        description: 如果不是本地，那么传相应的路径
      protocol:
        type: integer
        format: int32
        description: 0-CIFS，1-NFS，2-S3，3-BLOCK，4-LOCAL_DIR， 5-Tape
      auth:
        $ref: '#/definitions/Authentication'
      endpoint:
        $ref: '#/definitions/HostAddress'
      deduption:
        type: boolean
        description: 是否重删
      compression:
        type: boolean
        description: 是否压缩
      extendInfo:
        type: object
        description: json对象扩展信息
    required:
      - type
      - isLocal
  Qos:
    description: 限速策略，和pm保持一致
    properties:
      bandwidth:
        type: integer
        format: int32
        description: qos 速度限制，单位MB
      iops:
        type: integer
        format: int32
        description: qos 限制 iops
  ScriptConfiguration:
    description: 脚本配置信息
    properties:
      preScript:
        type: string
        description: 前置脚本
      postScript:
        type: string
        description: 成功时执行的后置脚本
      failPostScript:
        type: string
        description: 失败时执行的后置脚本
  DataLayout:
    description: 数据布局
    properties:
      srcEncryption:
        type: boolean
        description: 是否加密保存，源端
      srcDeduption:
        type: boolean
        description: 是否去重，源端
      srcCompression:
        type: boolean
        description: 是否压缩，源端
      dstEncryption:
        type: boolean
        description: 是否加密保存，目标端
      dstDeduption:
        type: boolean
        description: 是否去重，目标端
      dstCompression:
        type: boolean
        description: 是否压缩，目标端
      extendInfo:
        type: object
        description: 扩展信息，若指定了加密算法，则填写在扩展信息里
  HostAddress:
    description: 主机信息
    properties:
      ip:
        type: string
        description: ip
      port:
        type: integer
        format: int32
        description: port
      id:
        type: string
        description: host id，pm下发时要带上agent id
    required:
      - ip
  DBRestoreParam:
    description: 数据库恢复参数
    properties:
      channels:
        type: string
        description: 恢复的通道数
      instanceName:
        type: string
        description: 恢复的数据库实例名
      databaseName:
        type: string
        description: 恢复的数据库名
      dataPath:
        type: string
        description: 恢复的数据库路径
      restoreType:
        type: string
        description: 0-COPY_RESTORE，1-TIME_RESTORE，2-SCN_RESTORE
      restoreToValue:
        type: string
        description: restore to some data with in restore type
  VirtualRestoreParam:
    description: 虚拟机恢复参数
    properties:
      startupNetwork:
        type: boolean
        description: 恢复之后是否开启网络
      restoreLevel:
        type: integer
        format: int32
        description: 0-恢复虚拟机，1-恢复虚拟机的disk
      networkInfo:
        type: string
        description: 恢复虚拟机的网络信息
      diskInfo:
        type: object
        additionalProperties:
          type: string
        description: 恢复虚拟机的disk信息
      vmStorage:
        type: string
        description: 虚拟机的存储位置
  LogDetail:
    description: 日志详情
    properties:
      logInfo:
        type: string
        description: log detail label
      logInfoParam:
        type: array
        items:
          type: string
        description: log detail params
      logTimestamp:
        type: integer
        format: int32
        description: log generate time
      logDetail:
        type: integer
        format: int32
        description: errocode
      logDetailParam:
        type: array
        items:
          type: string
        description: additional params
      logDetailInfo:
        type: array
        items:
          type: string
        description: Detailed print
      logLevel:
        type: integer
        format: int32
        description: >-
          0-TASK_LOG_INFO，1-TASK_LOG_WARNING，2-TASK_LOG_ERROR，3-TASK_LOG_SERIOUS_WARN
  TaskDetails:
    description: 任务详情
    properties:
      taskId:
        type: string
        description: 主任务id
      subTaskId:
        type: string
        description: 子任务id
      taskStatus:
        type: integer
        format: int32
        description: >-
          INITIALIZING = 0, RUNNING = 1, ABORTING = 2, COMPLETED = 3, ABORTED =
          4, ABORTED_FAILED = 5, FAILED = 6, FAILED_NOTRY = 7, PARTIAL_COMPLETED
          = 13
        x-access-port: 30065
        x-auth-required: 'Y'
        x-public-api: 'N'
        x-auth-type: 双向证书认证
      logDetail:
        items:
          $ref: '#/definitions/LogDetail'
        description: 日志详情
        type: array
      taskStage:
        type: integer
        format: int32
        description: >-
          0-1为DME专属状态，保留，从2开始，
          2-AGENT_PREPARING，3-PRE_TASK_COMPLETE，4-GENERATE_TASK_COMPLETE，5-SWITCH_INCR_TO_FULL，该字段只有主任务填，子任务不填
        x-access-port: 30065
        x-auth-required: 'Y'
        x-public-api: 'N'
        x-auth-type: 双向证书认证
      progress:
        type: integer
        format: int32
        description: 任务进度
      dataSize:
        type: integer
        format: int32
        description: 任务速率，单位Mb
      extendInfo:
        type: object
        description: json对象，扩展信息
    required:
      - taskId
      - taskStatus
  CommonTask:
    description: common task model
    properties:
      requestId:
        type: string
        description: 请求id，可关联多个任务
      taskId:
        type: string
        description: 主任务id
      copyId:
        type: string
        description: 副本id
      protectObject:
        $ref: '#/definitions/Application'
      protectEnv:
        $ref: '#/definitions/AppEnvironment'
      protectSubObjects:
        type: array
        items:
          $ref: '#/definitions/AppResource'
        description: 保护子对象信息，可以是多个，默认为空
      repositories:
        type: array
        items:
          $ref: '#/definitions/StorageRepository'
        description: |-
          存储仓信息，可以是多个

          path字段 ：如果是nas，就是文件系统的共享名称加上路径名；如果是S3，就是桶名加上路径名

          多文件系统：

          构建两个结构体，抽取出remotePath
      agents:
        type: array
        items:
          $ref: '#/definitions/HostAddress'
        description: agent节点信息
      extendInfo:
        type: object
        description: json对象，扩展信息
    required:
      - requestId
      - taskId
      - copyId
      - protectObject
      - protectEnv
      - agents
  SubTask:
    description: 子任务模型
    properties:
      taskId:
        type: string
        description: 主任务id
      taskType:
        type: integer
        format: int32
        description: 0-PRE_TASK，1-GENERATE_TASK，2-POST_TASK，3-BUSINESS_TASK
      taskName:
        type: string
        description: 子任务名称
      taskPriority:
        type: integer
        format: int32
        description: 子任务的优先级，1开头，数字越大优先级越高
      executeStrategy:
        type: integer
        format: int32
        description: |-
          0 - normal：普通的子任务，直接加入数据库
          1 - localNode：在执行主任务的节点执行相应子任务
          2 - everyNode：在全部节点上执行该子任务
        x-access-port: 30065
        x-auth-required: 'Y'
        x-public-api: 'N'
        x-auth-type: 双向证书认证
      ignoreFailed:
        type: boolean
        description: 当子任务失败，是否忽视这个失败
      taskParams:
        type: object
        description: json对象，子任务的额外参数
    required:
      - taskId
      - taskType
      - taskName
      - taskPriority
      - executeStrategy
      - ignoreFailed
  CopyInfo:
    description: |-
      传给agent的结构体
      备份时只有copyId
      恢复时会将副本信息，包括生成环境、保护对象、仓库信息一起下发
    properties:
      id:
        type: string
        description: 副本id
      format:
        type: integer
        format: int32
        description: '副本格式，0-INNER_SNAPSHOT ,1-INNER_DIRECTORY,2-EXTERNAL'
      name:
        type: string
        description: 副本名称
      protectEnv:
        $ref: '#/definitions/AppEnvironment'
      protectObject:
        $ref: '#/definitions/Application'
      protectSubObject:
        type: array
        items:
          $ref: '#/definitions/AppResource'
        description: 保护子对象信息
      repositories:
        type: array
        items:
          $ref: '#/definitions/StorageRepositoryExtend'
        description: |-
          数据存储仓库信息，任务类型为恢复、即时恢复、即时挂载等恢复类任务时，使用此字段

          path字段 ：如果是nas，就是文件系统的共享名称加上路径名；如果是S3，就是桶名加上路径名

          多文件系统：

          构建两个结构体，抽取出remotePath
    required:
      - id
  BackupTask:
    description: 备份任务模型
    properties:
      requestId:
        type: string
        description: 请求id，可关联多个任务
      taskId:
        type: string
        description: 任务id
      copyId:
        type: string
        description: 副本id
      backupType:
        type: string
        description: >-
          snapshot（本地保护）, fullBackup（全量备份）, incrementBackup（增量备份）,
          diffBackup（差异备份），logBackup（日志备份），foreverIncrementBackup(永久增量备份，包括针对dorado同构场景复制能力的保护)
        x-access-port: 30065
        x-auth-required: 'Y'
        x-public-api: 'N'
        x-auth-type: 双向证书认证
        x-impact-subsystem: 不影响
      copyFormat:
        type: integer
        format: int32
        description: '0-INNER_SNAPSHOT ,1-INNER_DIRECTORY,2-EXTERNAL'
        x-access-port: 30065
        x-auth-required: 'Y'
        x-public-api: 'N'
        x-auth-type: 双向证书认证
      protectObject:
        $ref: '#/definitions/Application'
      protectEnv:
        $ref: '#/definitions/AppEnvironment'
      protectSubObjects:
        type: array
        items:
          $ref: '#/definitions/AppResource'
        description: 保护子对象信息，可以是多个
      repositories:
        type: array
        items:
          $ref: '#/definitions/StorageRepository'
        description: 存储仓信息，可以是多个
      agents:
        type: array
        items:
          $ref: '#/definitions/HostAddress'
        description: agent节点信息
      filters:
        type: array
        items:
          $ref: '#/definitions/ResourceFilter'
        description: 类型、内容、模式，和pm对齐
      qos:
        $ref: '#/definitions/Qos'
      scripts:
        $ref: '#/definitions/ScriptConfiguration'
      dataLayout:
        $ref: '#/definitions/DataLayout'
      advanceParams:
        type: object
        description: >-
          json对象，高级参数，比如appConsistentBackup boolean 是否启用应用一致性备份 multiFileSystem
          boolean 是否使用多文件系统格式
        x-access-port: 30065
        x-auth-required: 'Y'
        x-public-api: 'N'
        x-auth-type: 双向证书认证
    required:
      - requestId
      - taskId
      - copyId
      - backupType
      - copyFormat
      - protectObject
      - protectEnv
      - repositories
      - agents
      - dataLayout
  RestoreTask:
    description: |-
      恢复任务模型
      统一由pm下发repositories

      copyId 代表 全副本，恢复对象
    properties:
      requestId:
        type: string
        description: 请求id，可关联多个任务
      taskId:
        type: string
        description: 任务id
      copyId:
        type: string
        description: 副本id
      restoreType:
        type: string
        description: normalRestore，instantRestore，fineGrainedRestore
        x-access-port: 30065
        x-auth-required: 'Y'
        x-public-api: 'N'
        x-auth-type: 双向证书认证
      subObjects:
        type: array
        items:
          $ref: '#/definitions/AppResource'
        description: 恢复的子对象，可用于细粒度恢复
      targetEnv:
        $ref: '#/definitions/AppEnvironment'
      targetObject:
        $ref: '#/definitions/Application'
      repositories:
        type: array
        items:
          $ref: '#/definitions/StorageRepository'
        description: 因为鉴权信息有可能会改变，所以需要pm下发
      agents:
        type: array
        items:
          $ref: '#/definitions/HostAddress'
        description: agent节点信息
      filters:
        type: array
        items:
          $ref: '#/definitions/ResourceFilter'
        description: 过滤参数，与pm保持一致
      advanceParams:
        type: object
        description: json对象，高级参数，比如数据库时间点、scn等
    required:
      - requestId
      - taskId
      - copyId
      - restoreType
      - targetEnv
      - agents
  BuildIndexTask:
    description: |-
      建立索引任务的模型，只需要copyId
      目前nas、大数据场景下是agent去做
      agents为当前应用关联的agent

      不需要环境、保护对象、repository

      和DEE对接口
      手动建索引待讨论
    properties:
      requestId:
        type: string
        description: 请求id
      taskId:
        type: string
        description: 任务id
      copyId:
        type: string
        description: 当前副本id
      preCopyId:
        type: string
        description: 前一个副本的id
      repositories:
        type: array
        items:
          $ref: '#/definitions/StorageRepositoryExtend'
        description: 存储仓信息
      agents:
        type: array
        items:
          $ref: '#/definitions/HostAddress'
        description: agent节点信息
      extendInfo:
        type: object
        description: json对象，扩展信息
    required:
      - requestId
      - taskId
      - copyId
      - preCopyId
      - repositories
      - agents
  ProtectTask:
    description: >-
      分配任务的任务模型 -- 主任务

      requestId、taskId、copyId、taskType必填

      备份时使用：

      appInfo、resourceInfo、filters、envInfo、repositories、qos、scripts、taskParams（备份高级参数）、extendInfo

      恢复时使用：

      appInfo、resourceInfo、filters、envInfo、extendInfo

      删除副本时使用：

      copyInfo: 删除本地保护的副本时使用

      建立索引时使用：

      taskParams（包括preCopyId，indexPath）


      分配任务的任务模型 -- 子任务

      除了主任务信息，还要填写

      subTaskId、taskName、subTaskType、subTaskParams
    properties:
      requestId:
        type: string
        description: 请求id
      taskId:
        type: string
        description: 主任务id
      taskType:
        type: integer
        format: int32
        description: |-
          主任务类型
          BACKUP_TASK = 0
          RESTORE_TASK = 1
          LIVEMOUNT_TASK = 2
          CANCEL_LIVEMOUNT_TASK = 3
          BUILD_INDEX_TASK = 4
          DELETE_COPY_TASK = 5
        x-access-port: 30065
        x-auth-required: 'Y'
        x-public-api: 'N'
        x-auth-type: 双向证书认证
      agents:
        type: array
        items:
          $ref: '#/definitions/HostAddress'
        description: 任务所使用的agent列表，只有主任务下发
      copyInfo:
        $ref: '#/definitions/CopyInfo'
      appInfo:
        $ref: '#/definitions/Application'
      resourceInfo:
        type: array
        items:
          $ref: '#/definitions/AppResource'
        description: 子对象信息
      envInfo:
        $ref: '#/definitions/AppEnvironment'
      repositories:
        type: array
        items:
          $ref: '#/definitions/StorageRepositoryExtend'
        description: 存储仓信息，任务类型是备份时，使用此字段
      taskParams:
        type: object
        description: >-
          json对象，主任务参数，不同任务不同模型，backup对应BackupParams，restore对应restoreParams，LiveMountParams以此类推
      subTaskId:
        type: string
        description: 子任务id，由dme生成
      taskName:
        type: string
        description: 子任务名称，用于子任务的唯一标识
      subTaskType:
        type: integer
        format: int32
        description: 0-PRE_TASK，1-GENERATE_TASK，2-POST_TASK，3-BUSINESS_TASK
        x-access-port: 30065
        x-auth-required: 'Y'
        x-public-api: 'N'
        x-auth-type: 双向证书认证
      subTaskParams:
        type: object
        description: json对象，子任务额外参数
      extendInfo:
        type: object
        description: json对象，主任务的扩展参数
    required:
      - requestId
      - taskId
  Resource:
    description: 共享资源的模型
    properties:
      scope:
        type: integer
        format: int32
        description: 范围，0-ENTIRE_SYSTEM，1-SINGLE_NODE，2-SINGLE_JOB
      scopeKey:
        type: string
        description: 范围的键值，用于识别不用的范围
      resourceKey:
        type: string
        description: 资源的键值
      resourceValue:
        type: string
        description: 资源的值
      sharedNum:
        type: integer
        format: int32
        description: 如果资源共享，多少个节点可以使用
    required:
      - scope
      - scopeKey
      - resourceKey
      - resourceValue
  ResourceStatus:
    description: 资源状态模型
    properties:
      resource:
        $ref: '#/definitions/Resource'
      lockNum:
        type: integer
        format: int32
        description: 如果资源被锁定，该资源已被多少个节点共享
    required:
      - resource
  ErrorDetails:
    description: 错误描述
    required:
      - code
    properties:
      code:
        type: integer
        format: int32
        description: 错误码
      description:
        type: string
        description: 错误信息描述
  Path:
    description: 存储数据的路径
    properties:
      type:
        type: integer
        format: int32
        description: '0-data, 1-meta'
      path:
        type: string
        description: 具体的存储路径
    required:
      - type
      - path
  StorageRepositoryExtend:
    description: |-
      数据存储仓库信息

      path字段 ：如果是nas，就是文件系统的共享名称加上路径名；如果是S3，就是桶名加上路径名

      多文件系统：

      构建两个结构体，抽取出remotePath
    allOf:
      - $ref: '#/definitions/StorageRepository'
      - required:
          - remotePath
        type: object
        properties:
          remotePath:
            type: array
            items:
              $ref: '#/definitions/Path'
            description: 存储仓路径，因为可能有多个，所以是列表形式
          remoteHost:
            type: array
            items:
              $ref: '#/definitions/HostAddress'
            description: 比如逻辑端口地址
          transProtocol:
            type: string
            description: 传输协议http/https
          proxy:
            description: 代理信息
            $ref: '#/definitions/ProxyInfo'
  UpdateCopy:
    description: |-
      副本信息

      copyRepositoy: 有两部分组成，备份存储信息（PM下发）和这次副本对应的路径（DME保存，下发时组装）
    properties:
      id:
        type: string
        description: 副本id
      name:
        type: string
        description: 副本名称
      repositories:
        type: array
        items:
          $ref: '#/definitions/StorageRepositoryExtend'
        description: |-
          数据存储仓库信息，日志仓库的目录信息放在remotePath

          path字段 ：如果是nas，就是文件系统的共享名称加上路径名；如果是S3，就是桶名加上路径名

          多文件系统：

          构建两个结构体，抽取出remotePath

          删除副本的时候，只需要auth和endpoint信息
        x-access-port: 30065
        x-auth-required: 'Y'
        x-public-api: 'N'
        x-auth-type: 双向证书认证
      extendInfo:
        type: object
        description: 扩展信息，可以存放日志时间区间和SCN区间等
  ResourceFilter:
    properties:
      filterBy:
        description: >-
          根据什么进行过滤，取值：Name-名称；ID-标识；Format-文件的格式；ModifyTime-修改时间；CreateTime-创建时间；AccessTime-访问时间
        type: string
      type:
        description: 过滤的资源类型，取值：VM-虚拟机；Disk-磁盘；File-文件；Dir-目录
        type: string
      rule:
        description: 过滤规则：如模糊匹配、全匹配、正则表达式等。Fuzzy-模糊匹配；Exact-精确匹配；Regex-正则表达式
        type: string
      mode:
        description: 过滤类型：INCLUDE-包含；EXCLUDE-排除
        type: string
      values:
        type: array
        items:
          type: string
        description: 过滤的具体内容
    required:
      - filterBy
      - type
      - rule
      - mode
      - values
  BackupParams:
    description: 分配任务时使用的备份任务参数
    properties:
      backupType:
        type: string
        description: >-
          snapshot（本地保护）, fullBackup, incrementBackup,
          diffBackup，cumulativeBackup，logBackup，repBackup(针对dorado同构场景复制能力的保护)
      copyFormat:
        type: integer
        format: int32
        description: >-
          agent不需要，副本格式，0-INNER_SNAPSHOT
          ,1-INNER_DIRECTORY,2-EXTERNAL,3-ARCHIVE_S3_COPY,4-ARCHIVE_TAPE_COPY
      filters:
        type: array
        items:
          $ref: '#/definitions/ResourceFilter'
        description: 保护对象过滤器
      qos:
        $ref: '#/definitions/Qos'
      scripts:
        $ref: '#/definitions/ScriptConfiguration'
      advanceParams:
        $ref: '#/definitions/DataLayout'
    required:
      - backupType
  RestoreParams:
    description: 分配任务时，使用的恢复任务参数
    properties:
      restoreType:
        type: string
        description: '''normalRestore'', ''instantRestore'', ''fineGrainedRestore'''
      filters:
        type: array
        items:
          $ref: '#/definitions/ResourceFilter'
        description: 恢复对象的过滤器
      dataLayout:
        $ref: '#/definitions/DataLayout'
    required:
      - restoreType
  buildIndexParams:
    description: 分配任务时，建立索引任务的参数（本地保护快照类型的备份任务才传给agent去做）
    properties:
      preCopyId:
        type: string
        description: 前一个副本的id
      repositories:
        type: array
        items:
          $ref: '#/definitions/StorageRepositoryExtend'
        description: 存储仓信息
    required:
      - preCopyId
      - repositories
  DeleteCopyTask:
    properties:
      taskId:
        type: string
        description: 任务id
      requestId:
        type: string
        description: 请求id
      copyId:
        type: string
      protectEnv:
        $ref: '#/definitions/AppEnvironment'
      repositories:
        type: array
        items:
          $ref: '#/definitions/StorageRepository'
    required:
      - taskId
      - requestId
      - copyId
  LiveMountTask:
    description: 挂载模型
    properties:
      requestId:
        type: string
        description: 请求id，可关联多个任务
      taskId:
        type: string
        description: 任务id
      copyId:
        type: string
        description: 副本id
      subObjects:
        type: array
        items:
          $ref: '#/definitions/AppResource'
        description: 恢复的子对象
      targetEnv:
        $ref: '#/definitions/AppEnvironment'
      targetObject:
        $ref: '#/definitions/Application'
      repositories:
        type: array
        items:
          $ref: '#/definitions/StorageRepository'
        description: 因为鉴权信息有可能会改变，所以需要pm下发
      agents:
        type: array
        items:
          $ref: '#/definitions/HostAddress'
        description: agent节点信息
      mountQos:
        $ref: '#/definitions/MountQos'
      advanceParams:
        type: object
        description: json对象，高级参数
    required:
      - requestId
      - taskId
      - copyId
      - targetEnv
      - agents
  MountQos:
    description: 限速策略
    properties:
      bandwidthMin:
        type: integer
        format: int32
        description: 最小带宽，单位MB/s
      bandwidthMax:
        type: integer
        format: int32
        description: 最大带宽，单位MB/s
      bandwidthBurst:
        type: integer
        format: int32
        description: 峰值带宽，单位MB/s
      IOPSMin:
        type: integer
        format: int32
        description: 最小IOPS，单位8K
      IOPSMax:
        type: string
        description: 最大IOPS，单位8K
      IOPSBurst:
        type: string
        description: 峰值IOPS，单位8K
      Latency:
        type: string
        description: 延时，500或者1500
    required:
      - bandwidthMin
      - bandwidthMax
      - bandwidthBurst
      - IOPSMin
      - IOPSMax
      - IOPSBurst
      - Latency
  CancelLiveMountTask:
    description: 卸载模型
    properties:
      requestId:
        type: string
        description: 请求id，可关联多个任务
      taskId:
        type: string
        description: 任务id
      copyId:
        type: string
        description: 副本id
      targetEnv:
        $ref: '#/definitions/AppEnvironment'
      targetObject:
        $ref: '#/definitions/Application'
      repositories:
        type: array
        items:
          $ref: '#/definitions/StorageRepositoryExtend'
        description: 鉴权信息可能改变，需要pm下发
      agents:
        type: array
        items:
          $ref: '#/definitions/HostAddress'
        description: agent节点信息
    required:
      - requestId
      - taskId
      - copyId
      - targetEnv
      - repositories
      - agents
  BackupClone:
    required:
      - copyId
      - type
    properties:
      copyId:
        type: string
        description: 副本Id
      type:
        type: integer
        format: int32
        description: 新克隆副本类型， 1：可写副本 2：只读副本
      appType:
        type: string
        description: 应用类型：“vim.VirtualMachine” 和 “Oracle”
  MountQosModel:
    properties:
      copyId:
        type: string
        description: 副本id
      mountQos:
        $ref: '#/definitions/MountQos'
    description: MountQos请求体
    required:
      - copyId
      - mountQos
  GetCopyInfoResponse:
    description: 获取副本详情的返回体
    properties:
      id:
        type: string
        description: 副本id
      snapshots:
        type: array
        items:
          $ref: '#/definitions/Snapshot'
        description: 快照信息，有可能多个
      timestamp:
        type: integer
        format: int64
        description: 副本创建时间
      status:
        type: integer
        format: int32
        description: 副本状态， 0：正常 1：删除中 2：归档中 3：复制中 4：无效 存入md
      type:
        type: string
        description: >-
          副本类型：nativeSnapshot：本地快照 | full：全量 | increment：增量 | diff：差异增量 |
          foreverIncrement：永久增量 | log：日志 | replication：复制 | s3Archive：S3归档 |
          tapeArchive：磁带归档 | clone：克隆副本 存入md；
        x-impact-subsystem: 不影响
        x-access-port: 30065
        x-auth-required: 'Y'
        x-public-api: 'N'
        x-auth-type: 双向证书认证
      format:
        type: integer
        format: int32
        description: 副本格式： 0：快照格式 1：目录格式 存入md
      size:
        type: integer
        format: int64
        description: 副本大小
      protectObject:
        $ref: '#/definitions/Application'
      protectSubObject:
        type: array
        items:
          $ref: '#/definitions/AppResource'
        description: 被保护子对象
      protectEnv:
        type: array
        items:
          $ref: '#/definitions/AppEnvironment'
        description: 被保护的环境信息，无鉴权信息
      repositories:
        type: array
        items:
          $ref: '#/definitions/StorageRepositoryExtend'
        description: 存储仓信息，无鉴权信息
      dataLayout:
        $ref: '#/definitions/DataLayout'
      extendInfo:
        type: object
        description: json对象，扩展信息
  Snapshot:
    description: 快照信息
    properties:
      id:
        type: string
        description: 快照id
      parentName:
        type: string
        description: 文件系统名或LUN名
  StatisticTaskResponse:
    description: 统计结果的返回值
    properties:
      mainTask:
        type: integer
        format: int32
        description: |-
          INITIALIZING = 0,
              RUNNING = 1,
              ABORTING = 2,
              COMPLETED = 3,
              PARTIAL_COMPLETED = 4,
              ABORTED = 5,
              ABORTED_FAILED = 6,
              FAILED = 7,
              FAILED_NOTRY = 8
      subTask:
        type: object
        description: >-
          key-value形式，类似于这种：{'total': 1, 'success': 2, 'failed': 3, 'aborted':
          4}
  LiveMountParams:
    description: 发送给agent时，taskParams对应的参数
    properties:
      advanceParams:
        type: object
        description: 高级参数
  CancelLiveMountParams:
    description: 取消挂载参数，无
    properties:
      advanceParams:
        type: object
  ProxyInfo:
    required:
      - enabled
      - hostname
      - port
    properties:
      enabled:
        type: boolean
        description: 是否启用
      hostname:
        type: string
        description: 代理服务器域名/IP
      port:
        type: integer
        format: int32
        description: 代理端口
      userName:
        type: string
        description: 用户名
      password:
        type: string
        description: 密码
      extendInfo:
        type: object
        description: 拓展字段
