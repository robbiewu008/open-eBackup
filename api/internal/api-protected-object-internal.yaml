swagger: '2.0'
info:
  title: 保护对象接口
  version: v1
tags:
  - name: projected_object_api
paths:
  /v1/internal/protected-objects:
    get:
      x-product: CyberEngine,OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'Y'
      x-dp-admin-role: 'Y'
      x-public-api: 'N'
      x-sysadmin-role: 'Y'
      produces:
        - application/json
      parameters:
        - description: 资源名称，支持模糊查询
          in: query
          name: name
          required: false
          type: string
        - collectionFormat: multi
          description: SLA类型，支持筛选过滤
          in: query
          items:
            $ref: '#/definitions/ResourceSubTypeEnum'
          name: sub_type
          required: false
          type: array
        - description: 资源位置，支持模糊查询
          in: query
          name: path
          required: false
          type: string
        - collectionFormat: multi
          description: SLA遵从度，支持筛选过滤
          in: query
          items:
            type: boolean
          name: sla_compliance
          required: false
          type: array
        - description: SLA的ID
          in: query
          name: sla_id
          required: true
          type: string
        - description: 分页页面编码
          in: query
          name: page_no
          required: true
          type: integer
        - description: 分页数据条数
          in: query
          name: page_size
          required: true
          type: integer
      responses:
        '200':
          description: Successful Response
          schema:
            $ref: '#/definitions/BasePage_ProtectedObjectQueryResponse_'
        '422':
          description: Validation Error
          schema:
            $ref: '#/definitions/HTTPValidationError'
      tags:
        - projected_object_api
      operationId: internal_page_query_v1_internal_protected_objects_get
      summary: 分页查询SLA关联资源信息列表【内部接口】
  /v1/internal/protected-objects/action/sync-sla:
    put:
      x-product: CyberEngine,OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'Y'
      x-public-api: 'N'
      x-sysadmin-role: 'Y'
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          required: true
          schema:
            $ref: >-
              #/definitions/Body_synchronize_sla_change_v1_internal_protected_objects_action_sync_sla_put
      responses:
        '200':
          description: Successful Response
          schema:
            $ref: '#/definitions/ProtectedObjectQuery'
        '422':
          description: Validation Error
          schema:
            $ref: '#/definitions/HTTPValidationError'
      tags:
        - projected_object_api
      operationId: synchronize_sla_change_v1_internal_protected_objects_action_sync_sla_put
      summary: 保护对象同步SLA信息变更【内部接口】
  /v1/internal/protected-objects/compliance:
    put:
      x-product: CyberEngine,OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'Y'
      x-public-api: 'N'
      x-sysadmin-role: 'Y'
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - in: body
          name: body
          required: true
          schema:
            allOf:
              - $ref: '#/definitions/ComplianceUpdate'
            description: 更新保护对象遵从度请求
            title: Update Req
      responses:
        '200':
          description: Successful Response
        '422':
          description: Validation Error
          schema:
            $ref: '#/definitions/HTTPValidationError'
      tags:
        - projected_object_api
      operationId: update_compliance_v1_internal_protected_objects_compliance_put
      summary: 更新保护对象遵从度【内部接口】
  /v1/internal/protected-objects/count:
    get:
      x-product: CyberEngine,OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'Y'
      x-dp-admin-role: 'Y'
      x-public-api: 'N'
      x-sysadmin-role: 'Y'
      produces:
        - application/json
      parameters:
        - description: SLA的ID
          format: uuid
          in: query
          name: sla_id
          required: true
          type: string
        - description: 用户ID
          in: query
          name: user_id
          required: false
          type: string
      responses:
        '200':
          description: Successful Response
        '422':
          description: Validation Error
          schema:
            $ref: '#/definitions/HTTPValidationError'
      tags:
        - projected_object_api
      operationId: count_protection_object_v1_internal_protected_objects_count_get
      summary: 根据SLA的ID查询关联资源数量【内部接口】
  /v1/internal/protected-objects/{resource_id}:
    get:
      x-product: CyberEngine,OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'Y'
      x-dp-admin-role: 'Y'
      x-public-api: 'N'
      x-sysadmin-role: 'Y'
      produces:
        - application/json
      parameters:
        - description: 保护对象资源ID
          in: path
          name: resource_id
          required: true
          type: string
      responses:
        '200':
          description: Successful Response
          schema:
            $ref: '#/definitions/ProtectedObjectQuery'
        '422':
          description: Validation Error
          schema:
            $ref: '#/definitions/HTTPValidationError'
      tags:
        - projected_object_api
      operationId: query_protection_object_v1_internal_protected_objects__resource_id__get
      summary: 根据资源ID查询保护对象信息【内部接口】
  /v1/internal/protected-objects/{resource_id}/action/update-last-backup-time:
    put:
      x-product: CyberEngine,OceanProtect X
      x-dm-role: 'N'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'Y'
      x-public-api: 'N'
      x-sysadmin-role: 'Y'
      produces:
        - application/json
      parameters:
        - description: 保护对象资源ID
          in: path
          name: resource_id
          required: true
          type: string
      responses:
        '200':
          description: Successful Response
        '422':
          description: Validation Error
          schema:
            $ref: '#/definitions/HTTPValidationError'
      tags:
        - projected_object_api
      operationId: synchronize_time_v1_internal_protected_objects__resource_id__action_update_last_backup_time_put
      summary: 更新保护对象的最新备份时间【内部接口】
definitions:
  BaseExtParam:
    properties: {}
    title: BaseExtParam
    type: object
  BasePage_ProtectedObjectQueryResponse_:
    properties:
      items:
        description: 数据列表
        items:
          $ref: '#/definitions/ProtectedObjectQueryResponse'
        title: Items
        type: array
      page_no:
        description: 页面编号
        title: Page No
        type: integer
      page_size:
        description: 每页数据量
        title: Page Size
        type: integer
      pages:
        description: 总页数
        title: Pages
        type: integer
      total:
        description: 总的数据条数
        title: Total
        type: integer
    required:
      - total
      - pages
      - page_size
      - page_no
      - items
    title: BasePage[ProtectedObjectQueryResponse]
    type: object
  BatchOperationReq:
    properties:
      resource_ids:
        description: 批量操作资源ID列表
        items:
          type: string
        title: Resource Ids
        type: array
    required:
      - resource_ids
    title: BatchOperationReq
    type: object
  BatchProtectionSubmitReq:
    properties:
      ext_parameters:
        allOf:
          - $ref: '#/definitions/BaseExtParam'
        description: 扩展属性
        title: Ext Parameters
      post_action:
        $ref: '#/definitions/ProtectPostAction'
      resources:
        description: 保护的资源列表
        items:
          $ref: '#/definitions/ProtectResource'
        title: Resources
        type: array
      sla_id:
        description: 关联的SLA ID
        maxLength: 36
        title: Sla Id
        type: string
    required:
      - sla_id
      - resources
    title: BatchProtectionSubmitReq
    type: object
  Body_synchronize_sla_change_v1_internal_protected_objects_action_sync_sla_put:
    properties:
      sla_id:
        description: SLA的ID
        title: Sla Id
        type: string
    required:
      - sla_id
    title: >-
      Body_synchronize_sla_change_v1_internal_protected_objects_action_sync_sla_put
    type: object
  ComplianceUpdate:
    properties:
      compliance:
        description: SLA遵从度, True：遵从，False：不遵从
        title: Compliance
        type: boolean
      resource_id:
        description: 资源ID
        title: Resource Id
        type: string
    required:
      - resource_id
      - compliance
    title: ComplianceUpdate
    type: object
  FilterColumn:
    description: An enumeration.
    enum:
      - NAME
      - ID
      - SLOT
    title: FilterColumn
    type: string
  FilterMode:
    description: An enumeration.
    enum:
      - EXCLUDE
      - INCLUDE
    title: FilterMode
    type: string
  FilterRule:
    description: An enumeration.
    enum:
      - ALL
      - START_WITH
      - END_WITH
      - FUZZY
    title: FilterRule
    type: string
  FilterType:
    description: An enumeration.
    enum:
      - DISK
      - VM
      - VOLUME
    title: FilterType
    type: string
  HTTPValidationError:
    properties:
      detail:
        items:
          $ref: '#/definitions/ValidationError'
        title: Detail
        type: array
    title: HTTPValidationError
    type: object
  ManualBackupReq:
    properties:
      action:
        $ref: '#/definitions/PolicyActionEnum'
      sla_id:
        description: 绑定SLA的ID
        maxLength: 36
        title: Sla Id
        type: string
    required:
      - sla_id
      - action
    title: ManualBackupReq
    type: object
  ModifyProtectionSubmitReq:
    properties:
      ext_parameters:
        allOf:
          - $ref: '#/definitions/BaseExtParam'
        description: 扩展属性
        title: Ext Parameters
      resource_id:
        description: 保护对象对应的资源ID
        maxLength: 64
        title: Resource Id
        type: string
      sla_id:
        description: 新的SLA ID
        maxLength: 36
        title: Sla Id
        type: string
    required:
      - sla_id
      - resource_id
    title: ModifyProtectionSubmitReq
    type: object
  PolicyActionEnum:
    description: An enumeration.
    enum:
      - full
      - log
      - cumulative_increment
      - difference_increment
      - replication
      - archiving
    title: PolicyActionEnum
    type: string
  ProtectPostAction:
    description: 保护后置操作
    enum:
      - BACKUP
    title: ProtectPostAction
    type: string
  ProtectResource:
    properties:
      filters:
        description: 过滤规则列表
        items:
          $ref: '#/definitions/ResourceFilter'
        title: Filters
        type: array
      resource_id:
        description: 资源ID
        maxLength: 64
        title: Resource Id
        type: string
    required:
      - resource_id
    title: ProtectResource
    type: object
  ProtectedObjectId:
    properties:
      uuid:
        description: 保护对象的ID
        title: Uuid
        type: string
    title: ProtectedObjectId
    type: object
  ProtectedObjectQuery:
    properties:
      earliest_time:
        description: 最早一次备份时间
        format: date-time
        title: Earliest Time
        type: string
      env_id:
        description: 环境ID
        title: Env Id
        type: string
      env_type:
        description: 环境类型
        title: Env Type
        type: string
      ext_parameters:
        description: 扩展属性
        format: json-string
        title: Ext Parameters
        type: string
      latest_time:
        description: 最近一次备份时间
        format: date-time
        title: Latest Time
        type: string
      name:
        description: 保护对象名称
        title: Name
        type: string
      next_time:
        description: 下一次备份时间
        format: date-time
        title: Next Time
        type: string
      path:
        description: 资源位置
        title: Path
        type: string
      resource_id:
        description: 保护对象对应资源的ID
        title: Resource Id
        type: string
      sla_id:
        description: 关联SLA的ID
        title: Sla Id
        type: string
      sla_name:
        description: SLA名称
        title: Sla Name
        type: string
      status:
        description: 保护状态
        title: Status
        type: integer
      sub_type:
        description: 资源子类型：如DBBackupAgent、Fileset、Oracle、vim.VirtualMachine等
        title: Sub Type
        type: string
      type:
        description: 资源类型：如Host、Fileset、Database、VM等
        title: Type
        type: string
    required:
      - sla_id
      - sla_name
      - resource_id
    title: ProtectedObjectQuery
    type: object
  ProtectedObjectQueryResponse:
    properties:
      earliest_time:
        description: 最早一次备份时间
        format: date-time
        title: Earliest Time
        type: string
      env_id:
        description: 环境ID
        title: Env Id
        type: string
      env_type:
        description: 环境类型
        title: Env Type
        type: string
      ext_parameters:
        description: 扩展属性
        title: Ext Parameters
        type: object
      latest_time:
        description: 最近一次备份时间
        format: date-time
        title: Latest Time
        type: string
      name:
        description: 保护对象名称
        title: Name
        type: string
      next_time:
        description: 下一次备份时间
        format: date-time
        title: Next Time
        type: string
      path:
        description: 资源位置
        title: Path
        type: string
      resource_id:
        description: 保护对象对应资源的ID
        title: Resource Id
        type: string
      sla_compliance:
        description: SLA遵从度，True：遵从，False：不遵从
        title: Sla Compliance
        type: boolean
      sla_id:
        description: 关联SLA的ID
        title: Sla Id
        type: string
      sla_name:
        description: SLA名称
        title: Sla Name
        type: string
      status:
        description: 保护状态
        title: Status
        type: integer
      sub_type:
        description: 资源子类型：如DBBackupAgent、Fileset、Oracle、vim.VirtualMachine等
        title: Sub Type
        type: string
      type:
        description: 资源类型：如Host、Fileset、Database、VM等
        title: Type
        type: string
    required:
      - sla_id
      - sla_name
      - resource_id
    title: ProtectedObjectQueryResponse
    type: object
  ProtectedObjectTime:
    properties:
      earliest_time:
        description: 最早一次备份时间
        format: date-time
        title: Earliest Time
        type: string
      latest_time:
        description: 最近一次备份时间
        format: date-time
        title: Latest Time
        type: string
      next_time:
        description: 下一次备份时间
        format: date-time
        title: Next Time
        type: string
    title: ProtectedObjectTime
    type: object
  ResourceFilter:
    properties:
      filter_by:
        $ref: '#/definitions/FilterColumn'
      mode:
        $ref: '#/definitions/FilterMode'
      rule:
        $ref: '#/definitions/FilterRule'
      type:
        $ref: '#/definitions/FilterType'
      values:
        description: 具体过滤的值
        items:
          type: string
        title: Values
        type: array
    required:
      - filter_by
      - type
      - rule
      - mode
      - values
    title: ResourceFilter
    type: object
  ResourceSubTypeEnum:
    description: An enumeration.
    enum:
      - DBBackupAgent
      - VMBackupAgent
      - ABBackupClient
      - DWSBackupAgent
      - Fileset
      - HDFSFileset
      - DFSFileset
      - Oracle
      - OracleApp
      - SQLServer
      - DB2
      - MySQL
      - GaussDB
      - SAP HANA
      - Kingbase
      - Sybase IQ
      - Informix
      - TimesTen
      - GBase
      - Dameng
      - Cassandra
      - OscarDB
      - Exchange
      - VMware vCenter Server
      - VMware
      - VMware ESX
      - VMware ESXi
      - Hyper-V
      - HDFS
      - ms.HostSystem
      - FusionSphere
      - vim.ClusterComputeResource
      - vim.HostSystem
      - vim.Folder
      - vim.ResourcePool
      - OpenStack
      - HuaweiCloudStack
      - vim.VirtualMachine
      - ms.VirtualMachine
      - Hadoop
      - FusionInsight
      - vim.VirtualApp
      - vim.Datacenter
      - Common
      - Replica
      - K8S-Common-dataset
      - K8S-MySQL-dataset
      - K8S-cluster
      - K8S-namespace
      - ImportCopy
    title: ResourceSubTypeEnum
    type: string
  ValidationError:
    properties:
      loc:
        items:
          type: string
        title: Location
        type: array
      msg:
        title: Message
        type: string
      type:
        title: Error Type
        type: string
    required:
      - loc
      - msg
      - type
    title: ValidationError
    type: object
x-components: {}
