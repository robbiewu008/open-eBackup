swagger: '2.0'
info:
  version: v1
  title: DEE Indexer API Document
  contact: {}
  license: {}
host: localhost
basePath: /
tags:
  - name: 索引和浏览管理
    description: 索引和浏览Controller
  - name: 索引管理
  - name: 浏览管理
paths:
  /v1/internal/indexes:
    post:
      x-dm-role: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-sysadmin-role: 'N'
      x-impact-subsystem: 影响
      x-access-port: 8084
      x-auth-required: 'N'
      x-public-api: 'N'
      tags:
        - 索引管理
      summary: 为副本创建索引
      operationId: createIndexForCopy
      consumes:
        - application/json
      produces:
        - '*/*'
      parameters:
        - in: body
          name: request
          description: request
          required: true
          schema:
            originalRef: CreateIndexRequest
            $ref: '#/definitions/CreateIndexRequest'
      responses:
        '200':
          description: OK
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
      security:
        - Authorization:
            - global
    delete:
      x-dm-role: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-sysadmin-role: 'N'
      tags:
        - 索引管理
      summary: 删除资源或副本的索引
      x-impact-subsystem: 影响
      x-access-port: 8084
      x-auth-required: 'N'
      x-public-api: 'N'
      operationId: deleteCopyIndex
      parameters:
        - name: requestId
          in: query
          required: true
          description: 请求id
          type: string
          minLength: 1
          maxLength: 128
        - name: resourceId
          in: query
          required: true
          description: 资源id
          type: string
          minLength: 1
          maxLength: 128
        - name: copyId
          in: query
          required: false
          description: 副本id，删除单个副本索引时必填
          type: string
          minLength: 1
          maxLength: 128
        - name: chainId
          in: query
          required: false
          description: 备份链id，删除单个副本索引时必填
          type: string
          minLength: 1
          maxLength: 128
        - name: userId
          in: query
          required: true
          description: 用户id
          type: string
          minLength: 1
          maxLength: 128
      responses:
        '200':
          description: OK
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
  '/v1/internal/indexes/{requestId}/action/report-rfi':
    post:
      x-dm-role: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-sysadmin-role: 'N'
      x-impact-subsystem: 影响
      x-access-port: 8084
      x-auth-required: 'N'
      x-public-api: 'N'
      tags:
        - 索引管理
      summary: 应用上报生成RFI文件
      operationId: reportRfiFiles
      consumes:
        - application/json
      produces:
        - '*/*'
      parameters:
        - name: requestId
          in: path
          required: true
          type: string
          minLength: 1
          maxLength: 128
        - in: body
          name: request
          description: request
          required: true
          schema:
            originalRef: ReportRfiRequest
            $ref: '#/definitions/ReportRfiRequest'
      responses:
        '200':
          description: OK
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
      security:
        - Authorization:
            - global
  /v1/internal/indexes/folder/action/list:
    post:
      x-dm-role: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-sysadmin-role: 'N'
      x-impact-subsystem: 影响
      x-access-port: 8084
      x-auth-required: 'N'
      x-public-api: 'N'
      tags:
        - 浏览管理
      summary: 浏览副本文件系统
      operationId: listFilesInCopyFolder
      consumes:
        - application/json
      produces:
        - '*/*'
      parameters:
        - in: body
          name: request
          description: request
          required: true
          schema:
            originalRef: ListCopyRequest
            $ref: '#/definitions/ListCopyRequest'
      responses:
        '200':
          description: OK
          schema:
            originalRef: listFilesResponse
            $ref: '#/definitions/listFilesResponse'
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
      security:
        - Authorization:
            - global
  /v1/internal/restore-filesystem/action/mount:
    post:
      x-dm-role: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-sysadmin-role: 'N'
      x-impact-subsystem: 影响
      x-access-port: 8084
      x-auth-required: 'N'
      x-public-api: 'N'
      tags:
        - 浏览管理
      summary: 挂载恢复目标文件系统
      operationId: mountBrowseRestoreDeviceUsingPOST
      consumes:
        - application/json
      produces:
        - '*/*'
      parameters:
        - in: body
          name: request
          description: request
          required: true
          schema:
            originalRef: MountFileSystemRequest
            $ref: '#/definitions/MountFileSystemRequest'
      responses:
        '200':
          description: OK
          schema:
            originalRef: MountFileSystemResponse
            $ref: '#/definitions/MountFileSystemResponse'
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
      security:
        - Authorization:
            - global
  /v1/internal/restore-filesystem/folder:
    post:
      x-dm-role: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-sysadmin-role: 'N'
      x-impact-subsystem: 影响
      x-access-port: 8084
      x-auth-required: 'N'
      x-public-api: 'N'
      tags:
        - 浏览管理
      summary: 在恢复目标文件系统中创建目录
      operationId: createFolderInRestoreFilesystem
      consumes:
        - application/json
      produces:
        - '*/*'
      parameters:
        - name: folderName
          in: query
          description: folderName
          required: true
          type: string
          minLength: 1
          maxLength: 4096
        - name: mountPointId
          in: query
          description: mountPointId
          required: true
          type: string
          minLength: 1
          maxLength: 128
        - name: parentPath
          in: query
          description: parentPath
          required: true
          type: string
          minLength: 1
          maxLength: 4096
      responses:
        '200':
          description: OK
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
      security:
        - Authorization:
            - global
    get:
      x-dm-role: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-sysadmin-role: 'N'
      x-impact-subsystem: 影响
      x-access-port: 8084
      x-auth-required: 'N'
      x-public-api: 'N'
      tags:
        - 浏览管理
      summary: 获取恢复目标文件系统目录中文件列表
      operationId: listFilesInRestorFilesystemFolder
      produces:
        - '*/*'
      parameters:
        - name: mountPointId
          in: query
          description: mountPointId
          required: true
          type: string
          minLength: 1
          maxLength: 128
        - name: parentPath
          in: query
          description: parentPath
          required: true
          type: string
          minLength: 1
          maxLength: 4096
        - name: pageNum
          in: query
          description: pageNum
          required: true
          type: integer
          format: int64
          minimum: 0
        - name: pageSize
          in: query
          description: pageSize
          required: true
          type: integer
          format: int64
          maximum: 1024
      responses:
        '200':
          description: OK
          schema:
            originalRef: listFilesResponse
            $ref: '#/definitions/listFilesResponse'
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
      security:
        - Authorization:
            - global
    delete:
      x-dm-role: 'N'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'N'
      x-sysadmin-role: 'N'
      x-impact-subsystem: 影响
      x-access-port: 8084
      x-auth-required: 'N'
      x-public-api: 'N'
      tags:
        - 浏览管理
      summary: 从恢复目标文件系统目录中删除文件
      operationId: deleteFileFormRestoreFilesystemFolder
      produces:
        - '*/*'
      parameters:
        - name: mountPointId
          in: query
          description: mountPointId
          required: true
          type: string
          minLength: 1
          maxLength: 128
        - name: filePath
          in: query
          required: true
          description: fileName
          type: string
          minLength: 1
          maxLength: 4096
      responses:
        '200':
          description: OK
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
      security:
        - Authorization:
            - global
securityDefinitions:
  Authorization:
    type: apiKey
    name: TOKEN
    in: header
definitions:
  CreateIndexRequest:
    properties:
      requestId:
        type: string
        description: 请求id
        minLength: 1
        maxLength: 128
      triggerMode:
        type: string
        description: '建索引触发方式: AUTO-调度自动建,MANUAL-手动建'
        enum:
          - AUTO
          - MANUAL
        minLength: 1
        maxLength: 64
      copyInfo:
        description: 副本信息
        originalRef: copyInfo
        $ref: '#/definitions/CopyInfo'
      agents:
        type: array
        description: agent节点信息，只传内置agent
        items:
          originalRef: HostAddress
          $ref: '#/definitions/HostAddress'
    title: CreateIndexRequest
    required:
      - requestId
      - triggerMode
      - copyInfo
      - agents
  ReportRfiRequest:
    properties:
      requestId:
        type: string
        description: 请求id
        minLength: 1
        maxLength: 128
      taskId:
        type: string
        description: 任务id
        minLength: 1
        maxLength: 128
      status:
        type: integer
        format: int32
        description: >-
          任务状态：0-INITIALIZING，1-RUNNING，2-ABORTING，3-COMPLETED，4-PARTIAL_COMPLETED，5-ABORTED，6-ABORTED_FAILED，7-FAILED，8-FAILED_NOTRY
        minimum: 0
        maximum: 20
      extendField:
        items:
          properties:
            copyId:
              type: string
              example: dfed7b8e-f7ae-47c7-878a-1542438e4997
              description: 副本id
              minLength: 1
              maxLength: 128
            rfiFiles:
              type: array
              items:
                type: string
                minLength: 1
                maxLength: 1024
              example:
                - /RFI_new_and_old_2.zip
              description: rfi文件路径
              minItems: 1
              maxItems: 4096
        description: 扩展信息
        type: array
        minItems: 1
        maxItems: 10000
    title: ReportRfiRequest
    required:
      - requestId
      - taskId
      - status
  ListCopyRequest:
    properties:
      copyInfo:
        description: 副本信息
        originalRef: CopyInfo
        $ref: '#/definitions/CopyInfo'
      pageNum:
        type: integer
        format: int64
        description: 起始页
        minimum: 0
      pageSize:
        type: integer
        format: int64
        description: 分页大小
        maximum: 1024
      parentPath:
        type: string
        description: 父路径
        minLength: 1
        maxLength: 4096
    title: ListCopyRequest
    required:
      - copyInfo
      - pageNum
      - pageSize
      - parentPath
  listFilesResponse:
    properties:
      items:
        type: array
        items:
          originalRef: FolderInfo
          $ref: '#/definitions/FileInfo'
      total:
        type: integer
        format: int32
    title: listFilesResponse
  MountFileSystemRequest:
    properties:
      location:
        type: string
        description: '文件系统所处位置：LOCAL,本机位置;NEW,新位置'
        enum:
          - LOCAL
          - NEW
        minLength: 1
        maxLength: 64
      shareInfo:
        description: 共享文件系统信息
        originalRef: FilesystemInfo
        $ref: '#/definitions/ShareInfo'
      targetEnv:
        $ref: '#/definitions/AppEnvironment'
    title: MountFileSystemRequest
    required:
      - location
      - shareInfo
  MountFileSystemResponse:
    properties:
      mountPointId:
        type: string
        minLength: 1
        maxLength: 128
    title: MountFileSystemResponse
    required:
      - mountPointId
  HostAddress:
    properties:
      ip:
        type: string
        description: ip
        minLength: 1
        maxLength: 128
      port:
        type: integer
        format: int32
        description: port
        minimum: 1
        maximum: 65535
      id:
        type: string
        description: host id，pm下发时要带上agent id
        minLength: 1
        maxLength: 128
    title: HostAddress
    required:
      - ip
      - port
      - id
  ReportRfiInfo:
    properties:
      extendInfo:
        type: array
        items:
          $ref: '#/definitions/ExtendInfo'
        description: 当前副本ID
    title: ReportRfiInfo
    required:
      - extendInfo
  CopyInfo:
    properties:
      uuid:
        type: string
        description: 副本ID
        minLength: 1
        maxLength: 128
      generatedBy:
        type: string
        description: 副本生成方式
        minLength: 1
        maxLength: 64
      isAggregation:
        type: boolean
        description: 副本是否是聚合格式
      isIndexed:
        type: boolean
        description: 副本是否索引标志位
      resourceId:
        type: string
        description: '${dee.indexer.browse.copyInfo.request.resourceId}'
        minLength: 1
        maxLength: 128
      resourceName:
        type: string
        description: 副本资源名称，创建索引时必选
        minLength: 1
        maxLength: 64
      resourceSubType:
        type: string
        description: 副本资源子类型
        minLength: 1
        maxLength: 64
      gn:
        type: integer
        format: int32
        description: '${dee.indexer.browse.copyInfo.request.gn}'
      chainId:
        type: string
        description: 备份链ID
        minLength: 1
        maxLength: 128
      userId:
        type: string
        description: 副本用户ID
        minLength: 1
        maxLength: 128
      snapshots:
        type: array
        items:
          $ref: '#/definitions/SnapshotInfo'
        description: 副本对应的快照列表，浏览未建索引副本时必选
        minItems: 1
        maxItems: 64
    title: CopyInfo
    required:
      - uuid
      - generatedBy
      - isAggregation
      - isIndexed
      - resourceId
      - resourceSubType
      - gn
      - chainId
      - userId
  SnapshotInfo:
    properties:
      id:
        type: string
        description: 快照ID
        minLength: 1
        maxLength: 128
      parentName:
        type: string
        description: 父节点（文件系统）名
        minLength: 1
        maxLength: 512
    title: SnapshotInfo
    required:
      - id
      - parentName
  FileInfo:
    properties:
      path:
        type: string
        minLength: 1
        maxLength: 1024
      type:
        type: string
        minLength: 1
        maxLength: 64
      hasChildren:
        type: boolean
      size:
        type: integer
        format: int64
      modifyTime:
        type: string
        minLength: 1
        maxLength: 128
    title: FolderInfo
  ShareInfo:
    properties:
      filesystemName:
        type: string
        description: 文件系统名
        minLength: 1
        maxLength: 512
      shareIp:
        type: string
        description: 共享IP，新位置需要
        minLength: 1
        maxLength: 128
      name:
        type: string
        description: 共享名，新位置需要
        minLength: 1
        maxLength: 512
      protocol:
        type: string
        description: 共享协议，新位置需要
        minLength: 1
        maxLength: 64
      targetType:
        type: string
        description: 目标共享文件系统类型，HOMOGENEOUS：同构、HETEROGENEOUS：异构
        enum:
          - HOMOGENEOUS
          - HETEROGENEOUS
        minLength: 1
        maxLength: 64
      nfsAuth:
        description: NFS验证信息，新位置是NFS共享需要
        originalRef: NfsAuth
        $ref: '#/definitions/NfsAuth'
      cifsAuth:
        description: CIFS验证信息，新位置是CIFS共享需要
        originalRef: CifsAuth
        $ref: '#/definitions/CifsAuth'
    title: FilesystemInfo
    required:
      - filesystemName
  NfsAuth:
    properties:
      kerberos:
        type: string
        description: kerberos
        minLength: 1
        maxLength: 512
      mode:
        type: string
        description: 验证模式
        minLength: 1
        maxLength: 64
    title: NfsAuth
  CifsAuth:
    properties:
      domainName:
        type: string
        description: 域名
        minLength: 1
        maxLength: 512
      mode:
        type: string
        description: 验证模式
        minLength: 1
        maxLength: 64
      password:
        type: string
        description: 密码
        minLength: 1
        maxLength: 512
      username:
        type: string
        description: 用户名
        minLength: 1
        maxLength: 512
    title: CifsAuth
  fileSystemInfo:
    properties:
      fileSystemName:
        type: string
        description: 副本所在文件系统名称
      fileSystemID:
        type: string
        description: 副本所在文件系统ID
      shareProtocol:
        type: string
        description: '共享协议类型：NFS,CIFS'
  Authentication:
    description: >-
      0-NO_AUTH, 1-OS_PASSWORD,  2-APP_PASSWORD, 3-LADP, 4-AKSK, 5-KERBEROS,
      6-TOKEN, 7-OAUTH2, 8-OTHER

      1到3,authKey填用户名,authPwd填密码， 4 authKey填AK， authPwd填SK,
      5,6,7,8认证认证信息在扩展字段中扩充。

      认证信息

      0-NO_AUTH, 1-OS_PASSWORD, 2-APP_PASSWORD, 3-LADP, 4-AKSK, 5-KERBEROS,
      6-TOKEN, 7-OAUTH2, 8-OTHER

      1到3,authKey填用户名,authPwd填密码， 4 authKey填AK， authPwd填SK,
      5,6,7,8认证认证信息在扩展字段中扩充。
    properties:
      authType:
        type: integer
        format: int32
        description: >-
          0-NO_AUTH, 1-OS_PASSWORD, 2-APP_PASSWORD, 3-LADP, 4-AKSK, 5-KERBEROS,
          6-TOKEN, 7-OAUTH2, 8-OTHER
        minimum: 0
        maximum: 20
      authKey:
        type: string
        description: 用户名
        minLength: 1
        maxLength: 512
      authPwd:
        type: string
        description: 密码
        minLength: 1
        maxLength: 512
      extendInfo:
        type: object
        description: json对象，key_value键值对，扩展信息
    required:
      - authType
  AppEnvironment:
    properties:
      endpoint:
        type: string
        minLength: 1
        maxLength: 128
      port:
        type: integer
        format: int32
        minimum: 1
        maximum: 65535
      auth:
        $ref: '#/definitions/Authentication'
      extendInfo:
        type: object
        description: json对象，扩展信息
  ExtendInfo:
    properties:
      copyId:
        type: string
        minLength: 1
        maxLength: 128
      rfiFiles:
        type: array
        items:
          type: string
          minLength: 1
          maxLength: 1024
        minItems: 1
        maxItems: 1024
