swagger: '2.0'
info:
  title: SLA管理接口
  version: v1
tags:
  - name: sla-api
paths:
  /v1/slas:
    get:
      x-dm-role: 'Y'
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'Y'
      x-rd-admin-role: 'N'
      x-auditor-role: 'Y'
      x-dp-admin-role: 'Y'
      x-public-api: 'Y'
      x-sysadmin-role: 'Y'
      produces:
        - application/json
      parameters:
        - description: SLA名称，支持模糊查询
          in: query
          name: name
          required: false
          type: string
        - collectionFormat: multi
          description: sla类型，支持筛选过滤
          in: query
          items:
            $ref: '#/definitions/SlaType'
          name: types
          required: false
          type: array
        - collectionFormat: multi
          description: sla应用类型，支持过筛选过滤
          in: query
          items:
            $ref: '#/definitions/ResourceSubTypeEnum'
          name: applications
          required: false
          type: array
        - collectionFormat: multi
          description: 备份模式列表
          in: query
          items:
            $ref: '#/definitions/PolicyActionEnum'
          name: actions
          required: false
          type: array
        - description: 分页页面编码
          in: query
          name: page_no
          required: true
          type: integer
        - description: 分页数据条数
          in: query
          maximum: 200
          minimum: 0
          name: page_size
          required: true
          type: integer
        - description: 请求token
          in: header
          name: X-Auth-Token
          required: true
          type: string
        - name: orderBy
          in: query
          required: false
          description: 排序字段，默认值为created_time
          type: string
          enum:
            - name
            - created_time
        - name: orderType
          in: query
          required: false
          description: 排序类型，默认值为asc升序
          type: string
          enum:
            - asc
            - desc
      responses:
        '200':
          description: Successful Response
          schema:
            $ref: '#/definitions/BasePage_SlaQuery_'
        '422':
          description: Validation Error
          schema:
            $ref: '#/definitions/HTTPValidationError'
      tags:
        - sla-api
      operationId: page_query_slas_v1_slas_get
      summary: 分页查询SLA信息
    post:
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'Y'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'Y'
      x-public-api: 'Y'
      x-sysadmin-role: 'Y'
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - description: 请求token
          in: header
          name: X-Auth-Token
          required: true
          type: string
        - in: body
          name: body
          required: true
          schema:
            allOf:
              - $ref: '#/definitions/SlaCreate'
            description: SLA详细信息
            title: Sla Req
      responses:
        '200':
          description: Successful Response
          schema:
            $ref: '#/definitions/SlaId'
        '422':
          description: Validation Error
          schema:
            $ref: '#/definitions/HTTPValidationError'
      tags:
        - sla-api
      description: |-
        创建SLA
        接口：/v1/slas 方法：Post
        :param database_session: 数据库连接会话
        :param token: 用户令牌
        :param sla_req: SLA请求
        :return: SLA编号
      operationId: create_v1_slas_post
      summary: 创建新的SLA
    put:
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'Y'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'Y'
      x-public-api: 'Y'
      x-sysadmin-role: 'Y'
      consumes:
        - application/json
      produces:
        - application/json
      parameters:
        - description: 请求token
          in: header
          name: X-Auth-Token
          required: true
          type: string
        - in: body
          name: body
          schema:
            allOf:
              - $ref: '#/definitions/SlaUpdate'
            description: SLA详细信息
            title: Sla Req
          required: false
      responses:
        '200':
          description: Successful Response
          schema:
            $ref: '#/definitions/SlaId'
        '422':
          description: Validation Error
          schema:
            $ref: '#/definitions/HTTPValidationError'
      tags:
        - sla-api
      description: |-
        修改SLA
        接口：/v1/slas 方法：Put
        :param user_info: 注入的登录用户信息
        :param sla_req: SLA请求
        :return: SAL编号
      operationId: modify_v1_slas_put
      summary: 修改SLA信息
  '/v1/slas/{sla_id}':
    delete:
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'Y'
      x-rd-admin-role: 'N'
      x-auditor-role: 'N'
      x-dp-admin-role: 'Y'
      x-public-api: 'Y'
      x-sysadmin-role: 'Y'
      produces:
        - application/json
      parameters:
        - description: SLA的id
          in: path
          name: sla_id
          required: true
          type: string
        - description: 请求token
          in: header
          name: X-Auth-Token
          required: true
          type: string
      responses:
        '200':
          description: Successful Response
          schema:
            $ref: '#/definitions/SlaId'
        '422':
          description: Validation Error
          schema:
            $ref: '#/definitions/HTTPValidationError'
      tags:
        - sla-api
      operationId: delete_v1_slas__sla_id__delete
      summary: 删除SLA信息
    get:
      x-impact-subsystem: 不影响
      x-access-port: 25081
      x-auth-required: 'Y'
      x-rd-admin-role: 'N'
      x-auditor-role: 'Y'
      x-dp-admin-role: 'Y'
      x-public-api: 'Y'
      x-sysadmin-role: 'Y'
      produces:
        - application/json
      parameters:
        - description: SLA的id
          in: path
          maxLength: 64
          minLength: 1
          name: sla_id
          required: true
          type: string
        - description: 请求token
          in: header
          name: X-Auth-Token
          required: true
          type: string
      responses:
        '200':
          description: SLA详细信息
          schema:
            $ref: '#/definitions/SlaQuery'
        '422':
          description: Validation Error
          schema:
            $ref: '#/definitions/HTTPValidationError'
      tags:
        - sla-api
      description: |-
        查询SLA详细信息
        接口：/v1/slas/{sla_id} 方法：Get
        :param database_session: 数据库连接会话
        :param token: 用户令牌
        :param sla_id: 请求SLA的编号
        :return: SLA详细信息
      operationId: query_sla_by_id_v1_slas__sla_id__get
      summary: 根据id查询单个SLA
definitions:
  BackupTimeUnit:
    description: An enumeration.
    enum:
      - m
      - h
      - d
      - w
    title: BackupTimeUnit
    type: string
  BaseExtendParam:
    properties:
      qos_id:
        description: 限速策略id
        title: Qos Id
        type: string
    title: BaseExtendParam
    type: object
  BasePage_SlaQuery_:
    properties:
      items:
        description: 数据列表
        items:
          $ref: '#/definitions/SlaQuery'
        title: Items
        type: array
      page_no:
        description: 页面编号
        title: Page No
        type: integer
      page_size:
        description: 每页数据量
        title: Page Size
        type: integer
      pages:
        description: 总页数
        title: Pages
        type: integer
      total:
        description: 总的数据条数
        title: Total
        type: integer
    required:
      - total
      - pages
      - page_size
      - page_no
      - items
    title: 'BasePage[SlaQuery]'
    type: object
  HTTPValidationError:
    properties:
      detail:
        items:
          $ref: '#/definitions/ValidationError'
        title: Detail
        type: array
    title: HTTPValidationError
    type: object
  Policy:
    properties:
      action:
        $ref: '#/definitions/PolicyActionEnum'
      ext_parameters:
        allOf:
          - $ref: '#/definitions/BaseExtendParam'
        description: |-
          扩展参数:
          备份策略扩展参数主要参数key定义：
          qos_id : 限速策略id 非必传
          auto_retry : 是否开启自动重试   integer  必传
          auto_retry_times : 自动重试次数  integer  非必传
          auto_retry_wait_minutes: 自动重试等待时间(分钟) integer 非必传
          job_failed_alarm : 是否开启任务失败告警   boolean 必传
          deduplication : 是否开启目标端重复删除  boolean 必传
          source_deduplication : 源端重复数据删除  boolean 必传

          复制策略扩展参数key说明
          qos_id : 限速策略id 非必传
          external_system_id : 外部复制集群id 必传
          link_deduplication : 是否开启复制链路重删 必传
          link_compression : 是否开启复制链路压缩 必传

          归档扩展参数：
          qos_id : 限速策略id 非必传
          storage_id：归档存储id，非必传
          auto_retry : 是否开启自动重试   integer  必传
          auto_retry_times : 自动重试次数  integer  非必传
          auto_retry_wait_minutes: 自动重试等待时间(分钟) integer 非必传
          archive_target_type：副本归档类型  integer  1归档所有副本 2指定副本归档
          archiving_scope：归档所有副本-归档范围，取值"latest","all_no_archiving",非必传
          network_access：网络加速，boolean 非必传
          delete_import_copy：归档后删除原导入副本，  boolean 非必传
          protocol：归档存储类型，integer枚举[0, 1, 2, 3, 4, 5, 6, 7]
          auto_index: 是否开启自动索引 boolean 非必传
        title: Ext Parameters
      name:
        description: 策略名称
        maxLength: 64
        minLength: 1
        pattern: '^[a-zA-Z_\u4e00-\u9fa5]{1}[\u4e00-\u9fa5\w-]*$'
        title: Name
        type: string
      retention:
        allOf:
          - $ref: '#/definitions/Retention'
        description: 保留策略
        title: Retention
      schedule:
        allOf:
          - $ref: '#/definitions/Schedule'
        description: 策略调度信息
        title: Schedule
      type:
        $ref: '#/definitions/PolicyTypeEnum'
      uuid:
        description: 唯一编码
        format: uuid
        title: Uuid
        type: string
    title: Policy
    required:
      - name
      - schedule
      - type
  PolicyActionEnum:
    description: An enumeration.
    enum:
      - full
      - log
      - cumulative_increment
      - difference_increment
      - replication
      - archiving
    title: PolicyActionEnum
    type: string
  PolicyQuery:
    properties:
      action:
        $ref: '#/definitions/PolicyActionEnum'
      ext_parameters:
        description: 扩展参数，不同类型应用各自扩展
        format: json-string
        title: Ext Parameters
        type: string
      name:
        description: 策略名称
        title: Name
        type: string
      retention:
        allOf:
          - $ref: '#/definitions/Retention'
        description: 保留策略
        title: Retention
      schedule:
        allOf:
          - $ref: '#/definitions/ScheduleQuery'
        description: 策略调度信息
        title: Schedule
      type:
        $ref: '#/definitions/PolicyTypeEnum'
      uuid:
        description: 唯一编码
        title: Uuid
        type: string
    required:
      - name
      - schedule
      - type
    title: PolicyQuery
    type: object
  PolicyTypeEnum:
    description: An enumeration.
    enum:
      - backup
      - archiving
      - replication
    title: PolicyTypeEnum
    type: string
  ResourceSubTypeEnum:
    description: An enumeration.
    enum:
      - DBBackupAgent
      - VMBackupAgent
      - ABBackupClient
      - DWSBackupAgent
      - Fileset
      - HDFSFileset
      - DFSFileset
      - Oracle
      - OracleApp
      - SQLServer
      - DB2
      - MySQL
      - GaussDB
      - SAP HANA
      - Kingbase
      - Sybase IQ
      - Informix
      - TimesTen
      - GBase
      - Dameng
      - Cassandra
      - OscarDB
      - Exchange
      - VMware vCenter Server
      - VMware
      - VMware ESX
      - VMware ESXi
      - Hyper-V
      - HDFS
      - ms.HostSystem
      - FusionSphere
      - vim.ClusterComputeResource
      - vim.HostSystem
      - vim.Folder
      - vim.ResourcePool
      - OpenStack
      - HuaweiCloudStack
      - vim.VirtualMachine
      - ms.VirtualMachine
      - Hadoop
      - FusionInsight
      - vim.VirtualApp
      - vim.Datacenter
      - Common
      - Replica
      - K8S-Common-dataset
      - K8S-MySQL-dataset
      - K8S-cluster
      - K8S-namespace
      - ImportCopy
    title: ResourceSubTypeEnum
    type: string
  Retention:
    properties:
      duration_unit:
        $ref: '#/definitions/RetentionTimeUnit'
      retention_duration:
        description: 保留周期
        title: Retention Duration
        type: integer
      retention_type:
        $ref: '#/definitions/RetentionTypeEnum'
    required:
      - retention_type
    title: Retention
    type: object
  RetentionTimeUnit:
    description: An enumeration.
    enum:
      - d
      - w
      - MO
      - 'y'
    title: RetentionTimeUnit
    type: string
  RetentionTypeEnum:
    description: An enumeration.
    enum:
      - 1
      - 2
    title: RetentionTypeEnum
    type: integer
  Schedule:
    properties:
      days_of_month:
        description: '每月的某些天，可多选，格式 1-20,21,23'
        pattern: '^\d+(?:-\d+)?(?:,\d+(?:-\d+)?)*$'
        title: Days Of Month
        type: string
      days_of_week:
        description: '每周的周几，可多选，格式 List[mon tue wed thu fri sat sun]'
        items:
          type: string
        title: Days Of Week
        type: array
      days_of_year:
        description: 每年的某天，格式 YYYY/MM/DD
        format: date
        title: Days Of Year
        type: string
      interval:
        description: '调度间隔周期[分/小时/天/周/月]'
        title: Interval
        type: integer
      interval_unit:
        $ref: '#/definitions/BackupTimeUnit'
      start_time:
        description: '首次开始时间，格式 [YYYY/MM/DD HH:mm:ss]/[YYYY/MM/DD]'
        title: Start Time
      trigger:
        $ref: '#/definitions/TriggerEnum'
      trigger_action:
        $ref: '#/definitions/TriggerActionEnum'
      window_end:
        description: '时间窗结束时间，格式 HH:mm:ss'
        format: time
        title: Window End
        type: string
      window_start:
        description: '时间窗开始时间，格式[HH:mm:ss]'
        format: time
        title: Window Start
        type: string
    required:
      - trigger
    title: Schedule
    type: object
  ScheduleQuery:
    properties:
      days_of_month:
        description: '每月的某些天，可多选，格式 1-20,21,23'
        pattern: '^\d+(?:-\d+)?(?:,\d+(?:-\d+)?)*$'
        title: Days Of Month
        type: string
      days_of_week:
        description: '每周的周几数据库1,2,3 返回前台格式 List[mon tue wed thu fri sat sun]'
        title: Days Of Week
        type: string
      days_of_year:
        description: 每年的某天，格式 YYYY/MM/DD
        format: date
        title: Days Of Year
        type: string
      interval:
        description: '调度间隔周期[分/小时/天/周/月]'
        title: Interval
        type: integer
      interval_unit:
        $ref: '#/definitions/BackupTimeUnit'
      start_time:
        description: '首次开始时间，格式 [YYYY/MM/DD HH:mm:ss]/[YYYY/MM/DD]'
        title: Start Time
      trigger:
        $ref: '#/definitions/TriggerEnum'
      trigger_action:
        $ref: '#/definitions/TriggerActionEnum'
      window_end:
        description: '时间窗结束时间，格式 HH:mm:ss'
        format: time
        title: Window End
        type: string
      window_start:
        description: '时间窗开始时间，格式[HH:mm:ss]'
        format: time
        title: Window Start
        type: string
    required:
      - trigger
    title: ScheduleQuery
    type: object
  SlaBase:
    properties:
      application:
        $ref: '#/definitions/ResourceSubTypeEnum'
      created_time:
        description: SLA创建时间
        format: date-time
        title: Created Time
        type: string
      name:
        description: SLA名称
        maxLength: 64
        minLength: 1
        pattern: '^[a-zA-Z_\u4e00-\u9fa5]{1}[\u4e00-\u9fa5\w-]*$'
        title: Name
        type: string
      type:
        $ref: '#/definitions/SlaType'
    required:
      - name
      - type
      - application
    title: SlaBase
    type: object
  SlaCreate:
    properties:
      application:
        $ref: '#/definitions/ResourceSubTypeEnum'
      created_time:
        description: SLA创建时间
        format: date-time
        title: Created Time
        type: string
      name:
        description: SLA名称
        maxLength: 64
        minLength: 1
        pattern: '^[a-zA-Z_\u4e00-\u9fa5]{1}[\u4e00-\u9fa5\w-]*$'
        title: Name
        type: string
      policy_list:
        description: SLA对应的策略集合
        items:
          $ref: '#/definitions/Policy'
        maxItems: 16
        minItems: 1
        title: Policy List
        type: array
      type:
        $ref: '#/definitions/SlaType'
      user_id:
        description: 创建SLA的用户
        maxLength: 64
        minLength: 1
        title: User Id
        type: string
    required:
      - name
      - type
      - application
      - policy_list
    title: SlaCreate
    type: object
  SlaId:
    properties:
      uuid:
        description: SLA唯一编码
        format: uuid
        title: Uuid
        type: string
    required:
      - uuid
    title: SlaId
    type: object
  SlaQuery:
    properties:
      application:
        $ref: '#/definitions/ResourceSubTypeEnum'
      archival_count:
        description: SLA关联的归档目标数量
        title: Archival Count
        type: integer
      created_time:
        description: SLA创建时间
        format: date-time
        title: Created Time
        type: string
      is_global:
        description: 是否是预置策略，true-预置策略  false-非预置策略
        title: Is Global
        type: boolean
      name:
        description: SLA名称
        maxLength: 64
        minLength: 1
        pattern: '^[a-zA-Z_\u4e00-\u9fa5]{1}[\u4e00-\u9fa5\w-]*$'
        title: Name
        type: string
      policy_list:
        description: SLA对应的策略集合
        items:
          $ref: '#/definitions/PolicyQuery'
        title: Policy List
        type: array
      replication_count:
        description: SLA关联的复制目标数量
        title: Replication Count
        type: integer
      resource_count:
        description: SLA关联资源的数量
        title: Resource Count
        type: integer
      type:
        $ref: '#/definitions/SlaType'
      uuid:
        description: 唯一编码
        format: uuid
        title: Uuid
        type: string
    required:
      - name
      - type
      - application
      - uuid
      - is_global
      - policy_list
    title: SlaQuery
    type: object
  SlaType:
    description: An enumeration.
    enum:
      - 1
      - 2
    title: SlaType
    type: integer
  SlaUpdate:
    properties:
      application:
        $ref: '#/definitions/ResourceSubTypeEnum'
      created_time:
        description: SLA创建时间
        format: date-time
        title: Created Time
        type: string
      name:
        description: SLA名称
        maxLength: 64
        minLength: 1
        pattern: '^[a-zA-Z_\u4e00-\u9fa5]{1}[\u4e00-\u9fa5\w-]*$'
        title: Name
        type: string
      policy_list:
        description: SLA对应的策略集合
        items:
          $ref: '#/definitions/Policy'
        maxItems: 16
        minItems: 1
        title: Policy List
        type: array
      type:
        $ref: '#/definitions/SlaType'
      user_id:
        description: 创建SLA的用户
        maxLength: 64
        minLength: 1
        title: User Id
        type: string
      uuid:
        description: 唯一编码
        format: uuid
        title: Uuid
        type: string
    required:
      - name
      - type
      - application
      - policy_list
      - uuid
    title: SlaUpdate
    type: object
  TriggerActionEnum:
    description: An enumeration.
    enum:
      - year
      - month
      - week
    title: TriggerActionEnum
    type: string
  TriggerEnum:
    description: An enumeration.
    enum:
      - 1
      - 2
      - 3
      - 4
    title: TriggerEnum
    type: integer
  ValidationError:
    properties:
      loc:
        items:
          type: string
        title: Location
        type: array
      msg:
        title: Message
        type: string
      type:
        title: Error Type
        type: string
    required:
      - loc
      - msg
      - type
    title: ValidationError
    type: object
x-components: {}
