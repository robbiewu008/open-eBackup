swagger: '2.0'
info:
  version: v1
  title: ResourceAccessFramework
basePath: /
tags:
  - name: protected-environment-api
  - name: protected-resource-api
schemes:
  - https
consumes:
  - application/json
produces:
  - application/json
paths:
  '/v2/environments/{envId}/resources':
    get:
      x-dp-admin-role: 'Y'
      x-sysadmin-role: 'Y'
      tags:
        - protected-environment-api
      x-access-port: 25081
      x-auth-required: 'Y'
      x-public-api: 'Y'
      summary: 浏览环境资源
      description: 浏览环境资源，支持HDFS、HBase受保护环境资源的浏览
      operationId: ListEnvironmentResource
      parameters:
        - name: envId
          in: path
          required: true
          type: string
          description: 受保护环境ID
        - name: parentId
          in: query
          required: false
          description: 父资源ID
          type: string
        - name: resourceType
          in: query
          required: true
          description: 资源类型
          type: string
        - name: pageNo
          in: query
          required: true
          description: 起始页
          type: integer
          format: int32
        - name: pageSize
          in: query
          required: true
          description: 分页大小
          type: integer
          format: int32
        - name: X-Auth-Token
          in: header
          required: true
          description: 访问令牌
          type: string
      responses:
        '200':
          description: 环境资源响应体
          schema:
            $ref: '#/definitions/EnvironmentResourceList'
  /v2/resources:
    post:
      tags:
        - protected-resource-api
      x-access-port: 25081
      x-auth-required: 'Y'
      x-public-api: 'Y'
      summary: 创建资源
      description: 创建资源
      operationId: CreateResource
      parameters:
        - name: CreateResourceRequestBody
          in: body
          required: true
          schema:
            $ref: '#/definitions/ProtectedResourceRequest'
          description: 创建资源的请求体
      responses:
        '200':
          description: 资源UUID
          schema:
            type: array
            items:
              type: string
    get:
      x-access-port: 25081
      x-auth-required: 'Y'
      x-public-api: 'Y'
      tags:
        - protected-resource-api
      summary: 支持资源分页查询，支持资源属性、环境属性、受保护对象属性的过滤查询
      description: 资源分页查询。
      operationId: ListResources
      parameters:
        - name: pageNo
          in: query
          required: false
          type: integer
          format: int32
          default: 0
          x-access-port: 25081
          x-auth-required: 'Y'
          x-public-api: 'Y'
          description: 页索引
        - name: pageSize
          in: query
          required: false
          type: integer
          format: int32
          default: 10
          x-access-port: 25081
          x-auth-required: 'Y'
          x-public-api: 'Y'
          description: 页大小
        - name: conditions
          in: query
          required: false
          type: string
          default: '{}'
          x-access-port: 25081
          x-auth-required: 'Y'
          x-public-api: 'Y'
          description: 查询条件(json格式)
        - name: orders
          in: query
          required: false
          type: array
          default: '[]'
          items:
            type: string
          x-access-port: 25081
          x-auth-required: 'Y'
          x-public-api: 'Y'
          description: 排序字段（格式：升序为+field，降序为-field）
      responses:
        '200':
          description: 分页查询结果
          schema:
            $ref: '#/definitions/ProtectedResourcePageListResponse'
  /v2/environments:
    post:
      x-request-examples-url-2: 'POST https://host:25080/v2/environments'
      x-request-examples-description-2: 注册Nas设备
      x-request-examples-text-2: >-
        {

        "name":"DoradoV6_001",

        "type":"StorageEquipment",

        "subType":"DoradoV6",  //
        设备类型：DoradoV6、OceanStorV6、OceanStorV5、OceanStorPacific、NetApp、StorageOthers

        "endpoint":"8.40.101.37", // 设备管理ip

        "port":"8088", // 设备端口

        "username":"string", // 用户名

        "password":"string",// 密码

        "extendInfo":{

        "verifyStatus":"1", // 是否校验证书：0-不校验，1-校验

        "snapConsistency":"0" // 是否开启快照一致性：0-不打开，1-打开

        }}
      x-request-examples-2: >-
        {

        "name":"DoradoV6_001",

        "type":"StorageEquipment",

        "subType":"DoradoV6",  //
        设备类型：DoradoV6、OceanStorV6、OceanStorV5、OceanStorPacific、NetApp、StorageOthers

        "endpoint":"8.40.101.37", // 设备管理ip

        "port":"8088", // 设备端口

        "username":"string", // 用户名

        "password":"string",// 密码

        "extendInfo":{

        "verifyStatus":"1", // 是否校验证书：0-不校验，1-校验

        "snapConsistency":"0" // 是否开启快照一致性：0-不打开，1-打开

        }}
      x-request-examples-text-1: |-
        {
          "name": "HDFS_Cluster",
          "type": "BigData",
          "endpoint": "192.168.0.1",
          "subType": "HDFS",
          "port": 8888,
          "extendInfo": {
            "loginMode": "string",//环境的鉴权方式，取值：loginWithPassword|loginWithNoAuth|loginWithKerberos
            "kerberosId": "string",//环境鉴权使用的kerberosid
            "accessType": "string",//环境访问方式（ip或域名），取值：ip|domain
            "clusterType": "string"// 环境集群类型，取值：MRS|CDH|FusionInsight
          }
        }
      x-request-examples-1: |-
        {
          "name": "HDFS_Cluster",
          "type": "BigData",
          "endpoint": "192.168.0.1",
          "subType": "HDFS",
          "port": 8888,
          "extendInfo": {
            "loginMode": "string",//环境的鉴权方式，取值：loginWithPassword|loginWithNoAuth|loginWithKerberos
            "kerberosId": "string",//环境鉴权使用的kerberosid
            "accessType": "string",//环境访问方式（ip或域名），取值：ip|domain
            "clusterType": "string"// 环境集群类型，取值：MRS|CDH|FusionInsight
          }
        }
      x-request-examples-url-1: 'POST https://host:25801/v2/environments'
      x-request-examples-description-1: 注册HDFS集群
      x-dp-admin-role: 'Y'
      x-sysadmin-role: 'Y'
      tags:
        - protected-environment-api
      summary: 注册环境
      x-access-port: 25081
      x-auth-required: 'Y'
      x-public-api: 'Y'
      description: 注册受保护环境，支持HDFS、HBase，NAS受保护环境的注册
      operationId: RegisterProtectedEnviroment
      consumes:
        - application/x-www-form-urlencoded
      parameters:
        - name: RegisterProtectedEnviromentRequestBody
          in: body
          required: true
          description: 环境名称
          schema:
            $ref: '#/definitions/RegisterProtectedEnvironmentRequest'
          x-access-port: 25081
          x-auth-required: 'Y'
          x-public-api: 'Y'
        - name: X-Auth-Token
          in: header
          required: true
          description: 访问令牌
          type: string
      responses:
        '200':
          description: ''
          schema:
            type: string
          examples:
            application/json: ''
  '/v2/resources/{resourceId}':
    get:
      x-access-port: 25081
      x-auth-required: 'Y'
      x-public-api: 'Y'
      tags:
        - protected-resource-api
      summary: 根据资源ID查询资源信息
      description: 查询单个资源信息
      operationId: ShowResource
      parameters:
        - name: resourceId
          in: path
          required: true
          type: string
          description: 资源ID
      responses:
        '200':
          description: 资源信息
          schema:
            $ref: '#/definitions/ProtectedResourceResponse'
    delete:
      x-access-port: 25081
      x-auth-required: 'Y'
      x-public-api: 'Y'
      tags:
        - protected-resource-api
      summary: 删除资源ID对应的资源
      description: 删除资源ID对应的资源，资源已关联SLA的情况下，不允许删除
      operationId: DeleteResource
      parameters:
        - name: resourceId
          in: path
          required: true
          type: string
          description: 资源ID
      responses:
        '200':
          description: 操作成功无返回结果，操作失败异常报错。
    put:
      x-access-port: 25081
      x-auth-required: 'Y'
      x-public-api: 'Y'
      tags:
        - protected-resource-api
      summary: 更新资源
      description: 更新资源
      operationId: UpdateResource
      parameters:
        - name: resourceId
          in: path
          required: true
          type: string
          description: 资源ID
        - name: UpdateResourceRequestBody
          in: body
          required: true
          description: 资源信息
          schema:
            $ref: '#/definitions/ProtectedResourceUpdateRequest'
      responses:
        '200':
          description: 操作成功无返回结果，操作失败异常报错。
  '/v2/environments/{envId}':
    put:
      x-dp-admin-role: 'Y'
      x-sysadmin-role: 'Y'
      x-access-port: 25081
      x-auth-required: 'Y'
      x-public-api: 'Y'
      tags:
        - protected-environment-api
      summary: 更新受保护环境
      description: 更新受保护环境，支持HDFS、HBase，NAS受保护环境的更新
      operationId: UpdateProtectedEnvironment
      parameters:
        - name: envId
          in: path
          required: true
          type: string
          description: 受保护环境ID
        - name: UpdateProtectedEnvironmentRequestBody
          in: body
          required: true
          description: 更新受保护环境请求体
          schema:
            $ref: '#/definitions/UpdateEnvironmentRequest'
        - name: X-Auth-Token
          in: header
          required: true
          description: 访问令牌
          type: string
      responses:
        '200':
          description: ''
          schema:
            type: string
    delete:
      x-access-port: 25081
      x-auth-required: 'Y'
      x-public-api: 'Y'
      x-dp-admin-role: 'Y'
      x-sysadmin-role: 'Y'
      tags:
        - protected-environment-api
      summary: 删除受保护环境
      description: 删除受保护环境，支持HDFS、HBase，NAS受保护环境的删除
      operationId: DeleteProtectedEnvironment
      parameters:
        - name: envId
          in: path
          required: true
          type: string
          description: 受保护环境ID
        - name: X-Auth-Token
          in: header
          required: true
          description: 访问令牌
          type: string
      responses:
        '200':
          description: ''
          schema:
            type: string
  '/v2/{resourceId}/authentication':
    get:
      x-access-port: 25082
      x-auth-required: 'Y'
      x-public-api: 'Y'
      tags:
        - protected-resource-api
      summary: 更新资源认证信息
      description: 更新资源认证信息
      operationId: UpdateAuthentication
      parameters:
        - name: resourceId
          in: path
          required: true
          type: string
          description: 资源ID
        - name: updateAuthenticationRequestBody
          in: body
          required: true
          description: 认证信息更新请求
          schema:
            $ref: '#/definitions/Authentication'
      responses:
        '200':
          description: '--'
  '/v2/environments/{envId}/authentication':
    put:
      x-access-port: 25081
      x-auth-required: 'Y'
      x-public-api: 'Y'
      x-dp-admin-role: 'Y'
      x-sysadmin-role: 'Y'
      tags:
        - protected-environment-api
      summary: 更新环境认证信息
      description: 更新环境认证信息
      operationId: UpdateEnvironmentAuthentication
      parameters:
        - name: envId
          in: path
          required: true
          type: string
          description: 受保护环境ID
        - name: UpdateEnvironmentAuthenticationRequestBody
          in: body
          required: true
          description: 认证信息
          schema:
            $ref: '#/definitions/Authentication'
        - name: X-Auth-Token
          in: header
          required: true
          description: 访问令牌
          type: string
      responses:
        '200':
          description: ''
          schema:
            type: string
definitions:
  ProtectedEnvironmentRequest:
    description: 受保护对象请求体
    properties:
      uuid:
        type: string
        description: 受保护环境UUID
      name:
        type: string
        description: 受保护环境名称
        minLength: 1
        maxLength: 64
        x-access-port: 25081
        x-auth-required: 'Y'
        x-public-api: 'Y'
      type:
        type: string
        description: 环境的类型
      endpoint:
        type: string
        description: 环境的IP地址或域名
      subType:
        type: string
        description: 环境的子类型
      port:
        type: integer
        format: int32
        description: 环境的接入端口
      username:
        type: string
        description: 环境的用户名
      password:
        type: string
        description: 环境的密码
      osType:
        type: string
        description: 环境的操作系统
      version:
        type: string
        description: 环境的版本
      extendInfo:
        type: object
        additionalProperties:
          type: string
        description: 环境扩展参数，存放不同环境的自定义扩展属性
      auth:
        $ref: '#/definitions/Authentication'
    required:
      - name
      - type
      - subType
  ProtectedResourceResponse:
    description: 创建资源请求体
    properties:
      uuid:
        type: string
        description: 资源uuid
      name:
        type: string
        description: 资源名称
        minLength: 1
        maxLength: 64
        x-access-port: 25081
        x-auth-required: 'Y'
        x-public-api: 'Y'
      type:
        type: string
        description: 资源主类型
      subType:
        type: string
        description: 资源子类型
      path:
        type: string
        description: 资源路径
      rootUuid:
        type: string
        description: 资源所属根资源uuid，即环境的uuid
      parentUuid:
        type: string
        description: 父资源ID
      extendInfo:
        type: object
        additionalProperties:
          type: string
        description: 资源扩展属性
      createdTime:
        type: string
        format: date-time
        description: 资源创建时间
      version:
        type: string
        description: 资源的版本
      parentName:
        type: string
        description: 父资源名称
      userId:
        type: string
        description: 资源所属用户ID
      authorizedUser:
        type: string
        description: 资源所属用户名称
      sla:
        $ref: '#/definitions/ProtectedObject'
      environment:
        $ref: '#/definitions/ProtectedEnvironment'
      auth:
        $ref: '#/definitions/AuthType'
    required:
      - name
      - type
      - subType
      - rootUuid
  EnvironmentResourceList:
    description: 环境资源列表
    properties:
      totalCount:
        type: integer
        format: int32
        description: 总记录数
      records:
        items:
          $ref: '#/definitions/BaseProtectedResource'
        description: 创建资源请求体
        type: array
  ProtectedObject:
    properties:
      slaId:
        type: string
        description: SLA的ID
      slaName:
        type: string
        description: SLA的名称
      slaCompliance:
        type: boolean
        description: SLA遵从度
      status:
        type: integer
        format: int32
        description: 状态
    required:
      - slaId
      - slaName
      - slaCompliance
      - status
  ProtectedEnvironment:
    properties:
      endpoint:
        type: string
        description: 环境地址
      port:
        type: integer
        format: int32
        description: 环境端口
      linkStatus:
        type: string
        description: 连接状态
      userName:
        type: string
        description: 用户名
      location:
        type: string
        description: 位置
      osType:
        type: string
        description: 操作系统类型
      osName:
        type: string
        description: 操作系统名称
      scanInterval:
        type: string
        description: 扫描间隔时间
  ProtectedResourcePageListResponse:
    properties:
      totalCount:
        type: integer
        format: int32
        description: 满足分页查询条件的统计数量
      records:
        type: array
        items:
          $ref: '#/definitions/ProtectedResourceResponse'
        description: 当前分页的查询记录
  ProtectedResourceRequest:
    description: 创建资源请求体
    properties:
      uuid:
        type: string
        description: 资源uuid
      name:
        type: string
        description: 资源名称
        minLength: 1
        maxLength: 64
        x-access-port: 25081
        x-auth-required: 'Y'
        x-public-api: 'Y'
      type:
        type: string
        description: 资源主类型
      subType:
        type: string
        description: 资源子类型
      path:
        type: string
        description: 资源路径
      rootUuid:
        type: string
        description: 资源所属根资源uuid，即环境的uuid
      parentUuid:
        type: string
        description: 父资源ID
      extendInfo:
        type: object
        additionalProperties:
          type: string
        description: 资源扩展属性
      version:
        type: string
        description: 资源的版本
      auth:
        $ref: '#/definitions/Authentication'
    required:
      - name
      - type
      - subType
      - rootUuid
  BaseProtectedResource:
    description: 创建资源请求体
    properties:
      uuid:
        type: string
        description: 资源uuid
      name:
        type: string
        description: 资源名称
        minLength: 1
        maxLength: 64
        x-access-port: 25081
        x-auth-required: 'Y'
        x-public-api: 'Y'
      type:
        type: string
        description: 资源主类型
      subType:
        type: string
        description: 资源子类型
      path:
        type: string
        description: 资源路径
      rootUuid:
        type: string
        description: 资源所属根资源uuid，即环境的uuid
      parentUuid:
        type: string
        description: 父资源ID
      extendInfo:
        type: object
        additionalProperties:
          type: string
        description: 资源扩展属性
      createdTime:
        type: string
        format: date-time
        description: 资源创建时间
      parentName:
        type: string
        description: 父资源名称
    required:
      - name
      - type
      - subType
      - rootUuid
  ProtectedResourceUpdateRequest:
    properties:
      name:
        type: string
        description: 资源名称
      extendInfo:
        type: object
        additionalProperties:
          type: string
        description: 扩展属性
  Authentication:
    description: 认证信息
    allOf:
      - $ref: '#/definitions/AuthType'
      - type: object
        properties:
          authKey:
            type: string
            description: 使用用户名密码认证时该字段填用户名，使用AK/SK认证时该字段填充AK
          authPwd:
            type: string
            description: 使用用户名密码认证时该字段填密码，使用AK/SK认证时该字段填充SK
          extendInfo:
            type: object
            additionalProperties:
              type: string
            description: 认证扩展信息，使用其他方式认证时，认证信息放在扩展该字段里
  AuthType:
    description: 认证类型
    required:
      - authType
    properties:
      authType:
        type: integer
        format: int32
        description: >-
          0-NO_AUTH, 1-OS_PASSWORD, 2-APP_PASSWORD，3-LADP, 4-AKSK, 5-KERBEROS,
          6-TOKEN, 7-OAUTH2, 8-OTHER。1到3,authKey填用户名,authPwd填密码， 4 authKey填AK，
          authPwd填SK, 5,6,7,8认证认证信息在扩展字段中扩充。
  RegisterProtectedEnvironmentRequest:
    description: 受保护对象请求体
    properties:
      name:
        type: string
        description: 受保护环境名称
        minLength: 1
        maxLength: 64
        x-access-port: 25081
        x-auth-required: 'Y'
        x-public-api: 'Y'
      type:
        type: string
        description: 环境的类型
      endpoint:
        type: string
        description: 环境的IP地址或域名
      subType:
        type: string
        description: 环境的子类型
      port:
        type: integer
        format: int32
        description: 环境的接入端口
      username:
        type: string
        description: 环境的用户名
      password:
        type: string
        description: 环境的密码
      osType:
        type: string
        description: 环境的操作系统
      version:
        type: string
        description: 环境的版本
      extendInfo:
        type: object
        additionalProperties:
          type: string
        description: 环境扩展参数，存放不同环境的自定义扩展属性
      auth:
        $ref: '#/definitions/Authentication'
    required:
      - name
      - type
      - subType
  UpdateEnvironmentRequest:
    description: 受保护对象请求体
    properties:
      name:
        type: string
        description: 受保护环境名称
        minLength: 1
        maxLength: 64
        x-access-port: 25081
        x-auth-required: 'Y'
        x-public-api: 'Y'
      endpoint:
        type: string
        description: 环境的IP地址或域名
      port:
        type: integer
        format: int32
        description: 环境的接入端口
      username:
        type: string
        description: 环境的用户名
      password:
        type: string
        description: 环境的密码
      osType:
        type: string
        description: 环境的操作系统
      extendInfo:
        type: object
        additionalProperties:
          type: string
        description: 环境扩展参数，存放不同环境的自定义扩展属性
